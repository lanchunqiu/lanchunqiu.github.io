<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¸€ä¸ªäºŒå‰æ ‘</title>
      <link href="/2019/03/23/SerializeAndDeserializeBinaryTree/"/>
      <url>/2019/03/23/SerializeAndDeserializeBinaryTree/</url>
      
        <content type="html"><![CDATA[<h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>åºåˆ—åŒ–æ˜¯å°†ä¸€ä¸ªæ•°æ®ç»“æ„æˆ–è€…å¯¹è±¡è½¬æ¢ä¸ºè¿ç»­çš„æ¯”ç‰¹ä½çš„æ“ä½œï¼Œè¿›è€Œå¯ä»¥å°†è½¬æ¢åçš„æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶æˆ–è€…å†…å­˜ä¸­ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ç½‘ç»œä¼ è¾“åˆ°å¦ä¸€ä¸ªè®¡ç®—æœºç¯å¢ƒï¼Œé‡‡å–ç›¸åæ–¹å¼é‡æ„å¾—åˆ°åŸæ•°æ®ã€‚</p><p>è¯·è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥å®ç°äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚è¿™é‡Œä¸é™å®šä½ çš„åºåˆ— / ååºåˆ—åŒ–ç®—æ³•æ‰§è¡Œé€»è¾‘ï¼Œä½ åªéœ€è¦ä¿è¯ä¸€ä¸ªäºŒå‰æ ‘å¯ä»¥è¢«åºåˆ—åŒ–ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²å¹¶ä¸”å°†è¿™ä¸ªå­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºåŸå§‹çš„æ ‘ç»“æ„ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><pre><code>ä½ å¯ä»¥å°†ä»¥ä¸‹äºŒå‰æ ‘ï¼š    1   / \  2   3     / \    4   5åºåˆ—åŒ–ä¸º &quot;[1,2,3,null,null,4,5]&quot;</code></pre><p><strong>æç¤º:</strong> è¿™ä¸ LeetCode ç›®å‰ä½¿ç”¨çš„æ–¹å¼ä¸€è‡´ï¼Œè¯¦æƒ…è¯·å‚é˜… <a href="https://leetcode-cn.com/faq/#binary-tree" target="_blank" rel="noopener">LeetCode åºåˆ—åŒ–äºŒå‰æ ‘çš„æ ¼å¼</a>ã€‚ä½ å¹¶éå¿…é¡»é‡‡å–è¿™ç§æ–¹å¼ï¼Œä½ ä¹Ÿå¯ä»¥é‡‡ç”¨å…¶ä»–çš„æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p><strong>è¯´æ˜:</strong> ä¸è¦ä½¿ç”¨ç±»çš„æˆå‘˜ / å…¨å±€ / é™æ€å˜é‡æ¥å­˜å‚¨çŠ¶æ€ï¼Œä½ çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç®—æ³•åº”è¯¥æ˜¯æ— çŠ¶æ€çš„ã€‚</p><h2 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p>é€šè¿‡äºŒå‰æ ‘å…ˆåºéå†å®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼šé€šè¿‡å…ˆåºéå†æŠŠäºŒå‰æ ‘è¾“å‡ºä¸ºæŒ‡å®šæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚</p><p>å…·ä½“çš„åºåˆ—åŒ–æ­¥éª¤ä¸ºï¼šåˆè¯†æ—¶treeStr=â€â€ï¼Œå…ˆåºéå†äºŒå‰æ ‘ï¼Œé‡åˆ°èŠ‚ç‚¹ä¸ºnullæ—¶ï¼Œå°±æ‹¼ä¸Šå­—ç¬¦<code>#</code>ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¹‹é—´ä½¿ç”¨å­—ç¬¦<code>!</code>æ¥åˆ†å‰²ï¼Œç¤ºä¾‹ä¸­çš„äºŒå‰æ ‘çš„åºåˆ—åŒ–ç»“æœä¸º<code>1!2!#!#!3!4!#!#!5!#!#!</code>ã€‚</p><p>äºŒå‰æ ‘çš„èŠ‚ç‚¹ç»“æ„</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TreeNode</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>    T data<span class="token punctuation">;</span>    TreeNode left<span class="token punctuation">;</span>    TreeNode right<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">TreeNode</span><span class="token punctuation">(</span>T data<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">=</span> null<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">=</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>äºŒå‰æ ‘çš„åºåˆ—åŒ–</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// åºåˆ—åŒ–</span><span class="token keyword">public</span> String <span class="token function">serialize</span><span class="token punctuation">(</span>TreeNode root<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">final</span> String split <span class="token operator">=</span> <span class="token string">"!"</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> String emptyNode <span class="token operator">=</span> <span class="token string">"#"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>root <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> emptyNode <span class="token operator">+</span> split<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// å…ˆåºéå†ï¼ˆé€’å½’ï¼‰</span>    StringBuilder treeStr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    treeStr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>split<span class="token punctuation">)</span><span class="token punctuation">;</span>    treeStr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    treeStr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> treeStr<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>äºŒå‰æ ‘çš„ååºåˆ—åŒ–</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// ååºåˆ—åŒ–</span><span class="token keyword">public</span> TreeNode <span class="token function">deserialize</span><span class="token punctuation">(</span>String data<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">final</span> String split <span class="token operator">=</span> <span class="token string">"!"</span><span class="token punctuation">;</span>    String<span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>split<span class="token punctuation">)</span><span class="token punctuation">;</span>    Queue<span class="token operator">&lt;</span>String<span class="token operator">></span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayDeque</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>a<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// é€’å½’æ„å»ºäºŒå‰æ ‘</span>    <span class="token keyword">return</span> <span class="token function">buildBinaryTree</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">private</span> TreeNode <span class="token function">buildBinaryTree</span><span class="token punctuation">(</span>Queue<span class="token operator">&lt;</span>String<span class="token operator">></span> queue<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">final</span> String emptyNode <span class="token operator">=</span> <span class="token string">"#"</span><span class="token punctuation">;</span>    String value <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    TreeNode node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>    node<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token function">buildBinaryTree</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">;</span>    node<span class="token punctuation">.</span>right<span class="token operator">=</span> <span class="token function">buildBinaryTree</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> node<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æµ‹è¯•</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * äºŒå‰æ ‘çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ– */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Codec</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        TreeNode node1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        TreeNode node2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        TreeNode node3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        TreeNode node4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        TreeNode node5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        node1<span class="token punctuation">.</span>left <span class="token operator">=</span> node2<span class="token punctuation">;</span>        node1<span class="token punctuation">.</span>right <span class="token operator">=</span> node3<span class="token punctuation">;</span>        node3<span class="token punctuation">.</span>left <span class="token operator">=</span> node4<span class="token punctuation">;</span>        node3<span class="token punctuation">.</span>right <span class="token operator">=</span> node5<span class="token punctuation">;</span>        Codec test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Codec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        String treeStr <span class="token operator">=</span> test<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span>node1<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>treeStr<span class="token punctuation">)</span><span class="token punctuation">;</span>        TreeNode head <span class="token operator">=</span> test<span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span>treeStr<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// åºåˆ—åŒ–</span>    <span class="token keyword">public</span> String <span class="token function">serialize</span><span class="token punctuation">(</span>TreeNode root<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">final</span> String split <span class="token operator">=</span> <span class="token string">"!"</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> String emptyNode <span class="token operator">=</span> <span class="token string">"#"</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>root <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> emptyNode <span class="token operator">+</span> split<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// å…ˆåºéå†ï¼ˆé€’å½’ï¼‰</span>        StringBuilder treeStr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        treeStr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>split<span class="token punctuation">)</span><span class="token punctuation">;</span>        treeStr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        treeStr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> treeStr<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// ååºåˆ—åŒ–</span>    <span class="token keyword">public</span> TreeNode <span class="token function">deserialize</span><span class="token punctuation">(</span>String data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">final</span> String split <span class="token operator">=</span> <span class="token string">"!"</span><span class="token punctuation">;</span>        String<span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>split<span class="token punctuation">)</span><span class="token punctuation">;</span>        Queue<span class="token operator">&lt;</span>String<span class="token operator">></span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayDeque</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>a<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// é€’å½’æ„å»ºäºŒå‰æ ‘</span>        <span class="token keyword">return</span> <span class="token function">buildBinaryTree</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> TreeNode <span class="token function">buildBinaryTree</span><span class="token punctuation">(</span>Queue<span class="token operator">&lt;</span>String<span class="token operator">></span> queue<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">final</span> String emptyNode <span class="token operator">=</span> <span class="token string">"#"</span><span class="token punctuation">;</span>        String value <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> null<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        TreeNode node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>        node<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token function">buildBinaryTree</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">;</span>        node<span class="token punctuation">.</span>right<span class="token operator">=</span> <span class="token function">buildBinaryTree</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> node<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼š<span class="token number">1</span><span class="token operator">!</span><span class="token number">2</span><span class="token operator">!</span>#<span class="token operator">!</span>#<span class="token operator">!</span><span class="token number">3</span><span class="token operator">!</span><span class="token number">4</span><span class="token operator">!</span>#<span class="token operator">!</span>#<span class="token operator">!</span><span class="token number">5</span><span class="token operator">!</span>#<span class="token operator">!</span>#<span class="token operator">!</span><span class="token number">1</span><span class="token operator">!</span><span class="token number">2</span><span class="token operator">!</span>#<span class="token operator">!</span>#<span class="token operator">!</span><span class="token number">3</span><span class="token operator">!</span><span class="token number">4</span><span class="token operator">!</span>#<span class="token operator">!</span>#<span class="token operator">!</span><span class="token number">5</span><span class="token operator">!</span>#<span class="token operator">!</span>#<span class="token operator">!</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> äºŒå‰æ ‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> LeetCode </tag>
            
            <tag> äºŒå‰æ ‘ </tag>
            
            <tag> åºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rediså®æˆ˜</title>
      <link href="/2019/03/20/RedisInAction/"/>
      <url>/2019/03/20/RedisInAction/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆè¯†Redis"><a href="#åˆè¯†Redis" class="headerlink" title="åˆè¯†Redis"></a>åˆè¯†Redis</h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œç¼“å­˜å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p><ul><li>åº”ç”¨å†…ç¼“å­˜ï¼Œæ¯”å¦‚Javaçš„Mapã€Setç­‰ç®€å•æ•°æ®ç»“æ„ï¼Œä»¥åŠEhcacheç­‰ä¸‰æ–¹åº“ï¼›</li><li>ç‹¬ç«‹çš„ç¼“å­˜æœåŠ¡ï¼ˆç»„ä»¶ï¼‰ï¼Œæ¯”å¦‚Memcachedã€Redisï¼›</li></ul><p>Redisï¼ˆRemote Dictionary Serverï¼‰è¿œç¨‹å­—å…¸æœåŠ¡å™¨ï¼Œå®ƒæ˜¯ä¸€ç§åŸºäºkey-valueçš„é«˜æ€§èƒ½çš„å­˜å‚¨ç³»ç»Ÿï¼Œå®ƒæä¾›äº†5ç§é”®å€¼æ•°æ®ç±»å‹æ¥é€‚åº”ä¸åŒåœºæ™¯ä¸‹çš„ç¼“å­˜ä¸å­˜å‚¨éœ€æ±‚ã€‚Redisæ˜¯ä¸€ç§é€Ÿåº¦éå¸¸å¿«çš„éå…³ç³»æ•°æ®åº“ï¼Œå®ƒé™¤äº†æ€§èƒ½å¼ºåŠ²ä¹‹å¤–è¿˜å…·æœ‰å¤åˆ¶ã€æŒä¹…åŒ–ã€åˆ†ç‰‡ã€äº‹ç‰©ç­‰ç‰¹æ€§ï¼Œç”¨æˆ·å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°†Redisæ‰©å±•æˆä¸€ä¸ªèƒ½å¤ŸåŒ…å«æ•°ç™¾Gæ•°æ®ã€æ¯ç§’å¤„ç†ä¸Šç™¾ä¸‡æ¬¡è¯·æ±‚çš„ç³»ç»Ÿã€‚</p><p>å¦‚ä¸‹è¡¨Rediså’Œå…¶ä»–ä¸€äº›éå…³ç³»æ•°æ®åº“çš„æ¯”è¾ƒã€‚</p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>æ•°æ®å­˜å‚¨</th><th>ç‰¹æ€§</th></tr></thead><tbody><tr><td>Redis</td><td>å†…å­˜å­˜å‚¨éå…³ç³»é”®å€¼æ•°æ®åº“</td><td>å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€æ•£åˆ—ã€é›†åˆã€æœ‰åºé›†åˆ</td><td>ä¸»ä»å¤åˆ¶ã€æŒä¹…åŒ–ã€åˆ†ç‰‡ã€å‘å¸ƒä¸è®¢é˜…ï¼ŒLuaè„šæœ¬</td></tr><tr><td>Memcached</td><td>å†…å­˜å­˜å‚¨é”®å€¼ç¼“å­˜</td><td>é”®å€¼å…³ç³»æ˜ å°„</td><td></td></tr><tr><td>MongoDB</td><td>ç¡¬ç›˜å­˜å‚¨éå…³ç³»æ–‡æ¡£å‹æ•°æ®åº“</td><td>BSONæ–‡æ¡£ï¼ˆç±»ä¼¼jsonæ ¼å¼ï¼‰</td><td>æ”¯æŒMap-Reduceæ“ä½œã€ä¸»ä»å¤åˆ¶ã€åˆ†ç‰‡ã€ç©ºé—´ç´¢å¼•</td></tr></tbody></table><h2 id="Redisçš„å®‰è£…"><a href="#Redisçš„å®‰è£…" class="headerlink" title="Redisçš„å®‰è£…"></a>Redisçš„å®‰è£…</h2><p>Redisçº¦å®šæ¬¡ç‰ˆæœ¬å·ï¼ˆç¬¬ä¸€ä¸ªå°æ•°ç‚¹åçš„æ•°å­—ï¼‰ä¸ºå¶æ•°æ˜¯ç¨³å®šç‰ˆæœ¬ï¼Œä¾‹å¦‚2.8ã€3.0ã€3.2ï¼Œæ¬¡ç‰ˆæœ¬å·ä¸ºåŸºæ•°æ—¶æ˜¯éç¨³å®šç‰ˆæœ¬ã€‚</p><h3 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h3><ol><li>ä¸‹è½½Rediså®‰è£…åŒ…ï¼Œ<a href="http://download.redis.io/releases/" target="_blank" rel="noopener">http://download.redis.io/releases/</a></li><li>tar -zxvfè§£å‹å®‰è£…åŒ…;</li><li>cdåˆ°è§£å‹åçš„ç›®å½•;</li><li>æ‰§è¡Œmakeç¼–è¯‘;</li><li>æµ‹è¯•ç¼–è¯‘çŠ¶æ€ï¼Œ make test;</li><li>make install {prefix=/path/â€¦/â€¦}  å®‰è£…;</li></ol><h3 id="å¯åŠ¨å’Œåœæ­¢"><a href="#å¯åŠ¨å’Œåœæ­¢" class="headerlink" title="å¯åŠ¨å’Œåœæ­¢"></a>å¯åŠ¨å’Œåœæ­¢</h3><p>Rediså®‰è£…å®Œæˆä¹‹åï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€äº›å¯æ‰§è¡Œæ–‡ä»¶ï¼š</p><ul><li><p><strong>redis-server</strong>ï¼šredisæœåŠ¡ç«¯</p></li><li><p><strong>redis-cli</strong>ï¼šrediså‘½ä»¤è¡Œå®¢æˆ·ç«¯</p></li><li><p><strong>redis-sentinel</strong>ï¼šsentinelæœåŠ¡ï¼ˆ2.8ä»¥åï¼‰</p></li><li><p><strong>redis-check-rdb</strong>ï¼šrdbæ–‡ä»¶æ£€æŸ¥å·¥å…·</p></li><li><p><strong>redis-check-aof</strong>ï¼šaofæ–‡ä»¶ä¿®å¤å·¥å…·</p></li><li><p><strong>redis-benchmark</strong>ï¼šredisæ€§èƒ½æµ‹è¯•å·¥å…·</p></li></ul><p>å¸¸ç”¨çš„å‘½ä»¤æ˜¯redis-serverå’Œredis-cli</p><p>1.å¯åŠ¨æœåŠ¡</p><pre><code>redis-server /path/redis.conf</code></pre><p>æœåŠ¡å™¨å¯åŠ¨åé»˜è®¤ç«¯å£æ˜¯6379ï¼Œå¯ä»¥â€“portè‡ªå®šä¹‰ç«¯å£ã€‚ï¼ˆ6379åœ¨æ‰‹æœºé”®ç›˜ä¸Šä¸MERZå¯¹åº”ï¼ŒMERZæ˜¯ä¸€åæ„å¤§åˆ©æ­Œå¥³çš„åå­—ï¼‰å¦‚æœæƒ³ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼å¯åŠ¨ï¼Œéœ€è¦ä¿®æ”¹redis.confé…ç½®æ–‡ä»¶ï¼ŒæŠŠdaemonizeè®¾ç½®ä¸ºyesã€‚</p><p>2.åœæ­¢æœåŠ¡</p><pre><code>redis-cli shutdown</code></pre><p>è€ƒè™‘åˆ°RedisæœåŠ¡æœ‰å¯èƒ½æ­£åœ¨å°†å†…å­˜çš„æ•°æ®åŒæ­¥åˆ°ç£ç›˜ä¸­ï¼Œå¼ºè¡Œç»ˆæ­¢Redisè¿›ç¨‹å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œæ­£ç¡®åœæ­¢Redisçš„æ–¹å¼æ˜¯å‘Rediså‘é€shutdownå‘½ä»¤ã€‚å½“RedisæœåŠ¡æ”¶åˆ°shutdownå‘½ä»¤åï¼Œä¼šå…ˆæ–­å¼€æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œç„¶åæ ¹æ®é…ç½®è¿›è¡ŒæŒä¹…åŒ–ï¼Œæœ€ç»ˆå®Œæˆé€€å‡ºã€‚</p><h2 id="æ•°æ®ç»“æ„ç±»å‹"><a href="#æ•°æ®ç»“æ„ç±»å‹" class="headerlink" title="æ•°æ®ç»“æ„ç±»å‹"></a>æ•°æ®ç»“æ„ç±»å‹</h2><p>Rediså¯ä»¥å­˜å‚¨é”®ä¸5ç§ä¸åŒæ•°æ®ç»“æ„ç±»å‹ä¹‹é—´çš„æ˜ å°„ï¼Œè¿™5ç§æ•°æ®ç»“æ„ç±»å‹åˆ†åˆ«ä¸ºå­—ç¬¦ä¸²ï¼ˆstringï¼‰ï¼Œåˆ—è¡¨ï¼ˆlistï¼‰ï¼Œé›†åˆï¼ˆsetï¼‰ï¼Œæœ‰åºé›†åˆï¼ˆzsetï¼‰ï¼Œå“ˆå¸Œï¼ˆhashï¼‰ã€‚</p><p><strong>Redisæä¾›çš„5ç§æ•°æ®ç»“æ„ç±»å‹</strong></p><table><thead><tr><th>ç»“æ„ç±»å‹</th><th>ç»“æ„å­˜å‚¨çš„å€¼</th><th>ç»“æ„çš„è¯»å†™èƒ½åŠ›</th></tr></thead><tbody><tr><td>STRING</td><td>å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–æµ®ç‚¹æ•°</td><td>å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†æ”¯çº¿æ“ä½œï¼›å¯¹æ•´æ•°å’Œæµ®ç‚¹æ•°æ‰§è¡Œè‡ªå¢ï¼ˆincrementï¼‰æˆ–è‡ªå‡ï¼ˆdecrementï¼‰æ“ä½œ</td></tr><tr><td>LIST</td><td>ä¸€ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«äº†ä¸€ä¸ªå­—ç¬¦ä¸²</td><td>ä»é“¾è¡¨çš„ä¸¤ç«¯æ¨å…¥æˆ–è€…å¼¹å‡ºå…ƒç´ ï¼›æ ¹æ®åç§»é‡å¯¹é“¾è¡¨è¿›è¡Œä¿®å‰ª(trim)ï¼›è¯»å–å•ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ ï¼›æ ¹æ®å€¼æŸ¥æ‰¾æˆ–è€…ç§»é™¤å…ƒç´ </td></tr><tr><td>SET</td><td>åŒ…å«å­—ç¬¦ä¸²çš„æ— åºæ”¶é›†å™¨ï¼Œå¹¶ä¸”è¢«å­—ç¬¦ä¸²ä¸èƒ½é‡å¤ï¼Œå„ä¸ç›¸åŒ</td><td>æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªå…ƒç´ ï¼›æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­ï¼›è®¡ç®—äº¤é›†ã€å¹¶é›†ã€å·®é›†ï¼›ä»é›†åˆé‡Œé¢éšæœºå–å…ƒç´ </td></tr><tr><td>ZSET</td><td>å­—ç¬¦æˆå‘˜ä¸æµ®ç‚¹æ•°åˆ†å€¼ä¹‹é—´çš„æœ‰åºæ˜ å°„ï¼Œå…ƒç´ çš„æ’åˆ—é¡ºåºç”±åˆ†å€¼çš„å¤§å°å†³å®š</td><td>æ·»åŠ ã€è·å–ã€åˆ é™¤å•ä¸ªå…ƒç´ ï¼›æ ¹æ®åˆ†å€¼èŒƒå›´æˆ–è€…æˆå‘˜æ¥è·å–å…ƒç´ </td></tr><tr><td>HASH</td><td>åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨</td><td>æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªé”®å€¼å¯¹ï¼›è·å–æ‰€ä»¥é”®å€¼å¯¹</td></tr></tbody></table><h3 id="å­—ç¬¦ä¸²-String"><a href="#å­—ç¬¦ä¸²-String" class="headerlink" title="å­—ç¬¦ä¸²(String)"></a>å­—ç¬¦ä¸²(String)</h3><p>å­—ç¬¦ä¸²(string)ç±»å‹æ˜¯redisä¸­æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œå®ƒèƒ½å­˜å‚¨ä»»ä½•å½¢å¼çš„å­—ç¬¦ä¸²ï¼ŒåŒ…æ‹¬äºŒè¿›åˆ¶æ•°æ®ã€‚å¯ä»¥ç”¨å®ƒæ¥å­˜å‚¨ç”¨æˆ·çš„é‚®ç®±ã€jsonåŒ–å¯¹è±¡ã€ç”šè‡³æ˜¯å›¾ç‰‡ã€‚ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹é”®å…è®¸å­˜å‚¨çš„æœ€å¤§å®¹é‡æ˜¯512Mã€‚</p><h4 id="å†…éƒ¨æ•°æ®ç»“æ„"><a href="#å†…éƒ¨æ•°æ®ç»“æ„" class="headerlink" title="å†…éƒ¨æ•°æ®ç»“æ„"></a>å†…éƒ¨æ•°æ®ç»“æ„</h4><p>åœ¨Rediså†…éƒ¨ï¼ŒStringç±»å‹é€šè¿‡intã€sds(simple dynamic string)ä½œä¸ºå­˜å‚¨ç»“æ„ï¼Œintç”¨æ¥å­˜æ”¾æ•´å‹æ•°æ®ï¼Œsdså­˜æ”¾å­—èŠ‚ã€å­—ç¬¦ä¸²ã€æµ®ç‚¹å‹æ•°æ®ã€‚åœ¨Cçš„æ ‡å‡†å­—ç¬¦ä¸²ç»“æ„ä¸‹è¿›è¡Œäº†å°è£…ï¼Œç”¨æ¥æå‡åŸºæœ¬æ“ä½œçš„æ€§èƒ½ï¼ŒåŒæ—¶ä¹Ÿå……åˆ†åˆ©ç”¨å·²æœ‰çš„Cæ ‡å‡†åº“ï¼Œç®€åŒ–å®ç°é€»è¾‘ã€‚å¯ä»¥åœ¨Redisçš„æºç ä¸­[sds.h]ä¸­çœ‹åˆ°çš„ç»“æ„å¦‚ä¸‹ï¼š</p><pre class=" language-c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">char</span> <span class="token operator">*</span>sds<span class="token punctuation">;</span></code></pre><p>redis3.2ç‰ˆæœ¬ä¹‹åå¼•å…¥äº†5ç§sdshdrç±»å‹ï¼Œç›®çš„æ˜¯ä¸ºäº†æ»¡è¶³ä¸åŒé•¿åº¦å­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨ä¸åŒå¤§å°çš„sdshdrï¼Œä»è€ŒèŠ‚çœå†…å­˜ï¼Œæ¯æ¬¡åˆ›å»ºä¸€ä¸ªsdsæ—¶æ ¹æ®sdsçš„å®é™…é•¿åº¦åˆ¤æ–­åº”è¯¥é€‰æ‹©ä»€ä¹ˆç±»å‹çš„sdshdrã€‚sdshdrçš„5ä¸­ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* Note: sdshdr5 is never used, we just access the flags byte directly. * However is here to document the layout of type 5 SDS strings. */</span><span class="token keyword">struct</span> <span class="token function">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__packed__<span class="token punctuation">)</span><span class="token punctuation">)</span> sdshdr5 <span class="token punctuation">{</span>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> flags<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* 3 lsb of type, and 5 msb of string length */</span>    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token function">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__packed__<span class="token punctuation">)</span><span class="token punctuation">)</span> sdshdr8 <span class="token punctuation">{</span>    uint8_t len<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* used */</span>    uint8_t alloc<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* excluding the header and null terminator */</span>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> flags<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* 3 lsb of type, 5 unused bits */</span>    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token function">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__packed__<span class="token punctuation">)</span><span class="token punctuation">)</span> sdshdr16 <span class="token punctuation">{</span>    uint16_t len<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* used */</span>    uint16_t alloc<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* excluding the header and null terminator */</span>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> flags<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* 3 lsb of type, 5 unused bits */</span>    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token function">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__packed__<span class="token punctuation">)</span><span class="token punctuation">)</span> sdshdr32 <span class="token punctuation">{</span>    uint32_t len<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* used */</span>    uint32_t alloc<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* excluding the header and null terminator */</span>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> flags<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* 3 lsb of type, 5 unused bits */</span>    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token function">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__packed__<span class="token punctuation">)</span><span class="token punctuation">)</span> sdshdr64 <span class="token punctuation">{</span>    uint64_t len<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* used */</span>    uint64_t alloc<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* excluding the header and null terminator */</span>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> flags<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* 3 lsb of type, 5 unused bits */</span>    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>ä»¥sdshdr8ä¸ºä¾‹ï¼Œæ¥è§£é‡Šä¸€ä¸‹ï¼Œ8è¡¨ç¤ºå­—ç¬¦ä¸²æœ€å¤§é•¿åº¦æ˜¯<code>2^8-1</code>å³255</p><pre class=" language-c"><code class="language-c"><span class="token keyword">struct</span> <span class="token function">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__packed__<span class="token punctuation">)</span><span class="token punctuation">)</span> sdshdr8 <span class="token punctuation">{</span>    uint8_t len<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//è¡¨ç¤ºå½“å‰sdsçš„é•¿åº¦(å•ä½æ˜¯å­—èŠ‚)</span>    uint8_t alloc<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//è¡¨ç¤ºsdså·²åˆ†é…å†…å­˜å¤§å°(å•ä½æ˜¯å­—èŠ‚)</span>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> flags<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºå½“å‰sdshdrçš„ç±»å‹ï¼Œåº”ä¸ºsdshdræœ‰5ç§ç±»å‹ï¼Œæ‰€ä»¥è‡³å°‘éœ€è¦3ä½æ¥è¡¨ç¤ºï¼š000--sdshdr5ã€001--shshdr8ã€010--sdshdr16ã€011--sdshdr32ã€100--sdshdr64ï¼Œé«˜5ä½ç”¨ä¸åˆ°æ‰€ä»¥éƒ½æ˜¯0</span>    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å­—èŠ‚æ•°æ®ï¼Œç”¨äºä¿å­˜å­—ç¬¦ä¸²</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p><img src="/2019/03/20/RedisInAction/sdshdr8.png" alt></p><p>SDSéµå¾ªCå­—ç¬¦ä¸²ä»¥ç©ºå­—ç¬¦ç»“å°¾çš„æƒ¯ä¾‹ã€‚</p><h4 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h4><ol><li><p><strong>append</strong>ï¼š append key valueï¼› å¦‚æœkeyå·²ç»å­˜åœ¨å¹¶ä¸”æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œappendå‘½ä»¤å°†valueè¿½åŠ åˆ°åŸç†å€¼å¾—æœ«å°¾ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.0.0ã€‚</p></li><li><p><strong>bitcount</strong>ï¼šbitcount key [start end]ï¼› ç»Ÿè®¡å­—ç¬¦ä¸²ä¸­ï¼Œè¢«è®¾ç½®ä¸º1çš„æ¯”ç‰¹ä½çš„æ•°é‡ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.6.0ã€‚</p></li><li><p><strong>bitop</strong>ï¼šbitop operation destkey key [key â€¦] ï¼›å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªä¿å­˜äºŒè¿›åˆ¶ä½çš„å­—ç¬¦ä¸²keyè¿›è¡Œä½å…ƒæ“ä½œï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°destkeyä¸Šã€‚operationå¯ä»¥æ˜¯ANDã€ORã€NOTã€XORè¿™å››ç§æ“ä½œä¸­çš„ä»»æ„ä¸€ç§ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.6.0ã€‚</p></li><li><p><strong>decr</strong>ï¼šdecr key ï¼›å°†keyä¸­å­˜å‚¨çš„æ•°æ®å€¼å‡1ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>decrby</strong>ï¼šdecrby key decrementï¼›å°†keyæ‰€å­˜å‚¨çš„å€¼å‡å»decrementã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>get</strong>ï¼šget keyï¼›è¿”å›Keyæ‰€å¯¹åº”çš„æ”¯ä»˜ä¸²çš„å€¼ã€‚å¦‚æœ keyä¸å­˜åœ¨é‚£ä¹ˆè¿”å›ç‰¹æ®Šå€¼ nil ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>getbit</strong>ï¼šgetbit key offsetï¼›å¯¹keyæ‰€å­˜å‚¨çš„å­—ç¬¦ä¸²å€¼ï¼Œè·å–æŒ‡å®šåç§»é‡ä¸Šçš„ä½(bit)ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.2.0ã€‚</p></li><li><p><strong>getrange</strong>ï¼šgetrange key start endï¼›æˆªå–å¾—å‡ºå­å­—ç¬¦ä¸²ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.4.0</p></li><li><p><strong>getset</strong>ï¼šgetset key valueï¼›å°†ç»™å®škeyçš„å€¼è®¾ä¸ºvalueï¼Œå¹¶è¿”å›keyçš„æ—§å€¼ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>incr</strong>ï¼šincr keyï¼›å°†keyä¸­å­˜å‚¨çš„æ•°å­—å€¼å¢ä¸€ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0</p></li><li><p><strong>incrby</strong>ï¼šincrby key incrementï¼›å°†keyæ‰€å­˜å‚¨çš„å€¼åŠ ä¸Šå¢é‡incrementã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>incrbyfloat</strong>ï¼šincrbyfloat key incrementï¼›ä¸ºkeyä¸­æ‰€å­˜å‚¨çš„å€¼åŠ ä¸Šæµ®ç‚¹æ•°å¢é‡incrementã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.6.0</p></li><li><p><strong>mget</strong>ï¼šmget key [key â€¦] ï¼›è¿”å›æ‰€æœ‰(ä¸€ä¸ªæˆ–å¤šä¸ª)ç»™å®škeyçš„å€¼ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>mset</strong>ï¼šmset key value [key value â€¦] ï¼›åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªkey-valueå¯¹ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.1</p></li><li><p><strong>msetnx</strong>ï¼šmsetnx key value [key value â€¦]ï¼› åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªkey-valueå¯¹ï¼Œå½“ä¸”ä»…å½“æ‰€æœ‰ç»™å®šçš„keyéƒ½ä¸å­˜åœ¨ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.1ã€‚</p></li><li><p><strong>psetnx</strong>ï¼špsetnx key milliseconds valueï¼› è¿™ä¸ªå‘½ä»¤å’Œsetexå‘½ä»¤ç›¸è¯†ï¼Œä½†å®ƒä»¥æ¯«ç§’ä¸ºå•ä½è®¾ç½®keyçš„ç”Ÿå­˜æ—¶é—´ï¼Œè€Œä¸æ˜¯åƒsetexå‘½ä»¤é‚£æ ·ï¼Œä»¥ç§’ä¸ºå•ä½ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.6.0ã€‚</p></li><li><p><strong>set</strong>ï¼šset key value [EX seconds] [PX milliseconds] [NX|XX]ï¼›å°†å­—ç¬¦ä¸²valueå…³è”åˆ°keyã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p><p>ä»ç‰ˆæœ¬2.6.12å¼€å§‹ï¼Œsetå‘½ä»¤çš„è¡Œä¸ºå¯ä»¥é€šè¿‡ä¸€ç³»åˆ—å‚æ•°æ¥ä¿®æ”¹ï¼š</p><ul><li><p>EX seconds:è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸ºsecondç§’ï¼Œset key value ex second æ•ˆæœç­‰åŒäºsetex key second valueï¼›</p></li><li><p>PX milliseconds:è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸ºmillisecondæ¯«ç§’ã€‚set key value px millisecondæ•ˆæœç­‰åŒäºpsetex key millisecond valueï¼›</p></li><li>NX:åªæœ‰é”®ä¸å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œï¼Œset key value nx æ•ˆæœç­‰åŒäºsetnx key valueï¼›</li><li>XX:åªåœ¨é”®å·²ç»å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œã€‚</li></ul></li><li><p><strong>setbit</strong>ï¼šsetbit key offset valueï¼›å¯¹keyæ‰€å­˜å‚¨çš„å­—ç¬¦ä¸²å€¼ï¼Œè®¾ç½®æˆ–æ¸…é™¤æŒ‡å®šåç§»é‡ä¸Šçš„ä½(bit)ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.2.0ã€‚</p></li><li><p><strong>setex</strong>ï¼šsetex key seconds valueï¼›å°†å€¼valueå…³è”åˆ°keyï¼Œå¹¶å°†keyçš„ç”Ÿå­˜æ—¶é—´è®¾ç½®ä¸ºsecondsç§’ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.0.0ã€‚</p></li><li><p><strong>setnx</strong>ï¼šsetnx key valueï¼›å°†keyçš„å€¼è®¾ä¸ºvalueï¼Œå½“ä¸”ä»…å½“keyä¸å­˜åœ¨ã€‚è®¾ç½®æˆåŠŸï¼Œè¿”å›1ï¼›è®¾ç½®å¤±è´¥ï¼Œè¿”å›0ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>setrange</strong>ï¼šsetrange key offset valueï¼›ç”¨valueè¦†ç›–ç»™å®škeyæ‰€å­˜åœ¨çš„å­—ç¬¦ä¸²å€¼ï¼Œä»åç§»é‡offsetå¼€å§‹ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.2.0ã€‚</p></li><li><p><strong>strlen</strong>ï¼šstrlen keyï¼›è¿”å›keyæ‰€å­˜å‚¨çš„å­—ç¬¦ä¸²å€¼å¾—é•¿åº¦ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.2.0ã€‚</p></li></ol><h3 id="åˆ—è¡¨-List"><a href="#åˆ—è¡¨-List" class="headerlink" title="åˆ—è¡¨(List)"></a>åˆ—è¡¨(List)</h3><p>åˆ—è¡¨(list)ç±»å‹å¯ä»¥å­˜å‚¨ä¸€ä¸ªæœ‰åºçš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œå¸¸ç”¨çš„æ“ä½œæ˜¯å‘åˆ—è¡¨çš„ä¸¤ç«¯æ·»åŠ å…ƒç´ æˆ–è€…è·å–åˆ—è¡¨çš„æŸä¸ªç‰‡æ®µã€‚</p><p> åˆ—è¡¨ç±»å‹ä½¿ç”¨åŒå‘é“¾è¡¨å®ç°çš„ï¼Œæ‰€ä»¥å‘åˆ—è¡¨ä¸¤ç«¯æ·»åŠ å…ƒç´ çš„æ—¶é—´å¤åˆ¶åº¦ä¸ºO(1)ï¼Œè·å–è¶Šæ¥è¿‘ä¸¤ç«¯çš„å…ƒç´ å°±è¶Šå¿«ã€‚</p><h4 id="å†…éƒ¨æ•°æ®ç»“æ„-1"><a href="#å†…éƒ¨æ•°æ®ç»“æ„-1" class="headerlink" title="å†…éƒ¨æ•°æ®ç»“æ„"></a>å†…éƒ¨æ•°æ®ç»“æ„</h4><p>åœ¨redis3.2ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œåˆ—è¡¨ç±»å‹çš„valueå¯¹è±¡å†…éƒ¨æ˜¯ä»¥linkedlistæˆ–ziplistæ¥å®ç°ï¼Œå½“åˆ—è¡¨åªåŒ…å«å°‘é‡å…ƒç´ ï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ è¦ä¹ˆæ˜¯å°æ•´æ•°å€¼ï¼Œè¦ä¹ˆæ˜¯é•¿åº¦ğŸ“’çŸ­çš„å­—ç¬¦ä¸²æ—¶ï¼ŒRediså°±ä¼šä½¿ç”¨å‹ç¼©é“¾è¡¨(zpilist)æ¥å­˜å‚¨æ¥èŠ‚çœå†…å­˜ï¼Œå¦åˆ™å°†ä¼šé‡‡ç”¨åŒå‘é“¾è¡¨ï¼ˆlinkedlistï¼‰å­˜å‚¨ã€‚åŒå‘é“¾è¡¨çš„èŠ‚ç‚¹ç»“æ„å¯ä»¥åœ¨redisæºç çš„<code>adlist.h</code>çœ‹åˆ°ï¼ŒlistNodeå…·ä½“ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class=" language-c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> listNode <span class="token punctuation">{</span>    <span class="token keyword">struct</span> listNode <span class="token operator">*</span>prev<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//å‰ç½®èŠ‚ç‚¹</span>    <span class="token keyword">struct</span> listNode <span class="token operator">*</span>next<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//åç½®èŠ‚ç‚¹</span>    <span class="token keyword">void</span> <span class="token operator">*</span>value<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//èŠ‚ç‚¹çš„å€¼</span><span class="token punctuation">}</span> listNode<span class="token punctuation">;</span></code></pre><p>è™½ç„¶å¯ä»¥ä½¿ç”¨å¤šä¸ªlistNodeç»“æ„å°±èƒ½ç»„æˆé“¾è¡¨ï¼Œä½†æ˜¯ä½¿ç”¨ä¸€ä¸ªlistæ¥æŒæœ‰é“¾è¡¨çš„åŒ–ï¼Œæ“ä½œä¼šæ›´æ–¹ä¾¿ï¼Œlistå…·ä½“ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class=" language-c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> list <span class="token punctuation">{</span>    listNode <span class="token operator">*</span>head<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//é“¾è¡¨å¤´èŠ‚ç‚¹</span>    listNode <span class="token operator">*</span>tail<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//é“¾è¡¨å°¾èŠ‚ç‚¹</span>    <span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>dup<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//èŠ‚ç‚¹å¤åˆ¶å‡½æ•°</span>    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>free<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//èŠ‚ç‚¹é‡Šæ”¾å‡½æ•°</span>    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>match<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//èŠ‚ç‚¹å¯¹æ¯”å‡½æ•°</span>    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> len<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//é“¾è¡¨åŒ…å«çš„èŠ‚ç‚¹æ•°é‡</span><span class="token punctuation">}</span> list<span class="token punctuation">;</span></code></pre><p>åˆ—è¡¨çš„è¿™ä¸¤ç§å­˜å‚¨æ–¹å¼å„æœ‰ä¼˜ç¼ºç‚¹ï¼š</p><ul><li>åŒå‘é“¾è¡¨åœ¨é“¾è¡¨çš„ä¸¤ç«¯è¿›è¡Œæ·»åŠ å’Œåˆ é™¤æ“ä½œï¼Œæ—¶é—´å¤æŸ¥åº¦ä½ï¼Œä½†å†…å­˜å¼€é”€å¤§ï¼›</li><li>å‹ç¼©é“¾è¡¨å­˜å‚¨åœ¨ä¸€æ®µè¿ç»­çš„å†…å­˜ä¸Šï¼Œæ‰€ä»¥å­˜å‚¨æ•ˆç‡é«˜ï¼Œä½†æ˜¯æ’å…¥å’Œåˆ é™¤éƒ½è¦é¢‘ç¹ç”³è¯·å’Œé‡Šæ”¾å†…å­˜ï¼›</li></ul><p>åœ¨redis3.2ä¹‹åçš„ç‰ˆæœ¬ï¼Œé‡‡ç”¨äº†ä¸€ç§å«quicklistçš„æ•°æ®ç»“æ„æ¥å­˜å‚¨åˆ—è¡¨ç±»å‹çš„valueå€¼ï¼Œquicklistç»“æ„å‚è§Redisæºç <code>quicklist.h</code>ï¼ŒquicklistNodeçš„ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* quicklistNode is a 32 byte struct describing a ziplist for a quicklist. * We use bit fields keep the quicklistNode at 32 bytes. * count: 16 bits, max 65536 (max zl bytes is 65k, so max count actually &lt; 32k). * encoding: 2 bits, RAW=1, LZF=2. * container: 2 bits, NONE=1, ZIPLIST=2. * recompress: 1 bit, bool, true if node is temporarry decompressed for usage. * attempted_compress: 1 bit, boolean, used for verifying during testing. * extra: 12 bits, free for future use; pads out the remainder of 32 bits */</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> quicklistNode <span class="token punctuation">{</span>    <span class="token keyword">struct</span> quicklistNode <span class="token operator">*</span>prev<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å‰ç½®èŠ‚ç‚¹</span>    <span class="token keyword">struct</span> quicklistNode <span class="token operator">*</span>next<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//åç½®èŠ‚ç‚¹</span>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>zl<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ziplistèŠ‚ç‚¹</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> sz<span class="token punctuation">;</span>             <span class="token comment" spellcheck="true">/* ziplist size in bytes */</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> count <span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">/* count of items in ziplist */</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> encoding <span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">/* RAW==1 or LZF==2 */</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> container <span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">/* NONE==1 or ZIPLIST==2 */</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> recompress <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* was this node previous compressed? */</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> attempted_compress <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* node can't compress; too small */</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> extra <span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* more bits to steal for future usage */</span><span class="token punctuation">}</span> quicklistNode<span class="token punctuation">;</span></code></pre><p>å¯ä»¥ä»ä¸Šé¢çš„ç»“æ„å®šä¹‰çœ‹å‡ºï¼Œquicklistæœ¬è´¨ä»»ç„¶æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œåªæ˜¯åœ¨åˆ—è¡¨çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªziplist,å…¶å®å°±æ˜¯linkedlistå’Œziplistçš„ç»“åˆï¼Œquicklistä¸­æ¯ä¸ªèŠ‚ç‚¹ziplistéƒ½èƒ½å¤Ÿå­˜å‚¨å¤šä¸ªæ•°æ®å…ƒç´ ï¼Œåœ¨æºç ä¸­çš„æ–‡ä»¶ä¸º<code>quicklist.c</code>çš„ç¬¬ä¸€è¡Œå°±æœ‰è¿™æ ·çš„æè¿°ï¼šquicklist.c - A doubly linked list of ziplistsæ„æ€æ˜¯quicklistå°±æ˜¯æœ‰ziplistç»„æˆçš„åŒå‘é“¾è¡¨ã€‚</p><p><img src="/2019/03/20/RedisInAction/quicklist.png" alt></p><h4 id="å¸¸ç”¨å‘½ä»¤-1"><a href="#å¸¸ç”¨å‘½ä»¤-1" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h4><ol><li><p><strong>blpop</strong>ï¼šblpop key [key â€¦] timeoutï¼›blpopæ˜¯åˆ—è¡¨é˜»å¡å¼(blocking)å¼¹å‡ºåŸè¯­ã€‚å®ƒæ˜¯lpopå‘½ä»¤çš„é˜»å¡ç‰ˆæœ¬ï¼Œå½“ç»™å®šåˆ—è¡¨æ²¡æœ‰ä»»ä½•å…ƒç´ å¯ä¾›å¼¹å‡ºçš„æ—¶å€™ï¼Œè¿æ¥å°†è¢«blpopå‘½ä»¤é˜»å¡ï¼Œç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å…ƒç´ ä¸ºæ­¢ã€‚è¶…æ—¶å‚æ•° <code>timeout</code> æ¥å—ä¸€ä¸ªä»¥ç§’ä¸ºå•ä½çš„æ•°å­—ä½œä¸ºå€¼ã€‚è¶…æ—¶å‚æ•°è®¾ä¸º <code>0</code> è¡¨ç¤ºé˜»å¡æ—¶é—´å¯ä»¥æ— é™æœŸå»¶é•¿(block indefinitely) ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.0.0ã€‚</p></li><li><p><strong>brpop</strong>ï¼šbrpop key [key â€¦] timeoutï¼›brpopæ˜¯åˆ—è¡¨çš„é˜»å¡å¼(blocking)å¼¹å‡ºåŸè¯­ã€‚å®ƒæ˜¯ rpopå‘½ä»¤çš„é˜»å¡ç‰ˆæœ¬ï¼Œå½“ç»™å®šåˆ—è¡¨å†…æ²¡æœ‰ä»»ä½•å…ƒç´ å¯ä¾›å¼¹å‡ºçš„æ—¶å€™ï¼Œè¿æ¥å°†è¢«brpopå‘½ä»¤é˜»å¡ï¼Œç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢ã€‚å¯ç”¨ç‰ˆæœ¬&gt;2.0.0ã€‚</p></li><li><p><strong>brpoplpush</strong>ï¼šbrpoplpush source destination timeoutï¼›brpoplpushæ˜¯rpoplpushçš„é˜»å¡ç‰ˆæœ¬ï¼Œå½“ç»™å®šåˆ—è¡¨sourceä¸ä¸ºç©ºæ—¶ï¼Œbrpoplpushçš„è¡¨ç°å’Œrpoplpushä¸€æ ·ã€‚å½“åˆ—è¡¨sourceä¸ºç©ºæ—¶brpoplpushå‘½ä»¤å°†é˜»å¡è¿æ¥ï¼Œç›´åˆ°ç­‰å¾…è¶…æ—¶ï¼Œæˆ–æœ‰å¦ä¸€ä¸ªå®¢æˆ·ç«¯å¤šsourceæ‰§è¡Œlpushæˆ–rpushå‘½ä»¤ä¸ºæ­¢ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.2.0ã€‚</p></li><li><p><strong>lindex</strong>ï¼šlindex key indexï¼›è¿”å›åˆ—è¡¨keyä¸­ï¼Œä¸‹æ ‡ä¸ºindexçš„å…ƒç´ ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>linsert</strong>ï¼šlinsert key before|after pivot valueï¼›å°†å€¼valueæ’å…¥åˆ°åˆ—è¡¨keyä¸­ï¼Œä½äºå€¼prvotä¹‹å‰æˆ–ä¹‹åã€‚å¯ç”¨ç‰ˆæœ¬&gt;2.2.0ã€‚</p></li><li><p><strong>llen</strong>ï¼šllen keyï¼›è¿”å›åˆ—è¡¨keyçš„é•¿åº¦ã€‚  å¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™keyè¢«è§£é‡Šä¸ºä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œè¿”å›0ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>lpop</strong>ï¼šlpop keyï¼›ç§»é™¤å¹¶è¿”å›åˆ—è¡¨keyçš„å¤´å…ƒç´ ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>lpush</strong>ï¼šlpush key value [value â€¦]ï¼›å°†ä¸€ä¸ªæˆ–å¤šä¸ªvalueæ’å…¥åˆ°åˆ—è¡¨keyçš„è¡¨å¤´ã€‚å¦‚æœæœ‰å¤šä¸ªvalueå€¼ï¼Œé‚£ä¹ˆå„ä¸ªvalueå€¼æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºä¾æ¬¡æ’å…¥åˆ°è¡¨å¤´ã€‚æ‰§è¡Œlpushåè¿”å›åˆ—è¡¨çš„é•¿åº¦ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>lpushx</strong>ï¼šlpushx key valueï¼›å°†å€¼valueæ’å…¥åˆ°åˆ—è¡¨keyçš„è¡¨å¤´ï¼Œå½“ä¸”ä»…å½“keyå­˜åœ¨å¹¶ä¸”æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚å½“keyä¸å­˜åœ¨æ—¶ï¼Œlpushxå‘½ä»¤ä»€ä¹ˆä¹Ÿä¸åšã€‚lpushxå‘½ä»¤æ‰§è¡Œåï¼Œè¿”å›åˆ—è¡¨çš„é•¿åº¦ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.2.0ã€‚</p></li><li><p>lrangeï¼šlrange key start stopï¼›è¿”å›åˆ—è¡¨keyä¸­æŒ‡å®šåŒºé—´å†…çš„å…ƒç´ ï¼ŒåŒºé—´ä»¥åç§»é‡startå’ŒstopæŒ‡å®šã€‚ä¸‹æ ‡å‚æ•°startå’Œendéƒ½æ˜¯ä»¥0å¼€å§‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥0è¡¨ç¤ºåˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä»¥1è¡¨ç¤ºåˆ—è¡¨çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä»¥æ­¤ç±»æ¨ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨è´Ÿæ•°ä¸‹æ ‡ï¼Œä»¥-1è¡¨ç¤ºåˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œ-2è¡¨ç¤ºåˆ—è¡¨çš„å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä»¥æ­¤ç±»æ¨ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p>lremï¼šlrem key count valueï¼›ä¾æ®å‚æ•°countçš„å€¼ï¼Œç§»é™¤åˆ—è¡¨ä¸­ä¸å‚æ•°valueç›¸ç­‰çš„å…ƒç´ ã€‚è¿”å›è¢«ç§»é™¤å…ƒç´ çš„æ•°é‡ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p><p>countçš„å€¼å¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li>count &gt; 0ï¼šä»è¡¨å¤´å¼€å§‹å‘è¡¨å°¾æœç´¢ï¼Œç§»é™¤ä¸valueç›¸ç­‰çš„å…ƒç´ ï¼Œæ•°é‡ä¸ºcountï¼›</li><li>count &lt; 0ï¼šä»è¡¨å°¾å‘è¡¨å¤´æœç´¢ï¼Œç§»é™¤ä¸valueç›¸ç­‰çš„å…ƒç´ ï¼Œæ•°é‡ä¸ºcountçš„ç»å¯¹å€¼ã€‚</li><li>count = 0ï¼šç§»é™¤è¡¨ä¸­æ‰€æœ‰ä¸valueç›¸ç­‰çš„å€¼ã€‚</li></ul></li><li><p>lsetï¼šlset key index valueï¼›å°†åˆ—è¡¨keyä¸‹æ ‡ä¸ºindexçš„å…ƒç´ çš„å€¼è®¾ç½®ä¸ºvalueã€‚å½“indexå‚æ•°è¶…å‡ºèŒƒå›´ï¼Œæˆ–å¯¹ä¸€ä¸ªç©ºåˆ—è¡¨(keyä¸å­˜åœ¨)è¿›è¡Œlsetæ—¶ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚æ“ä½œæˆåŠŸè¿”å›okï¼Œå¦åˆ™è¿”å›é”™è¯¯ä¿¡æ¯ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p>ltrimï¼šltrim key start stopï¼›å¯¹ä¸€ä¸ªåˆ—è¡¨è¿›è¡Œä¿®å‰ª(trim)ï¼Œå°±æ˜¯è¯´ï¼Œè®©åˆ—è¡¨åªä¿ç•™æŒ‡å®šåŒºé—´å†…çš„å…ƒç´ ï¼Œä¸åœ¨æŒ‡å®šåŒºé—´å†…çš„å…ƒç´ éƒ½å°†è¢«åˆ é™¤ã€‚å‘½ä»¤æ‰§è¡ŒæˆåŠŸè¿”å›okã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p>rpopï¼šrpop keyï¼›ç§»é™¤å¹¶è¿”å›åˆ—è¡¨keyçš„å°¾å…ƒç´ ã€‚å½“keyä¸å­˜åœ¨æ—¶ï¼Œè¿”å›nilã€‚</p></li><li><p>rpoplpushï¼šrpoplpush source destinationï¼›è¯¥å‘½ä»¤åœ¨ä¸€ä¸ªåŸå­æ—¶é—´å†…æ‰§è¡Œä¸¤ä¸ªæ“ä½œï¼š</p><ul><li>å°†åˆ—è¡¨sourceä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ (å°¾å…ƒç´ )å¼¹å‡ºï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li>å°†sourceå¼¹å‡ºçš„å…ƒç´ æ’å…¥åˆ°åˆ—è¡¨destinationï¼Œä½œä¸ºåˆ—è¡¨destinationçš„å¤´å…ƒç´ ã€‚</li></ul><p>å¦‚æœsourceä¸å­˜åœ¨ï¼Œè¿”å›nilï¼Œå¹¶ä¸æ‰§è¡Œå…¶ä»–åŠ¨ä½œã€‚å¦‚æœsourceå’Œdestinationç›¸åŒï¼Œåˆ™åˆ—è¡¨ä¸­çš„è¡¨å°¾å…ƒç´ è¢«ç§»åŠ¨åˆ°è¡¨å¤´ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ ï¼Œå¯ä»¥æŠŠè¿™ç§ç‰¹æ®Šæƒ…å†µè§†ä½œåˆ—è¡¨çš„åè½¬ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.2.0ã€‚</p></li><li><p>rpushï¼šrpush key value [value â€¦]ï¼›å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼valueæ’å…¥åˆ—è¡¨keyçš„è¡¨å°¾(æœ€å³è¾¹)ã€‚å¦‚æœæœ‰å¤šä¸ªvalueå€¼ï¼Œé‚£ä¹ˆå„ä¸ªvalueå€¼æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºä¾æ¬¡æ’å…¥åˆ°è¡¨å°¾ã€‚rpushæ‰§è¡Œåï¼Œè¿”å›åˆ—è¡¨çš„é•¿åº¦ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p>rpushxï¼šrpushx key valueï¼›å°†å€¼valueæ’å…¥åˆ—è¡¨keyçš„è¡¨å°¾ï¼Œå½“ä¸”ä»…å½“keyå­˜åœ¨å¹¶ä¸”æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚å½“keyä¸å­˜åœ¨æ—¶ï¼Œrpushxå‘½ä»¤ä»€ä¹ˆä¹Ÿä¸åšã€‚rpushxæ‰§è¡ŒæˆåŠŸåï¼Œè¿”å›åˆ—è¡¨çš„é•¿åº¦ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.2.0ã€‚</p></li></ol><h3 id="å“ˆå¸Œ-Hash"><a href="#å“ˆå¸Œ-Hash" class="headerlink" title="å“ˆå¸Œ(Hash)"></a>å“ˆå¸Œ(Hash)</h3><p>å“ˆå¸Œå¯ä»¥å­˜å‚¨å¤šä¸ªé”®å€¼å¯¹ä¹‹é—´çš„æ˜ å°„ï¼Œå’Œå­—ç¬¦ä¸²ä¸€æ ·ï¼Œå“ˆå¸Œå­˜å‚¨çš„å€¼æ—¢å¯ä»¥æ˜¯å­—ç¬¦ä¸²åˆå¯ä»¥æ˜¯æ•°å­—å€¼ã€‚</p><h4 id="å†…éƒ¨æ•°æ®ç»“æ„-2"><a href="#å†…éƒ¨æ•°æ®ç»“æ„-2" class="headerlink" title="å†…éƒ¨æ•°æ®ç»“æ„"></a>å†…éƒ¨æ•°æ®ç»“æ„</h4><p>å“ˆå¸Œç±»å‹çš„å†…éƒ¨æ•°æ®ç»“æ„å¯ä»¥æ˜¯ziplistæˆ–è€…hashtableã€‚å½“å“ˆå¸Œä¿å­˜çš„æ‰€æœ‰é”®å€¼å¯¹çš„é”®å’Œå€¼å¾—å­—ç¬¦ä¸²å¤§å°éƒ½å°äº64å­—èŠ‚ï¼Œå¹¶ä¸”é”®å€¼å¯¹çš„æ•°é‡å°äº512ä¸ªæ—¶ï¼Œåº•å±‚å°†ä¼šé‡‡ç”¨ziplistå­˜å‚¨ç»“æ„ï¼Œå¦åˆ™å°†é‡‡ç”¨hashtableå­˜å‚¨ç»“æ„ã€‚åœ¨redisä¸­ï¼Œhashtableæœ‰3å±‚ç»“æ„ï¼Œdict -&gt; dictht -&gt; dictEntryï¼Œæºç åœ¨<code>dict.h</code>ä¸­ã€‚</p><p><strong>dictEntryï¼ˆå“ˆå¸ŒèŠ‚ç‚¹ï¼‰</strong></p><p>ç®¡ç†ä¸€ä¸ªkey-valueï¼ŒåŒæ—¶ä¿ç•™åŒä¸€ä¸ªæ¡¶ä¸­ç›¸é‚»å…ƒç´ çš„æŒ‡é’ˆï¼Œç”¨æˆ·ç»´æŠ¤å“ˆå¸Œæ¡¶çš„å†…éƒ¨é“¾è¡¨ï¼Œç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class=" language-c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> dictEntry <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token operator">*</span>key<span class="token punctuation">;</span>    <span class="token keyword">union</span> <span class="token punctuation">{</span>        <span class="token keyword">void</span> <span class="token operator">*</span>val<span class="token punctuation">;</span>        uint64_t u64<span class="token punctuation">;</span>        int64_t s64<span class="token punctuation">;</span>        <span class="token keyword">double</span> d<span class="token punctuation">;</span>    <span class="token punctuation">}</span> v<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// å› ä¸ºvalueæœ‰å¤šç§ç±»å‹ï¼Œæ‰€ä»¥valueç”¨äº†unionæ¥å­˜å‚¨</span>    <span class="token keyword">struct</span> dictEntry <span class="token operator">*</span>next<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„åœ°å€ï¼Œç”¨æ¥å¤„ç†å†²çªï¼Œæ‰€ä»¥åˆ†é…åˆ°åŒä¸€ä¸ªç´¢å¼•çš„å…ƒç´ é€šè¿‡nextæŒ‡é’ˆé“¾æ¥èµ·æ¥å½¢æˆé“¾è¡¨</span><span class="token punctuation">}</span> dictEntry<span class="token punctuation">;</span></code></pre><p><strong>dicthtï¼ˆå“ˆå¸Œè¡¨ï¼‰</strong> </p><p>å®ç°ä¸€ä¸ªhashtableä¼šç”¨ä¸€ä¸ªbuckerså­˜æ”¾dictEntryåœ°å€ï¼Œä¸€èˆ¬æƒ…å†µä¸‹é€šè¿‡hash(key) % lenå¾—åˆ°çš„å€¼å°±æ˜¯buckersçš„ç´¢å¼•ï¼Œè¿™ä¸ªå€¼å†³å®šäº†dictEntryèŠ‚ç‚¹çš„å­˜æ”¾ä½ç½®ï¼Œ<code>dict.h</code>ä¸­çš„dicthtç»“æ„ä¸­tableå°±æ˜¯buckersçš„åœ°å€ã€‚</p><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* This is our hash table structure. Every dictionary has two of this as we * implement incremental rehashing, for the old to the new table. */</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> dictht <span class="token punctuation">{</span>    dictEntry <span class="token operator">*</span><span class="token operator">*</span>table<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//bucketsçš„åœ°å€</span>    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> size<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//buckertsçš„å¤§å°ï¼Œæ€»ä¿æŒä¸º2^n</span>    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> sizemask<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ©ç ï¼Œç”¨æ¥æŠ€æœ¯hashå€¼å¯¹åº”çš„buckersç´¢å¼•</span>    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> used<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å½“å‰dicthtæœ‰å¤šå°‘ä¸ªdictEntryèŠ‚ç‚¹</span><span class="token punctuation">}</span> dictht<span class="token punctuation">;</span></code></pre><p><strong>dictï¼ˆå­—å…¸ï¼‰</strong>                                                                           </p><p>dicthtå®é™…ä¸Šå°±æ˜¯hashè¡¨çš„æ ¸å¿ƒï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªdicthtè¿˜ä¸å¤Ÿï¼Œæ¯”å¦‚rehashã€éå†hashç­‰æ“ä½œï¼Œæ‰€ä»¥rediså®šä¹‰äº† ä¸€ä¸ªå«dictçš„ç»“æ„ä»¥æ”¯æŒå­—å…¸çš„å„ç§æ“ä½œï¼Œå½“dicthtéœ€è¦æ‰©å®¹/ç¼©å®¹æ—¶ï¼Œç”¨æ¥ç®¡ç†dicthtçš„è¿ç§»ï¼Œä»¥ä¸‹æ˜¯å®ƒçš„æ•°æ®ç»“æ„:</p><pre class=" language-c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> dict <span class="token punctuation">{</span>    dictType <span class="token operator">*</span>type<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//dictTypeé‡Œå­˜æ”¾çš„æ˜¯å·¥å…·å‡½æ•°çš„æŒ‡é’ˆ</span>    <span class="token keyword">void</span> <span class="token operator">*</span>privdata<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ä¿å­˜typeä¸­æŸäº›å‡½æ•°éœ€è¦ä½œä¸ºå‚æ•°çš„æ•°æ®</span>    dictht ht<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ç»´æŠ¤ä¸¤ä¸ªdicthtï¼Œht[0]å¹³æ—¶ç”¨ï¼Œht[1]rehashæ—¶ç”¨</span>    <span class="token keyword">long</span> rehashidx<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//å½“å‰rehashåˆ°buckertsçš„å“ªä¸ªç´¢å¼•ä½ç½®ï¼Œ-1è¡¨ç¤ºérehashçŠ¶æ€</span>    <span class="token keyword">int</span> iterators<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//å®‰å…¨è¿­ä»£å™¨çš„è®¡æ•°</span><span class="token punctuation">}</span> dict<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å·¥å…·å‡½æ•°</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> dictType <span class="token punctuation">{</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>hashFunction<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>keyDup<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>privdata<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>valDup<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>privdata<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>keyCompare<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>privdata<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>key1<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>key2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>keyDestructor<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>privdata<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>valDestructor<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>privdata<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> dictType<span class="token punctuation">;</span></code></pre><p><strong>dictçš„ç»“æ„å›¾</strong>ï¼š</p><p><img src="/2019/03/20/RedisInAction/dict.png" alt></p><p><strong>å“ˆå¸Œç®—æ³•</strong></p><p>å½“è¦è®²ä¸€ä¸ªæ–°çš„é”®å€¼å¯¹æ·»åŠ åˆ°dicté‡Œé¢æ—¶ï¼Œç¨‹åºéœ€è¦å…ˆæ ¹æ®é”®è®¡ç®—å‡ºå“ˆå¸Œå€¼å’Œç´¢å¼•å€¼ï¼Œç„¶ååœ¨æ ¹æ®ç´¢å¼•å€¼å°†é”®å€¼å¯¹çš„å“ˆå¸Œè¡¨èŠ‚ç‚¹æ”¾åˆ°å“ˆå¸Œæ•°ç»„çš„æŒ‡å®šç´¢å¼•ä¸Šé¢ã€‚</p><pre class=" language-tex"><code class="language-tex">#ä½¿ç”¨dictè®¾ç½®çš„å“ˆå¸Œå‡½æ•°ï¼Œè®¡ç®—keyçš„å“ˆå¸Œå€¼hash = dict -> type -> hashFunction(key);#ä½¿ç”¨å“ˆå¸Œè¡¨çš„sizemaskå±æ€§å’Œå“ˆå¸Œå€¼ï¼Œè®¡ç®—å‡ºç´¢å¼•å€¼ï¼›æ ¹æ®æƒ…å†µä¸åŒï¼Œht[x]å¯ä»¥æ˜¯ht[0]æˆ–ht[1]index = hash & dict -> hx[x].sizemask;</code></pre><p>Redisä½¿ç”¨<strong>MurmurHash2</strong>ç®—æ³•æ¥è®¡ç®—é”®çš„å“ˆå¸Œå€¼ã€‚<strong>MurmuhHashç®—æ³•</strong>æœ€åˆç”±Austin Applebyäº2008å¹´å‘æ˜ï¼Œè¿™ä¸ªç®—æ³•çš„ä¼˜ç‚¹åœ¨äºå³ä½¿è¾“å…¥çš„é”®æ˜¯ç”±è§„å¾‹çš„ï¼Œç®—æ³•ä»èƒ½ç»™å‡ºä¸€ä¸ªå¾ˆå¥½çš„éšæœºåˆ†å¸ƒè¡Œï¼Œå¹¶ä¸”ç®—æ³•çš„è®¡ç®—é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚</p><p><strong>è§£å†³å“ˆå¸Œå†²çª</strong></p><p>å½“æœ‰ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„é”®è¢«åˆ†é…åˆ°å“ˆå¸Œè¡¨æ•°ç»„çš„åŒä¸€ä¸ªç´¢å¼•ä¸Šé¢æ—¶ï¼Œå°±ç§°è¿™äº›é”®å‘ç”Ÿäº†å†²çªï¼ˆconllisionï¼‰ã€‚Redisçš„å“ˆå¸Œç±»å‹ä½¿ç”¨<strong>é“¾åœ°å€æ³•</strong>æ¥è§£å†³å†²çªï¼Œæ¯ä¸ªå“ˆå¸ŒèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªnextæŒ‡é’ˆï¼Œå¤šä¸ªå“ˆå¸ŒèŠ‚ç‚¹å¯ä»¥ç”¨nextæŒ‡é’ˆæ„æˆä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œè¢«åˆ†é…åˆ°åŒä¸€ä¸ªç´¢å¼•ä¸Šçš„å¤šä¸ªèŠ‚ç‚¹å¯ä»¥ç”¨è¿™ä¸ªå•å‘é“¾è¡¨è¿æ¥èµ·æ¥ï¼Œè¿™å°±è§£å†³äº†é”®å†²çªé—®é¢˜ã€‚</p><p><strong>Rehash</strong></p><p>éšç€æ“ä½œçš„ä¸æ–­æ‰§è¡Œï¼Œå“ˆå¸Œè¡¨ä¿å­˜çš„é”®å€¼å¯¹ä¼šé€æ¸åœ°å¢å¤šæˆ–å‡å°‘ï¼Œä¸ºäº†è®©å“ˆå¸Œè¡¨çš„è´Ÿè½½å› å­ç»´æŒåœ¨ä¸€ä¸ªåˆç†çš„èŒƒå›´ä¹‹å†…ï¼Œå½“å“ˆå¸Œè¡¨ä¿å­˜çš„é”®å€¼å¯¹æ•°é‡å¤§å¤šæˆ–å¤ªå°‘æ—¶ï¼Œéƒ½éœ€è¦å¯¹å“ˆå¸Œè¡¨çš„å¤§å°è¿›è¡Œç›¸åº”çš„æ‰©å±•æˆ–ç¼©å°ã€‚</p><p>æ‰©å±•å’Œç¼©å°å“ˆå¸Œè¡¨çš„å·¥ä½œå¯ä»¥é€šè¿‡æ‰§è¡Œrehash(é‡æ–°æ•£åˆ—)æ“ä½œæ¥å®Œæˆï¼ŒRediså¯¹å­—å…¸çš„å“ˆå¸Œè¡¨æ‰§è¡Œrehashçš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li><p>ä¸ºå­—å…¸çš„ht[1]å“ˆå¸Œè¡¨åˆ†é…å†…å­˜ç©ºé—´ï¼Œè¿™ä¸ªå“ˆå¸Œè¡¨çš„ç©ºé—´å¤§å°å–å†³äºè¦æ‰§è¡Œçš„æ“ä½œä¾æ®ht[0]å“ˆå¸Œè¡¨åŒ…å«çš„é”®å€¼å¯¹çš„æ•°é‡(å³ht[0].usedå±æ€§çš„å€¼)ã€‚</p><ul><li>å¦‚æœæ‰§è¡Œçš„æ˜¯æ‰©å±•æ“ä½œï¼Œé‚£ä¹ˆht[1]çš„å¤§å°ä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äºht[0].used*2çš„2^nï¼ˆ2çš„næ¬¡æ–¹ï¼‰ï¼›</li><li>å¦‚æœæ‰§è¡Œçš„æ˜¯æ”¶ç¼©æ“ä½œï¼Œé‚£ä¹ˆht[1]çš„å¤§å°ä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äºht[0].usedçš„2^nï¼›</li></ul></li><li><p>å°†ä¿å­˜åœ¨ht[0]ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹rehashåˆ°ht[1]ä¸Šé¢ã€‚</p></li><li>å½“ht[0]åŒ…å«çš„æ‰€æœ‰é”®å€¼å¯¹éƒ½è¿ç§»åˆ°äº†ht[1]ä¹‹åï¼Œå°±æŠŠht[0]ç½®ä¸ºç©ºè¡¨ï¼Œé‡Šæ”¾ht[0]ï¼Œç„¶åå°†ht[1]è®¾ç½®ä¸ºht[0]ï¼Œå¹¶ä¸ºht[1]æ–°å»ºä¸€ä¸ªç©ºçš„å“ˆå¸Œè¡¨ï¼Œä¸ºä¸‹æ¬¡rehashåšå‡†å¤‡ã€‚</li></ul><h4 id="å¸¸ç”¨å‘½ä»¤-2"><a href="#å¸¸ç”¨å‘½ä»¤-2" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h4><ol><li><strong>hdel</strong>ï¼šhdel key field [field â€¦]ï¼›åˆ é™¤å“ˆå¸Œè¡¨çš„ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šåŸŸï¼Œä¸å­˜åœ¨çš„åŸŸå°†è¢«å¿½ç•¥ã€‚è¿”å›è¢«æˆåŠŸåˆ é™¤çš„åŸŸçš„æ•°é‡ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.0.0ã€‚</li><li><strong>hexists</strong>ï¼šhexists key fieldï¼›æŸ¥çœ‹å“ˆäº›è¡¨keyä¸­ï¼Œç»™å®šçš„fieldæ˜¯å¦å­˜åœ¨ã€‚å¦‚æœå­˜åœ¨ï¼Œè¿”å›1ï¼›å¦‚æœå“ˆå¸Œè¡¨ä¸å«æœ‰ç»™å®šåŸŸï¼Œæˆ–keyä¸å­˜åœ¨ï¼Œè¿”å›0ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.0.0ã€‚</li><li><strong>hget</strong>ï¼šhget key fieldï¼›è¿”å›å“ˆå¸Œè¡¨keyä¸­ç»™å®šåŸŸfieldçš„å€¼ã€‚å¦‚æœç»™å®šçš„åŸŸä¸å­˜åœ¨æˆ–æ˜¯ç»™å®škeyä¸å­˜åœ¨æ—¶ï¼Œè¿”å›nilã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.0.0ã€‚</li><li><strong>hgetall</strong>ï¼šhgetall keyï¼›è¿”å›å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„åŸŸå’Œå€¼ã€‚è‹¥keyä¸å­˜åœ¨ï¼Œè¿”å›ç©ºåˆ—è¡¨ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.0.0ã€‚</li><li><strong>hincrby</strong>ï¼šhincrby key field incrementï¼›ä¸ºå“ˆå¸Œè¡¨keyä¸­çš„åŸŸfieldçš„å€¼åŠ ä¸Šå¢é‡incrementã€‚å¢é‡ä¹Ÿå¯ä»¥æ˜¯è´Ÿæ•°ï¼Œç›¸å½“äºå¯¹ç»™å®šåŸŸè¿›è¡Œå‡æ³•æ“ä½œã€‚å¦‚æœkeyä¸å­˜åœ¨ï¼Œä¸€ä¸ªæ–°çš„å“ˆå¸Œè¡¨è¢«åˆ›å»ºå¹¶æ‰§è¡Œhincrbyå‘½ä»¤ã€‚å¦‚æœåŸŸfieldä¸å­˜åœ¨ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œå‘½ä»¤å‰ï¼ŒåŸŸçš„å€¼è¢«åˆå§‹åŒ–ä¸º0ã€‚å¯¹ä¸€ä¸ªå­˜å‚¨å­—ç¬¦ä¸²å€¼å¾—åŸŸfieldæ‰§è¡Œhincrbyå‘½ä»¤ï¼Œä¼šè¿”å›é”™è¯¯ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.0.0ã€‚</li><li><strong>hincrbyfloat</strong>ï¼šhincrbyfloat key field incrementï¼›ä¸ºå“ˆå¸Œè¡¨keyä¸­çš„fieldåŠ ä¸Šæµ®ç‚¹æ•°å¢é‡Incrementã€‚å¦‚æœå“ˆå¸Œè¡¨ä¸­æ²¡æœ‰åŸŸfieldï¼Œé‚£ä¹ˆhincrbyfloatä¼šå…ˆå°†åŸŸfieldçš„å€¼è®¾ä¸º0ï¼Œç„¶åå†æ‰§è¡ŒåŠ æ³•æ“ä½œã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.6.0ã€‚</li><li><strong>hkeys</strong>ï¼šhkeys keyï¼›è¿”å›å“ˆå¸Œè¡¨keyä¸­çš„æ‰€æœ‰åŸŸã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.0.0ã€‚</li><li><strong>hlen</strong>ï¼šhlen keyï¼›è¿”å›å“ˆå¸Œè¡¨keyä¸­åŸŸçš„æ•°é‡ã€‚å½“key ä¸å­˜åœ¨æ—¶è¿”å›0ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</li><li><strong>hmget</strong>ï¼šhmget key field [field â€¦]ï¼›è¿”å›å“ˆå¸Œè¡¨keyä¸­ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªç»™å®šåŸŸçš„å€¼ã€‚å¦‚æœç»™å®šçš„åŸŸä¸å­˜åœ¨äºå“ˆå¸Œè¡¨ï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ªnilå€¼ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.0.0ã€‚</li><li><strong>hmset</strong>ï¼šhmset key field value [field value â€¦]ï¼›åŒæ—¶å°†å¤šä¸ªfield-valueè®¾ç½®åˆ°å“ˆå¸Œè¡¨keyä¸­ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.0.0ã€‚</li><li><strong>hset</strong>ï¼šhset key field valueï¼›å°†å“ˆå¸Œè¡¨keyä¸­çš„åŸŸfieldçš„å€¼è®¾ä¸ºvalueã€‚å¦‚æœkeyä¸å­˜åœ¨ï¼Œä¸€ä¸ªæ–°çš„å“ˆå¸Œè¡¨è¢«åˆ›å»ºå¹¶è¿›è¡Œhsetæ“ä½œã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.0.0ã€‚</li><li><strong>hsetnx</strong>ï¼šhsetnx key field valueï¼›å°†å“ˆå¸Œè¡¨keyä¸­çš„åŸŸfieldçš„å€¼è®¾ç½®ä¸ºvalueï¼Œå½“ä¸”ä»…å½“åŸŸfieldä¸å­˜åœ¨ã€‚è®¾ç½®æˆåŠŸï¼Œè¿”å›1ï¼›å¦‚æœç»™å®šåŸŸå·²ç»å­˜åœ¨æ–Œåˆ«æ²¡æœ‰æ“ä½œè¢«æ‰§è¡Œï¼Œè¿”å›0ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.0.0ã€‚</li><li><strong>hvals</strong>ï¼šhvals keyï¼›è¿”å›å“ˆå¸Œè¡¨keyä¸­æ‰€æœ‰åŸŸçš„å€¼ã€‚è¿”å›ä¸€ä¸ªåŒ…å«å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰å€¼çš„è¡¨ï¼›å¦‚æœkeyä¸å­˜åœ¨ï¼Œè¿”å›ä¸€ä¸ªç©ºè¡¨ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=2.0.0ã€‚</li><li><strong>hscan</strong>ï¼šhsan key cursor [match pattern] [count count]ï¼›</li></ol><h3 id="é›†åˆ-Set"><a href="#é›†åˆ-Set" class="headerlink" title="é›†åˆ(Set)"></a>é›†åˆ(Set)</h3><p>é›†åˆç±»å‹ä¸­ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½æœ‰é‡å¤çš„æ•°æ®ï¼Œç—›æ­»é›†åˆç±»å‹ä¸­çš„æ•°æ®æ˜¯æ— åºçš„ã€‚ä¸€ä¸ªé›†åˆç±»å‹å¯ä»¥å­˜å‚¨è‡³å¤š2^32 -1ä¸ªå…ƒç´ ã€‚é›†åˆç±»å‹å’Œåˆ—è¡¨ç±»å‹çš„æœ€å¤§åŒºåˆ«æ˜¯æœ‰åºæ€§å’Œå”¯ä¸€æ€§ã€‚</p><p>é›†åˆç±»å‹çš„å¸¸ç”¨æ“ä½œæ˜¯å‘é›†åˆä¸­åŠ å…¥æˆ–åˆ é™¤å…ƒç´ ï¼Œåˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ã€‚</p><h4 id="å†…éƒ¨æ•°æ®ç»“æ„-3"><a href="#å†…éƒ¨æ•°æ®ç»“æ„-3" class="headerlink" title="å†…éƒ¨æ•°æ®ç»“æ„"></a>å†…éƒ¨æ•°æ®ç»“æ„</h4><p>é›†åˆ(Set)çš„åº•å±‚æ•°æ®ç»“æœæ˜¯intsetæˆ–è€…hashtableã€‚å½“é›†åˆåªåŒ…å«æ•´æ•°å‹å…ƒç´ å¹¶ä¸”å…ƒç´ çš„æ•°é‡ä¸è¶…è¿‡512ä¸ªæ—¶ï¼Œé‡‡ç”¨intsetæ¥å­˜å‚¨ï¼Œå¦åˆ™é‡‡ç”¨hashtableæ¥å­˜å‚¨ï¼Œä½†å¯¹äºsetæ¥è¯´ï¼Œè¯¥hashtableçš„valueå€¼å‡ä¸ºNULLã€‚</p><p>insetçš„ç»“æ„åœ¨æºç <code>intset.h</code>ä¸­æœ‰å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class=" language-c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> intset <span class="token punctuation">{</span>    uint32_t encoding<span class="token punctuation">;</span>    uint32_t length<span class="token punctuation">;</span>    int8_t contents<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span> intset<span class="token punctuation">;</span></code></pre><p>hashtableçš„ç»“æ„å…¶å®å°±æ˜¯å‰é¢ç« èŠ‚ä»‹ç»è¿‡çš„å­—å…¸(dict)ï¼Œè¿™é‡Œä¸å†é‡å¤ä»‹ç»ã€‚</p><h4 id="å¸¸ç”¨å‘½ä»¤-3"><a href="#å¸¸ç”¨å‘½ä»¤-3" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h4><ol><li><p><strong>sadd</strong>ï¼šsadd key member [member â€¦]ï¼›å°†ä¸€ä¸ªæˆ–å¤šä¸ªmemberå…ƒç´ åŠ å…¥åˆ°é›†åˆkeyå½“ä¸­ï¼Œå·²ç»å­˜åœ¨äºé›†åˆçš„memberå…ƒç´ å°†è¢«å¿½ç•¥ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>scard</strong>ï¼šscard keyï¼›è¿”å›é›†åˆkeyä¸­å…ƒç´ çš„æ•°é‡ã€‚å½“keyä¸å­˜åœ¨æ—¶è¿”å›0ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>sdiff</strong>ï¼šsdiff key [key â€¦]ï¼›è¿”å›ä¸€ä¸ªé›†åˆçš„å…¨éƒ¨æˆå‘˜ï¼Œè¯¥é›†åˆæ—¶æ‰€ç”¨ç»™å®šé›†åˆä¹‹é—´çš„å·®é›†ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>sdiffstore</strong>ï¼šsdiffstore destination key [key â€¦]ï¼›è¿™ä¸ªå‘½ä»¤å’Œsdiffç±»ä¼¼ï¼Œä½†å®ƒå°†ç»“æœä¿å­˜åˆ°destinationé›†åˆä¸­ï¼Œè€Œä¸æ˜¯ç®€å•åœ°è¿”å›ç»“æœé›†ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>sinter</strong>ï¼šsinter key [key â€¦]ï¼›è¿”å›é›†åˆçš„äº¤é›†ã€‚å¯ç”¨ç‰ˆæœ¬&gt;1.0.0ã€‚</p></li><li><p><strong>sinterstore</strong>ï¼šsinter destination key [key â€¦]ï¼›è¿™ä¸ªå‘½ä»¤å’Œsinterç±»å‹ï¼Œä½†å®ƒå°†ç»“æœä¿å­˜åˆ°destinationé›†åˆä¸­ï¼Œè€Œä¸æ˜¯ç®€å•åœ°è¿”å›ç»“æœé›†ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>sismember</strong>ï¼šsismember key memeberï¼›åˆ¤æ–­memeberå…ƒç´ æ˜¯å¦ä¸ºé›†åˆkeyçš„æˆå‘˜ã€‚å¦‚æœmemberå…ƒç´ æ—¶é›†åˆkeyçš„æˆå‘˜ï¼Œè¿”å›1;å¦‚æœé›†åˆmemberå…ƒç´ ä¸æ˜¯é›†åˆçš„æˆå‘˜ï¼Œæˆ–keyä¸å­˜åœ¨ï¼Œè¿”å›0ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>smembers</strong>ï¼šsmembers keyï¼›è¿”å›é›†åˆkeyä¸­çš„æ‰€æœ‰æˆå‘˜ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>smove</strong>ï¼šsmove source destination memberï¼›å°†memberå…ƒç´ ä»sourceé›†åˆç§»åŠ¨åˆ°destinationé›†åˆã€‚smoveæ˜¯åŸå­æ€§æ“ä½œã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>spop</strong>ï¼šspop keyï¼›ç§»é™¤å¹¶è¿”å›é›†åˆä¸­çš„ä¸€ä¸ªéšæœºå…ƒç´ ã€‚å½“keyä¸å­˜åœ¨æˆ–è€…keyæ˜¯ç©ºé›†æ—¶ï¼Œè¿”å›nilã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>srandmember</strong>ï¼šsrandmember key [count]ï¼›è‹¥å‘½ä»¤æ‰§è¡Œæ—¶ï¼Œåªæä¾›äº†keyå‚æ•°ï¼Œé‚£ä¹ˆè¿”å›é›†åˆä¸­çš„ä¸€ä¸ªéšæœºå…ƒç´ ã€‚ä»Redis2.6å¼€å§‹ï¼Œsrandmemberå‘½ä»¤æ¥å—å¯é€‰å‚æ•°count:</p><ul><li>å¦‚æœcountä¸ºæ­£æ•°ï¼Œä¸”å°äºé›†åˆåŸºæ•°ï¼Œé‚£ä¹ˆå‘½ä»¤è¿”å›ä¸€ä¸ªåŒ…å«countä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ å„ä¸ç›¸åŒã€‚å¦‚æœcountå¤§äºç­‰äºé›†åˆåŸºæ•°ï¼Œé‚£ä¹ˆè¿”å›æ•´ä¸ªé›†åˆã€‚</li><li>å¦‚æœcountä¸ºè´Ÿæ•°ï¼Œé‚£ä¹ˆå‘½ä»¤è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ ä¼šé‡å¤å¤šæ¬¡å‡ºç°ï¼Œè€Œæ•°ç»„çš„é•¿åº¦ä¸ºcountçš„ç»å¯¹å€¼ã€‚</li></ul><p>å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>srem</strong>ï¼šsrem key member [member â€¦]ï¼›ç§»é™¤é›†åˆkeyä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªmemberå…ƒç´ ï¼Œä¸å­˜åœ¨çš„å…ƒç´ ä¼šè¢«å¿½ç•¥ã€‚å¯ç”¨ç‰ˆæœ¬&gt;1.0.0ã€‚</p></li><li><p><strong>sunion</strong>ï¼šsunion key [key â€¦]ï¼›è¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„å¹¶é›†ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>sunionstore</strong>ï¼šsunionstore destination key [key â€¦]ï¼›è¿™ä¸ªå‘½ä»¤ç±»ä¼¼äºsunionå‘½ä»¤ï¼Œä½†å®ƒå°†ç»“æœä¿å­˜åˆ°destinationé›†åˆï¼Œè€Œä¸æ˜¯ç®€å•åœ°è¿”å›ç»“æœé›†ã€‚å¯ç”¨ç‰ˆæœ¬&gt;=1.0.0ã€‚</p></li><li><p><strong>sscan</strong>ï¼šsscan key cursor [match pattern] [count count]ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾</title>
      <link href="/2019/03/17/SearchIn2DArray/"/>
      <url>/2019/03/17/SearchIn2DArray/</url>
      
        <content type="html"><![CDATA[<h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>åœ¨ä¸€ä¸ªäºŒç»´æ•°ç»„ä¸­ï¼ˆæ¯ä¸ªä¸€ç»´æ•°ç»„çš„é•¿åº¦ç›¸åŒï¼‰ï¼Œæ¯ä¸€è¡Œéƒ½æŒ‰ç…§ä»å·¦åˆ°å³é€’å¢çš„é¡ºåºæ’åˆ—ï¼Œæ¯ä¸€åˆ—éƒ½æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹é€’å¢çš„é¡ºåºæ’åˆ—ã€‚è¯·å®Œæˆä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥è¿™æ ·çš„ä¸€ä¸ªäºŒç»´æ•°ç»„å’Œä¸€ä¸ªæ•´æ•°ï¼Œåˆ¤æ–­æ•´æ•°æ˜¯å¦åœ¨äºŒç»´æ•°ç»„ä¸­ã€‚</p><p><img src="/2019/03/17/SearchIn2DArray/2DArray-1.png" alt></p><h3 id="è§£æ³•ä¸€ï¼šæš´åŠ›è§£æ³•"><a href="#è§£æ³•ä¸€ï¼šæš´åŠ›è§£æ³•" class="headerlink" title="è§£æ³•ä¸€ï¼šæš´åŠ›è§£æ³•"></a>è§£æ³•ä¸€ï¼šæš´åŠ›è§£æ³•</h3><p>æš´åŠ›è§£æ³•æ˜¯æœ€å®¹æ˜“æƒ³åˆ°çš„è§£å†³æ­¤é—®é¢˜çš„æ–¹æ³•ï¼Œå³éå†äºŒç»´æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n*n)ã€‚è¿™ç§å¤„ç†æ–¹å¼è™½ç„¶èƒ½å¤Ÿè§£å†³é—®é¢˜ï¼Œä½†æ˜¯æ²¡æœ‰åˆ©ç”¨ä¸Šé¢˜ç›®ä¸­ç»™å‡ºçš„æ•°ç»„ä»å·¦åˆ°å³ã€ä»ä¸Šåˆ°ä¸‹éƒ½æ˜¯é€’å¢æœ‰åºçš„ç‰¹ç‚¹ã€‚</p><h3 id="è§£æ³•äºŒï¼šäºŒåˆ†æŸ¥æ‰¾"><a href="#è§£æ³•äºŒï¼šäºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="è§£æ³•äºŒï¼šäºŒåˆ†æŸ¥æ‰¾"></a>è§£æ³•äºŒï¼šäºŒåˆ†æŸ¥æ‰¾</h3><p>åœ¨ä¸€ç»´æ•°ç»„ä¸­è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾å¾ˆå®¹æ˜“ï¼Œé‚£ä¹ˆå¯ä»¥å¯¹äºŒç»´æ•°ç»„ä¸­çš„æ¯ä¸€è¡Œè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œä¸€ä¸ªnè¡Œmåˆ—çš„äºŒç»´æ•°ç»„çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(nlogm)ã€‚äºŒåˆ†æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(logm)ï¼Œä¸€å…±nè¡Œï¼Œæ•…æ€»ä½“æ—¶é—´å¤æ‚åº¦æ˜¯O(nlogm)ã€‚</p><h3 id="è§£æ³•ä¸‰ï¼šè§„å¾‹æŸ¥æ‰¾æ³•"><a href="#è§£æ³•ä¸‰ï¼šè§„å¾‹æŸ¥æ‰¾æ³•" class="headerlink" title="è§£æ³•ä¸‰ï¼šè§„å¾‹æŸ¥æ‰¾æ³•"></a>è§£æ³•ä¸‰ï¼šè§„å¾‹æŸ¥æ‰¾æ³•</h3><p>é¢˜ç›®ä¸­ç»™çš„äºŒç»´æ•°ç»„å…·æœ‰ä»å·¦åˆ°å³ã€ä»ä¸Šåˆ°ä¸‹é€’å¢çš„è§„å¾‹ï¼Œå¯ä»¥ä»å·¦ä¸‹è§’ï¼ˆæˆ–å³ä¸Šè§’ï¼‰çš„å…ƒç´ å¼€å§‹æŸ¥æ‰¾ï¼Œå¦‚æœå…ƒç´ a[row] [col] æ¯”targetå°ï¼Œå°±å¾€å³æŸ¥æ‰¾ï¼ˆcol++ï¼‰ï¼›å¦‚æœå…ƒç´ a[row] [col] æ¯”targetå¤§ï¼Œå°±å¾€ä¸ŠæŸ¥æ‰¾ï¼ˆrowâ€”ï¼‰ã€‚ä¾‹å¦‚æŸ¥æ‰¾12çš„è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><p><img src="/2019/03/17/SearchIn2DArray/2DArray-2.png" alt></p><p>ä»å·¦ä¸‹è§’å¼€å§‹æŸ¥æ‰¾</p><pre class=" language-java"><code class="language-java">    <span class="token comment" spellcheck="true">/**     *     * è§„å¾‹æ³•ï¼š     * æ ¹æ®äºŒç»´æ•°ç»„ç”±ä¸Šåˆ°ä¸‹ï¼Œç”±å·¦è‡³ç”±é€’å¢çš„è§„å¾‹ï¼Œä»å·¦ä¸‹è§’å¼€å§‹æŸ¥æ‰¾ï¼Œ     * å¦‚æœtargetå°äºa[i][j]åˆ™å¾€å³æ‰¾ï¼Œå¦‚æœtargetå¤§äºa[i][j]åˆ™å¾€ä¸Šæ‰¾ï¼Œå¦‚æœæ•°å­—å­˜åœ¨ï¼Œå¿…ç„¶å¯ä»¥æ‰¾åˆ°ã€‚     * å¦‚æœæ˜¯n*mçš„æ•°ç»„æ—¶é—´å¤æ‚åº¦2nå³ä¸ºO(n+m)     * @param target     * @param matrix     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">findLB2RT</span><span class="token punctuation">(</span><span class="token keyword">int</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>matrix<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>matrix <span class="token operator">==</span> null <span class="token operator">||</span> matrix<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span> h <span class="token operator">=</span> matrix<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> w <span class="token operator">=</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>target <span class="token operator">&lt;</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> target <span class="token operator">></span> matrix<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">[</span>w<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span> row <span class="token operator">=</span> h<span class="token punctuation">;</span>        <span class="token keyword">int</span> col <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// ä»å³ä¸‹è§’å‘å·¦ä¸Šè§’çš„æ–¹å‘æœç´¢</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>row <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> col  <span class="token operator">&lt;=</span> w<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>target <span class="token operator">></span> matrix<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// targetæ¯”matrix[row][col]å¤§ï¼Œåˆ™å‘å³ç§»åŠ¨</span>                col<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">&lt;</span> matrix<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// targetæ¯”matrix[row][col]å°ï¼Œåˆ™å‘ä¸Šç§»åŠ¨</span>                row<span class="token operator">--</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>ä»å³ä¸Šè§’å¼€å§‹æŸ¥æ‰¾</p><pre class=" language-java"><code class="language-java">    <span class="token comment" spellcheck="true">/**     *     * ä¸€ã€è§„å¾‹æ³•ï¼š     * æ ¹æ®äºŒç»´æ•°ç»„ç”±ä¸Šåˆ°ä¸‹ï¼Œç”±å·¦è‡³ç”±é€’å¢çš„è§„å¾‹ï¼Œä»å³ä¸Šè§’å¼€å§‹æŸ¥æ‰¾ï¼Œ     * å¦‚æœtargetå°äºa[i][j]åˆ™å¾€å·¦æ‰¾ï¼Œå¦‚æœtargetå¤§äºa[i][j]åˆ™å¾€ä¸‹æ‰¾ï¼Œå¦‚æœæ•°å­—å­˜åœ¨ï¼Œå¿…ç„¶å¯ä»¥æ‰¾åˆ°ã€‚     * å¦‚æœæ˜¯n*mçš„æ•°ç»„æ—¶é—´å¤æ‚åº¦2nå³ä¸ºO(n+m)     * @param target     * @param matrix     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">findRT2LB</span><span class="token punctuation">(</span><span class="token keyword">int</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>matrix<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>matrix <span class="token operator">==</span> null <span class="token operator">||</span> matrix<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span> h <span class="token operator">=</span> matrix<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> w <span class="token operator">=</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>target <span class="token operator">&lt;</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> target <span class="token operator">></span> matrix<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">[</span>w<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span> row <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> col <span class="token operator">=</span> w<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// ä»å³ä¸Šè§’å‘å·¦ä¸‹è§’çš„æ–¹å‘æœç´¢</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>row <span class="token operator">&lt;=</span> h <span class="token operator">&amp;&amp;</span> col  <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>target <span class="token operator">&lt;</span> matrix<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// targetæ¯”matrix[row][col]å°ï¼Œåˆ™å‘å·¦ç§»åŠ¨</span>                col<span class="token operator">--</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">></span> matrix<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// targetæ¯”matrix[row][col]å¤§ï¼Œåˆ™å‘ä¸‹ç§»åŠ¨</span>                row<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><h3 id="è§£æ³•å››ï¼šè§„å¾‹äºŒåˆ†æŸ¥æ‰¾"><a href="#è§£æ³•å››ï¼šè§„å¾‹äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="è§£æ³•å››ï¼šè§„å¾‹äºŒåˆ†æŸ¥æ‰¾"></a>è§£æ³•å››ï¼šè§„å¾‹äºŒåˆ†æŸ¥æ‰¾</h3><p>å°†è§£æ³•äºŒå’Œè§£æ³•ä¸‰ç»“åˆï¼šå¯¹æ¯è¡Œæ¯åˆ—éƒ½è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(logn * logm)ã€‚</p><p>ä¾‹å¦‚æŸ¥æ‰¾<strong>ç›®æ ‡æ•°å­—7</strong>ï¼Œé¦–å…ˆä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾å‡ºä¸­é—´è¡Œï¼Œå…±5è¡Œï¼Œé‚£ä¹ˆä¸­é—´è¡Œä¸º(0+4)/ 2 = 2ï¼Œå³ç¬¬ä¸‰è¡Œã€‚æ¥ä¸‹æ¥å¯¹è¿™ä¸€è¡Œè¿›è¡Œè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾å‡ºè¿™ä¸€è¡Œä¸­æœ€åä¸€ä¸ªæ¯”ç›®æ ‡å€¼å°çš„å…ƒç´ ï¼Œè¿™é‡Œæ˜¯6ã€‚æ•°å­—6å¯ä»¥æŠŠäºŒç»´æ•°ç»„åˆ’åˆ†ä¸º4ä¸ªéƒ¨åˆ†ï¼Œå¦‚ä¸‹å›¾ï¼Œ<strong>å·¦ä¸ŠåŒºåŸŸ</strong>çš„å…ƒç´ å€¼éƒ½æ¯”ç›®æ ‡å€¼7å°ï¼Œ<strong>å³ä¸‹åŒºåŸŸ</strong>çš„å…ƒç´ å€¼éƒ½æ¯”ç›®æ ‡å€¼å¤§ï¼Œæ‰€ä»¥åªéœ€è¦åœ¨<strong>å·¦ä¸‹åŒºåŸŸ</strong>å’Œ<strong>å³ä¸ŠåŒºåŸŸ</strong>ä¸­æŸ¥æ‰¾å°±è¡Œäº†ã€‚</p><p><img src="/2019/03/17/SearchIn2DArray/2DArray-3.png" alt></p><pre class=" language-java"><code class="language-java">    <span class="token comment" spellcheck="true">/**     * äºŒã€äºŒåˆ†è§„å¾‹æ³•ï¼š     * å¯¹æ¯è¡Œã€æ¯åˆ—éƒ½ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(logn * logm)     * @param target     * @param matrix     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">find2</span><span class="token punctuation">(</span><span class="token keyword">int</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>matrix<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>matrix <span class="token operator">==</span> null <span class="token operator">||</span> matrix<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span> h <span class="token operator">=</span> matrix<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> w <span class="token operator">=</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>target <span class="token operator">&lt;</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> target <span class="token operator">></span> matrix<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">[</span>w<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * äºŒç»´æ•°ç»„çš„äºŒåˆ†æŸ¥æ‰¾     * @param target     * @param array     * @param startX     * @param startY     * @param endX     * @param endY     * @return     */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">binarySearchIn2DArray</span><span class="token punctuation">(</span><span class="token keyword">int</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span> <span class="token keyword">int</span> startX<span class="token punctuation">,</span> <span class="token keyword">int</span> startY<span class="token punctuation">,</span> <span class="token keyword">int</span> endX<span class="token punctuation">,</span> <span class="token keyword">int</span> endY<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span> startX <span class="token operator">></span> endX <span class="token operator">||</span> startY <span class="token operator">></span> endY<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// é¦–å…ˆï¼Œæ‰¾ä¸­é—´è¡Œ</span>        <span class="token keyword">int</span> midRow <span class="token operator">=</span> <span class="token punctuation">(</span>startX <span class="token operator">+</span> endX<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// å¯¹ä¸€ç»´æ•°ç»„è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾</span>        <span class="token keyword">int</span> r <span class="token operator">=</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> array<span class="token punctuation">[</span>midRow<span class="token punctuation">]</span><span class="token punctuation">,</span> startY<span class="token punctuation">,</span> endY<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>midRow<span class="token punctuation">]</span><span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">==</span> target<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// ç”±åæ ‡råˆ†å‰²å‡ºçš„4ä¸ªéƒ¨åˆ†</span>        <span class="token comment" spellcheck="true">// å·¦ä¸Šéƒ¨åˆ†çš„å€¼éƒ½æ¯”ç›®æ ‡å€¼å°ï¼Œå³ä¸‹éƒ¨åˆ†çš„å€¼éƒ½æ¯”ç›®æ ‡å€¼å¤§</span>        <span class="token comment" spellcheck="true">// æ‰€ä»¥ï¼Œåªéœ€å¯¹ä¸­çš„å·¦ä¸‹éƒ¨åˆ†å’Œå³ä¸Šéƒ¨åˆ†è¿›è¡Œé€’å½’æŸ¥æ‰¾</span>        <span class="token keyword">return</span> <span class="token function">binarySearchIn2DArray</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> array<span class="token punctuation">,</span> midRow <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> startY<span class="token punctuation">,</span> endX<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//åä¸‹åŒºåŸŸ</span>                <span class="token operator">||</span> <span class="token function">binarySearchIn2DArray</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> array<span class="token punctuation">,</span> startX<span class="token punctuation">,</span> r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> midRow <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> endY<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//å³ä¸ŠåŒºåŸŸ</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * ä¸€ç»´æ•°ç»„çš„äºŒåˆ†æŸ¥æ‰¾: æ‰¾å‡ºä¸ç›®æ ‡å€¼ç›¸åŒçš„ä¸‹æ ‡æˆ–æœ€åä¸€ä¸ªæ¯”ç›®æ ‡å€¼å°çš„ä¸‹æ ‡     * @param target     * @param array     * @param start     * @param end     * @return     */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span><span class="token keyword">int</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span> <span class="token keyword">int</span> start<span class="token punctuation">,</span> <span class="token keyword">int</span> end<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>start <span class="token operator">+</span> end<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>target <span class="token operator">==</span> array<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">||</span> start <span class="token operator">></span> end<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> mid<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">&lt;</span> array<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            end <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> array<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            start <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> array<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span></code></pre><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>lancq<span class="token punctuation">.</span>array<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SearchIn2DArray</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     *     * åœ¨ä¸€ä¸ªäºŒç»´æ•°ç»„ä¸­ï¼ˆæ¯ä¸ªä¸€ç»´æ•°ç»„çš„é•¿åº¦ç›¸åŒï¼‰ï¼Œæ¯ä¸€è¡Œéƒ½æŒ‰ç…§ä»å·¦åˆ°å³é€’å¢çš„é¡ºåºæ’åˆ—ï¼Œæ¯ä¸€åˆ—éƒ½æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹é€’å¢çš„é¡ºåºæ’åˆ—ã€‚     * è¯·å®Œæˆä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥è¿™æ ·çš„ä¸€ä¸ªäºŒç»´æ•°ç»„å’Œä¸€ä¸ªæ•´æ•°ï¼Œåˆ¤æ–­æ•´æ•°æ˜¯å¦åœ¨äºŒç»´æ•°ç»„ä¸­ã€‚     * [     * [1,2,4,8,10]     * [3,8,9,10,11]     * [5,9,11,13,16]     * [7,10,13,15,19]     * ]     */</span>    <span class="token comment" spellcheck="true">/**     *     * ä¸€ã€è§„å¾‹æ³•ï¼š     * æ ¹æ®äºŒç»´æ•°ç»„ç”±ä¸Šåˆ°ä¸‹ï¼Œç”±å·¦è‡³ç”±é€’å¢çš„è§„å¾‹ï¼Œä»å³ä¸Šè§’å¼€å§‹æŸ¥æ‰¾ï¼Œ     * å¦‚æœtargetå°äºa[i][j]åˆ™å¾€å·¦æ‰¾ï¼Œå¦‚æœtargetå¤§äºa[i][j]åˆ™å¾€ä¸‹æ‰¾ï¼Œå¦‚æœæ•°å­—å­˜åœ¨ï¼Œå¿…ç„¶å¯ä»¥æ‰¾åˆ°ã€‚     * å¦‚æœæ˜¯n*mçš„æ•°ç»„æ—¶é—´å¤æ‚åº¦2nå³ä¸ºO(n+m)     * @param target     * @param matrix     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">findRT2LB</span><span class="token punctuation">(</span><span class="token keyword">int</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>matrix<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>matrix <span class="token operator">==</span> null <span class="token operator">||</span> matrix<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span> h <span class="token operator">=</span> matrix<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> w <span class="token operator">=</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>target <span class="token operator">&lt;</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> target <span class="token operator">></span> matrix<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">[</span>w<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span> row <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> col <span class="token operator">=</span> w<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// ä»å³ä¸Šè§’å‘å·¦ä¸‹è§’çš„æ–¹å‘æœç´¢</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>row <span class="token operator">&lt;=</span> h <span class="token operator">&amp;&amp;</span> col  <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>target <span class="token operator">&lt;</span> matrix<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// targetæ¯”matrix[row][col]å°ï¼Œåˆ™å‘å·¦ç§»åŠ¨</span>                col<span class="token operator">--</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">></span> matrix<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// targetæ¯”matrix[row][col]å¤§ï¼Œåˆ™å‘ä¸‹ç§»åŠ¨</span>                row<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     *     * ä¸€ã€è§„å¾‹æ³•ï¼š     * æ ¹æ®äºŒç»´æ•°ç»„ç”±ä¸Šåˆ°ä¸‹ï¼Œç”±å·¦è‡³ç”±é€’å¢çš„è§„å¾‹ï¼Œä»å·¦ä¸‹è§’å¼€å§‹æŸ¥æ‰¾ï¼Œ     * å¦‚æœtargetå°äºa[i][j]åˆ™å¾€å³æ‰¾ï¼Œå¦‚æœtargetå¤§äºa[i][j]åˆ™å¾€ä¸Šæ‰¾ï¼Œå¦‚æœæ•°å­—å­˜åœ¨ï¼Œå¿…ç„¶å¯ä»¥æ‰¾åˆ°ã€‚     * å¦‚æœæ˜¯n*mçš„æ•°ç»„æ—¶é—´å¤æ‚åº¦2nå³ä¸ºO(n+m)     * @param target     * @param matrix     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">findLB2RT</span><span class="token punctuation">(</span><span class="token keyword">int</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>matrix<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>matrix <span class="token operator">==</span> null <span class="token operator">||</span> matrix<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span> h <span class="token operator">=</span> matrix<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> w <span class="token operator">=</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>target <span class="token operator">&lt;</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> target <span class="token operator">></span> matrix<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">[</span>w<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span> row <span class="token operator">=</span> h<span class="token punctuation">;</span>        <span class="token keyword">int</span> col <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// ä»å³ä¸‹è§’å‘å·¦ä¸Šè§’çš„æ–¹å‘æœç´¢</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>row <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> col  <span class="token operator">&lt;=</span> w<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>target <span class="token operator">></span> matrix<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// targetæ¯”matrix[row][col]å¤§ï¼Œåˆ™å‘å³ç§»åŠ¨</span>                col<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">&lt;</span> matrix<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// targetæ¯”matrix[row][col]å°ï¼Œåˆ™å‘ä¸Šç§»åŠ¨</span>                row<span class="token operator">--</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * äºŒã€äºŒåˆ†è§„å¾‹æ³•ï¼š     * å¯¹æ¯è¡Œã€æ¯åˆ—éƒ½ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(logn * logm)     * @param target     * @param matrix     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">find2</span><span class="token punctuation">(</span><span class="token keyword">int</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>matrix<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>matrix <span class="token operator">==</span> null <span class="token operator">||</span> matrix<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span> h <span class="token operator">=</span> matrix<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> w <span class="token operator">=</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>target <span class="token operator">&lt;</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> target <span class="token operator">></span> matrix<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">[</span>w<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">binarySearchIn2DArray</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> matrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> h<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * äºŒç»´æ•°ç»„çš„äºŒåˆ†æŸ¥æ‰¾     * @param target     * @param array     * @param startX     * @param startY     * @param endX     * @param endY     * @return     */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">binarySearchIn2DArray</span><span class="token punctuation">(</span><span class="token keyword">int</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span> <span class="token keyword">int</span> startX<span class="token punctuation">,</span> <span class="token keyword">int</span> startY<span class="token punctuation">,</span> <span class="token keyword">int</span> endX<span class="token punctuation">,</span> <span class="token keyword">int</span> endY<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span> startX <span class="token operator">></span> endX <span class="token operator">||</span> startY <span class="token operator">></span> endY<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// é¦–å…ˆï¼Œæ‰¾ä¸­é—´è¡Œ</span>        <span class="token keyword">int</span> midRow <span class="token operator">=</span> <span class="token punctuation">(</span>startX <span class="token operator">+</span> endX<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// å¯¹ä¸€ç»´æ•°ç»„è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾</span>        <span class="token keyword">int</span> r <span class="token operator">=</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> array<span class="token punctuation">[</span>midRow<span class="token punctuation">]</span><span class="token punctuation">,</span> startY<span class="token punctuation">,</span> endY<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>midRow<span class="token punctuation">]</span><span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">==</span> target<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// ç”±åæ ‡råˆ†å‰²å‡ºçš„4ä¸ªéƒ¨åˆ†</span>        <span class="token comment" spellcheck="true">// å·¦ä¸Šéƒ¨åˆ†çš„å€¼éƒ½æ¯”ç›®æ ‡å€¼å°ï¼Œå³ä¸‹éƒ¨åˆ†çš„å€¼éƒ½æ¯”ç›®æ ‡å€¼å¤§</span>        <span class="token comment" spellcheck="true">// æ‰€ä»¥ï¼Œåªéœ€å¯¹ä¸­çš„å·¦ä¸‹éƒ¨åˆ†å’Œå³ä¸Šéƒ¨åˆ†è¿›è¡Œé€’å½’æŸ¥æ‰¾</span>        <span class="token keyword">return</span> <span class="token function">binarySearchIn2DArray</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> array<span class="token punctuation">,</span> midRow <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> startY<span class="token punctuation">,</span> endX<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//åä¸‹åŒºåŸŸ</span>                <span class="token operator">||</span> <span class="token function">binarySearchIn2DArray</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> array<span class="token punctuation">,</span> startX<span class="token punctuation">,</span> r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> midRow <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> endY<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//å³ä¸ŠåŒºåŸŸ</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * ä¸€ç»´æ•°ç»„çš„äºŒåˆ†æŸ¥æ‰¾: æ‰¾å‡ºä¸ç›®æ ‡å€¼ç›¸åŒçš„ä¸‹æ ‡æˆ–æœ€åä¸€ä¸ªæ¯”ç›®æ ‡å€¼å°çš„ä¸‹æ ‡     * @param target     * @param array     * @param start     * @param end     * @return     */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span><span class="token keyword">int</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span> <span class="token keyword">int</span> start<span class="token punctuation">,</span> <span class="token keyword">int</span> end<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>start <span class="token operator">+</span> end<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>target <span class="token operator">==</span> array<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">||</span> start <span class="token operator">></span> end<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> mid<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">&lt;</span> array<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            end <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> array<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            start <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> array<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>                <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">{</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">findRT2LB</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">findLB2RT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> b<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">29</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">binarySearch</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">binarySearch</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> c<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>                <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">{</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">29</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">{</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">29</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">{</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">27</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token number">39</span><span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">binarySearchIn2DArray</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>length<span class="token punctuation">,</span> c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">find2</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">find2</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">find2</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">find2</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">find2</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼š<span class="token boolean">true</span><span class="token boolean">true</span><span class="token number">1</span><span class="token number">1</span><span class="token boolean">true</span><span class="token boolean">true</span><span class="token boolean">true</span><span class="token boolean">true</span><span class="token boolean">false</span><span class="token boolean">false</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è·³è·ƒæ¸¸æˆII</title>
      <link href="/2019/03/16/JumpGame2/"/>
      <url>/2019/03/16/JumpGame2/</url>
      
        <content type="html"><![CDATA[<p>ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ï¼Œä½ æœ€åˆä½äºæ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä½ åœ¨è¯¥ä½ç½®å¯ä»¥è·³è·ƒçš„æœ€å¤§é•¿åº¦ã€‚ä½ çš„ç›®æ ‡æ˜¯ä½¿ç”¨æœ€å°‘çš„è·³è·ƒæ¬¡æ•°åˆ°è¾¾æ•°ç»„çš„æœ€åä¸€ä¸ªä½ç½®ã€‚<a href="https://leetcode-cn.com/problems/jump-game-ii/" target="_blank" rel="noopener">LeetCode</a></p><p>ç¤ºä¾‹</p><pre><code>è¾“å…¥: [2,3,1,1,4]è¾“å‡º: 2è§£é‡Š: è·³åˆ°æœ€åä¸€ä¸ªä½ç½®çš„æœ€å°è·³è·ƒæ•°æ˜¯ 2ã€‚     ä»ä¸‹æ ‡ä¸º 0 è·³åˆ°ä¸‹æ ‡ä¸º 1 çš„ä½ç½®ï¼Œè·³ 1 æ­¥ï¼Œç„¶åè·³ 3 æ­¥åˆ°è¾¾æ•°ç»„çš„æœ€åä¸€ä¸ªä½ç½®ã€‚</code></pre><p><strong>è¯´æ˜:</strong></p><p>å‡è®¾ä½ æ€»æ˜¯å¯ä»¥åˆ°è¾¾æ•°ç»„çš„æœ€åä¸€ä¸ªä½ç½®ã€‚</p><p><strong>è´ªå¿ƒç®—æ³•ï¼š</strong></p><p>è¿™é‡Œè´ªå¿ƒçš„æ„æ€ï¼Œä¸æ˜¯è¯´å½“å‰ä½ç½®æœ€å¤§å¯ä»¥è·³å¤šå°‘æ­¥å°±è·³å¤šå°‘æ­¥ï¼Œè€Œæ˜¯åœ¨å½“å‰ä½ç½®å¯ä»¥è·³çš„æ­¥æ•°çš„èŒƒå›´å†…ï¼Œé€‰æ‹©ä¸‹ä¸€è·³å¯ä»¥è·³çš„æœ€è¿œçš„é‚£ä¸ªæ­¥æ•°ï¼Œæ¥å†³å®šå½“å‰è·³å¤šå°‘æ­¥ã€‚</p><p>è§£é¢˜æ€è·¯ï¼š</p><ul><li>å¦Lã€Rå‡è¡¨ç¤ºæ•°ç»„çš„ä¸‹æ ‡ä½ç½®ï¼›<ul><li>åœ¨[L,R]èŒƒå›´å†…æ‰¾å‡ºæœ€å¤§çš„æ•°ä½œä¸ºä¸‹ä¸€ä¸ªè·³è·ƒçš„ä½ç½®ï¼Œæ‰€ä»¥å…³é”®æ˜¯æ€ä¹ˆæ‰¾å‡ºä¸‹ä¸€ä¸ªè·³è·ƒçš„ä½ç½®ï¼›</li><li>ä¾‹å­a=[2,3,1,1,4]</li><li>å¼€å§‹,ç¬¬a[0]=2ï¼Œåˆ™ã€L,Rã€‘=ã€0,2ã€‘ï¼Œåœ¨æ­¤åŒºé—´å†…å¯ä»¥åˆ°è¾¾çš„ä½ç½®ä¸º{a[0]+0, a[1]+1, a[2]+2} = {2+0, 3+1, 1+2}ï¼Œæœ€å¤§å€¼ä¸ºa[1]+1=3+1ï¼Œæ‰€ä»¥ä¸‹ä¸€ä¸ªè·³è·ƒçš„ä½ç½®å°±ä¸ºa[1];</li><li>L=1,R=a[1]=3ï¼Œåˆ™ã€L,Rã€‘=ã€1,4ã€‘ï¼Œåœ¨æ­¤åŒºé—´å†…å¯åˆ°è¾¾çš„ä½ç½®{a[1]+1, a[2]+2, a[3]+3, a[4]+4}={3+1,1+2,1+3,4+4}={4,3,4,8},æœ€å¤§å€¼ä¸ºa[4]+4=8,æ‰€ä»¥ä¸‹ä¸€æ¬¡è·³è·ƒçš„ä½ç½®ä¸ºa[4]ï¼Œå³è·³åˆ°æœ€åä¸€ä¸ªä½ç½®è‡³å°‘è¦2æ­¥ã€‚</li></ul></li></ul><pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">jump</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//ä¸ç”¨è·³çš„æƒ…å†µ</span>        <span class="token keyword">if</span><span class="token punctuation">(</span> a <span class="token operator">==</span> null <span class="token operator">||</span> a<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span> step <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">/**         * å¦Lã€Rå‡è¡¨ç¤ºæ•°ç»„çš„ä¸‹æ ‡ä½ç½®         * åœ¨[L,R]èŒƒå›´å†…æ‰¾å‡ºæœ€å¤§çš„æ•°ä½œä¸ºä¸‹ä¸€ä¸ªè·³è·ƒçš„ä½ç½®ï¼Œæ‰€ä»¥å…³é”®æ˜¯æ€ä¹ˆæ‰¾å‡ºä¸‹ä¸€ä¸ªè·³è·ƒçš„ä½ç½®         * ä¾‹å­a=[2,3,1,1,4]         * å¼€å§‹,ç¬¬a[0]=2ï¼Œåˆ™ã€L,Rã€‘=ã€0,2ã€‘ï¼Œåœ¨æ­¤åŒºé—´å†…å¯ä»¥åˆ°è¾¾çš„ä½ç½®ä¸º{a[0]+0,a[1]+1,a[2]+2}={2+0,3+1,1+2},æœ€å¤§å€¼ä¸ºa[1]+1=3+1ï¼Œæ‰€ä»¥ä¸‹ä¸€ä¸ªè·³è·ƒçš„ä½ç½®å°±ä¸ºa[1];         * L=1,R=a[1]=3,åˆ™ã€L,Rã€‘=ã€1,4ã€‘ï¼Œåœ¨æ­¤åŒºé—´å†…å¯åˆ°è¾¾çš„ä½ç½®{a[1]+1,a[2]+2,a[3]+3,a[4]+4}={3+1,1+2,1+3,4+4}={4,3,4,8},æœ€å¤§å€¼ä¸ºa[4]+4=8,æ‰€ä»¥ä¸‹ä¸€æ¬¡è·³è·ƒçš„ä½ç½®ä¸ºa[4]ï¼Œå³è·³åˆ°æœ€åä¸€ä¸ªä½ç½®è‡³å°‘è¦2æ­¥ã€‚         */</span>        <span class="token keyword">int</span> L <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> R <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>R <span class="token operator">&lt;</span> a<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// åŒºé—´ä¸­å¯ä»¥è·³è·ƒçš„æœ€å¤§ä½ç½®</span>            <span class="token keyword">int</span> maxIndex <span class="token operator">=</span> a<span class="token punctuation">[</span>L<span class="token punctuation">]</span><span class="token punctuation">;</span>             <span class="token comment" spellcheck="true">// å–åŒºé—´å†…a[i]+iæœ€å¤§å€¼</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span> L<span class="token punctuation">;</span> i<span class="token operator">&lt;=</span>R<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                maxIndex <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> maxIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            L <span class="token operator">=</span> R <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>            R <span class="token operator">=</span> maxIndex<span class="token punctuation">;</span>            step<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> step<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    </code></pre>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> ç®—æ³• </tag>
            
            <tag> LeetCode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¾“å‡ºæ­£æ•´æ•°Nä»¥å†…çš„æ‰€æœ‰è´¨æ•°ï¼ˆç´ æ•°ï¼‰</title>
      <link href="/2019/03/06/GetPrimes/"/>
      <url>/2019/03/06/GetPrimes/</url>
      
        <content type="html"><![CDATA[<h3 id="è¾“å‡ºNä»¥å†…çš„æ‰€æœ‰è´¨æ•°ï¼ˆç´ æ•°ï¼‰"><a href="#è¾“å‡ºNä»¥å†…çš„æ‰€æœ‰è´¨æ•°ï¼ˆç´ æ•°ï¼‰" class="headerlink" title="è¾“å‡ºNä»¥å†…çš„æ‰€æœ‰è´¨æ•°ï¼ˆç´ æ•°ï¼‰"></a>è¾“å‡ºNä»¥å†…çš„æ‰€æœ‰è´¨æ•°ï¼ˆç´ æ•°ï¼‰</h3><p>ä¾‹å¦‚ï¼šè¾“å…¥20ï¼Œè¾“å‡º[2,3,5,7,11,13,17,19]</p><h3 id="æ–¹æ³•1ï¼šè´ªå¿ƒç®—æ³•"><a href="#æ–¹æ³•1ï¼šè´ªå¿ƒç®—æ³•" class="headerlink" title="æ–¹æ³•1ï¼šè´ªå¿ƒç®—æ³•"></a>æ–¹æ³•1ï¼šè´ªå¿ƒç®—æ³•</h3><p>çœ‹åˆ°è¿™åˆ°é¢˜æ—¶ï¼Œç«‹åˆ»å°±èƒ½æƒ³åˆ°ç”¨åµŒå¥—å¾ªç¯ï¼Œå¯¹äºä»»æ„çš„nå¯¹ã€2ï¼Œn-1ã€‘ä¹‹é—´æ¯ä¸ªæ•°å–ä½™ï¼Œå¦‚æœä½™æ•°0ï¼Œè¯´æ˜èƒ½é™¤å°½ï¼Œåˆ™ä¸æ˜¯ç´ æ•°ï¼ˆè´¨æ•°ï¼‰ã€‚</p><pre class=" language-java"><code class="language-java">    <span class="token comment" spellcheck="true">/**     * è´ªå¿ƒç®—æ³•     * @param num     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> <span class="token function">getPrimes</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>        List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>num <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">int</span> n <span class="token operator">=</span> num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token keyword">while</span><span class="token punctuation">(</span>n <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">%</span> n <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    n<span class="token operator">--</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            num<span class="token operator">--</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> list<span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><h3 id="æ–¹æ³•2ï¼šç®—æ³•æ”¹è¿›"><a href="#æ–¹æ³•2ï¼šç®—æ³•æ”¹è¿›" class="headerlink" title="æ–¹æ³•2ï¼šç®—æ³•æ”¹è¿›"></a>æ–¹æ³•2ï¼šç®—æ³•æ”¹è¿›</h3><p>å…¶å®ï¼Œè´ªå¿ƒç®—æ³•ä¸­å³ä¸€äº›å¤šä½™çš„åˆ¤æ–­ï¼Œæ¯”å¦‚ï¼Œå¶æ•°è‚¯å®šä¸æ˜¯è´¨æ•°ï¼›å¯¹äºä¸€ä¸ªæ­£æ•´æ•°nåªéœ€è¦åˆ¤æ–­ã€2ï¼Œnçš„å¹³æ–¹æ ¹ã€‘ä¹‹é—´çš„æœ‰æ²¡æœ‰æ•´æ•°èƒ½è¢«næ•´é™¤ï¼Œå¦‚æœæœ‰å°±ä¸æ˜¯è´¨æ•°ã€‚</p><pre class=" language-java"><code class="language-java">   <span class="token comment" spellcheck="true">/**     * ç®—æ³•ä¼˜åŒ–ï¼šæ¯ä¸ªæ•°nåªæ¯”è¾ƒ[2 ~ sqrt(n)]ä¹‹å†…çš„å¥‡æ•°     * @param num     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> <span class="token function">getPrimes2</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span><span class="token punctuation">{</span>        List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> list<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> num<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">int</span> sqrt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>            <span class="token keyword">while</span><span class="token punctuation">(</span>j <span class="token operator">&lt;=</span> sqrt<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">%</span> j <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    j <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//åªåˆ¤æ–­å¥‡æ•°</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//åªåˆ¤æ–­å¥‡æ•°</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> list<span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è·³è·ƒæ¸¸æˆ</title>
      <link href="/2019/03/02/JumpGame/"/>
      <url>/2019/03/02/JumpGame/</url>
      
        <content type="html"><![CDATA[<p>ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ï¼Œä½ æœ€åˆä½äºæ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä½ åœ¨è¯¥ä½ç½®å¯ä»¥è·³è·ƒçš„æœ€å¤§é•¿åº¦ã€‚åˆ¤æ–­ä½ æ˜¯å¦èƒ½å¤Ÿåˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚<a href="https://leetcode-cn.com/problems/jump-game/" target="_blank" rel="noopener">LeetCode</a></p><p>ç¤ºä¾‹1</p><pre class=" language-txt"><code class="language-txt">è¾“å…¥: [2,3,1,1,4]è¾“å‡º: trueè§£é‡Š: ä»ä½ç½® 0 åˆ° 1 è·³ 1 æ­¥, ç„¶åè·³ 3 æ­¥åˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚</code></pre><p>ç¤ºä¾‹2</p><pre class=" language-txt"><code class="language-txt">è¾“å…¥: [3,2,1,0,4]è¾“å‡º: falseè§£é‡Š: æ— è®ºæ€æ ·ï¼Œä½ æ€»ä¼šåˆ°è¾¾ç´¢å¼•ä¸º 3 çš„ä½ç½®ã€‚ä½†è¯¥ä½ç½®çš„æœ€å¤§è·³è·ƒé•¿åº¦æ˜¯ 0 ï¼Œ æ‰€ä»¥ä½ æ°¸è¿œä¸å¯èƒ½åˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚</code></pre><p>æš´åŠ›è§£æ³•</p><p>å¤„ç†æ€è·¯ï¼šä»¤reach=0,ç„¶åéå†æ•°ç»„å…ƒç´ æ¯”è¾ƒa[i]+iä¸reachçš„å¤§å°ï¼Œå¦‚æœæ¯”reachå€¼å¤§å°±å’Œreachçš„å€¼äº¤æ¢ï¼Œå¦åˆ™reachä¸å˜ï¼Œæœ€åå¦‚æœreachå¤§äºç­‰äºæ•°ç»„çš„é•¿åº¦ï¼Œè¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">canJump</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> reach <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> a<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> reach<span class="token punctuation">)</span><span class="token punctuation">{</span>            reach <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>reach<span class="token punctuation">,</span> i <span class="token operator">+</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>reach <span class="token operator">>=</span> a<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            i<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> ç®—æ³• </tag>
            
            <tag> LeetCode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼</title>
      <link href="/2019/03/02/DesignPattern/"/>
      <url>/2019/03/02/DesignPattern/</url>
      
        <content type="html"><![CDATA[<p>ç”µå•†ã€ç¤¾äº¤ç½‘ç»œã€ç§»åŠ¨äº’è”ç½‘â€¦â€¦è¿™ä¸€ä¸ªä¸ªåç§°æˆä¸ºè¿‘å‡ å¹´æ¥äº’è”ç½‘å‘å±•çš„ä»£åè¯ï¼Œè€Œåœ¨èƒŒåæ¨åŠ¨è€…ä¸­é«˜æ•°å‘å±•çš„å°±æ˜¯æŠ€æœ¯ã€‚æ•æ·å¼€å‘æ˜¯äº’è”ç½‘ä¼ä¸šè¿›è¡Œäº§å“å¼€å‘æ—¶å¸¸ç”¨çš„ä¸€ç§æ¨¡å¼ï¼Œä¸€ä¸ªäº§å“ä»åˆ¶å®šéœ€æ±‚åˆ°ä¸Šçº¿ç”šè‡³åœ¨ä¸€å‘¨ä¹‹å†…å°±è¦ç‹æœï¼Œæ¯•ç«Ÿå¿«ç«äº‰å¯¹æ‰‹ä¸€æ­¥æ‰èƒ½æŠ“ä½æ›´å¤šçš„ç”¨æˆ·ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€äº›ä¹…ç»è€ƒéªŒçš„æ¶æ„æ¨¡å¼è¢«å¹¿æ³›çš„ä½¿ç”¨èµ·æ¥ï¼Œå½“ç¡®å®šä¸€ä¸ªäº§å“çš„æ¶æ„æ–¹æ¡ˆæ—¶ï¼Œâ€è®¾è®¡æ¨¡å¼â€œä¸€è¯è¢«è¶Šæ¥è¶Šå¤šçš„æå‡ºæ¥ï¼Œç”šè‡³ä¸€äº›å…¬å¸æ—¢å®šçš„æ¡†æ¶å°±æ˜¯æŸä¸€ä¸ªæˆ–å‡ ä¸ªè®¾è®¡æ¨¡å¼çš„ä½“ç°ã€‚</p><p>è®¾è®¡æ¨¡å¼ï¼ˆDesign Patternï¼‰æ˜¯ä¸€å¥—é¢å‘å¯¹è±¡çš„ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ï¼Œæ˜¯åœ¨ç¼–ç¨‹é¢†åŸŸè¢«åå¤ä½¿ç”¨ã€è¢«å¤šäººçŸ¥æ™“ã€è€Œä¸”å·¾å¸¼åˆ†ç±»æ•´ç†çš„ä»£ç è®¾è®¡æ–¹æ³•ã€‚æœ€ç»å…¸çš„è®¾è®¡æ¨¡å¼æ˜¯ç”±GOFï¼ˆâ€œå››äººå¸®â€ï¼‰åœ¨1995å¹´æå‡ºçš„23ç§è®¾è®¡æ¨¡å¼ã€‚è®¾è®¡æ¨¡å¼æœ‰23ç§å•ä¸ä»…ä»…é™äº23ç§ï¼Œ<a href="https://en.wikipedia.org/wiki/Design_Patterns" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a>ä¸­å¯¹è½¯ä»¶çš„å„ç§è®¾è®¡æ¨¡å¼æœ‰å¾ˆè¯¦ç»†çš„ä»‹ç»ã€‚</p><h2 id="è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™"><a href="#è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™" class="headerlink" title="è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™"></a>è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™</h2><h3 id="å•ä¸€èŒè´£åŸåˆ™"><a href="#å•ä¸€èŒè´£åŸåˆ™" class="headerlink" title="å•ä¸€èŒè´£åŸåˆ™"></a>å•ä¸€èŒè´£åŸåˆ™</h3><p>å•ä¸€èŒè´£åŸåˆ™ä¹Ÿè¢«ç§°ä½œæ¥å£éš”ç¦»åŸåˆ™ï¼Œå…¶å®šä¹‰ï¼šå¯¹äºä¸€ä¸ªç±»ï¼Œåº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ã€‚</p><p>å•ä¸€èŒè´£çš„æœ¬è´¨æ˜¯ä½¿ç”¨å¤šä¸ªéš”ç¦»çš„æ¥å£ï¼Œæ¯”ä½¿ç”¨å•ä¸ªæ¥å£è¦å¥½ã€‚è¿˜æ˜¯ä¸€ä¸ªé™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦çš„æ„æ€ï¼Œä»è¿™å„¿æˆ‘ä»¬çœ‹å‡ºï¼Œå…¶å®è®¾è®¡æ¨¡å¼å°±æ˜¯ä¸€ä¸ªè½¯ä»¶çš„è®¾è®¡æ€æƒ³ï¼Œä»å¤§å‹è½¯ä»¶æ¶æ„å‡ºå‘ï¼Œä¸ºäº†å‡çº§å’Œç»´æŠ¤æ–¹ä¾¿ã€‚</p><h3 id="é‡Œæ°ä»£æ¢åŸåˆ™"><a href="#é‡Œæ°ä»£æ¢åŸåˆ™" class="headerlink" title="é‡Œæ°ä»£æ¢åŸåˆ™"></a>é‡Œæ°ä»£æ¢åŸåˆ™</h3><p>é‡Œæ°ä»£æ¢åŸåˆ™çš„å®šä¹‰ï¼šå­ç±»å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰å®ƒä»¬çš„çˆ¶ç±»å‹ã€‚</p><h3 id="å¼€é—­åŸåˆ™"><a href="#å¼€é—­åŸåˆ™" class="headerlink" title="å¼€é—­åŸåˆ™"></a>å¼€é—­åŸåˆ™</h3><p>å¼€é—­åŸåˆ™çš„å®šä¹‰ ï¼šç¨‹åºçš„å®ä½“å¯¹è±¡ï¼ˆæ¨¡å—ã€ç±»ã€å‡½æ•°ï¼‰åº”è¯¥å¯ä»¥è¿›è¡Œæ‰©å±•ï¼Œä½†ä¸åº”è¯¥å¯ä»¥ä¿®æ”¹ã€‚</p><p>å¼€é—­åŸåˆ™æœ‰ä¸¤ä¸ªç‰¹å¾ï¼š</p><ul><li><p>å¯¹äºæ‰©å±•æ˜¯å¼€æ”¾çš„ï¼›</p></li><li><p>å¯¹äºä¿®æ”¹æ˜¯å°é—­çš„ï¼›</p></li></ul><h3 id="ä¾èµ–å€’è½¬åŸåˆ™"><a href="#ä¾èµ–å€’è½¬åŸåˆ™" class="headerlink" title="ä¾èµ–å€’è½¬åŸåˆ™"></a>ä¾èµ–å€’è½¬åŸåˆ™</h3><p>ä¾èµ–å€’è½¬åŸåˆ™çš„å®šä¹‰ï¼šç¨‹åºçš„é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºåº•å±‚æ¨¡å—ï¼Œä½†ä¸¤è€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡ï¼›æŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºå…·ä½“ç»†èŠ‚ï¼Œè€Œç»†èŠ‚åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚é€šä¿—çš„è®²å°±æ˜¯é¢å‘å¯¹è±¡åº”è¯¥é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹ã€‚</p><p>ä¾èµ–å€’è½¬åŸåˆ™çš„æœ¬è´¨æ˜¯é€šè¿‡æŠ½è±¡ï¼ˆæ¥å£æˆ–æŠ½è±¡ç±»ï¼‰ä½¿å„ä¸ªç±»æˆ–æ¨¡å—çš„å®ç°å½¼æ­¤ç‹¬ç«‹ï¼Œäº’ä¸å½±å“ï¼Œä»è€Œå®ç°æ¨¡å—é—´çš„æ¾è€¦åˆã€‚</p><h3 id="åˆæˆå¤ç”¨åŸåˆ™"><a href="#åˆæˆå¤ç”¨åŸåˆ™" class="headerlink" title="åˆæˆå¤ç”¨åŸåˆ™"></a>åˆæˆå¤ç”¨åŸåˆ™</h3><p>åˆæˆå¤ç”¨åŸåˆ™çš„å®šä¹‰ï¼šå°½é‡ä¸ä½¿ç”¨ç»§æ‰¿ï¼Œè€Œå°½é‡ä½¿ç”¨åˆæˆ/èšåˆã€‚</p><p>åˆæˆäºèšå’Œéƒ½æ˜¯ç±»ä¹‹é—´ç‰¹æ®Šçš„å…³è”å…³ç³»ã€‚èšåˆè¡¨ç¤ºæ¯”è¾ƒâ€œå¼±â€çš„æ‹¥æœ‰å…³ç³»ï¼Œå…·ä½“ä½“ç°æ˜¯ç”²å¯¹è±¡ä¸­å¯ä»¥åŒ…å«ä¹™å¯¹è±¡ï¼Œä½†ä¹™å¯¹è±¡ä¸ä¸æ˜¯ç”²å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼›åˆæˆåˆ™æ˜¯ä¸€ç§æ¯”è¾ƒâ€œå¼ºâ€çš„æ‹¥æœ‰å…³ç³»ï¼Œä½“ç°çš„æ˜¯ä¸¥æ ¼çš„æ•´ä½“ä¸éƒ¨åˆ†ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶ä¸”æ•´ä½“ä¸éƒ¨åˆ†æ‹¥æœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸã€‚æ¯”å¦‚é±¼å’Œé±¼ç¾¤æ˜¯èšåˆå…³ç³»ï¼Œæ‰‹è‡‚å’Œäººä½“ä¹‹é—´æ˜¯éƒ¨åˆ†ä¸æ•´ä½“çš„åˆæˆå…³ç³»ã€‚</p><h3 id="è¿ªç±³ç‰¹æ³•åˆ™"><a href="#è¿ªç±³ç‰¹æ³•åˆ™" class="headerlink" title="è¿ªç±³ç‰¹æ³•åˆ™"></a>è¿ªç±³ç‰¹æ³•åˆ™</h3><p>è¿ªç±³ç‰¹æ³•åˆ™ä¹Ÿè¢«ç§°ä½œæœ€å°‘çŸ¥é“åŸåˆ™ï¼Œå°±æ˜¯è¯´ä¸€ä¸ªå¯¹è±¡åº”å½“å°½å¯èƒ½å°‘åœ°äº†è§£å…¶ä»–å¯¹è±¡â€”â€”ä¸å’Œé™Œç”Ÿäººè¯´è¯ã€‚</p><p>è¿ªç±³ç‰¹æ³•åˆ™çš„å®šä¹‰ï¼šå¦‚æœä¸¤ä¸ªç±»ä¹‹é—´ä¸å¿…ç›´æ¥é€šä¿¡ï¼Œåˆ™è¿™ä¸¤ä¸ªç±»ä¸åº”è¯¥å‘ç”Ÿç›´æ¥çš„ç›¸äº’ä½œç”¨ã€‚å¦‚æœå…¶ä¸­çš„ä¸€ä¸ªç±»éœ€è¦è°ƒç”¨å¦ä¸€ä¸ªç±»çš„æŸä¸ªæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡ç¬¬ä¸‰è€…æ¥è½¬å‘è¿™ä¸ªè°ƒç”¨ã€‚</p><h2 id="23ç§ç»å…¸è®¾è®¡æ¨¡å¼"><a href="#23ç§ç»å…¸è®¾è®¡æ¨¡å¼" class="headerlink" title="23ç§ç»å…¸è®¾è®¡æ¨¡å¼"></a>23ç§ç»å…¸è®¾è®¡æ¨¡å¼</h2><h3 id="è®¾è®¡æ¨¡å¼çš„åˆ†ç±»"><a href="#è®¾è®¡æ¨¡å¼çš„åˆ†ç±»" class="headerlink" title="è®¾è®¡æ¨¡å¼çš„åˆ†ç±»"></a>è®¾è®¡æ¨¡å¼çš„åˆ†ç±»</h3><p>æ ¹æ®å„ç§è®¾è®¡æ¨¡å¼çš„ç‰¹ç‚¹ï¼Œå¯ä»¥å°†è®¾è®¡æ¨¡å¼ç®€å•åˆ†ä¸ºä¸‰ç±»ï¼šåˆ›å»ºå‹æ¨¡å¼ã€ç»“æ„å‹æ¨¡å¼ã€è¡Œä¸ºæ¨¡å¼ã€‚</p><ul><li>åˆ›å»ºå‹æ¨¡å¼ï¼Œæœ‰5ç§ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€å•ä¾‹æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ã€åŸå‹æ¨¡å¼ï¼›</li><li>ç»“æ„å‹æ¨¡å¼ï¼Œæœ‰7ç§ï¼šæ¡¥æ¥æ¨¡å¼ã€é€‚é…å™¨æ¨¡å¼ã€è£…é¥°æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€äº«å…ƒæ¨¡å¼ã€å¤–è§‚æ¨¡å¼ã€ä»£ç†æ¨¡å¼ï¼›</li><li>è¡Œä¸ºæ¨¡å¼ï¼Œæœ‰11ç§ï¼šæ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€ä¸­ä»‹è€…æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€è´£ä»»é“¾æ¨¡å¼ã€è¿­ä»£å™¨æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼ï¼›</li></ul><h3 id="ä¸€ã€åˆ›å»ºå‹æ¨¡å¼"><a href="#ä¸€ã€åˆ›å»ºå‹æ¨¡å¼" class="headerlink" title="ä¸€ã€åˆ›å»ºå‹æ¨¡å¼"></a>ä¸€ã€åˆ›å»ºå‹æ¨¡å¼</h3><h4 id="1-å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#1-å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="1.å·¥å‚æ–¹æ³•æ¨¡å¼"></a>1.å·¥å‚æ–¹æ³•æ¨¡å¼</h4><p>å·¥å‚æ–¹æ³•æ¨¡å¼çš„å®šä¹‰ï¼šå®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªç±»ã€‚å·¥å‚æ–¹æ³•æ˜¯ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°å…¶å­ç±»ã€‚</p><p>å·¥å‚æ–¹æ³•æ¨¡å¼ç”±æŠ½è±¡å·¥å‚ã€å…·ä½“å·¥å‚ã€æŠ½è±¡äº§å“å’Œå…·ä½“äº§å“ç­‰4ä¸ªè¦ç´ æ„æˆã€‚</p><p>å·¥å‚æ–¹æ³•æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ï¼š</p><ol><li>æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰ï¼šæä¾›äº†åˆ›å»ºäº§å“çš„æ¥å£ï¼Œè°ƒç”¨è€…é€šè¿‡å®ƒè®¿é—®å…·ä½“å·¥å‚çš„å·¥å‚æ–¹æ³• newProduct() æ¥åˆ›å»ºäº§å“ã€‚</li><li>å…·ä½“å·¥å‚ï¼ˆConcreteFactoryï¼‰ï¼šä¸»è¦æ˜¯å®ç°æŠ½è±¡å·¥å‚ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œå®Œæˆå…·ä½“äº§å“çš„åˆ›å»ºã€‚</li><li>æŠ½è±¡äº§å“ï¼ˆProductï¼‰ï¼šå®šä¹‰äº†äº§å“çš„è§„èŒƒï¼Œæè¿°äº†äº§å“çš„ä¸»è¦ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚</li><li>å…·ä½“äº§å“ï¼ˆConcreteProductï¼‰ï¼šå®ç°äº†æŠ½è±¡äº§å“è§’è‰²æ‰€å®šä¹‰çš„æ¥å£ï¼Œç”±å…·ä½“å·¥å‚æ¥åˆ›å»ºï¼Œå®ƒåŒå…·ä½“å·¥å‚ä¹‹é—´ä¸€ä¸€å¯¹åº”ã€‚</li></ol><p>ç»“æ„å›¾ï¼š</p><p><img src="/2019/03/02/DesignPattern/FactoryMethodPattern.png" alt></p><p>ç¤ºä¾‹ï¼ˆç”µè§†å·¥å‚ç”Ÿäº§ç”µè§†ï¼‰ï¼š</p><p>åˆ›å»ºç”µè§†æ¥å£ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TV</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>åˆ›å»ºç”µè§†çš„å®ç°ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HairTV</span> <span class="token keyword">implements</span> <span class="token class-name">TV</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æµ·å°”ç”µè§†æ’­æ”¾..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TCLTV</span> <span class="token keyword">implements</span> <span class="token class-name">TV</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"TCLç”µè§†æ’­æ”¾..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XiaoMiTV</span> <span class="token keyword">implements</span> <span class="token class-name">TV</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å°ç±³ç”µè§†æ’­æ”¾..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>åˆ›å»ºå·¥å‚æ¥å£ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TVFactory</span> <span class="token punctuation">{</span>    TV <span class="token function">produceTV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>åˆ›å»ºå·¥å‚çš„å®ç°ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HairTVFactory</span> <span class="token keyword">implements</span> <span class="token class-name">TVFactory</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> TV <span class="token function">produceTV</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æµ·å°”ç”µè§†å·¥å‚ ç”Ÿäº§ æµ·å°”ç”µè§†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HairTV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TCLTVFactory</span> <span class="token keyword">implements</span> <span class="token class-name">TVFactory</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> TV <span class="token function">produceTV</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"TCLç”µè§†å·¥å‚ ç”Ÿäº§ TCLç”µè§†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TCLTV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XiaoMiTVFactory</span> <span class="token keyword">implements</span> <span class="token class-name">TVFactory</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> TV <span class="token function">produceTV</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å°ç±³ç”µè§†å·¥å‚ ç”Ÿäº§ å°ç±³ç”µè§†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">XiaoMiTV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æµ‹è¯•</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        TV haierTV <span class="token operator">=</span>  null<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// å®šä¹‰två¯¹è±¡</span>        TVFactory hairTVFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HairTVFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// å®šä¹‰å·¥å‚</span>        haierTV <span class="token operator">=</span> hairTVFactory<span class="token punctuation">.</span><span class="token function">produceTV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// åˆ›å»ºç”µè§†å¯¹è±¡</span>        haierTV<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// æ’­æ”¾ç”µè§†</span>        TV tclTV <span class="token operator">=</span>  null<span class="token punctuation">;</span>        TVFactory tclTVFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TCLTVFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        tclTV <span class="token operator">=</span> tclTVFactory<span class="token punctuation">.</span><span class="token function">produceTV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        tclTV<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        TV xiaomiTV <span class="token operator">=</span>  null<span class="token punctuation">;</span>        TVFactory xiaomiTVFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XiaoMiTVFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        xiaomiTV <span class="token operator">=</span> xiaomiTVFactory<span class="token punctuation">.</span><span class="token function">produceTV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        xiaomiTV<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šæµ·å°”ç”µè§†å·¥å‚ ç”Ÿäº§ æµ·å°”ç”µè§†æµ·å°”ç”µè§†æ’­æ”¾<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>TCLç”µè§†å·¥å‚ ç”Ÿäº§ TCLç”µè§†TCLç”µè§†æ’­æ”¾<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>å°ç±³ç”µè§†å·¥å‚ ç”Ÿäº§ å°ç±³ç”µè§†å°ç±³ç”µè§†æ’­æ”¾<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>å·¥å‚æ–¹æ³•æ¨¡å¼æ€»ç»“</p><p>ä¼˜ç‚¹æœ‰ï¼š</p><ul><li>ç”¨æˆ·åªéœ€è¦çŸ¥é“å…·ä½“å·¥å‚çš„åç§°å°±å¯å¾—åˆ°æ‰€è¦çš„äº§å“ï¼Œæ— é¡»çŸ¥é“äº§å“çš„å…·ä½“åˆ›å»ºè¿‡ç¨‹ï¼›</li><li>åœ¨ç³»ç»Ÿå¢åŠ æ–°çš„äº§å“æ—¶åªéœ€è¦æ·»åŠ å…·ä½“äº§å“ç±»å’Œå¯¹åº”çš„å…·ä½“å·¥å‚ç±»ï¼Œæ— é¡»å¯¹åŸå·¥å‚è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼Œæ»¡è¶³å¼€é—­åŸåˆ™ï¼›</li></ul><p>ç¼ºç‚¹æ˜¯ï¼šæ¯å¢åŠ ä¸€ä¸ªäº§å“å°±è¦å¢åŠ ä¸€ä¸ªå…·ä½“äº§å“ç±»å’Œä¸€ä¸ªå¯¹åº”çš„å…·ä½“å·¥å‚ç±»ï¼Œè¿™å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚</p><p>é€‚ç”¨æ€§ï¼š</p><ul><li><p>å½“å®¢æˆ·ç«¯ç±»ä¸çŸ¥é“å®ƒæ‰€åˆ›å»ºçš„å¯¹è±¡çš„å…·ä½“ç±»æ—¶ï¼Œä¾‹å¦‚éœ€è¦åˆ›å»ºä¸€ä¸ªç”µè§†ï¼Œä½†æ˜¯å¹¶ä¸çŸ¥é“åˆ›å»ºçš„æ˜¯å“ªç§ç”µè§†ï¼›</p></li><li><p>å½“ä¸€ä¸ªç±»å¸Œæœ›æœ‰å®ƒçš„å­ç±»æ¥æ¥ç¡®å®šå®ƒæ‰€åˆ›å»ºçš„å¯¹è±¡æ—¶ï¼›</p></li><li><p>å½“ç±»é—´åˆ›å»ºå¯¹è±¡çš„èŒè´£å§”æ‰˜ç»™å¤šä¸ªå­ç±»ä¸­çš„æŸä¸€ä¸ªï¼Œå¹¶ä¸”å¸Œæœ›å°†å“ªä¸€ä¸ªå­ç±»æ˜¯ä»£ç†è€…è¿™ä¸€ä¿¡æ¯å±€éƒ¨åŒ–æ—¶ã€‚</p></li></ul><h4 id="2-æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#2-æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="2.æŠ½è±¡å·¥å‚æ¨¡å¼"></a>2.æŠ½è±¡å·¥å‚æ¨¡å¼</h4><p>æŠ½è±¡å·¥å‚æ¨¡å¼çš„å®šä¹‰ï¼šæä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œè€Œæ— éœ€æŒ‡å®šä»–ä»¬å…·ä½“çš„ç±»ã€‚</p><p>æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„å‡çº§ç‰ˆï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼åªç”Ÿäº§ä¸€ä¸ªç³»åˆ—çš„äº§å“ï¼Œè€ŒæŠ½è±¡å·¥å‚æ¨¡å¼å¯ç”Ÿäº§å¤šä¸ªç³»åˆ—çš„äº§å“ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼ä¸ºäº§å“ç³»åˆ—æä¾›äº†ä¸€ä¸ªå¥½çš„è§£å†³æ–¹æ¡ˆã€‚æŠ½è±¡å·¥å‚æ¨¡å¼å’Œå·¥å‚æ–¹æ³•æ¨¡å¼ç›¸åŒä¹Ÿæ˜¯ç”±æŠ½è±¡å·¥å‚ã€å…·ä½“å·¥å‚ã€æŠ½è±¡äº§å“å’Œå…·ä½“äº§å“ç­‰4ä¸ªè¦ç´ æ„æˆã€‚</p><p>å·¥å‚æ–¹æ³•æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ï¼š</p><ol><li>æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰ï¼šæä¾›äº†åˆ›å»ºäº§å“çš„æ¥å£ï¼Œè°ƒç”¨è€…é€šè¿‡å®ƒè®¿é—®å…·ä½“å·¥å‚çš„å·¥å‚æ–¹æ³• newProduct() æ¥åˆ›å»ºäº§å“ã€‚</li><li>å…·ä½“å·¥å‚ï¼ˆConcreteFactoryï¼‰ï¼šä¸»è¦æ˜¯å®ç°æŠ½è±¡å·¥å‚ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œå®Œæˆå…·ä½“äº§å“çš„åˆ›å»ºã€‚</li><li>æŠ½è±¡äº§å“ï¼ˆProductï¼‰ï¼šå®šä¹‰äº†äº§å“çš„è§„èŒƒï¼Œæè¿°äº†äº§å“çš„ä¸»è¦ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚</li><li>å…·ä½“äº§å“ï¼ˆConcreteProductï¼‰ï¼šå®ç°äº†æŠ½è±¡äº§å“è§’è‰²æ‰€å®šä¹‰çš„æ¥å£ï¼Œç”±å…·ä½“å·¥å‚æ¥åˆ›å»ºï¼Œå®ƒåŒå…·ä½“å·¥å‚ä¹‹é—´ä¸€ä¸€å¯¹åº”ã€‚</li></ol><p>ç»“æ„å›¾ï¼š</p><p><img src="/2019/03/02/DesignPattern/AbstractFactoryPattern.png" alt></p><p>ç¤ºä¾‹ï¼š</p><p>åˆ›å»º1ä¸ªæŠ½è±¡å·¥å‚æ¥å£</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractFactory</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">abstract</span> AbstractProductA <span class="token function">produceProductA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> AbstractProductB <span class="token function">produceProductB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>åˆ›å»º2ä¸ªæŠ½è±¡äº§å“æ¥å£</p><pre class=" language-Java"><code class="language-Java">public abstract class AbstractProductA {    //æ¯ä¸ªäº§å“å…±æœ‰çš„æ–¹æ³•    public void shareMethod(){          System.out.println("Aäº§å“çš„å…±æœ‰æ–¹æ³•");    }    //æ¯ä¸ªäº§å“ç›¸åŒæ–¹æ³•ï¼Œä¸åŒå®ç°    public abstract void doSomething(); }</code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractProductB</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//æ¯ä¸ªäº§å“å…±æœ‰çš„æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shareMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Bäº§å“çš„å…±æœ‰æ–¹æ³•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//æ¯ä¸ªäº§å“ç›¸åŒæ–¹æ³•ï¼Œä¸åŒå®ç°</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre><p>æŠ½è±¡å·¥å‚AbstractFactoryçš„ä¸¤ä¸ªå®ç°ç±»</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Factory1</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractFactory</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> AbstractProductA <span class="token function">produceProductA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ã€1çº§äº§å“å·¥å‚ã€‘ï¼šç”Ÿäº§1çº§äº§å“A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ProductA1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> AbstractProductB <span class="token function">produceProductB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ã€1çº§äº§å“å·¥å‚ã€‘ï¼šç”Ÿäº§1çº§äº§å“B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ProductB1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Factory2</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractFactory</span><span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> AbstractProductA <span class="token function">produceProductA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ã€2çº§äº§å“å·¥å‚ã€‘ï¼šç”Ÿäº§2çº§äº§å“A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ProductA2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> AbstractProductB <span class="token function">produceProductB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ã€2çº§äº§å“å·¥å‚ã€‘ï¼šç”Ÿäº§2çº§äº§å“B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ProductB2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æŠ½è±¡äº§å“AbstractProductAçš„å®ç°ç±»</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductA1</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractProductA</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"1çº§äº§å“Açš„å®ç°æ–¹æ³•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductA2</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractProductA</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"2çº§äº§å“Açš„å®ç°æ–¹æ³•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æŠ½è±¡äº§å“AbstractProductBçš„å®ç°ç±»</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductB1</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractProductB</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"1çº§äº§å“Bçš„å®ç°æ–¹æ³•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductB2</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractProductB</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"2çº§äº§å“Bçš„å®ç°æ–¹æ³•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æµ‹è¯•</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//å®šä¹‰å‡ºä¸¤ä¸ªå·¥å‚</span>        AbstractFactory factory1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Factory1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         AbstractFactory factory2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Factory2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//äº§ç”ŸA1å¯¹è±¡</span>        AbstractProductA a1 <span class="token operator">=</span>  factory1<span class="token punctuation">.</span><span class="token function">produceProductA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//äº§ç”ŸA2å¯¹è±¡</span>        AbstractProductA a2 <span class="token operator">=</span> factory2<span class="token punctuation">.</span><span class="token function">produceProductA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//äº§ç”ŸB1å¯¹è±¡</span>        AbstractProductB b1 <span class="token operator">=</span> factory1<span class="token punctuation">.</span><span class="token function">produceProductB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//äº§ç”ŸB2å¯¹è±¡</span>        AbstractProductB b2 <span class="token operator">=</span> factory2<span class="token punctuation">.</span><span class="token function">produceProductB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        a1<span class="token punctuation">.</span><span class="token function">shareMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        a1<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        a2<span class="token punctuation">.</span><span class="token function">shareMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        a2<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        b1<span class="token punctuation">.</span><span class="token function">shareMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        b1<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        b2<span class="token punctuation">.</span><span class="token function">shareMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        b2<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šã€<span class="token number">1</span>çº§äº§å“å·¥å‚ã€‘ï¼šç”Ÿäº§<span class="token number">1</span>çº§äº§å“Aã€<span class="token number">2</span>çº§äº§å“å·¥å‚ã€‘ï¼šç”Ÿäº§<span class="token number">2</span>çº§äº§å“Aã€<span class="token number">1</span>çº§äº§å“å·¥å‚ã€‘ï¼šç”Ÿäº§<span class="token number">1</span>çº§äº§å“Bã€<span class="token number">2</span>çº§äº§å“å·¥å‚ã€‘ï¼šç”Ÿäº§<span class="token number">2</span>çº§äº§å“BAäº§å“çš„å…±æœ‰æ–¹æ³•<span class="token number">1</span>çº§äº§å“Açš„å®ç°æ–¹æ³•Aäº§å“çš„å…±æœ‰æ–¹æ³•<span class="token number">2</span>çº§äº§å“Açš„å®ç°æ–¹æ³•Bäº§å“çš„å…±æœ‰æ–¹æ³•<span class="token number">1</span>çº§äº§å“Bçš„å®ç°æ–¹æ³•Bäº§å“çš„å…±æœ‰æ–¹æ³•<span class="token number">2</span>çº§äº§å“Bçš„å®ç°æ–¹æ³•</code></pre><p>æŠ½è±¡å·¥å‚æ¨¡å¼æ€»ç»“</p><p>ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li>åˆ†ç¦»äº†å…·ä½“çš„ç±»ï¼Œå·¥å‚å°è£…äº†åˆ›å»ºäº§å“å¯¹è±¡çš„è´£ä»»å’Œè¿‡ç¨‹ï¼Œå°†å®¢æˆ·ç«¯å’Œç±»çš„å®ç°åˆ†ç±»ã€‚å®¢æˆ·ç«¯é€šè¿‡æŠ½è±¡æ¥å£æ“çºµå®ä¾‹ã€‚</li><li>æ˜“äºäº¤æ¢äº§å“ç³»åˆ—ï¼Œä¸€ä¸ªå…·ä½“çš„å·¥å‚ç±»åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ä»…åœ¨åˆå§‹åŒ–æ—¶å‡ºç°ä¸€æ¬¡ï¼Œæ”¹å˜ä¸€ä¸ªå…·ä½“å·¥å‚å˜å¾—å®¹æ˜“ã€‚</li><li>æœ‰åˆ©äºäº§å“çš„ä¸€è‡´æ€§ï¼Œä¸€ä¸ªç³»åˆ—ä¸­çš„äº§å“å¯¹è±¡è¢«è®¾è®¡åœ¨ä¸€èµ·å·¥ä½œæ—¶ï¼Œä¸€ä¸ªåº”ç”¨ä¸€æ¬¡åªèƒ½ä½¿ç”¨åŒä¸€ç³»åˆ—ä¸­çš„å¯¹è±¡ã€‚</li></ul><p>å…¶ç¼ºç‚¹æ˜¯ï¼šéš¾ä»¥æ”¯æŒæ–°ç§ç±»çš„äº§å“ï¼ŒæŠ½è±¡å·¥å‚å·²ç»ç¡®å®šäº†å¯ä»¥è¢«åˆ›å»ºçš„äº§å“é›†åˆã€‚å½“äº§å“æ—ä¸­éœ€è¦å¢åŠ ä¸€ä¸ªæ–°çš„äº§å“æ—¶ï¼Œæ‰€æœ‰çš„å·¥å‚ç±»éƒ½éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚</p><h4 id="3-å•ä¾‹æ¨¡å¼"><a href="#3-å•ä¾‹æ¨¡å¼" class="headerlink" title="3.å•ä¾‹æ¨¡å¼"></a>3.å•ä¾‹æ¨¡å¼</h4><p>å•ä¾‹æ¨¡å¼çš„å®šä¹‰ï¼šä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚</p><p>åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œè¿˜æœ‰ Windows çš„å›æ”¶ç«™ã€æ“ä½œç³»ç»Ÿä¸­çš„æ–‡ä»¶ç³»ç»Ÿã€å¤šçº¿ç¨‹ä¸­çš„çº¿ç¨‹æ± ã€æ˜¾å¡çš„é©±åŠ¨ç¨‹åºå¯¹è±¡ã€æ‰“å°æœºçš„åå°å¤„ç†æœåŠ¡ã€åº”ç”¨ç¨‹åºçš„æ—¥å¿—å¯¹è±¡ã€æ•°æ®åº“çš„è¿æ¥æ± ã€ç½‘ç«™çš„è®¡æ•°å™¨ã€Web åº”ç”¨çš„é…ç½®å¯¹è±¡ã€åº”ç”¨ç¨‹åºä¸­çš„å¯¹è¯æ¡†ã€ç³»ç»Ÿä¸­çš„ç¼“å­˜ç­‰å¸¸å¸¸è¢«è®¾è®¡æˆå•ä¾‹ã€‚</p><p>å•ä¾‹æ¨¡å¼æœ‰ 3 ä¸ªç‰¹ç‚¹ï¼š</p><ul><li><p>å•ä¾‹ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼›</p></li><li><p>è¯¥å•ä¾‹å¯¹è±¡å¿…é¡»ç”±å•ä¾‹ç±»è‡ªè¡Œåˆ›å»ºï¼›</p></li><li><p>å•ä¾‹ç±»å¯¹å¤–æä¾›ä¸€ä¸ªè®¿é—®è¯¥å•ä¾‹çš„å…¨å±€è®¿é—®ç‚¹ï¼›</p></li></ul><p>ç»“æ„å›¾ï¼š</p><p><img src="/2019/03/02/DesignPattern/SingletonPattern.png" alt></p><p>ç¤ºä¾‹ï¼Œåˆ›å»ºå•ä¾‹çš„å‡ ç§æ–¹å¼ï¼š</p><ul><li><p>ç®€å•çš„æ‡’æ±‰å•ä¾‹æ¨¡å¼</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LazySingleton</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//ç§æœ‰é™æ€å˜é‡</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> LazySingleton singleton <span class="token operator">=</span> null<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//ç§æœ‰æ„é€ æ–¹æ³•</span>    <span class="token keyword">private</span> <span class="token function">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//è·å–å®ä¾‹</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> LazySingleton <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>singleton <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ–¹ä¾¿çº¿ç¨‹æµ‹è¯•ï¼Œä¼‘çœ ä¸€å®šæ—¶é—´</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            singleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> singleton<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¿™æ˜¯æœ€ç®€å•çš„åˆ›å»ºå•ä¾‹çš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼åœ¨å¹¶å‘çš„æƒ…å†µä¸‹å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸º<code>singleton = new LazySingleton();</code>å¹¶éåŸå­æ“çºµã€‚</p><p>æ¥ç€ï¼ŒéªŒè¯çº¿ç¨‹å®‰å…¨æ€§ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LazySingletonTest</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>        LazySingletonTest<span class="token punctuation">[</span><span class="token punctuation">]</span> mts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingletonTest</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mts<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>              mts<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingletonTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> mts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              mts<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>     <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>LazySingleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼š<span class="token number">815626842</span><span class="token number">1798433653</span><span class="token number">1865535330</span><span class="token number">880021412</span><span class="token number">218506352</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>ç»“æœå¾ˆæ˜æ˜¾ï¼Œå®ä¾‹çš„hashcodeå€¼ä¸åŒï¼Œæ•…æ˜¯ä¸åŒçš„å¯¹è±¡ã€‚</p></li><li><p>çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å•ä¾‹æ¨¡å¼</p></li><li><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LazySingleton2</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> LazySingleton2 lazySingleton2 <span class="token operator">=</span> null<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token function">LazySingleton2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> LazySingleton2 <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span> lazySingleton2 <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ–¹ä¾¿çº¿ç¨‹æµ‹è¯•ï¼Œä¼‘çœ ä¸€å®šæ—¶é—´</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            lazySingleton2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingleton2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> lazySingleton2 <span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è™½ç„¶æ–¹æ³•getInstance()é€šè¿‡synchronizedåŠ åŒæ­¥æ§åˆ¶ï¼Œèƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘æ˜¯ä¼šå‡ºç°ä¸¥é‡çš„æ€§é—® é¢˜ï¼Œå› ä¸ºæ¯æ¬¡æ‰§è¡Œæ–¹æ³•getInstance()éƒ½éœ€è¦å…ˆè·å–é”å¾ˆæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œåªéœ€è¦åœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºå®ä¾‹æ—¶åŠ é”ã€‚ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œåœ¨JDK1.5ä»¥åå¯ä»¥ä½¿ç”¨åŒæ ¡éªŒé”å•ä¾‹æ¨¡å¼ï¼Œæ—¢èƒ½ä¿æŒçº¿ç¨‹å®‰å…¨åˆå…¼é¡¾çš„æ€§èƒ½ã€‚</p><p>æ¥ç€ï¼ŒéªŒè¯çº¿ç¨‹å®‰å…¨æ€§ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LazySingleton2Test</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>        LazySingleton2Test<span class="token punctuation">[</span><span class="token punctuation">]</span> mts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingleton2Test</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mts<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>              mts<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingleton2Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> mts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              mts<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>     <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>LazySingleton2<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼š<span class="token number">42265496</span><span class="token number">42265496</span><span class="token number">42265496</span><span class="token number">42265496</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre></li></ul><p>â€‹      å¾ˆæ˜æ˜¾æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><ul><li><p>åŒæ ¡éªŒé”å•ä¾‹æ¨¡å¼ï¼ˆDCLï¼‰</p></li><li><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DuplicationCheckSingleton</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//volatileå±è”½æŒ‡ä»¤é‡æ’çš„è¯­ä¹‰åœ¨JDK1.5ä¸­æ‰è¢«ä¿®å¤</span>    <span class="token comment" spellcheck="true">//åœ¨æ­¤å‰çš„JDKä¸­å³ä½¿å˜é‡è¢«å£°æ˜ä¸ºvolatileä¹Ÿä¸èƒ½å®Œå…¨é¿å…æŒ‡ä»¤é‡æ’æ‰€å¯¼è‡´çš„é—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯åœ¨JDK1.5ä¹‹å‰çš„Javaä¸­æ— æ³•å®‰å…¨çš„ä½¿ç”¨DCLæ¥å®ç°å•ä¾‹çš„åŸå› ï¼ï¼</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">volatile</span> DuplicationCheckSingleton singleton <span class="token operator">=</span> null<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token function">DuplicationCheckSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> DuplicationCheckSingleton <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>singleton <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//1</span>            <span class="token comment" spellcheck="true">//çº¿ç¨‹æµ‹è¯•ï¼Œä¼‘çœ ä¸€å®šæ—¶é—´</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>DuplicationCheckSingleton<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>singleton <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//2</span>                    singleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DuplicationCheckSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> singleton<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¯´æ˜ï¼šæ ‡è®°1å¤„çš„åˆ¤æ–­æ˜¯ä¸ºäº†é˜²æ­¢ä¸å¿…è¦çš„é‡å¤åˆ›å»ºå¯¹è±¡å’ŒåŠ é”ï¼›åœ¨æç«¯çš„æƒ…å†µï¼Œæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶é€šè¿‡äº†1çš„åˆ¤æ–­ï¼Œä½†æ˜¯å½“ä»–ä»¬æ‰§è¡Œåˆ°<code>synchronized (DuplicationCheckSingleton.class)</code>æ—¶å°±éœ€è¦å…ˆè·å¾—é”ï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„ä»£ç ï¼Œå¦‚æœçº¿ç¨‹æ²¡æœ‰æ‹¿åˆ°é”å°±ä¼šè¢«é˜»å¡ç›´åˆ°å…¶ä»–çº¿ç¨‹æŠŠé”é‡Šæ”¾ï¼Œæ‰§è¡Œåˆ°æ ‡è®°2å¤„å‘ç°å¯¹è±¡å·²ç»å­˜åœ¨ï¼Œç›´æ¥è¿”å›å·²ç»å­˜åœ¨çš„å¯¹è±¡ã€‚</p><p>æ¥ç€ï¼ŒéªŒè¯çº¿ç¨‹å®‰å…¨æ€§ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DuplicationCheckSingletonTest</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>        DuplicationCheckSingletonTest<span class="token punctuation">[</span><span class="token punctuation">]</span> mts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DuplicationCheckSingletonTest</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mts<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            mts<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DuplicationCheckSingletonTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> mts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            mts<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>DuplicationCheckSingleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼š<span class="token number">1710248273</span><span class="token number">1710248273</span><span class="token number">1710248273</span><span class="token number">1710248273</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>å¾ˆæ˜æ˜¾ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå…·ä½“å’Œå‰ä¸€å‘¨æ–¹å¼çš„æ€§èƒ½å·®å¼‚ï¼Œå¯ä»¥è‡ªå·±è¿›è¡ŒéªŒè¯ã€‚</p></li><li><p>é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼</p></li><li><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticFinalInnerClassSingleton</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//é™æ€å†…éƒ¨ç±»</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SingletonHolder</span><span class="token punctuation">{</span>        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> StaticFinalInnerClassSingleton INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StaticFinalInnerClassSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//ç§æœ‰æ„é€ æ–¹æ³•</span>    <span class="token keyword">private</span> <span class="token function">StaticFinalInnerClassSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> StaticFinalInnerClassSingleton <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> SingletonHolder<span class="token punctuation">.</span>INSTANCE<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºåœ¨ç±»<code>StaticFinalInnerClassSingleton</code>åŠ è½½æ—¶å·²ç»å®Œæˆäº†é™æ€å†…éƒ¨ç±»<code>SingletonHolder</code>çš„åˆå§‹åŒ–ï¼Œå¹¶ä¸”åªåˆå§‹åŒ–ä¸€æ¬¡ï¼Œæ•…æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚ä¸‹çš„éªŒè¯ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticFinalInnerClassSingletonTest</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>        StaticFinalInnerClassSingletonTest<span class="token punctuation">[</span><span class="token punctuation">]</span> mts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StaticFinalInnerClassSingletonTest</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mts<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>              mts<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StaticFinalInnerClassSingletonTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> mts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              mts<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>     <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>StaticFinalInnerClassSingleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼š<span class="token number">2075741586</span><span class="token number">2075741586</span><span class="token number">2075741586</span><span class="token number">2075741586</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre></li></ul><h4 id="4-å»ºé€ è€…æ¨¡å¼"><a href="#4-å»ºé€ è€…æ¨¡å¼" class="headerlink" title="4.å»ºé€ è€…æ¨¡å¼"></a>4.å»ºé€ è€…æ¨¡å¼</h4><p>å»ºé€ è€…æ¨¡å¼çš„å®šä¹‰ï¼šå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥ç©¿å°±ä¸åŒçš„è¡¨ç¤ºã€‚</p><p>å»ºé€ è€…æ¨¡å¼å°†ä¸€ä¸ªå¤æ‚çš„å¯¹è±¡åˆ†è§£ä¸ºå¤šä¸ªç®€å•çš„å¯¹è±¡ï¼Œç„¶åä¸€æ­¥ä¸€æ­¥æ„å»ºè€Œæˆã€‚å®ƒå°†å˜ä¸ä¸å˜ç›¸åˆ†ç¦»ï¼Œå³äº§å“çš„ç»„æˆéƒ¨åˆ†æ˜¯ä¸å˜çš„ï¼Œä½†æ¯ä¸€éƒ¨åˆ†æ˜¯å¯ä»¥çµæ´»é€‰æ‹©çš„ã€‚</p><p>å»ºé€ è€…ï¼ˆBuilderï¼‰æ¨¡å¼ç”±äº§å“ã€æŠ½è±¡å»ºé€ è€…ã€å…·ä½“å»ºé€ è€…ã€æŒ‡æŒ¥è€…ç­‰ 4 ä¸ªè¦ç´ æ„æˆã€‚</p><p>å»ºé€ è€…ï¼ˆBuilderï¼‰æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ï¼š</p><ul><li><p>äº§å“è§’è‰²ï¼ˆProductï¼‰ï¼šå®ƒæ˜¯åŒ…å«å¤šä¸ªç»„æˆéƒ¨ä»¶çš„å¤æ‚å¯¹è±¡ï¼Œç”±å…·ä½“å»ºé€ è€…æ¥åˆ›å»ºå…¶å„ä¸ªæ»…éƒ¨ä»¶ã€‚</p></li><li><p>æŠ½è±¡å»ºé€ è€…ï¼ˆBuilderï¼‰ï¼šå®ƒæ˜¯ä¸€ä¸ªåŒ…å«åˆ›å»ºäº§å“å„ä¸ªå­éƒ¨ä»¶çš„æŠ½è±¡æ–¹æ³•çš„æ¥å£ï¼Œé€šå¸¸è¿˜åŒ…å«ä¸€ä¸ªè¿”å›å¤æ‚äº§å“çš„æ–¹æ³• getResult()ã€‚</p></li><li><p>å…·ä½“å»ºé€ è€…(Concrete Builderï¼‰ï¼šå®ç° Builder æ¥å£ï¼Œå®Œæˆå¤æ‚äº§å“çš„å„ä¸ªéƒ¨ä»¶çš„å…·ä½“åˆ›å»ºæ–¹æ³•ã€‚</p></li><li><p>æŒ‡æŒ¥è€…ï¼ˆDirectorï¼‰ï¼šå®ƒè°ƒç”¨å»ºé€ è€…å¯¹è±¡ä¸­çš„éƒ¨ä»¶æ„é€ ä¸è£…é…æ–¹æ³•å®Œæˆå¤æ‚å¯¹è±¡çš„åˆ›å»ºï¼Œåœ¨æŒ‡æŒ¥è€…ä¸­ä¸æ¶‰åŠå…·ä½“äº§å“çš„ä¿¡æ¯ã€‚</p></li></ul><p>ç»“æ„å›¾ï¼š</p><p><img src="/2019/03/02/DesignPattern/BuilderPattern.png" alt></p><p>ç¤ºä¾‹</p><p>äº§å“Product</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>String<span class="token operator">></span> parts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addPart</span><span class="token punctuation">(</span>String part<span class="token punctuation">)</span><span class="token punctuation">{</span>        parts<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>part<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Product:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parts<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            String part <span class="token operator">=</span> parts<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>part<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æŠ½è±¡å»ºé€ è€…</p><pre><code>public interface Builder {    void buildPartA();    void buildPartB();    Product getResult();}</code></pre><p>å…·ä½“å»ºé€ è€…</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteBuilder1</span> <span class="token keyword">implements</span> <span class="token class-name">Builder</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Product product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildPartA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        product<span class="token punctuation">.</span><span class="token function">addPart</span><span class="token punctuation">(</span><span class="token string">"Part A1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildPartB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        product<span class="token punctuation">.</span><span class="token function">addPart</span><span class="token punctuation">(</span><span class="token string">"Part B1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Product <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> product<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteBuilder2</span> <span class="token keyword">implements</span> <span class="token class-name">Builder</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Product product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildPartA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        product<span class="token punctuation">.</span><span class="token function">addPart</span><span class="token punctuation">(</span><span class="token string">"Part A2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildPartB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        product<span class="token punctuation">.</span><span class="token function">addPart</span><span class="token punctuation">(</span><span class="token string">"Part B2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Product <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> product<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æŒ‡å¯¼è€…ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Director</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Builder builder <span class="token operator">=</span> null<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Director</span><span class="token punctuation">(</span>Builder builder<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>builder <span class="token operator">=</span> builder<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Product <span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        builder<span class="token punctuation">.</span><span class="token function">buildPartA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        builder<span class="token punctuation">.</span><span class="token function">buildPartB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æµ‹è¯•</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Builder builder1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteBuilder1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Director director <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Director</span><span class="token punctuation">(</span>builder1<span class="token punctuation">)</span><span class="token punctuation">;</span>        Product product1 <span class="token operator">=</span> director<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        product1<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Builder builder2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteBuilder2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        director <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Director</span><span class="token punctuation">(</span>builder2<span class="token punctuation">)</span><span class="token punctuation">;</span>        Product product2 <span class="token operator">=</span> director<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        product2<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šProduct<span class="token operator">:</span>Part A1Part B1Product<span class="token operator">:</span>Part A2Part B2</code></pre><p>å»ºé€ è€…æ¨¡å¼æ€»ç»“</p><p>è¯¥æ¨¡å¼çš„ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>å„ä¸ªå…·ä½“çš„å»ºé€ è€…ç›¸äº’ç‹¬ç«‹ï¼Œæœ‰åˆ©äºç³»ç»Ÿçš„æ‰©å±•ï¼›</p></li><li><p>å®¢æˆ·ç«¯ä¸å¿…çŸ¥é“äº§å“å†…éƒ¨ç»„æˆçš„ç»†èŠ‚ï¼Œä¾¿äºæ§åˆ¶ç»†èŠ‚é£é™©ï¼›</p></li></ul><p>å…¶ç¼ºç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>äº§å“çš„ç»„æˆéƒ¨åˆ†å¿…é¡»ç›¸åŒï¼Œè¿™é™åˆ¶äº†å…¶ä½¿ç”¨èŒƒå›´ï¼›</p></li><li><p>å¦‚æœäº§å“çš„å†…éƒ¨å˜åŒ–å¤æ‚ï¼Œè¯¥æ¨¡å¼ä¼šå¢åŠ å¾ˆå¤šçš„å»ºé€ è€…ç±»ï¼›</p></li></ul><p>é€‚ç”¨æ€§ï¼š</p><ul><li>å»ºé€ è€…æ¨¡å¼å¯ä»¥è¯´æ˜¯å¯¹æµç¨‹çš„æŠ½è±¡ï¼Œå½“åˆ›å»ºå¤æ‚å¯¹è±¡çš„ç®—æ³•åº”è¯¥ç‹¬ç«‹äºè¯¥å¯¹è±¡çš„ç»„æˆéƒ¨åˆ†ä»¥åŠä»–ä»¬çš„ç»„è£…æ–¹å¼æ—¶ï¼›</li><li>å½“æ„é€ è¿‡ç¨‹å¿…é¡»å…è®¸è¢«æ„é€ çš„å¯¹è±¡æœ‰ä¸åŒçš„è¡¨ç¤ºæ—¶ï¼›</li></ul><p>å»ºé€ è€…ï¼ˆBuilderï¼‰æ¨¡å¼å’Œå·¥å‚æ¨¡å¼çš„å…³æ³¨ç‚¹ä¸åŒï¼šå»ºé€ è€…æ¨¡å¼æ³¨é‡é›¶éƒ¨ä»¶çš„ç»„è£…è¿‡ç¨‹ï¼Œè€Œå·¥å‚æ–¹æ³•æ¨¡å¼æ›´æ³¨é‡é›¶éƒ¨ä»¶çš„åˆ›å»ºè¿‡ç¨‹ï¼Œä½†ä¸¤è€…å¯ä»¥ç»“åˆä½¿ç”¨ã€‚</p><h4 id="5-åŸå‹æ¨¡å¼"><a href="#5-åŸå‹æ¨¡å¼" class="headerlink" title="5.åŸå‹æ¨¡å¼"></a>5.åŸå‹æ¨¡å¼</h4><p>åŸå‹æ¨¡å¼çš„å®šä¹‰ï¼šç”¨åŸå‹ç¤ºä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶ä¸”é€šè¿‡æ‹·è´è¿™äº›åŸå‹åˆ›å»ºæ–°å¯¹è±¡ã€‚</p><p>æ‰€è°“åŸå‹æ¨¡å¼ï¼Œå…¶å®å°±æ˜¯ä¾æ‰˜ä¸€ä¸ªå·²ç»å®ä¾‹åŒ–çš„å¯¹è±¡å»åˆ›å»ºå¦å¤–ä¸€ä¸ªå¯ä»¥è¿›è¡Œå®šåˆ¶çš„å¯¹è±¡ï¼Œè€Œä¸éœ€è¦çŸ¥é“åˆ›å»ºè¿‡ç¨‹ä¸­çš„å…·ä½“ç»†èŠ‚ã€‚</p><p>åŸå‹æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ã€‚</p><ul><li><p>æŠ½è±¡åŸå‹ç±»ï¼šè§„å®šäº†å…·ä½“åŸå‹å¯¹è±¡å¿…é¡»å®ç°çš„æ¥å£ï¼›</p></li><li><p>å…·ä½“åŸå‹ç±»ï¼šå®ç°æŠ½è±¡åŸå‹ç±»çš„ clone() æ–¹æ³•ï¼Œå®ƒæ˜¯å¯è¢«å¤åˆ¶çš„å¯¹è±¡ï¼›</p></li><li><p>è®¿é—®ç±»ï¼šä½¿ç”¨å…·ä½“åŸå‹ç±»ä¸­çš„ clone() æ–¹æ³•æ¥å¤åˆ¶æ–°çš„å¯¹è±¡ï¼›</p></li></ul><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/PrototypePattern.png" alt></p><p>ç¤ºä¾‹</p><p>åœ¨Javaä¸­ï¼Œå¤åˆ¶å¯¹è±¡æ˜¯é€šè¿‡clone()æ–¹æ³•å®ç°çš„ï¼ŒJavaçš„clone()æ–¹æ³•æ˜¯æµ…æ‹·è´ã€‚åˆ›å»ºåŸå‹ç±»</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RobotPrototype</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span>Serializable<span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">long</span> rid<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æœºå™¨äººåºåˆ—å·ï¼Œæ¯ä¸ªæœºå™¨äººåºåˆ—å·å‡ä¸ç›¸åŒ</span>    <span class="token keyword">private</span> CPU cpu<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ä½¿ç”¨çš„CPUï¼Œæ¯ä¸ªæœºå™¨äººçš„CPUå‡ä¸ç›¸åŒ</span>    <span class="token keyword">private</span> String birthday<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ç”Ÿäº§æ—¥æœŸ</span>    <span class="token keyword">private</span> String factory<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ç”Ÿäº§å·¥å‚</span>    <span class="token keyword">public</span> <span class="token function">RobotPrototype</span><span class="token punctuation">(</span><span class="token keyword">long</span> rid<span class="token punctuation">,</span> String birthday<span class="token punctuation">,</span> String factory<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>rid <span class="token operator">=</span> rid<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>birthday <span class="token operator">=</span> birthday<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>factory <span class="token operator">=</span> factory<span class="token punctuation">;</span>        cpu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CPU</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getRid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> rid<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRid</span><span class="token punctuation">(</span><span class="token keyword">long</span> rid<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>rid <span class="token operator">=</span> rid<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCpu</span><span class="token punctuation">(</span><span class="token keyword">long</span> cpu_no<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>cpu<span class="token punctuation">.</span><span class="token function">setCpu_no</span><span class="token punctuation">(</span>cpu_no<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">getBirthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> birthday<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBirthday</span><span class="token punctuation">(</span>String birthday<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>birthday <span class="token operator">=</span> birthday<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">getFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> factory<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFactory</span><span class="token punctuation">(</span>String factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>factory <span class="token operator">=</span> factory<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * æµ…æ‹·è´     * @return     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> Object <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CloneNotSupportedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * æ·±æ‹·è´     * @return     */</span>    <span class="token keyword">protected</span> Object <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            ByteArrayOutputStream bos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ObjectOutputStream oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>bos<span class="token punctuation">)</span><span class="token punctuation">;</span>            oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ByteArrayInputStream bis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>bos<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ObjectInputStream ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>bis<span class="token punctuation">)</span><span class="token punctuation">;</span>            RobotPrototype robot <span class="token operator">=</span> <span class="token punctuation">(</span>RobotPrototype<span class="token punctuation">)</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            robot<span class="token punctuation">.</span><span class="token function">setCpu</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            robot<span class="token punctuation">.</span><span class="token function">setRid</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> robot<span class="token punctuation">.</span>cpu<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> robot<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"æœºå™¨äººåºåˆ—å·ï¼š"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rid <span class="token operator">+</span> <span class="token string">"\n\t"</span> <span class="token operator">+</span>                <span class="token string">"ç”Ÿäº§æ—¥æœŸï¼š"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>birthday  <span class="token operator">+</span> <span class="token string">"\n\t"</span> <span class="token operator">+</span>                <span class="token string">"ç”Ÿäº§å·¥ç¨‹ï¼š"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>factory <span class="token operator">+</span> <span class="token string">"\n\t"</span> <span class="token operator">+</span>                <span class="token string">"ä½¿ç”¨çš„CPUä¿¡æ¯ï¼š"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cpu<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n\t"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>é€šè¿‡å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ¥å®ç°æ·±æ‹·è´ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CPU</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">long</span> cpu_no<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//cpuåºåˆ—å·ï¼Œæ¯ä¸ªCPUåºåˆ—å·å‡ä¸ç›¸åŒ</span>    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getCpu_no</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> cpu_no<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCpu_no</span><span class="token punctuation">(</span><span class="token keyword">long</span> cpu_no<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>cpu_no <span class="token operator">=</span> cpu_no <span class="token operator">+</span> System<span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"cpu_no: "</span> <span class="token operator">+</span> cpu_no <span class="token operator">+</span> <span class="token string">", hashCode:"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æµ‹è¯•</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        RobotPrototype protype_robot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RobotPrototype</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"2018-4-26"</span><span class="token punctuation">,</span> <span class="token string">"å¯Œå£«åº·æœºå™¨äººç”Ÿäº§å·¥å‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        protype_robot<span class="token punctuation">.</span><span class="token function">setCpu</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åŸå‹æœº ["</span> <span class="token operator">+</span> protype_robot<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            RobotPrototype robot <span class="token operator">=</span> <span class="token punctuation">(</span>RobotPrototype<span class="token punctuation">)</span> protype_robot<span class="token punctuation">.</span><span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"robot"</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">" ["</span> <span class="token operator">+</span> robot<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šåŸå‹æœº <span class="token punctuation">[</span>æœºå™¨äººåºåˆ—å·ï¼š<span class="token number">1551522612533</span>    ç”Ÿäº§æ—¥æœŸï¼š<span class="token number">2018</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">26</span>    ç”Ÿäº§å·¥ç¨‹ï¼šå¯Œå£«åº·æœºå™¨äººç”Ÿäº§å·¥å‚    ä½¿ç”¨çš„CPUä¿¡æ¯ï¼šcpu_no<span class="token operator">:</span> <span class="token number">199939540956962</span><span class="token punctuation">,</span> hashCode<span class="token operator">:</span><span class="token number">1826771953</span>    <span class="token punctuation">]</span>robot0 <span class="token punctuation">[</span>æœºå™¨äººåºåˆ—å·ï¼š<span class="token number">1552334878300</span>    ç”Ÿäº§æ—¥æœŸï¼š<span class="token number">2018</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">26</span>    ç”Ÿäº§å·¥ç¨‹ï¼šå¯Œå£«åº·æœºå™¨äººç”Ÿäº§å·¥å‚    ä½¿ç”¨çš„CPUä¿¡æ¯ï¼šcpu_no<span class="token operator">:</span> <span class="token number">199939636725580</span><span class="token punctuation">,</span> hashCode<span class="token operator">:</span><span class="token number">812265671</span>    <span class="token punctuation">]</span>robot1 <span class="token punctuation">[</span>æœºå™¨äººåºåˆ—å·ï¼š<span class="token number">1551715676989</span>    ç”Ÿäº§æ—¥æœŸï¼š<span class="token number">2018</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">26</span>    ç”Ÿäº§å·¥ç¨‹ï¼šå¯Œå£«åº·æœºå™¨äººç”Ÿäº§å·¥å‚    ä½¿ç”¨çš„CPUä¿¡æ¯ï¼šcpu_no<span class="token operator">:</span> <span class="token number">199939637142517</span><span class="token punctuation">,</span> hashCode<span class="token operator">:</span><span class="token number">193064360</span>    <span class="token punctuation">]</span>robot2 <span class="token punctuation">[</span>æœºå™¨äººåºåˆ—å·ï¼š<span class="token number">1551632574171</span>    ç”Ÿäº§æ—¥æœŸï¼š<span class="token number">2018</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">26</span>    ç”Ÿäº§å·¥ç¨‹ï¼šå¯Œå£«åº·æœºå™¨äººç”Ÿäº§å·¥å‚    ä½¿ç”¨çš„CPUä¿¡æ¯ï¼šcpu_no<span class="token operator">:</span> <span class="token number">199939637444134</span><span class="token punctuation">,</span> hashCode<span class="token operator">:</span><span class="token number">109961541</span>    <span class="token punctuation">]</span>robot3 <span class="token punctuation">[</span>æœºå™¨äººåºåˆ—å·ï¼š<span class="token number">1552193313008</span>    ç”Ÿäº§æ—¥æœŸï¼š<span class="token number">2018</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">26</span>    ç”Ÿäº§å·¥ç¨‹ï¼šå¯Œå£«åº·æœºå™¨äººç”Ÿäº§å·¥å‚    ä½¿ç”¨çš„CPUä¿¡æ¯ï¼šcpu_no<span class="token operator">:</span> <span class="token number">199939637755232</span><span class="token punctuation">,</span> hashCode<span class="token operator">:</span><span class="token number">670700378</span>    <span class="token punctuation">]</span>robot4 <span class="token punctuation">[</span>æœºå™¨äººåºåˆ—å·ï¼š<span class="token number">1552713267456</span>    ç”Ÿäº§æ—¥æœŸï¼š<span class="token number">2018</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">26</span>    ç”Ÿäº§å·¥ç¨‹ï¼šå¯Œå£«åº·æœºå™¨äººç”Ÿäº§å·¥å‚    ä½¿ç”¨çš„CPUä¿¡æ¯ï¼šcpu_no<span class="token operator">:</span> <span class="token number">199939638066609</span><span class="token punctuation">,</span> hashCode<span class="token operator">:</span><span class="token number">1190654826</span>    <span class="token punctuation">]</span>robot5 <span class="token punctuation">[</span>æœºå™¨äººåºåˆ—å·ï¼š<span class="token number">1552631984200</span>    ç”Ÿäº§æ—¥æœŸï¼š<span class="token number">2018</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">26</span>    ç”Ÿäº§å·¥ç¨‹ï¼šå¯Œå£«åº·æœºå™¨äººç”Ÿäº§å·¥å‚    ä½¿ç”¨çš„CPUä¿¡æ¯ï¼šcpu_no<span class="token operator">:</span> <span class="token number">199939638432856</span><span class="token punctuation">,</span> hashCode<span class="token operator">:</span><span class="token number">1109371569</span>    <span class="token punctuation">]</span>robot6 <span class="token punctuation">[</span>æœºå™¨äººåºåˆ—å·ï¼š<span class="token number">1552251503125</span>    ç”Ÿäº§æ—¥æœŸï¼š<span class="token number">2018</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">26</span>    ç”Ÿäº§å·¥ç¨‹ï¼šå¯Œå£«åº·æœºå™¨äººç”Ÿäº§å·¥å‚    ä½¿ç”¨çš„CPUä¿¡æ¯ï¼šcpu_no<span class="token operator">:</span> <span class="token number">199939638821939</span><span class="token punctuation">,</span> hashCode<span class="token operator">:</span><span class="token number">728890494</span>    <span class="token punctuation">]</span>robot7 <span class="token punctuation">[</span>æœºå™¨äººåºåˆ—å·ï¼š<span class="token number">1553081212960</span>    ç”Ÿäº§æ—¥æœŸï¼š<span class="token number">2018</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">26</span>    ç”Ÿäº§å·¥ç¨‹ï¼šå¯Œå£«åº·æœºå™¨äººç”Ÿäº§å·¥å‚    ä½¿ç”¨çš„CPUä¿¡æ¯ï¼šcpu_no<span class="token operator">:</span> <span class="token number">199939639177528</span><span class="token punctuation">,</span> hashCode<span class="token operator">:</span><span class="token number">1558600329</span>    <span class="token punctuation">]</span>robot8 <span class="token punctuation">[</span>æœºå™¨äººåºåˆ—å·ï¼š<span class="token number">1552159331444</span>    ç”Ÿäº§æ—¥æœŸï¼š<span class="token number">2018</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">26</span>    ç”Ÿäº§å·¥ç¨‹ï¼šå¯Œå£«åº·æœºå™¨äººç”Ÿäº§å·¥å‚    ä½¿ç”¨çš„CPUä¿¡æ¯ï¼šcpu_no<span class="token operator">:</span> <span class="token number">199939639639177</span><span class="token punctuation">,</span> hashCode<span class="token operator">:</span><span class="token number">636718812</span>    <span class="token punctuation">]</span>robot9 <span class="token punctuation">[</span>æœºå™¨äººåºåˆ—å·ï¼š<span class="token number">1551967664265</span>    ç”Ÿäº§æ—¥æœŸï¼š<span class="token number">2018</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">26</span>    ç”Ÿäº§å·¥ç¨‹ï¼šå¯Œå£«åº·æœºå™¨äººç”Ÿäº§å·¥å‚    ä½¿ç”¨çš„CPUä¿¡æ¯ï¼šcpu_no<span class="token operator">:</span> <span class="token number">199939640067454</span><span class="token punctuation">,</span> hashCode<span class="token operator">:</span><span class="token number">445051633</span>    <span class="token punctuation">]</span></code></pre><p>åŸå‹æ¨¡å¼æ€»ç»“</p><p>åŸå‹æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹å‡ ç§æƒ…æ™¯ï¼š</p><ul><li><p>å½“è¦å®ä¾‹åŒ–çš„ç±»æ˜¯åœ¨è¿è¡Œæ—¶åˆ»æŒ‡å®šæ—¶ï¼›</p></li><li><p>ä¸ºäº†é¿å…åˆ›å»ºä¸€ä¸ªä¸äº§å“ç±»å±‚æ¬¡å¹³è¡Œçš„å·¥å‚ç±»å±‚æ¬¡æ—¶ï¼›</p></li><li><p>å½“ä¸€ä¸ªç±»çš„å®ä¾‹åªèƒ½æœ‰å‡ ä¸ªä¸åŒçŠ¶æ€ç»„åˆä¸­çš„ä¸€ç§æ—¶ï¼›</p></li></ul><h3 id="äºŒã€ç»“æ„å‹æ¨¡å¼"><a href="#äºŒã€ç»“æ„å‹æ¨¡å¼" class="headerlink" title="äºŒã€ç»“æ„å‹æ¨¡å¼"></a>äºŒã€ç»“æ„å‹æ¨¡å¼</h3><h4 id="1-æ¡¥æ¥æ¨¡å¼"><a href="#1-æ¡¥æ¥æ¨¡å¼" class="headerlink" title="1.æ¡¥æ¥æ¨¡å¼"></a>1.æ¡¥æ¥æ¨¡å¼</h4><p>æ¡¥æ¥æ¨¡å¼çš„å®šä¹‰ï¼šå°†æŠ½è±¡éƒ¨åˆ†ä¸å®ƒçš„çš„å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ã€‚å®ƒæ˜¯ç”¨ç»„åˆå…³ç³»ä»£æ›¿ç»§æ‰¿å…³ç³»æ¥å®ç°ï¼Œä»è€Œé™ä½äº†æŠ½è±¡å’Œå®ç°è¿™ä¸¤ä¸ªå¯å˜ç»´åº¦çš„è€¦åˆåº¦ã€‚</p><p>æ¡¥æ¥ï¼ˆBridgeï¼‰æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š</p><ol><li><strong>æŠ½è±¡åŒ–ï¼ˆAbstractionï¼‰</strong>è§’è‰²ï¼šå®šä¹‰æŠ½è±¡ç±»ï¼Œå¹¶åŒ…å«ä¸€ä¸ªå¯¹å®ç°åŒ–å¯¹è±¡çš„å¼•ç”¨ã€‚</li><li><strong>æ‰©å±•æŠ½è±¡åŒ–ï¼ˆRefined Abstractionï¼‰</strong>è§’è‰²ï¼šæ˜¯æŠ½è±¡åŒ–è§’è‰²çš„å­ç±»ï¼Œå®ç°çˆ¶ç±»ä¸­çš„ä¸šåŠ¡æ–¹æ³•ï¼Œå¹¶é€šè¿‡ç»„åˆå…³ç³»è°ƒç”¨å®ç°åŒ–è§’è‰²ä¸­çš„ä¸šåŠ¡æ–¹æ³•ã€‚</li><li><strong>å®ç°åŒ–ï¼ˆImplementorï¼‰è§’è‰²</strong>ï¼šå®šä¹‰å®ç°åŒ–è§’è‰²çš„æ¥å£ï¼Œä¾›æ‰©å±•æŠ½è±¡åŒ–è§’è‰²è°ƒç”¨ã€‚</li><li><strong>å…·ä½“å®ç°åŒ–ï¼ˆConcrete Implementorï¼‰</strong>è§’è‰²ï¼šç»™å‡ºå®ç°åŒ–è§’è‰²æ¥å£çš„å…·ä½“å®ç°ã€‚</li></ol><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/BridgePattern.png" alt></p><p>ç¤ºä¾‹</p><p>å®ç°åŒ–è§’è‰²</p><pre class=" language-java"><code class="language-java"> <span class="token comment" spellcheck="true">//Implementor</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DrawingAPI</span><span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">drawCircle</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token keyword">double</span> y<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token keyword">double</span> radius<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æŠ½è±¡åŒ–è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//Abstraction</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Shape</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> DrawingAPI drawingAPI<span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token function">Shape</span><span class="token punctuation">(</span><span class="token keyword">final</span> DrawingAPI drawingAPI<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>drawingAPI <span class="token operator">=</span> drawingAPI<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//low level</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">resizeByPercentage</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token keyword">double</span> pct<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//height level</span><span class="token punctuation">}</span></code></pre><p>æ‰©å±•æŠ½è±¡åŒ–</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//RefinedAbstraction</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CircleShape</span> <span class="token keyword">extends</span> <span class="token class-name">Shape</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> radius<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">CircleShape</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token keyword">double</span> y<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token keyword">double</span> radius<span class="token punctuation">,</span> <span class="token keyword">final</span> DrawingAPI drawingAPI<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>drawingAPI<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>radius <span class="token operator">=</span> radius<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// low-level Implementation specific</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        drawingAPI<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> radius<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// high-level Abstraction specific</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">resizeByPercentage</span><span class="token punctuation">(</span><span class="token keyword">double</span> pct<span class="token punctuation">)</span> <span class="token punctuation">{</span>        radius <span class="token operator">*=</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">+</span> pct<span class="token operator">/</span><span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“å®ç°åŒ–è§’è‰²1</p><pre class=" language-java"><code class="language-java">    <span class="token comment" spellcheck="true">//ConcreteImplementor 1</span>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DrawingAPI1</span> <span class="token keyword">implements</span> <span class="token class-name">DrawingAPI</span><span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">drawCircle</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> y<span class="token punctuation">,</span> <span class="token keyword">double</span> radius<span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"API1.circle at %f:%f radius %f\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> radius<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span></code></pre><p>å…·ä½“å®ç°åŒ–è§’è‰²2</p><pre class=" language-java"><code class="language-java">    <span class="token comment" spellcheck="true">//ConcreteImplementor 2</span>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DrawingAPI2</span> <span class="token keyword">implements</span> <span class="token class-name">DrawingAPI</span><span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">drawCircle</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> y<span class="token punctuation">,</span> <span class="token keyword">double</span> radius<span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"API2.circle at %f:%f radius %f\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> radius<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Shape<span class="token punctuation">[</span><span class="token punctuation">]</span> shapes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Shape</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>          <span class="token keyword">new</span> <span class="token class-name">CircleShape</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DrawingAPI1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token keyword">new</span> <span class="token class-name">CircleShape</span><span class="token punctuation">(</span><span class="token number">5.0</span><span class="token punctuation">,</span><span class="token number">7.0</span><span class="token punctuation">,</span><span class="token number">11.0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DrawingAPI2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>Shape shape <span class="token operator">:</span> shapes<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//shape.draw();</span>            shape<span class="token punctuation">.</span><span class="token function">resizeByPercentage</span><span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            shape<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šAPI1<span class="token punctuation">.</span>circle at <span class="token number">1.000000</span><span class="token operator">:</span><span class="token number">2.000000</span> radius <span class="token number">3.075000</span>API2<span class="token punctuation">.</span>circle at <span class="token number">5.000000</span><span class="token operator">:</span><span class="token number">7.000000</span> radius <span class="token number">11.275000</span></code></pre><p>ç¤ºä¾‹2</p><p>æ•°å­¦è¯¾ç¨‹ï¼ˆå®ç°åŒ–è§’è‰²ï¼‰</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æ•°å­¦è¯¾ç¨‹ï¼ŒImplementor */</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Math</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>é«˜ç­‰æ•°å­¦ï¼ˆå…·ä½“å®ç°åŒ–è§’è‰²ï¼‰</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * é«˜ç­‰æ•°å­¦ç±»ï¼ŒConcreteImplementor */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdvanceMath</span> <span class="token keyword">extends</span> <span class="token class-name">Math</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"é€‰æ‹©äº†é«˜ç­‰æ•°å­¦"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ•°å­¦åˆ†æï¼ˆå…·ä½“å®ç°åŒ–è§’è‰²ï¼‰</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æ•°å­¦åˆ†æç±»ï¼ŒConcreteImplementor */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MathAnalysis</span> <span class="token keyword">extends</span> <span class="token class-name">Math</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"é€‰æ‹©äº†æ•°å­¦åˆ†æ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å­¦é™¢ï¼ˆæŠ½è±¡åŒ–è§’è‰²ï¼‰</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * é™¢ç³»ç±»ï¼ŒAbstraction */</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Department</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// é™¢ç³»åŒ…å«çš„è¯¾ç¨‹</span>    <span class="token keyword">protected</span> Math mathCourse<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCourse</span><span class="token punctuation">(</span>Math math<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>mathCourse <span class="token operator">=</span> math<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//é€‰æ‹©è¯¾ç¨‹</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>è®¡ç®—æœºå­¦é™¢ï¼ˆæ‰©å±•æŠ½è±¡åŒ–è§’è‰²ï¼‰</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * è®¡ç®—æœºå­¦é™¢ï¼ŒRefinedAbstraction */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ComputerDpt</span> <span class="token keyword">extends</span> <span class="token class-name">Department</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è®¡ç®—æœºå­¦é™¢çš„åŒå­¦å¼€å§‹é€‰è¯¾äº†ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mathCourse<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ•°å­¦é™¢ï¼ˆæ‰©å±•æŠ½è±¡åŒ–è§’è‰²ï¼‰</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æ•°å­¦é™¢ï¼ŒRefinedAbstraction */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MathematicsDpt</span> <span class="token keyword">extends</span> <span class="token class-name">Department</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ•°å­¦é™¢çš„åŒå­¦å¼€å§‹é€‰è¯¾äº†ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mathCourse<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Department dp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComputerDpt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dp<span class="token punctuation">.</span><span class="token function">setCourse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AdvanceMath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dp<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MathematicsDpt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dp<span class="token punctuation">.</span><span class="token function">setCourse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MathAnalysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dp<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šè®¡ç®—æœºå­¦é™¢çš„åŒå­¦å¼€å§‹é€‰è¯¾äº†ï¼šé€‰æ‹©äº†é«˜ç­‰æ•°å­¦æ•°å­¦é™¢çš„åŒå­¦å¼€å§‹é€‰è¯¾äº†ï¼šé€‰æ‹©äº†æ•°å­¦åˆ†æ</code></pre><p>æ¡¥æ¥æ¨¡å¼æ€»ç»“</p><p>æ¡¥æ¥ï¼ˆBridgeï¼‰æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯ï¼š</p><ul><li>ç”±äºæŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼Œæ‰€ä»¥æ‰©å±•èƒ½åŠ›å¼ºï¼›</li><li>å…¶å®ç°ç»†èŠ‚å¯¹å®¢æˆ·é€æ˜ã€‚</li></ul><p>ç¼ºç‚¹æ˜¯ï¼šç”±äºèšåˆå…³ç³»å»ºç«‹åœ¨æŠ½è±¡å±‚ï¼Œè¦æ±‚å¼€å‘è€…é’ˆå¯¹æŠ½è±¡åŒ–è¿›è¡Œè®¾è®¡ä¸ç¼–ç¨‹ï¼Œè¿™å¢åŠ äº†ç³»ç»Ÿçš„ç†è§£ä¸è®¾è®¡éš¾åº¦ã€‚</p><p>æ¡¥æ¥æ¨¡å¼é€šå¸¸é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p><ol><li>å½“ä¸€ä¸ªç±»å­˜åœ¨ä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œä¸”è¿™ä¸¤ä¸ªç»´åº¦éƒ½éœ€è¦è¿›è¡Œæ‰©å±•æ—¶ï¼›</li><li>å½“ä¸€ä¸ªç³»ç»Ÿä¸å¸Œæœ›ä½¿ç”¨ç»§æ‰¿æˆ–å› ä¸ºå¤šå±‚æ¬¡ç»§æ‰¿å¯¼è‡´ç³»ç»Ÿç±»çš„ä¸ªæ•°æ€¥å‰§å¢åŠ æ—¶ï¼›</li><li>å½“ä¸€ä¸ªç³»ç»Ÿéœ€è¦åœ¨æ„ä»¶çš„æŠ½è±¡åŒ–è§’è‰²å’Œå…·ä½“åŒ–è§’è‰²ä¹‹é—´å¢åŠ æ›´å¤šçš„çµæ´»æ€§æ—¶ã€‚</li></ol><h4 id="2-é€‚é…å™¨æ¨¡å¼"><a href="#2-é€‚é…å™¨æ¨¡å¼" class="headerlink" title="2.é€‚é…å™¨æ¨¡å¼"></a>2.é€‚é…å™¨æ¨¡å¼</h4><p>é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterPatternï¼‰ï¼Œä¹Ÿç§°ä¸ºåŒ…è£…å™¨æ¨¡å¼ã€‚åœ¨å®é™…çš„è½¯ä»¶å¼€å‘é¡¹ç›®ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°ä»¥å‰ç¼–å†™çš„æ¨¡å—çš„æ¥å£è·Ÿå½“å‰è®¾è®¡çš„æ¨¡å—æ¥å£ä¸å»åˆä»¥è‡³äºæ— æ³•å¤ç”¨æƒ…å†µï¼Œè¿™ç§æƒ…å†µåœ¨é¡¹ç›®ä¸­å°±éœ€è¦ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ã€‚</p><p>é€‚é…å™¨æ¨¡å¼å®šä¹‰ï¼šå°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·æ‰€å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£ã€‚é€‚é…å™¨æ¨¡å¼ä½¿åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½å†ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥åœ¨ä¸€èµ·å·¥ä½œã€‚</p><p>é€‚é…å™¨æ¨¡å¼æœ‰ä¸¤ç§ç±»å‹ï¼š<strong>ç±»é€‚é…å™¨æ¨¡å¼</strong>å’Œ<strong>å¯¹è±¡é€‚é…å™¨æ¨¡å¼</strong>ï¼Œå‰è€…ç±»ä¹‹é—´çš„è€¦åˆåº¦æ¯”åè€…é«˜ï¼Œä¸”è¦æ±‚ç¨‹åºå‘˜äº†è§£ç°æœ‰ç»„ä»¶åº“ä¸­çš„ç›¸å…³ç»„ä»¶çš„å†…éƒ¨ç»“æ„ï¼Œæ‰€ä»¥åº”ç”¨ç›¸å¯¹è¾ƒå°‘äº›ã€‚ç±»é€‚é…å™¨æ¨¡å¼å¯é‡‡ç”¨å¤šé‡ç»§æ‰¿æ–¹å¼å®ç°ï¼Œå¦‚ <a href="http://c.biancheng.net/cplus/" target="_blank" rel="noopener">C++</a> å¯å®šä¹‰ä¸€ä¸ªé€‚é…å™¨ç±»æ¥åŒæ—¶ç»§æ‰¿å½“å‰ç³»ç»Ÿçš„ä¸šåŠ¡æ¥å£å’Œç°æœ‰ç»„ä»¶åº“ä¸­å·²ç»å­˜åœ¨çš„ç»„ä»¶æ¥å£ï¼›<a href="http://c.biancheng.net/java/" target="_blank" rel="noopener">Java</a> ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œä½†å¯ä»¥å®šä¹‰ä¸€ä¸ªé€‚é…å™¨ç±»æ¥å®ç°å½“å‰ç³»ç»Ÿçš„ä¸šåŠ¡æ¥å£ï¼ŒåŒæ—¶åˆç»§æ‰¿ç°æœ‰ç»„ä»¶åº“ä¸­å·²ç»å­˜åœ¨çš„ç»„ä»¶ã€‚</p><p>é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š</p><ol><li><strong>ç›®æ ‡ï¼ˆTargetï¼‰æ¥å£</strong>ï¼šå½“å‰ç³»ç»Ÿä¸šåŠ¡æ‰€æœŸå¾…çš„æ¥å£ï¼Œå®ƒå¯ä»¥æ˜¯æŠ½è±¡ç±»æˆ–æ¥å£ã€‚</li><li><strong>é€‚é…è€…ï¼ˆAdapteeï¼‰ç±»</strong>ï¼šå®ƒæ˜¯è¢«è®¿é—®å’Œé€‚é…çš„ç°å­˜ç»„ä»¶åº“ä¸­çš„ç»„ä»¶æ¥å£ã€‚</li><li><strong>é€‚é…å™¨ï¼ˆAdapterï¼‰ç±»</strong>ï¼šå®ƒæ˜¯ä¸€ä¸ªè½¬æ¢å™¨ï¼Œé€šè¿‡ç»§æ‰¿æˆ–å¼•ç”¨é€‚é…è€…çš„å¯¹è±¡ï¼ŒæŠŠé€‚é…è€…æ¥å£è½¬æ¢æˆç›®æ ‡æ¥å£ï¼Œè®©å®¢æˆ·æŒ‰ç›®æ ‡æ¥å£çš„æ ¼å¼è®¿é—®é€‚é…è€…ã€‚</li></ol><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/AdapterPattern.png" alt></p><p>å¯¹è±¡é€‚é…å™¨ç¤ºä¾‹</p><p>ç›®æ ‡æ¥å£</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Target</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//åŸæœ‰æ–¹æ³•</span>    <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>é€‚é…è€…</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Adaptee</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">specificRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å®¢æˆ·å‘èµ·çš„ç‰¹æ®Šè¯·æ±‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>é€‚é…å™¨</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Adapter</span> <span class="token keyword">implements</span> <span class="token class-name">Target</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//åŒ…å«ä¸€ä¸ªç§æœ‰çš„Adapteeå¯¹è±¡</span>    <span class="token keyword">private</span> Adaptee adaptee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Adaptee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//è¦†ç›–åŸæœ‰çš„requestæ–¹æ³•</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å®¢æˆ·å‘èµ·çš„æ™®é€šè¯·æ±‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        adaptee<span class="token punctuation">.</span><span class="token function">specificRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//å®¢æˆ·åŸºæœ¬è¯·æ±‚</span>        Target target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Adapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"------å¼€å§‹é€‚é…------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//å®¢æˆ·çš„ç‰¹æ®Šè¯·æ±‚ï¼Œéœ€è¦è°ƒç”¨Adapterçš„æ–¹æ³•</span>        target<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼š<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>å¼€å§‹é€‚é…<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>å®¢æˆ·å‘èµ·çš„æ™®é€šè¯·æ±‚å®¢æˆ·å‘èµ·çš„ç‰¹æ®Šè¯·æ±‚</code></pre><p>ç±»é€‚é…å™¨ç¤ºä¾‹</p><p>ç›®æ ‡æ¥å£</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Target</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//å®¢æˆ·ç«¯æœŸå¾…å¾—åˆ°çš„æ¥å£</span>    <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>é€‚é…è€…</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Adaptee</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">specificRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å®¢æˆ·å‘èµ·çš„ç‰¹æ®Šè¯·æ±‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>é€‚é…å™¨</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Adapter</span> <span class="token keyword">extends</span> <span class="token class-name">Adaptee</span> <span class="token keyword">implements</span> <span class="token class-name">Target</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * ç›®æ ‡æ¥å£è¦æ±‚è°ƒç”¨request()è¿™ä¸ªæ–¹æ³•åï¼Œä½†æºç±»Adapteeæ²¡æœ‰æ–¹æ³•request()     * å› æ­¤é€‚é…å™¨è¡¥å……ä¸Šè¿™ä¸ªæ–¹æ³•å     * ä½†å®é™…ä¸Šrequest()åªæ˜¯è°ƒç”¨æºç±»Adapteeçš„specificRequest()æ–¹æ³•çš„å†…å®¹     * æ‰€ä»¥é€‚é…å™¨åªæ˜¯å°†specificRequest()æ–¹æ³•ä½œäº†ä¸€å±‚å°è£…ï¼Œå°è£…æˆTargetå¯ä»¥è°ƒç”¨çš„request()è€Œå·²     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å®¢æˆ·å‘èµ·çš„æ™®é€šè¯·æ±‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">specificRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Target mAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Adapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mAdapter<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šå®¢æˆ·å‘èµ·çš„æ™®é€šè¯·æ±‚å®¢æˆ·å‘èµ·çš„ç‰¹æ®Šè¯·æ±‚</code></pre><p>é€‚é…å™¨æ¨¡å¼æ€»ç»“</p><p>å¯¹è±¡é€‚é…å™¨å’Œç±»é€‚é…å™¨çš„åŒºåˆ«ï¼š</p><ul><li><p>å¯¹è±¡é€‚é…å™¨æ˜¯é€šè¿‡å¯¹è±¡ç»„åˆçš„æ–¹å¼æ¥å®ç°çš„ï¼›</p></li><li><p>ç±»é€‚é…å™¨ä½¿é€šè¿‡ç±»ç»§æ‰¿çš„æ–¹å¼æ¥å®ç°çš„ï¼›</p></li></ul><p>è¯¥æ¨¡å¼çš„ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li>å®¢æˆ·ç«¯é€šè¿‡é€‚é…å™¨å¯ä»¥é€æ˜åœ°è°ƒç”¨ç›®æ ‡æ¥å£ï¼›</li><li>å¤ç”¨äº†ç°å­˜çš„ç±»ï¼Œç¨‹åºå‘˜ä¸éœ€è¦ä¿®æ”¹åŸæœ‰ä»£ç è€Œé‡ç”¨ç°æœ‰çš„é€‚é…è€…ç±»ï¼›</li><li>å°†ç›®æ ‡ç±»å’Œé€‚é…è€…ç±»è§£è€¦ï¼Œè§£å†³äº†ç›®æ ‡ç±»å’Œé€‚é…è€…ç±»æ¥å£ä¸ä¸€è‡´çš„é—®é¢˜ï¼›</li></ul><p>å…¶ç¼ºç‚¹æ˜¯ï¼šå¯¹ç±»é€‚é…å™¨æ¥è¯´ï¼Œæ›´æ¢é€‚é…å™¨çš„å®ç°è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ã€‚</p><p>é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰é€šå¸¸é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p><ul><li>ä»¥å‰å¼€å‘çš„ç³»ç»Ÿå­˜åœ¨æ»¡è¶³æ–°ç³»ç»ŸåŠŸèƒ½éœ€æ±‚çš„ç±»ï¼Œä½†å…¶æ¥å£åŒæ–°ç³»ç»Ÿçš„æ¥å£ä¸ä¸€è‡´ï¼›</li><li>ä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„ç»„ä»¶ï¼Œä½†ç»„ä»¶æ¥å£å®šä¹‰å’Œè‡ªå·±è¦æ±‚çš„æ¥å£å®šä¹‰ä¸åŒï¼›</li></ul><h4 id="3-è£…é¥°å™¨æ¨¡å¼"><a href="#3-è£…é¥°å™¨æ¨¡å¼" class="headerlink" title="3.è£…é¥°å™¨æ¨¡å¼"></a>3.è£…é¥°å™¨æ¨¡å¼</h4><p>å½“å¯¹ä¸€ä¸ªç±»çš„åŠŸèƒ½è¿›è¡Œæ‰©å±•æ—¶ï¼Œç¨‹åºå‘˜å¾€å¾€ä¼šå¾€ç±»é‡Œé¢å¢åŠ æ–°çš„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶ç¨‹åºåœ¨è¿è¡Œä¸­å°±éœ€è¦ç”Ÿæˆä¸€ä¸ªå…·æœ‰æ–°çš„è¡Œä¸ºçš„å¯¹è±¡ï¼Œå½“æ‰€å¢åŠ çš„è¡Œä¸ºç›¸å½“äºæ•´ä¸ªç±»æ¥è¯´æ¯”è¾ƒå¾®å°æ—¶ï¼Œæœ€å¥½å¯ä»¥åšåˆ°åœ¨ä¸æ”¹å˜åŸæœ‰ç±»æ–‡ä»¶å’Œä½¿ç”¨ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€æ‰©å±•æŸä¸ªå¯¹è±¡çš„åŠŸèƒ½ã€‚æ­¤æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ã€‚</p><p>è£…é¥°å™¨æ¨¡å¼ï¼ˆDecorator) å®šä¹‰ï¼šåŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ï¼Œå°±æ–°å¢åŠ çš„åŠŸèƒ½æ¥è¯´ï¼Œè£…é¥°å™¨æ¨¡å¼æ¯”ç”Ÿæˆå­ç±»æ›´ä¸ºçµæ´»ã€‚</p><p>è£…é¥°æ¨¡å¼ä¸»è¦åŒ…å«ä»¥ä¸‹è§’è‰²ï¼š</p><ol><li><strong>æŠ½è±¡æ„ä»¶ï¼ˆComponentï¼‰</strong>è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªæŠ½è±¡æ¥å£ä»¥è§„èŒƒå‡†å¤‡æ¥æ”¶é™„åŠ è´£ä»»çš„å¯¹è±¡ã€‚</li><li><strong>å…·ä½“æ„ä»¶ï¼ˆConcreteComponentï¼‰</strong>è§’è‰²ï¼šå®ç°æŠ½è±¡æ„ä»¶ï¼Œé€šè¿‡è£…é¥°è§’è‰²ä¸ºå…¶æ·»åŠ ä¸€äº›èŒè´£ã€‚</li><li><strong>æŠ½è±¡è£…é¥°ï¼ˆDecoratorï¼‰</strong>è§’è‰²ï¼šç»§æ‰¿æŠ½è±¡æ„ä»¶ï¼Œå¹¶åŒ…å«å…·ä½“æ„ä»¶çš„å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡å…¶å­ç±»æ‰©å±•å…·ä½“æ„ä»¶çš„åŠŸèƒ½ã€‚</li><li><strong>å…·ä½“è£…é¥°ï¼ˆConcreteDecoratorï¼‰</strong>è§’è‰²ï¼šå®ç°æŠ½è±¡è£…é¥°çš„ç›¸å…³æ–¹æ³•ï¼Œå¹¶ç»™å…·ä½“æ„ä»¶å¯¹è±¡æ·»åŠ é™„åŠ çš„è´£ä»»ã€‚</li></ol><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/DecoratorPattern.png" alt></p><p>ç¤ºä¾‹</p><p>æŠ½è±¡ç»„ä»¶è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// åŸºæœ¬æ“ä½œ</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“ç»„ä»¶è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteComponent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// åŸºæœ¬æ“ä½œ</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åŸºæœ¬æ“ä½œ"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æŠ½è±¡è£…é¥°å™¨è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Decorator</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> Component component<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setComponent</span><span class="token punctuation">(</span>Component component<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>component <span class="token operator">=</span> component<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// åŸºæœ¬æ“ä½œ</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>null <span class="token operator">!=</span> component<span class="token punctuation">)</span> <span class="token punctuation">{</span>            component<span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“è£…é¥°å™¨è§’è‰²A</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteDecoratorA</span> <span class="token keyword">extends</span> <span class="token class-name">Decorator</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String addedState<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        addedState <span class="token operator">=</span> <span class="token string">"æ–°å¢çŠ¶æ€"</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿™ä¸ªç±»å…·æœ‰ä¸€ä¸ªçŠ¶æ€ï¼š"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>addedState<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“è£…é¥°å™¨è§’è‰²B</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteDecoratorB</span> <span class="token keyword">extends</span> <span class="token class-name">Decorator</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addedBehavior</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç°åœ¨è¿™ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªæ–°æ–¹æ³•ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addedBehavior</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>        Component component <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// å®ä¾‹åŒ–ä¸¤ä¸ªè£…é¥°å™¨</span>        ConcreteDecorator decoratorA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteDecoratorA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ConcreteDecorator decoratorB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteDecoratorB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// å¯¹componentè¿›è¡Œè£…é¥°</span>        decoratorA<span class="token punctuation">.</span><span class="token function">setComponent</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç»è¿‡è£…é¥°å™¨Aè£…é¥°åçš„æ“ä½œï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        decoratorA<span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// å¯¹componentè¿›è¡Œè£…é¥°</span>        decoratorB<span class="token punctuation">.</span><span class="token function">setComponent</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç»è¿‡è£…é¥°å™¨Bè£…é¥°åçš„æ“ä½œï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        decoratorB<span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šç»è¿‡è£…é¥°å™¨Aè£…é¥°åçš„æ“ä½œï¼šåŸºæœ¬æ“ä½œè¿™ä¸ªç±»å…·æœ‰ä¸€ä¸ªçŠ¶æ€ï¼šæ–°å¢çŠ¶æ€ç»è¿‡è£…é¥°å™¨Bè£…é¥°åçš„æ“ä½œï¼šåŸºæœ¬æ“ä½œç°åœ¨è¿™ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªæ–°æ–¹æ³•ï¼</code></pre><p>ä¾‹å¦‚Javaä¸­çš„FilterInputStreamä¹Ÿæ˜¯ä½¿ç”¨çš„è£…é¥°å™¨æ¨¡å¼ï¼š</p><p><img src="/2019/03/02/DesignPattern/InputStream.png" alt></p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DecoratorDemo</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> FileNotFoundException <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//FileInputStreamè¢«è£…é¥°è€…</span>        InputStream inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"a.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//è£…é¥°è€…</span>        <span class="token comment" spellcheck="true">//DataInputStream &lt;- FilterInputStream &lt;- InputStream</span>        FilterInputStream filterInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è£…é¥°å™¨æ¨¡å¼æ€»ç»“</p><p>è£…é¥°ï¼ˆDecoratorï¼‰æ¨¡å¼çš„ä¸»è¦ä¼˜ç‚¹æœ‰ï¼š</p><ul><li>é‡‡ç”¨è£…é¥°æ¨¡å¼æ‰©å±•å¯¹è±¡çš„åŠŸèƒ½æ¯”é‡‡ç”¨ç»§æ‰¿æ–¹å¼æ›´åŠ çµæ´»ã€‚</li><li>å¯ä»¥è®¾è®¡å‡ºå¤šä¸ªä¸åŒçš„å…·ä½“è£…é¥°ç±»ï¼Œåˆ›é€ å‡ºå¤šä¸ªä¸åŒè¡Œä¸ºçš„ç»„åˆã€‚</li></ul><p>å…¶ä¸»è¦ç¼ºç‚¹æ˜¯ï¼šè£…é¥°æ¨¡å¼å¢åŠ äº†è®¸å¤šå­ç±»ï¼Œå¦‚æœè¿‡åº¦ä½¿ç”¨ä¼šä½¿ç¨‹åºå˜å¾—å¾ˆå¤æ‚ã€‚</p><p>è£…é¥°å™¨æ¨¡å¼ä¸»è¦é€‚ç”¨äºä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li><p>å½“éœ€è¦ä»¥ä¸å½±å“å…¶ä»–å¯¹è±¡ä¸ºå‰æå®ç°åŠ¨æ€ã€é€æ˜åœ°ç»™å•ä¸ªå¯¹è±¡æ·»åŠ èŒè´£æ—¶ï¼›</p></li><li><p>å½“éœ€è¦å°†å¯¹è±¡çš„æŸäº›èŒè´£è¿›è¡Œæ’¤é”€æ“ä½œæ—¶ï¼›</p></li><li><p>å½“ä¸èƒ½ä½¿ç”¨ç”Ÿæˆå­ç±»çš„æ–¹æ³•è¿›è¡Œå½“å‰ç³»ç»Ÿçš„æ‰©å……æ—¶ï¼›</p></li></ul><h4 id="4-ç»„åˆæ¨¡å¼"><a href="#4-ç»„åˆæ¨¡å¼" class="headerlink" title="4.ç»„åˆæ¨¡å¼"></a>4.ç»„åˆæ¨¡å¼</h4><p>åœ¨ç°å®ç”Ÿæ´»ä¸­æœ‰å¾ˆå¤šéƒ¨åˆ†ä¸æ•´ä½“çš„å…³ç³»ï¼Œæ¯”å¦‚å¤§å­¦é‡Œçš„ä¸€ä¸ªé™¢ç³»æ˜¯ä¸€ä¸ªå¤§å­¦çš„ä¸€éƒ¨åˆ†ï¼Œè€Œé™¢ç³»æ‰€è®¾ç½®çš„å­¦ç”ŸåŠå…¬å®¤æ˜¯é™¢ç³»çš„ä¸€éƒ¨åˆ†ã€‚å…¶å®è¿™ç§éƒ¨åˆ†ä¸æ•´ä½“çš„ç»“æ„è·Ÿæˆ‘ä»¬æ¯å¤©éƒ½æœ‰è§åˆ°çš„æ ‘çš„ç»“æ„éå¸¸ç›¸åƒã€‚è¿™ç§ç±»å‹æ ‘çš„ç»“æ„çš„è®¾è®¡æ¨¡å¼å°±æ˜¯ç»„åˆæ¨¡å¼ã€‚</p><p><strong>ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰</strong>çš„å®šä¹‰ï¼šå°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€œéƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡ç»“æ„ã€‚ç»„åˆæ¨¡å¼ä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚</p><p>ç»„åˆæ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š</p><ol><li><strong>æŠ½è±¡æ„ä»¶ï¼ˆComponentï¼‰</strong>è§’è‰²ï¼šå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºæ ‘å¶æ„ä»¶å’Œæ ‘ææ„ä»¶å£°æ˜å…¬å…±æ¥å£ï¼Œå¹¶å®ç°å®ƒä»¬çš„é»˜è®¤è¡Œä¸ºã€‚åœ¨é€æ˜å¼çš„ç»„åˆæ¨¡å¼ä¸­æŠ½è±¡æ„ä»¶è¿˜å£°æ˜è®¿é—®å’Œç®¡ç†å­ç±»çš„æ¥å£ï¼›åœ¨å®‰å…¨å¼çš„ç»„åˆæ¨¡å¼ä¸­ä¸å£°æ˜è®¿é—®å’Œç®¡ç†å­ç±»çš„æ¥å£ï¼Œç®¡ç†å·¥ä½œç”±æ ‘ææ„ä»¶å®Œæˆã€‚</li><li><strong>æ ‘å¶æ„ä»¶ï¼ˆLeafï¼‰</strong>è§’è‰²ï¼šæ˜¯ç»„åˆä¸­çš„å¶èŠ‚ç‚¹å¯¹è±¡ï¼Œå®ƒæ²¡æœ‰å­èŠ‚ç‚¹ï¼Œç”¨äºå®ç°æŠ½è±¡æ„ä»¶è§’è‰²ä¸­ å£°æ˜çš„å…¬å…±æ¥å£ã€‚</li><li><strong>æ ‘ææ„ä»¶ï¼ˆCompositeï¼‰</strong>è§’è‰²ï¼šæ˜¯ç»„åˆä¸­çš„åˆ†æ”¯èŠ‚ç‚¹å¯¹è±¡ï¼Œå®ƒæœ‰å­èŠ‚ç‚¹ã€‚å®ƒå®ç°äº†æŠ½è±¡æ„ä»¶è§’è‰²ä¸­å£°æ˜çš„æ¥å£ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å­˜å‚¨å’Œç®¡ç†å­éƒ¨ä»¶ï¼Œé€šå¸¸åŒ…å« Add()ã€Remove()ã€GetChild() ç­‰æ–¹æ³•ã€‚</li></ol><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/CompositePattern.png" alt></p><p>ç»„åˆæ¨¡å¼åˆ†ä¸º<strong>é€æ˜å¼çš„ç»„åˆæ¨¡å¼</strong>å’Œ<strong>å®‰å…¨å¼çš„ç»„åˆæ¨¡å¼</strong>ï¼š</p><ul><li><p><strong>é€æ˜æ–¹å¼</strong>ï¼šåœ¨è¯¥æ–¹å¼ä¸­ï¼Œç”±äºæŠ½è±¡æ„ä»¶å£°æ˜äº†æ‰€æœ‰å­ç±»ä¸­çš„å…¨éƒ¨æ–¹æ³•ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯æ— é¡»åŒºåˆ«æ ‘å¶å¯¹è±¡å’Œæ ‘æå¯¹è±¡ï¼Œå¯¹å®¢æˆ·ç«¯æ¥è¯´æ˜¯é€æ˜çš„ã€‚ä½†å…¶ç¼ºç‚¹æ˜¯ï¼šæ ‘å¶æ„ä»¶æœ¬æ¥æ²¡æœ‰ Add()ã€Remove() åŠ GetChild() æ–¹æ³•ï¼Œå´è¦å®ç°å®ƒä»¬ï¼ˆç©ºå®ç°æˆ–æŠ›å¼‚å¸¸ï¼‰ï¼Œè¿™æ ·ä¼šå¸¦æ¥ä¸€äº›å®‰å…¨æ€§é—®é¢˜ã€‚</p></li><li><p><strong>å®‰å…¨æ–¹å¼</strong>ï¼šåœ¨è¯¥æ–¹å¼ä¸­ï¼Œå°†ç®¡ç†å­æ„ä»¶çš„æ–¹æ³•ç§»åˆ°æ ‘ææ„ä»¶ä¸­ï¼ŒæŠ½è±¡æ„ä»¶å’Œæ ‘å¶æ„ä»¶æ²¡æœ‰å¯¹å­å¯¹è±¡çš„ç®¡ç†æ–¹æ³•ï¼Œè¿™æ ·å°±é¿å…äº†ä¸Šä¸€ç§æ–¹å¼çš„å®‰å…¨æ€§é—®é¢˜ï¼Œä½†ç”±äºå¶å­å’Œåˆ†æ”¯æœ‰ä¸åŒçš„æ¥å£ï¼Œå®¢æˆ·ç«¯åœ¨è°ƒç”¨æ—¶è¦çŸ¥é“æ ‘å¶å¯¹è±¡å’Œæ ‘æå¯¹è±¡çš„å­˜åœ¨ï¼Œæ‰€ä»¥å¤±å»äº†é€æ˜æ€§ã€‚</p></li></ul><p>é€æ˜ç»„åˆæ¨¡å¼ç¤ºä¾‹</p><p>æŠ½è±¡ç»„ä»¶</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//æŠ½è±¡ç»„ä»¶</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>Component c<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span>Component c<span class="token punctuation">)</span><span class="token punctuation">;</span>    Component <span class="token function">getChild</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æ ‘æç»„ä»¶</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//æ ‘æç»„ä»¶</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Composite</span> <span class="token keyword">implements</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>Component<span class="token operator">></span> children<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>Component<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>Component c<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        children<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span>Component c<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        children<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Component <span class="token function">getChild</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> children<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>Object obj<span class="token operator">:</span>children<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token punctuation">(</span><span class="token punctuation">(</span>Component<span class="token punctuation">)</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ ‘å¶ç»„ä»¶</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//æ ‘å¶ç»„ä»¶</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Leaf</span> <span class="token keyword">implements</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Leaf</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">=</span>name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>Component c<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span>Component c<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">}</span>    <span class="token keyword">public</span> Component <span class="token function">getChild</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ ‘å¶"</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">"ï¼šè¢«è®¿é—®ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        Component c0<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Composite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Component c1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Composite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Component leaf1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Leaf</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Component leaf2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Leaf</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Component leaf3<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Leaf</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        c0<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>leaf1<span class="token punctuation">)</span><span class="token punctuation">;</span>        c0<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token punctuation">;</span>        c1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>leaf2<span class="token punctuation">)</span><span class="token punctuation">;</span>        c1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>leaf3<span class="token punctuation">)</span><span class="token punctuation">;</span>        c0<span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šæ ‘å¶<span class="token number">1</span>ï¼šè¢«è®¿é—®ï¼æ ‘å¶<span class="token number">2</span>ï¼šè¢«è®¿é—®ï¼æ ‘å¶<span class="token number">3</span>ï¼šè¢«è®¿é—®ï¼</code></pre><p>å®‰å…¨ç»„åˆæ¨¡å¼ç¤ºä¾‹</p><p>æŠ½è±¡ç»„ä»¶è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//Component</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Graphic</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æ ‘æç»„ä»¶è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//Composite</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompositeGraphic</span> <span class="token keyword">implements</span> <span class="token class-name">Graphic</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//Collection of child graphics.</span>    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>Graphic<span class="token operator">></span> childGraphic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>Graphic<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>Graphic graphic <span class="token operator">:</span> childGraphic<span class="token punctuation">)</span><span class="token punctuation">{</span>            graphic<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>Graphic graphic<span class="token punctuation">)</span><span class="token punctuation">{</span>        childGraphic<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>graphic<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span>Graphic graphic<span class="token punctuation">)</span><span class="token punctuation">{</span>        childGraphic<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>graphic<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ ‘å¶ç»„ä»¶è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//Leaf</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Ellipse</span> <span class="token keyword">implements</span> <span class="token class-name">Graphic</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Ellipse print"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//Initialize four ellipses</span>        Ellipse ellipse1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ellipse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Ellipse ellipse2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ellipse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Ellipse ellipse3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ellipse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Ellipse ellipse4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ellipse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//Initialize composite graphic</span>        CompositeGraphic graphic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CompositeGraphic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//Composes the graphics</span>        graphic<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ellipse1<span class="token punctuation">)</span><span class="token punctuation">;</span>        graphic<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ellipse2<span class="token punctuation">)</span><span class="token punctuation">;</span>        graphic<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ellipse3<span class="token punctuation">)</span><span class="token punctuation">;</span>        graphic<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ellipse4<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//Prints the complete graphic (Four times the string "Ellipse").</span>        graphic<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šEllipse printEllipse printEllipse printEllipse print</code></pre><p>ç»„åˆæ¨¡å¼æ€»ç»“</p><p>ç»„åˆæ¨¡å¼çš„ä¸»è¦ä¼˜ç‚¹æœ‰ï¼š</p><ul><li><p>ç»„åˆæ¨¡å¼ä½¿å¾—å®¢æˆ·ç«¯ä»£ç å¯ä»¥ä¸€è‡´åœ°å¤„ç†å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡ï¼Œæ— é¡»å…³å¿ƒè‡ªå·±å¤„ç†çš„æ˜¯å•ä¸ªå¯¹è±¡ï¼Œè¿˜æ˜¯ç»„åˆå¯¹è±¡ï¼Œè¿™ç®€åŒ–äº†å®¢æˆ·ç«¯ä»£ç ï¼›</p></li><li><p>æ›´å®¹æ˜“åœ¨ç»„åˆä½“å†…åŠ å…¥æ–°çš„å¯¹è±¡ï¼Œå®¢æˆ·ç«¯ä¸ä¼šå› ä¸ºåŠ å…¥äº†æ–°çš„å¯¹è±¡è€Œæ›´æ”¹æºä»£ç ï¼Œæ»¡è¶³â€œå¼€é—­åŸåˆ™â€ï¼›</p></li></ul><p>å…¶ä¸»è¦ç¼ºç‚¹æ˜¯ï¼š</p><ul><li><p>è®¾è®¡è¾ƒå¤æ‚ï¼Œå®¢æˆ·ç«¯éœ€è¦èŠ±æ›´å¤šæ—¶é—´ç†æ¸…ç±»ä¹‹é—´çš„å±‚æ¬¡å…³ç³»ï¼›</p></li><li><p>ä¸å®¹æ˜“é™åˆ¶å®¹å™¨ä¸­çš„æ„ä»¶ï¼›</p></li><li><p>ä¸å®¹æ˜“ç”¨ç»§æ‰¿çš„æ–¹æ³•æ¥å¢åŠ æ„ä»¶çš„æ–°åŠŸèƒ½ï¼›</p></li></ul><p>ç»„åˆæ¨¡å¼é€‚ç”¨äºä»¥ä¸‹åº”ç”¨åœºæ™¯ï¼š</p><ul><li><p>åœ¨éœ€è¦è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡æ•´ä½“ä¸éƒ¨åˆ†çš„å±‚æ¬¡ç»“æ„çš„åœºåˆã€‚</p></li><li><p>è¦æ±‚å¯¹ç”¨æˆ·éšè—ç»„åˆå¯¹è±¡ä¸å•ä¸ªå¯¹è±¡çš„ä¸åŒï¼Œç”¨æˆ·å¯ä»¥ç”¨ç»Ÿä¸€çš„æ¥å£ä½¿ç”¨ç»„åˆç»“æ„ä¸­çš„æ‰€æœ‰å¯¹è±¡çš„åœºåˆã€‚</p></li></ul><h4 id="5-äº«å…ƒæ¨¡å¼"><a href="#5-äº«å…ƒæ¨¡å¼" class="headerlink" title="5.äº«å…ƒæ¨¡å¼"></a>5.äº«å…ƒæ¨¡å¼</h4><p>æ¯ä¸ªå¤§å­¦éƒ½æœ‰è‡ªå·±çš„å›¾ä¹¦é¦†ï¼Œä¸€ä¸ªåŸå¸‚å¾€å¾€ä¹Ÿä¼šå»ºé€ è‡ªå·±çš„å›¾ä¹¦é¦†æ¥æ”¶è—ä¸€äº›ä¹¦ç±ã€‚å›¾ä¹¦é¦†å­˜åœ¨çš„é‡è¦ä»·å€¼å°±æ˜¯è®©æ›´å¤šçš„äººå…±äº«åˆ°å›¾ä¹¦ï¼Œå½“äººä»¬éœ€è¦æŸ¥é˜…æŸæœ¬å›¾ä¹¦å®¤ï¼Œåªéœ€è¦åˆ°å›¾ä¹¦é¦†ä¸­é˜…è¯»è¿™æœ¬ä¹¦å°±å¯ä»¥äº†ã€‚è¯•æƒ³å¦‚æœæ¯æ¬¡éœ€è¦æŸæœ¬ä¹¦æ—¶å°±å»ä¹°ä¸€æœ¬çš„è¯ï¼Œé‚£ä¹ˆè¿™ç¬”æŠ•å…¥ä¹Ÿæ˜¯å¾ˆå®¢è§‚çš„ã€‚æ‰€ä»¥å›¾ä¹¦é¦†çš„å­˜åœ¨æä¾›äº†ä¸€ç§å›¾ä¹¦çš„å…±äº«æ¨¡å¼ã€‚åœ¨ç¼–ç¨‹çš„ä¸–ç•Œä¸­ï¼Œå½“ä¸€ä¸ªç³»ç»Ÿéœ€è¦å¤§é‡çš„å°ç²’åº¦å¯¹è±¡æ—¶ï¼Œä½¿ç”¨å…±äº«çš„æŠ€æœ¯å¯ä»¥å¾ˆå¥½åœ°æ§åˆ¶èµ„æºçš„å ç”¨ã€‚</p><p><strong>äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰æ¨¡å¼</strong>çš„å®šä¹‰ï¼šè¿ç”¨å…±äº«æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡çš„å¤ç”¨ã€‚å®ƒé€šè¿‡å…±äº«å·²ç»å­˜åœ¨çš„åˆæ©¡æ¥å¤§å¹…åº¦å‡å°‘éœ€è¦åˆ›å»ºçš„å¯¹è±¡æ•°é‡ã€é¿å…å¤§é‡ç›¸ä¼¼ç±»çš„å¼€é”€ï¼Œä»è€Œæé«˜ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡ã€‚</p><p>äº«å…ƒæ¨¡å¼çš„ä¸»è¦è§’è‰²æœ‰å¦‚ä¸‹ï¼š</p><ol><li><strong>æŠ½è±¡äº«å…ƒè§’è‰²ï¼ˆFlyweightï¼‰</strong>:æ˜¯æ‰€æœ‰çš„å…·ä½“äº«å…ƒç±»çš„åŸºç±»ï¼Œä¸ºå…·ä½“äº«å…ƒè§„èŒƒéœ€è¦å®ç°çš„å…¬å…±æ¥å£ï¼Œéäº«å…ƒçš„å¤–éƒ¨çŠ¶æ€ä»¥å‚æ•°çš„å½¢å¼é€šè¿‡æ–¹æ³•ä¼ å…¥ã€‚</li><li><strong>å…·ä½“äº«å…ƒï¼ˆConcreteFlyweightï¼‰è§’è‰²</strong>ï¼šå®ç°æŠ½è±¡äº«å…ƒè§’è‰²ä¸­æ‰€è§„å®šçš„æ¥å£ã€‚</li><li><strong>éäº«å…ƒï¼ˆUnsharedConcreteFlyweight)è§’è‰²</strong>ï¼šæ˜¯ä¸å¯ä»¥å…±äº«çš„å¤–éƒ¨çŠ¶æ€ï¼Œå®ƒä»¥å‚æ•°çš„å½¢å¼æ³¨å…¥å…·ä½“äº«å…ƒçš„ç›¸å…³æ–¹æ³•ä¸­ã€‚</li><li><strong>äº«å…ƒå·¥å‚ï¼ˆFlyweightFactoryï¼‰è§’è‰²</strong>ï¼šè´Ÿè´£åˆ›å»ºå’Œç®¡ç†äº«å…ƒè§’è‰²ã€‚å½“å®¢æˆ·å¯¹è±¡è¯·æ±‚ä¸€ä¸ªäº«å…ƒå¯¹è±¡æ—¶ï¼Œäº«å…ƒå·¥å‚æ£€æŸ»ç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨ç¬¦åˆè¦æ±‚çš„äº«å…ƒå¯¹è±¡ï¼Œå¦‚æœå­˜åœ¨åˆ™æä¾›ç»™å®¢æˆ·ï¼›å¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº«å…ƒå¯¹è±¡ã€‚</li></ol><p>ä¸Šé¢æåˆ°äº†å†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€ï¼Œæ‰€è°“å†…éƒ¨çŠ¶æ€ï¼Œå°±æ˜¯æŒ‡äº«å…ƒå¯¹è±¡å†…éƒ¨çš„ä¸ä¼šéšç€ç¯å¢ƒè€Œæ”¹å˜çš„å¯ä»¥å…±äº«çš„éƒ¨åˆ†ï¼›åä¹‹ï¼Œéšç€ç¯å¢ƒçš„æ”¹å˜è€Œåšå‡ºæ”¹å˜çš„ã€æ— æ³•å…±äº«çš„çŠ¶æ€å°±æ˜¯å¤–éƒ¨çŠ¶æ€ã€‚</p><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/FlyweightPattern.png" alt></p><p>ç¤ºä¾‹1</p><p>äº«å…ƒç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// äº«å…ƒç±»çš„æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Flyweight</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">operation</span><span class="token punctuation">(</span><span class="token keyword">int</span> extrinsicState<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…±äº«çš„å…·ä½“äº«å…ƒç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// å…±äº«çš„å…·ä½“äº«å…ƒå¯¹è±¡</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteFlyweight</span> <span class="token keyword">extends</span> <span class="token class-name">Flyweight</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operation</span><span class="token punctuation">(</span><span class="token keyword">int</span> extrinsicState<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…±äº«çš„å…·ä½“äº«å…ƒå¯¹è±¡ï¼š"</span> <span class="token operator">+</span> extrinsicState<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ä¸è¢«å…±äº«çš„äº«å…ƒå¯¹è±¡</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnsharedFlyweight</span> <span class="token keyword">extends</span> <span class="token class-name">Flyweight</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operation</span><span class="token punctuation">(</span><span class="token keyword">int</span> extrinsicState<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸è¢«å…±äº«çš„äº«å…ƒå¯¹è±¡ï¼š"</span> <span class="token operator">+</span> extrinsicState<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>äº«å…ƒå·¥åœºç±»</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlyweightFactory</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Flyweight<span class="token operator">></span> flyweights <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">FlyweightFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        flyweights<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteFlyweight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        flyweights<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteFlyweight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        flyweights<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteFlyweight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        flyweights<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"D"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteFlyweight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Flyweight <span class="token function">getFlyweight</span><span class="token punctuation">(</span>String key<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> flyweights<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        FlyweightFactory factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FlyweightFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> state <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>        Flyweight a <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">getFlyweight</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        a<span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>        Flyweight b <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">getFlyweight</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        b<span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span>state <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Flyweight c <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">getFlyweight</span><span class="token punctuation">(</span><span class="token string">"C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        c<span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span>state <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Flyweight d <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">getFlyweight</span><span class="token punctuation">(</span><span class="token string">"D"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        d<span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span>state <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Flyweight x <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UnsharedFlyweight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        x<span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span>state<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Flyweight y <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UnsharedFlyweight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        y<span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span>state<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>æµ‹è¯•ç»“æœï¼šå…±äº«çš„å…·ä½“äº«å…ƒå¯¹è±¡ï¼š<span class="token number">100</span>å…±äº«çš„å…·ä½“äº«å…ƒå¯¹è±¡ï¼š<span class="token number">200</span>å…±äº«çš„å…·ä½“äº«å…ƒå¯¹è±¡ï¼š<span class="token number">300</span>å…±äº«çš„å…·ä½“äº«å…ƒå¯¹è±¡ï¼š<span class="token number">400</span>ä¸è¢«å…±äº«çš„äº«å…ƒå¯¹è±¡ï¼š<span class="token number">50</span>ä¸è¢«å…±äº«çš„äº«å…ƒå¯¹è±¡ï¼š<span class="token number">50</span></code></pre><p>ç¤ºä¾‹2</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Order</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> Order <span class="token function">of</span><span class="token punctuation">(</span>String flavourName<span class="token punctuation">,</span> <span class="token keyword">int</span> tableNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>        CoffeeFlavour flavour <span class="token operator">=</span> CoffeeFlavour<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span>flavourName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Serving "</span> <span class="token operator">+</span> flavour <span class="token operator">+</span> <span class="token string">" to table "</span> <span class="token operator">+</span> tableNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CoffeeShop</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> ArrayList<span class="token operator">&lt;</span>Order<span class="token operator">></span> orders <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">takeOrder</span><span class="token punctuation">(</span>String flavour<span class="token punctuation">,</span> <span class="token keyword">int</span> tableNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>        orders<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>Order<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>flavour<span class="token punctuation">,</span> tableNumber<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        orders<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>Order<span class="token operator">:</span><span class="token operator">:</span>serve<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CoffeeFlavour</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> String name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> WeakHashMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> CoffeeFlavour<span class="token operator">></span> CACHE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakHashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// only intern() can call this constructor</span>    <span class="token keyword">private</span> <span class="token function">CoffeeFlavour</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> CoffeeFlavour <span class="token function">intern</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>CACHE<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> CACHE<span class="token punctuation">.</span><span class="token function">computeIfAbsent</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> CoffeeFlavour<span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">flavoursInCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>CACHE<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> CACHE<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        CoffeeShop shop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoffeeShop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shop<span class="token punctuation">.</span><span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token string">"Cappuccino"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shop<span class="token punctuation">.</span><span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token string">"Frappe"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shop<span class="token punctuation">.</span><span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token string">"Espresso"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shop<span class="token punctuation">.</span><span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token string">"Frappe"</span><span class="token punctuation">,</span> <span class="token number">897</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shop<span class="token punctuation">.</span><span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token string">"Cappuccino"</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shop<span class="token punctuation">.</span><span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token string">"Frappe"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shop<span class="token punctuation">.</span><span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token string">"Espresso"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shop<span class="token punctuation">.</span><span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token string">"Cappuccino"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shop<span class="token punctuation">.</span><span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token string">"Espresso"</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shop<span class="token punctuation">.</span><span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token string">"Frappe"</span><span class="token punctuation">,</span> <span class="token number">552</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shop<span class="token punctuation">.</span><span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token string">"Cappuccino"</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shop<span class="token punctuation">.</span><span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token string">"Espresso"</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shop<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"CoffeeFlavor objects in cache: "</span> <span class="token operator">+</span> CoffeeFlavour<span class="token punctuation">.</span><span class="token function">flavoursInCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šServing Cappuccino to table <span class="token number">2</span>Serving Frappe to table <span class="token number">1</span>Serving Espresso to table <span class="token number">1</span>Serving Frappe to table <span class="token number">897</span>Serving Cappuccino to table <span class="token number">97</span>Serving Frappe to table <span class="token number">3</span>Serving Espresso to table <span class="token number">3</span>Serving Cappuccino to table <span class="token number">3</span>Serving Espresso to table <span class="token number">96</span>Serving Frappe to table <span class="token number">552</span>Serving Cappuccino to table <span class="token number">121</span>Serving Espresso to table <span class="token number">121</span>CoffeeFlavor objects in cache<span class="token operator">:</span> <span class="token number">3</span></code></pre><p>äº«å…ƒæ¨¡å¼æ€»ç»“</p><p>äº«å…ƒæ¨¡å¼çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ï¼šç›¸åŒå¯¹è±¡åªè¦ä¿å­˜ä¸€ä»½ï¼Œè¿™é™ä½äº†ç³»ç»Ÿä¸­å¯¹è±¡çš„æ•°é‡ï¼Œä»è€Œé™ä½äº†ç³»ç»Ÿä¸­ç»†ç²’åº¦å¯¹è±¡ç»™å†…å­˜å¸¦æ¥çš„å‹åŠ›ã€‚</p><p>å…¶ä¸»è¦ç¼ºç‚¹æ˜¯ï¼š</p><ul><li><p>ä¸ºäº†ä½¿å¯¹è±¡å¯ä»¥å…±äº«ï¼Œéœ€è¦å°†ä¸€äº›ä¸èƒ½å…±äº«çš„çŠ¶æ€å¤–éƒ¨åŒ–ï¼Œè¿™å°†å¢åŠ ç¨‹åºçš„å¤æ‚æ€§ã€‚</p></li><li><p>è¯»å–äº«å…ƒæ¨¡å¼çš„å¤–éƒ¨çŠ¶æ€ä¼šä½¿å¾—è¿è¡Œæ—¶é—´ç¨å¾®å˜é•¿ã€‚</p></li></ul><p>ä»¥ä¸‹å‡ ç§æƒ…å½¢é€‚åˆé‡‡ç”¨äº«å…ƒæ¨¡å¼ï¼š</p><ul><li><p>ç³»ç»Ÿä¸­å­˜åœ¨å¤§é‡ç›¸åŒæˆ–ç›¸ä¼¼çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡è€—è´¹å¤§é‡çš„å†…å­˜èµ„æºã€‚</p></li><li><p>å¤§éƒ¨åˆ†çš„å¯¹è±¡å¯ä»¥æŒ‰ç…§å†…éƒ¨çŠ¶æ€è¿›è¡Œåˆ†ç»„ï¼Œä¸”å¯å°†ä¸åŒéƒ¨åˆ†å¤–éƒ¨åŒ–ï¼Œè¿™æ ·æ¯ä¸€ä¸ªç»„åªéœ€ä¿å­˜ä¸€ä¸ªå†…éƒ¨çŠ¶æ€ã€‚</p></li><li><p>ç”±äºäº«å…ƒæ¨¡å¼éœ€è¦é¢å¤–ç»´æŠ¤ä¸€ä¸ªä¿å­˜äº«å…ƒçš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥åº”å½“åœ¨æœ‰è¶³å¤Ÿå¤šçš„äº«å…ƒå®ä¾‹æ—¶æ‰å€¼å¾—ä½¿ç”¨äº«å…ƒæ¨¡å¼ã€‚</p></li></ul><h4 id="6-ä»£ç†æ¨¡å¼"><a href="#6-ä»£ç†æ¨¡å¼" class="headerlink" title="6.ä»£ç†æ¨¡å¼"></a>6.ä»£ç†æ¨¡å¼</h4><p>åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå®¢æˆ·ä¸èƒ½æˆ–è€…ä¸æƒ³ç›´æ¥è®¿é—®å¦ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ—¶éœ€è¦æ‰¾ä¸€ä¸ªä¸­ä»‹å¸®å¿™å®ŒæˆæŸé¡¹ä»»åŠ¡ï¼Œè¿™ä¸ªä¸­ä»‹å°±æ˜¯ä»£ç†å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œè´­ä¹°ç«è½¦ç¥¨ä¸ä¸€å®šè¦å»ç«è½¦ç«™ä¹°ï¼Œå¯ä»¥é€šè¿‡ 12306 ç½‘ç«™æˆ–è€…å»ç«è½¦ç¥¨ä»£å”®ç‚¹ä¹°ã€‚åˆå¦‚æ‰¾å¥³æœ‹å‹ã€æ‰¾ä¿å§†ã€æ‰¾å·¥ä½œç­‰éƒ½å¯ä»¥é€šè¿‡æ‰¾ä¸­ä»‹å®Œæˆã€‚</p><p><strong>ä»£ç†æ¨¡å¼ï¼ˆProxyPatternï¼‰</strong>çš„å®šä¹‰ï¼šä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚</p><p>ä»£ç†æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ï¼š</p><ol><li><strong>æŠ½è±¡ä¸»é¢˜ï¼ˆSubjectï¼‰ç±»</strong>ï¼šé€šè¿‡æ¥å£æˆ–æŠ½è±¡ç±»å£°æ˜çœŸå®ä¸»é¢˜å’Œä»£ç†å¯¹è±¡å®ç°çš„ä¸šåŠ¡æ–¹æ³•ã€‚</li><li><strong>çœŸå®ä¸»é¢˜ï¼ˆReal Subjectï¼‰ç±»</strong>ï¼šå®ç°äº†æŠ½è±¡ä¸»é¢˜ä¸­çš„å…·ä½“ä¸šåŠ¡ï¼Œæ˜¯ä»£ç†å¯¹è±¡æ‰€ä»£è¡¨çš„çœŸå®å¯¹è±¡ï¼Œæ˜¯æœ€ç»ˆè¦å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li><strong>ä»£ç†ï¼ˆProxyï¼‰ç±»</strong>ï¼šæä¾›äº†ä¸çœŸå®ä¸»é¢˜ç›¸åŒçš„æ¥å£ï¼Œå…¶å†…éƒ¨å«æœ‰å¯¹çœŸå®ä¸»é¢˜çš„å¼•ç”¨ï¼Œå®ƒå¯ä»¥è®¿é—®ã€æ§åˆ¶æˆ–æ‰©å±•çœŸå®ä¸»é¢˜çš„åŠŸèƒ½ã€‚</li></ol><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/ProxyPattern.png" alt></p><p>ç¤ºä¾‹1</p><p>æŠ½è±¡ä¸»é¢˜</p><pre class=" language-java"><code class="language-java"><span class="token keyword">interface</span> <span class="token class-name">Subject</span><span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>çœŸå®ä¸»é¢˜</p><pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">RealSubject</span> <span class="token keyword">implements</span> <span class="token class-name">Subject</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è®¿é—®çœŸå®ä¸»é¢˜æ–¹æ³•..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ä»£ç†</p><pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Proxy</span> <span class="token keyword">implements</span> <span class="token class-name">Subject</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> RealSubject realSubject<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>realSubject<span class="token operator">==</span>null<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            realSubject<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">RealSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token function">preRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        realSubject<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">postRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">preRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è®¿é—®çœŸå®ä¸»é¢˜ä¹‹å‰çš„é¢„å¤„ç†ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è®¿é—®çœŸå®ä¸»é¢˜ä¹‹åçš„åç»­å¤„ç†ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        Proxy proxy<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        proxy<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æ„ï¼šè®¿é—®çœŸå®ä¸»é¢˜ä¹‹å‰çš„é¢„å¤„ç†ã€‚è®¿é—®çœŸå®ä¸»é¢˜æ–¹æ³•<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>è®¿é—®çœŸå®ä¸»é¢˜ä¹‹åçš„åç»­å¤„ç†ã€‚</code></pre><p>ç¤ºä¾‹2</p><p>æŠ½è±¡ä¸»é¢˜è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// æ¼”å‘˜</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Performer</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * è¡¨æ¼”     */</span>    <span class="token keyword">void</span> <span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>çœŸå®ä¸»é¢˜</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// æ˜æ˜Ÿ</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SuperStar</span> <span class="token keyword">implements</span> <span class="token class-name">Performer</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¤§æ˜æ˜Ÿè¡¨æ¼”"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ä»£ç†è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// ç»æµäºº</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Agent</span> <span class="token keyword">implements</span> <span class="token class-name">Performer</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> SuperStar star<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Agent</span><span class="token punctuation">(</span>SuperStar star<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>star <span class="token operator">=</span> star<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç»æµäººæ¥æ”¶åˆ°æ¼”å‡ºé‚€è¯·"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç»æµäººå‘æ˜æ˜Ÿç¡®è®¤æ˜¯å¦æ¥å—é‚€è¯·"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        star<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SuperStar star <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SuperStar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Agent agent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Agent</span><span class="token punctuation">(</span>star<span class="token punctuation">)</span><span class="token punctuation">;</span>        agent<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šç»æµäººæ¥æ”¶åˆ°æ¼”å‡ºé‚€è¯·ç»æµäººå‘æ˜æ˜Ÿç¡®è®¤æ˜¯å¦æ¥å—é‚€è¯·å¤§æ˜æ˜Ÿè¡¨æ¼”</code></pre><p>ä»£ç†æ¨¡å¼ä¸€èˆ¬æ˜¯åœ¨ä¸æ”¹å˜åŸæœ‰æœåŠ¡å®ç°ä»£ç çš„åŸºç¡€ä¸Šæ·»åŠ ä¸€äº›é¢å¤–æ“ä½œçš„ä¸€ç§å¿«é€Ÿè§£å†³æ–¹æ¡ˆã€‚ä»£ç†åœ¨Javaä¸­åˆ†ä¸º<strong>é™æ€ä»£ç†</strong>å’Œ<strong>åŠ¨æ€ä»£ç†</strong>ã€‚</p><p><strong>é™æ€ä»£ç†</strong>å°±æ˜¯ä½¿ç”¨â€œä»£ç†æ¨¡å¼â€æ¥å®ç°çš„è§£å†³æ–¹æ³•ã€‚ç”Ÿæˆä¸€ä¸ªå’Œç±»ç›¸åŒæ¥å£çš„ä»£ç†ç±»ï¼Œç”¨æˆ·é€šè¿‡ä½¿ç”¨ä»£ç†ç±»æ¥å°è£…æŸä¸ªå®ç°ç±»ã€‚å…¶ç›®çš„æ˜¯åŠ å¼ºå®ç°ç±»çš„æŸä¸ªæ–¹æ³•çš„åŠŸèƒ½ï¼Œè€Œä¸å¿…æ”¹å˜åŸæœ‰çš„æºä»£ç ã€‚</p><p>ä¸€èˆ¬è€Œè¨€ï¼Œ<strong>åŠ¨æ€ä»£ç†</strong>åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯JDKåå°„æœºåˆ¶æä¾›çš„ä»£ç†ï¼Œå¦ä¸€ç§æ˜¯CGLIBä»£ç†ã€‚åœ¨JDKæä¾›çš„ä»£ç†ï¼Œè¢«ä»£ç†å¯¹è±¡å¿…é¡»æ˜¯æ¥å£ï¼Œè€ŒCGLIBçš„è¢«ä»£ç†å¯¹è±¡ä¸éœ€è¦æ˜¯æ¥å£ã€‚</p><p><strong>JDKåŠ¨æ€ä»£ç†</strong>å’Œæ™®é€šçš„ä»£ç†æ¨¡å¼çš„åŒºåˆ«åœ¨äºåŠ¨æ€ä»£ç†ä¸­çš„ä»£ç†ç±»æ˜¯ç”±java.lang.reflect.Proxyç±»åœ¨è¿è¡Œæ—¶æ ¹æ®æ¥å£å®šä¹‰ï¼Œé‡‡ç”¨Javaåå°„åŠŸèƒ½åŠ¨æ€ç”Ÿæˆçš„ï¼Œå’Œjava.lang.reflect.InvocationHandlerç»“åˆï¼Œå¯ä»¥åŠ å¼ºç°æœ‰ç±»çš„æ–¹æ³•å®ç°ã€‚è‡ªå®šä¹‰Handleréœ€è¦å®ç°invokeæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥ä½¿ç”¨Javaåå°„è°ƒç”¨å®ç°ç±»çš„å®ç°æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å®ç°å…¶ä»–åŠŸèƒ½ï¼Œä¾‹å¦‚åœ¨è°ƒç”¨å®ç°ç±»æ–¹æ³•å‰ååŠ å…¥Logç­‰ä¸šåŠ¡ã€‚Proxyç±»æ ¹æ®Handlerå’Œéœ€è¦ä»£ç†çš„æ¥å£åŠ¨æ€ç”Ÿæˆä¸€ä¸ªæ¥å£å®ç°ç±»çš„å¯¹è±¡ã€‚å½“ç”¨æˆ·è°ƒç”¨è¿™ä¸ªåŠ¨æ€ç”Ÿæˆçš„å®ç°ç±»æ—¶ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨äº†è‡ªå®šä¹‰Handlerçš„invokeæ–¹æ³•ã€‚</p><p>JDKåŠ¨æ€ä»£ç†çš„å®ç°æ­¥éª¤ï¼š</p><ul><li><p>ç¼–å†™æœåŠ¡ç±»å’Œæ¥å£ï¼Œè¿™ä¸ªæ˜¯çœŸæ­£çš„æœåŠ¡æä¾›è€…ï¼Œåœ¨JDKåŠ¨æ€ä»£ç†ä¸­æ¥å£æ˜¯å¿…é¡»çš„ï¼›</p></li><li><p>ç¼–å†™ä»£ç†ç±»ï¼Œæä¾›ç»‘å®šå’Œä»£ç†æ–¹æ³•ï¼›</p></li></ul><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// æœåŠ¡æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IMath</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span> <span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span> <span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">mut</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span> <span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">div</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span> <span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// å®ç°ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Math</span> <span class="token keyword">implements</span> <span class="token class-name">IMath</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span> <span class="token keyword">int</span> n2<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n1 <span class="token operator">+</span> <span class="token string">" + "</span> <span class="token operator">+</span> n2 <span class="token operator">+</span> <span class="token string">" = "</span>  <span class="token operator">+</span> <span class="token punctuation">(</span>n1 <span class="token operator">+</span> n2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> n1 <span class="token operator">+</span> n2<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span> <span class="token keyword">int</span> n2<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n1 <span class="token operator">+</span> <span class="token string">" - "</span> <span class="token operator">+</span> n2 <span class="token operator">+</span> <span class="token string">" = "</span>  <span class="token operator">+</span> <span class="token punctuation">(</span>n1 <span class="token operator">-</span> n2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> n1 <span class="token operator">-</span> n2<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">mut</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span> <span class="token keyword">int</span> n2<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n1 <span class="token operator">+</span> <span class="token string">" * "</span> <span class="token operator">+</span> n2 <span class="token operator">+</span> <span class="token string">" = "</span>  <span class="token operator">+</span> <span class="token punctuation">(</span>n1 <span class="token operator">*</span> n2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> n1 <span class="token operator">*</span> n2<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">div</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span> <span class="token keyword">int</span> n2<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n1 <span class="token operator">+</span> <span class="token string">" / "</span> <span class="token operator">+</span> n2 <span class="token operator">+</span> <span class="token string">" = "</span>  <span class="token operator">+</span> <span class="token punctuation">(</span>n1 <span class="token operator">/</span> n2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> n1 <span class="token operator">/</span> n2<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// ä»£ç†ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicProxy</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// çœŸå®æœåŠ¡å¯¹è±¡</span>    <span class="token keyword">private</span> Object targetObj<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// ç»‘å®šå§”æ‰˜å¯¹è±¡å¹¶è¿”å›ä¸€ä¸ªä»£ç†ç±»</span>    <span class="token keyword">public</span> Object <span class="token function">getProxyObject</span><span class="token punctuation">(</span>Object target<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>targetObj <span class="token operator">=</span> target<span class="token punctuation">;</span>        Class <span class="token class-name">clazz</span> <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Object proxy <span class="token operator">=</span> Proxy<span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>clazz<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>clazz<span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> proxy<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•æ—¶é¦–å…ˆè¿›å…¥è¿™ä¸ªæ–¹æ³•     * @param proxy ä»£ç†å¯¹è±¡     * @param method è¢«è°ƒç”¨æ–¹æ³•     * @param args æ–¹æ³•å‚æ•°     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Object <span class="token function">invoke</span><span class="token punctuation">(</span>Object proxy<span class="token punctuation">,</span> Method method<span class="token punctuation">,</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// åå°„æ–¹æ³•å‰è°ƒç”¨</span>        <span class="token keyword">long</span> start <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// æ‰§è¡Œæ–¹æ³•ï¼Œç›¸å½“ä¸è°ƒç”¨Mathç±»ä¸­çš„add/sub/mut/divæ–¹æ³•</span>        Object result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>targetObj<span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// åå°„æ–¹æ³•åè°ƒç”¨</span>        <span class="token keyword">long</span> end <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…±ç”¨æ—¶ï¼š"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// æµ‹è¯•</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        IMath math <span class="token operator">=</span> <span class="token punctuation">(</span>IMath<span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name">DynamicProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProxyObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Math</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>        math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>        math<span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>        math<span class="token punctuation">.</span><span class="token function">mut</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>        math<span class="token punctuation">.</span><span class="token function">div</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼š<span class="token number">100</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">102</span>å…±ç”¨æ—¶ï¼š<span class="token number">472</span><span class="token number">100</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">98</span>å…±ç”¨æ—¶ï¼š<span class="token number">181</span><span class="token number">100</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">200</span>å…±ç”¨æ—¶ï¼š<span class="token number">180</span><span class="token number">100</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">50</span>å…±ç”¨æ—¶ï¼š<span class="token number">366</span></code></pre><p><strong>CGLIBåŠ¨æ€ä»£ç†</strong>ï¼šJDKæä¾›çš„åŠ¨æ€ä»£ç†å­˜åœ¨ä¸€ä¸ªç¼ºé™·ï¼Œå°±æ˜¯ä½ å¿…é¡»æä¾›æ¥å£æ‰å¯ä»¥ä½¿ç”¨ï¼Œä¸ºäº†å…‹æœè¿™ä¸ªç¼ºé™·ï¼Œå¯ä»¥ä½¿ç”¨å¼€æºæ¡†æ¶-CGLIBï¼Œå®ƒæ˜¯ä¸€ç§æµè¡Œçš„åŠ¨æ€ä»£ç†ã€‚</p><p>å¦‚ä½•ä½¿ç”¨CGLIBåŠ¨æ€ä»£ç†ï¼Œå¾ˆç®€å•ï¼Œåœ¨æˆ‘ä»¬åˆ›å»ºä»£ç†ç±»æ—¶å®ç°net.sf.cglib.proxy.MethodInterceptoræ¥å£å°±è¡Œäº†, IMathæ¥å£å’ŒMathç±»éƒ½ä¸éœ€è¦æ”¹å˜ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// GLIB,åŠ¨æ€ä»£ç†ç±»,å®ç°ä¸€ä¸ªæ–¹æ³•æ‹¦æˆªå™¨æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicProxy</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//è¢«ä»£ç†å¯¹è±¡</span>    <span class="token keyword">private</span> Object targetObj<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//åŠ¨æ€ç”Ÿæˆä¸€ä¸ªæ–°ç±»</span>    <span class="token keyword">public</span> Object <span class="token function">getProxyObject</span><span class="token punctuation">(</span>Object object<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>targetObj <span class="token operator">=</span> object<span class="token punctuation">;</span>        Enhancer enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>targetObj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Object <span class="token function">intercept</span><span class="token punctuation">(</span>Object object<span class="token punctuation">,</span> Method method<span class="token punctuation">,</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> MethodProxy methodProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>        <span class="token keyword">long</span> start <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//Object result = methodProxy.invokeSuper(object, args);</span>        Object result <span class="token operator">=</span> methodProxy<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>targetObj<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å’Œä¸Šä¸€è¡Œä»£ç ç­‰ä»·</span>        <span class="token keyword">long</span> end <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…±ç”¨æ—¶ï¼š"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// æµ‹è¯•</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Math math <span class="token operator">=</span> <span class="token punctuation">(</span>Math<span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name">DynamicProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProxyObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Math</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>        math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>        math<span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>        math<span class="token punctuation">.</span><span class="token function">mut</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>        math<span class="token punctuation">.</span><span class="token function">div</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ä»£ç†æ¨¡å¼æ€»ç»“</p><p>ä»£ç†æ¨¡å¼çš„ä¸»è¦ä¼˜ç‚¹æœ‰ï¼š</p><ul><li>ä»£ç†æ¨¡å¼åœ¨å®¢æˆ·ç«¯ä¸ç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸€ä¸ªä¸­ä»‹ä½œç”¨å’Œä¿æŠ¤ç›®æ ‡å¯¹è±¡çš„ä½œç”¨ï¼›</li><li>ä»£ç†å¯¹è±¡å¯ä»¥æ‰©å±•ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ï¼›</li><li>ä»£ç†æ¨¡å¼èƒ½å°†å®¢æˆ·ç«¯ä¸ç›®æ ‡å¯¹è±¡åˆ†ç¦»ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†ç³»ç»Ÿçš„è€¦åˆåº¦ï¼›</li></ul><p>å…¶ä¸»è¦ç¼ºç‚¹æ˜¯ï¼š</p><ul><li>åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´å¢åŠ ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œä¼šé€ æˆè¯·æ±‚å¤„ç†é€Ÿåº¦å˜æ…¢ï¼›</li><li>å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼›</li></ul><p>ä»£ç†æ¨¡å¼ä¸€èˆ¬é€‚ç”¨äºä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li><p>å½“éœ€è¦ä¸ºä¸€ä¸ªå¯¹è±¡åœ¨ä¸åŒçš„åœ°å€ç©ºé—´æä¾›å±€éƒ¨çš„ä»£è¡¨æ—¶ï¼›</p></li><li><p>å½“éœ€è¦åˆ›å»ºå¼€é”€éå¸¸å¤§çš„å¯¹è±¡æ—¶ï¼›</p></li><li><p>å½“éœ€è¦æ§åˆ¶å¯¹åŸå§‹å¯¹è±¡çš„è®¿é—®æ—¶ï¼›</p></li><li><p>å½“éœ€è¦åœ¨è®¿é—®å¯¹è±¡æ—¶æ‰§è¡Œä¸€äº›é™„åŠ æ“ä½œæ—¶ï¼Œæ¯”å¦‚å¯é€šè¿‡ä»£ç†å¯¹è±¡è®¡ç®—è®¿é—®å®é™…å¯¹è±¡çš„æ¬¡æ•°ã€‚</p></li></ul><h4 id="7-å¤–è§‚æ¨¡å¼"><a href="#7-å¤–è§‚æ¨¡å¼" class="headerlink" title="7.å¤–è§‚æ¨¡å¼"></a>7.å¤–è§‚æ¨¡å¼</h4><p>åœ¨ç°å®çš„é¡¹ç›®ä¸­ï¼Œæ€»ä¼šæœ‰ä¸€äº›é—ç•™çš„éš¾æ˜“ç»´æŠ¤çš„å¤§å‹é¡¹ç›®å­˜åœ¨ï¼Œä½†æ˜¯è¿™äº›å­˜åœ¨çš„ç³»ç»Ÿå´èƒ½åœ¨æŸäº›åœºåˆå‘æŒ¥é‡è¦ä½œç”¨ï¼Œæ‰€ä»¥åœ¨åç»­çš„å¼€å‘äººå‘˜ä¸å¸Œæœ›è¿™ç§ç³»ç»Ÿè¢«åºŸå¼ƒæ‰ï¼Œä¸€äº›æ–°çš„å¼€å‘éœ€æ±‚å°±ä¼šä¾èµ–äºè¿™äº›éš¾ä»¥ç»´æŠ¤çš„ç³»ç»Ÿï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨æœ¬å¤–è§‚æ¨¡å¼å°†ä¼šæå¥½åœ°è§£å†³å„ç§å„æ ·çš„å¯èƒ½ä¼šå‘ç”Ÿçš„é—®é¢˜ã€‚</p><p><strong>å¤–è§‚ï¼ˆFacadeï¼‰æ¨¡å¼çš„å®šä¹‰</strong>ï¼šä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªä¸€è‡´çš„ç•Œé¢ï¼Œæ­¤æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä½¿å¾—è¿™ä¸€ä¸ªå­ç³»ç»Ÿæ›´åŠ å®¹æ˜“ä½¿ç”¨ã€‚è¯¥æ¨¡å¼å¯¹å¤–æœ‰ä¸€ä¸ªç»Ÿä¸€æ¥å£ï¼Œå¤–éƒ¨åº”ç”¨ç¨‹åºä¸ç”¨å…³å¿ƒå†…éƒ¨å­ç³»ç»Ÿçš„å…·ä½“çš„ç»†èŠ‚ï¼Œè¿™æ ·ä¼šå¤§å¤§é™ä½åº”ç”¨ç¨‹åºçš„å¤æ‚åº¦ï¼Œæé«˜äº†ç¨‹åºçš„å¯ç»´æŠ¤æ€§ã€‚</p><p>å¤–è§‚ï¼ˆFacadeï¼‰æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š</p><ol><li><strong>å¤–è§‚ï¼ˆFacadeï¼‰è§’è‰²</strong>ï¼šä¸ºå¤šä¸ªå­ç³»ç»Ÿå¯¹å¤–æä¾›ä¸€ä¸ªå…±åŒçš„æ¥å£ï¼›</li><li><strong>å­ç³»ç»Ÿï¼ˆSubSystemï¼‰è§’è‰²</strong>ï¼šå®ç°ç³»ç»Ÿçš„éƒ¨åˆ†åŠŸèƒ½ï¼Œå®¢æˆ·å¯ä»¥é€šè¿‡å¤–è§‚è§’è‰²è®¿é—®å®ƒï¼›</li><li><strong>å®¢æˆ·ï¼ˆClientï¼‰è§’è‰²</strong>ï¼šé€šè¿‡ä¸€ä¸ªå¤–è§‚è§’è‰²è®¿é—®å„ä¸ªå­ç³»ç»Ÿçš„åŠŸèƒ½ï¼›</li></ol><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/FacadePattern.png" alt></p><p>ç¤ºä¾‹1</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FacadeDemo</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// Clientè§’è‰²</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ServiceFacade serviceFacade <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServiceFacade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        serviceFacade<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// SubSystemè§’è‰²</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ServiceA</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"save"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// SubSystemè§’è‰²</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ServiceB</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"delete"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// Facadeè§’è‰²</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ServiceFacade</span><span class="token punctuation">{</span>        <span class="token keyword">private</span> ServiceA serviceA<span class="token punctuation">;</span>        <span class="token keyword">private</span> ServiceB serviceB<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token function">ServiceFacade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            serviceA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServiceA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            serviceB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServiceB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            serviceB<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            serviceA<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šdeletesave</code></pre><p>ç¤ºä¾‹2</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FacadeDemo2</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// Clientè§’è‰²</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Facade facade <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Facade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        facade<span class="token punctuation">.</span><span class="token function">operation1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        facade<span class="token punctuation">.</span><span class="token function">operation2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// SubSystemè§’è‰²</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SubSystemA</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> String <span class="token function">operationA1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token string">"Subsystem A, Method A1\n"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> String <span class="token function">operationA2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token string">"Subsystem A, Method A2\n"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// SubSystemè§’è‰²</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SubSystemB</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> String <span class="token function">operationB1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token string">"Subsystem B, Method B1\n"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> String <span class="token function">operationB2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token string">"Subsystem B, Method B2\n"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// SubSystemè§’è‰²</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SubSystemC</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> String <span class="token function">operationC1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token string">"Subsystem C, Method C1\n"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> String <span class="token function">operationC2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token string">"Subsystem C, Method C2\n"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// Facadeè§’è‰²</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Facade</span><span class="token punctuation">{</span>        <span class="token keyword">private</span> SubSystemA a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubSystemA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> SubSystemB b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubSystemB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> SubSystemC c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubSystemC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operation1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"operation 1\n"</span> <span class="token operator">+</span>                    a<span class="token punctuation">.</span><span class="token function">operationA1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>                    b<span class="token punctuation">.</span><span class="token function">operationB1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>                    c<span class="token punctuation">.</span><span class="token function">operationC1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operation2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"operation 2\n"</span> <span class="token operator">+</span>                    a<span class="token punctuation">.</span><span class="token function">operationA2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>                    b<span class="token punctuation">.</span><span class="token function">operationB2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>                    c<span class="token punctuation">.</span><span class="token function">operationC2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šoperation <span class="token number">1</span>Subsystem A<span class="token punctuation">,</span> Method A1Subsystem B<span class="token punctuation">,</span> Method B1Subsystem C<span class="token punctuation">,</span> Method C1operation <span class="token number">2</span>Subsystem A<span class="token punctuation">,</span> Method A2Subsystem B<span class="token punctuation">,</span> Method B2Subsystem C<span class="token punctuation">,</span> Method C2</code></pre><p>ç¤ºä¾‹3</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FacadeDemo3</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// Clientè§’è‰²</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ComputerFacade computer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComputerFacade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        computer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// SubSystemè§’è‰²</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CPU</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"CPU: freeze"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jump</span><span class="token punctuation">(</span><span class="token keyword">long</span> position<span class="token punctuation">)</span><span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"CPU: jump location "</span><span class="token operator">+</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"CPU: execute"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// SubSystemè§’è‰²</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">HardDirve</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">long</span> lba<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// SubSystemè§’è‰²</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Memory</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">long</span> position<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// Facadeè§’è‰²</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ComputerFacade</span><span class="token punctuation">{</span>        <span class="token keyword">private</span> CPU processor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CPU</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> Memory ram <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Memory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> HardDirve hd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HardDirve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> BOOT_ADDRESS <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> BOOT_SECTOR <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> SECTOR_SIZE <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            processor<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ram<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>BOOT_ADDRESS<span class="token punctuation">,</span>hd<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>BOOT_SECTOR<span class="token punctuation">,</span>SECTOR_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            processor<span class="token punctuation">.</span><span class="token function">jump</span><span class="token punctuation">(</span>BOOT_ADDRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>            processor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šCPU<span class="token operator">:</span> freezeCPU<span class="token operator">:</span> jump location <span class="token number">1</span>CPU<span class="token operator">:</span> execute</code></pre><p>å¤–è§‚æ¨¡å¼æ€»ç»“ï¼š</p><p>å¤–è§‚ï¼ˆFacadeï¼‰æ¨¡å¼æ˜¯â€œè¿ªç±³ç‰¹æ³•åˆ™â€çš„å…¸å‹åº”ç”¨ï¼Œå®ƒæœ‰ä»¥ä¸‹ä¸»è¦ä¼˜ç‚¹ï¼š</p><ul><li><p>é™ä½äº†å­ç³»ç»Ÿä¸å®¢æˆ·ç«¯ä¹‹é—´çš„è€¦åˆåº¦ï¼Œä½¿å¾—å­ç³»ç»Ÿçš„å˜åŒ–ä¸ä¼šå½±å“è°ƒç”¨å®ƒçš„å®¢æˆ·ç±»ã€‚</p></li><li><p>å¯¹å®¢æˆ·å±è”½äº†å­ç³»ç»Ÿç»„ä»¶ï¼Œå‡å°‘äº†å®¢æˆ·å¤„ç†çš„å¯¹è±¡æ•°ç›®ï¼Œå¹¶ä½¿å¾—å­ç³»ç»Ÿä½¿ç”¨èµ·æ¥æ›´åŠ å®¹æ˜“ã€‚</p></li><li><p>é™ä½äº†å¤§å‹è½¯ä»¶ç³»ç»Ÿä¸­çš„ç¼–è¯‘ä¾èµ–æ€§ï¼Œç®€åŒ–äº†ç³»ç»Ÿåœ¨ä¸åŒå¹³å°ä¹‹é—´çš„ç§»æ¤è¿‡ç¨‹ï¼Œå› ä¸ºç¼–è¯‘ä¸€ä¸ªå­ç³»ç»Ÿä¸ä¼šå½±å“å…¶ä»–çš„å­ç³»ç»Ÿï¼Œä¹Ÿä¸ä¼šå½±å“å¤–è§‚å¯¹è±¡ã€‚</p></li></ul><p>å¤–è§‚ï¼ˆFacadeï¼‰æ¨¡å¼çš„ä¸»è¦ç¼ºç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>ä¸èƒ½å¾ˆå¥½åœ°é™åˆ¶å®¢æˆ·ä½¿ç”¨å­ç³»ç»Ÿç±»ã€‚</p></li><li><p>å¢åŠ æ–°çš„å­ç³»ç»Ÿå¯èƒ½éœ€è¦ä¿®æ”¹å¤–è§‚ç±»æˆ–å®¢æˆ·ç«¯çš„æºä»£ç ï¼Œè¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€ã€‚</p></li></ul><h3 id="ä¸‰ã€è¡Œä¸ºæ¨¡å¼"><a href="#ä¸‰ã€è¡Œä¸ºæ¨¡å¼" class="headerlink" title="ä¸‰ã€è¡Œä¸ºæ¨¡å¼"></a>ä¸‰ã€è¡Œä¸ºæ¨¡å¼</h3><h4 id="1-æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#1-æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="1.æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>1.æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h4><p>åœ¨é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡è¿‡ç¨‹ä¸­ï¼Œç¨‹åºå‘˜å¸¸å¸¸ä¼šé‡åˆ°è¿™ç§æƒ…å†µï¼šè®¾è®¡ä¸€ä¸ªç³»ç»Ÿæ—¶çŸ¥é“äº†ç®—æ³•æ‰€éœ€çš„å…³é”®æ­¥éª¤ï¼Œè€Œä¸”ç¡®å®šäº†è¿™äº›æ­¥éª¤çš„æ‰§è¡Œé¡ºåºï¼Œä½†æŸäº›æ­¥éª¤çš„å…·ä½“å®ç°è¿˜æœªçŸ¥ï¼Œæˆ–è€…è¯´æŸäº›æ­¥éª¤çš„å®ç°ä¸å…·ä½“çš„ç¯å¢ƒç›¸å…³ã€‚</p><p>ä¾‹å¦‚ï¼Œå»é“¶è¡ŒåŠç†ä¸šåŠ¡ä¸€èˆ¬è¦ç»è¿‡ä»¥ä¸‹4ä¸ªæµç¨‹ï¼šå–å·ã€æ’é˜Ÿã€åŠç†å…·ä½“ä¸šåŠ¡ã€å¯¹é“¶è¡Œå·¥ä½œäººå‘˜è¿›è¡Œè¯„åˆ†ç­‰ï¼Œå…¶ä¸­å–å·ã€æ’é˜Ÿå’Œå¯¹é“¶è¡Œå·¥ä½œäººå‘˜è¿›è¡Œè¯„åˆ†çš„ä¸šåŠ¡å¯¹æ¯ä¸ªå®¢æˆ·æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥åœ¨çˆ¶ç±»ä¸­å®ç°ï¼Œä½†æ˜¯åŠç†å…·ä½“ä¸šåŠ¡å´å› äººè€Œå¼‚ï¼Œå®ƒå¯èƒ½æ˜¯å­˜æ¬¾ã€å–æ¬¾æˆ–è€…è½¬è´¦ç­‰ï¼Œå¯ä»¥å»¶è¿Ÿåˆ°å­ç±»ä¸­å®ç°ã€‚</p><p>è¿™æ ·çš„ä¾‹å­åœ¨ç”Ÿæ´»ä¸­è¿˜æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªäººæ¯å¤©ä¼šèµ·åºŠã€åƒé¥­ã€åšäº‹ã€ç¡è§‰ç­‰ï¼Œå…¶ä¸­â€œåšäº‹â€çš„å†…å®¹æ¯å¤©å¯èƒ½ä¸åŒã€‚æˆ‘ä»¬æŠŠè¿™äº›è§„å®šäº†æµç¨‹æˆ–æ ¼å¼çš„å®ä¾‹å®šä¹‰æˆæ¨¡æ¿ï¼Œå…è®¸ä½¿ç”¨è€…æ ¹æ®è‡ªå·±çš„éœ€æ±‚å»æ›´æ–°å®ƒï¼Œä¾‹å¦‚ï¼Œç®€å†æ¨¡æ¿ã€è®ºæ–‡æ¨¡æ¿ã€Word ä¸­æ¨¡æ¿æ–‡ä»¶ç­‰ã€‚</p><p><strong>æ¨¡æ¿æ–¹æ³•ï¼ˆTemplateMethodï¼‰æ¨¡å¼</strong>å®šä¹‰ï¼šå®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚å®ƒä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„å³å¯é‡æ–°å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚</p><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š</p><p><strong>(1) æŠ½è±¡ç±»ï¼ˆAbstractClassï¼‰</strong>ï¼šè´Ÿè´£ç»™å‡ºä¸€ä¸ªç®—æ³•çš„è½®å»“å’Œéª¨æ¶ã€‚å®ƒç”±ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•å’Œè‹¥å¹²ä¸ªåŸºæœ¬æ–¹æ³•æ„æˆã€‚è¿™äº›æ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><ul><li><p>æ¨¡æ¿æ–¹æ³•ï¼šå®šä¹‰äº†ç®—æ³•çš„éª¨æ¶ï¼ŒæŒ‰æŸç§é¡ºåºè°ƒç”¨å…¶åŒ…å«çš„åŸºæœ¬æ–¹æ³•ã€‚</p></li><li><p>åŸºæœ¬æ–¹æ³•ï¼šæ˜¯æ•´ä¸ªç®—æ³•ä¸­çš„ä¸€ä¸ªæ­¥éª¤ï¼ŒåŒ…å«ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p><ul><li>æŠ½è±¡æ–¹æ³•ï¼šåœ¨æŠ½è±¡ç±»ä¸­ç”³æ˜ï¼Œç”±å…·ä½“å­ç±»å®ç°ã€‚</li><li>å…·ä½“æ–¹æ³•ï¼šåœ¨æŠ½è±¡ç±»ä¸­å·²ç»å®ç°ï¼Œåœ¨å…·ä½“å­ç±»ä¸­å¯ä»¥ç»§æ‰¿æˆ–é‡å†™å®ƒã€‚</li><li>é’©å­æ–¹æ³•ï¼šåœ¨æŠ½è±¡ç±»ä¸­å·²ç»å®ç°ï¼ŒåŒ…æ‹¬ç”¨äºåˆ¤æ–­çš„é€»è¾‘æ–¹æ³•å’Œéœ€è¦å­ç±»é‡å†™çš„ç©ºæ–¹æ³•ä¸¤ç§ã€‚</li></ul></li></ul><p><strong>(2) å…·ä½“å­ç±»ï¼ˆConcreteClassï¼‰</strong>ï¼šå®ç°æŠ½è±¡ç±»ä¸­æ‰€å®šä¹‰çš„æŠ½è±¡æ–¹æ³•å’Œé’©å­æ–¹æ³•ï¼Œå®ƒä»¬æ˜¯ä¸€ä¸ªé¡¶çº§é€»è¾‘çš„ä¸€ä¸ªç»„æˆæ­¥éª¤ã€‚</p><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/TemplateMethodPattern.png" alt></p><p>ç¤ºä¾‹1</p><p>æŠ½è±¡ç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//æŠ½è±¡ç±»</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractClass</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">TemplateMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//æ¨¡æ¿æ–¹æ³•</span>    <span class="token punctuation">{</span>        <span class="token function">SpecificMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">abstractMethod1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token function">abstractMethod2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">SpecificMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//å…·ä½“æ–¹æ³•</span>    <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æŠ½è±¡ç±»ä¸­çš„å…·ä½“æ–¹æ³•è¢«è°ƒç”¨..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>       <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">abstractMethod1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æŠ½è±¡æ–¹æ³•1</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">abstractMethod2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æŠ½è±¡æ–¹æ³•2</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“å­ç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//å…·ä½“å­ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteClass</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractClass</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">abstractMethod1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æŠ½è±¡æ–¹æ³•1çš„å®ç°è¢«è°ƒç”¨..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>       <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">abstractMethod2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æŠ½è±¡æ–¹æ³•2çš„å®ç°è¢«è°ƒç”¨..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        AbstractClass tm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        tm<span class="token punctuation">.</span><span class="token function">TemplateMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šæŠ½è±¡ç±»ä¸­çš„å…·ä½“æ–¹æ³•è¢«è°ƒç”¨<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>æŠ½è±¡æ–¹æ³•<span class="token number">1</span>çš„å®ç°è¢«è°ƒç”¨<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>æŠ½è±¡æ–¹æ³•<span class="token number">2</span>çš„å®ç°è¢«è°ƒç”¨<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>ç¤ºä¾‹2</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æŠ½è±¡ç±»ï¼šæ‰‹æœº */</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">MobilePhone</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * ä¸åŒçš„æ‰‹æœºå‚å•†å®‰è£…ä¸åŒçš„æ“ä½œç³»ç»Ÿ     * @return æ“ä½œç³»ç»Ÿåç§°     */</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> String <span class="token function">installOS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * å®‰è£…ç”µæ±      * @return ç”µæ± å®¹é‡     */</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">int</span> <span class="token function">installBattary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">powerOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¼€æœº..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æˆåŠŸå¼€æœº"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">calling</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰‹æœºå¼€å§‹é€šè¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">lowPowerChecking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰‹æœºç”µé‡è¿‡ä½ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">powerOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰‹æœºå¼€æœº"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * æ¨¡ç‰ˆæ–¹æ³•     */</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        String osName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">installOS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰‹æœºå®‰è£…äº†"</span> <span class="token operator">+</span> osName <span class="token operator">+</span> <span class="token string">"æ“ä½œç³»ç»Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> capacity <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">installBattary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰‹æœºå®‰è£…äº†"</span> <span class="token operator">+</span> capacity <span class="token operator">+</span> <span class="token string">"æ¯«å®‰ç”µæ± "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">powerOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">calling</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">lowPowerChecking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">powerOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“ç±»ï¼šåä¸ºè£è€€æ‰‹æœº */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HuaWeiHonor</span> <span class="token keyword">extends</span> <span class="token class-name">MobilePhone</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">HuaWeiHonor</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰‹æœºåç§° ["</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">installOS</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"Androidç³»ç»Ÿ"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">installBattary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token number">4000</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“ç±»ï¼šiphone x æ‰‹æœº */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IPhoneX</span> <span class="token keyword">extends</span> <span class="token class-name">MobilePhone</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">IPhoneX</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰‹æœºåç§° ["</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">installOS</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"IOSç³»ç»Ÿ"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">installBattary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token number">2000</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å®¢æˆ·ç«¯ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¯Œå£«åº·å·¥å‚å¼€å§‹ç”Ÿäº§æ‰‹æœºäº†ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        MobilePhone phone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IPhoneX</span><span class="token punctuation">(</span><span class="token string">"IPhoneX"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        phone<span class="token punctuation">.</span><span class="token function">installOS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        phone<span class="token punctuation">.</span><span class="token function">installBattary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        phone<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        phone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HuaWeiHonor</span><span class="token punctuation">(</span><span class="token string">"Honor10"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        phone<span class="token punctuation">.</span><span class="token function">installOS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        phone<span class="token punctuation">.</span><span class="token function">installBattary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        phone<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šå¯Œå£«åº·å·¥å‚å¼€å§‹ç”Ÿäº§æ‰‹æœºäº†ï¼šæ‰‹æœºåç§° <span class="token punctuation">[</span>IPhoneX<span class="token punctuation">]</span>æ‰‹æœºå®‰è£…äº†IOSç³»ç»Ÿæ“ä½œç³»ç»Ÿæ‰‹æœºå®‰è£…äº†<span class="token number">2000</span>æ¯«å®‰ç”µæ± å¼€æœº<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>æˆåŠŸå¼€æœºæ‰‹æœºå¼€å§‹é€šè¯æ‰‹æœºç”µé‡è¿‡ä½ï¼æ‰‹æœºå¼€æœº<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>æ‰‹æœºåç§° <span class="token punctuation">[</span>Honor10<span class="token punctuation">]</span>æ‰‹æœºå®‰è£…äº†Androidç³»ç»Ÿæ“ä½œç³»ç»Ÿæ‰‹æœºå®‰è£…äº†<span class="token number">4000</span>æ¯«å®‰ç”µæ± å¼€æœº<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>æˆåŠŸå¼€æœºæ‰‹æœºå¼€å§‹é€šè¯æ‰‹æœºç”µé‡è¿‡ä½ï¼æ‰‹æœºå¼€æœº</code></pre><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ€»ç»“</p><p>å¾ˆå¤šå¼€å‘äººå‘˜éƒ½å‘ç°å…¶å®è‡ªå·±åœ¨ä»¥å‰çš„ç¼–ç ä¸­å°±å·²ç»ä½¿ç”¨è¿‡æ¨¡æ¿æ–¹æ³•æ¨¡å¼äº†ã€‚ç¡®å®æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ¯”è¾ƒç®€å•å¹¶ä¸”å¾ˆå¸¸ç”¨ï¼Œç”šè‡³åœ¨Javaçš„ç±»åº“ä¸­éƒ½æœ‰ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ¥æå–å…¬å…±è¡Œä¸ºè‡³æŠ½è±¡ç±»ä¸­ã€‚</p><p>è¯¥æ¨¡å¼çš„ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>å®ƒå°è£…äº†ä¸å˜éƒ¨åˆ†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†ã€‚å®ƒæŠŠè®¤ä¸ºæ˜¯ä¸å˜éƒ¨åˆ†çš„ç®—æ³•å°è£…åˆ°çˆ¶ç±»ä¸­å®ç°ï¼Œè€ŒæŠŠå¯å˜éƒ¨åˆ†ç®—æ³•ç”±å­ç±»ç»§æ‰¿å®ç°ï¼Œä¾¿äºå­ç±»ç»§ç»­æ‰©å±•ã€‚</p></li><li><p>å®ƒåœ¨çˆ¶ç±»ä¸­æå–äº†å…¬å…±çš„éƒ¨åˆ†ä»£ç ï¼Œä¾¿äºä»£ç å¤ç”¨ã€‚</p></li><li><p>éƒ¨åˆ†æ–¹æ³•æ˜¯ç”±å­ç±»å®ç°çš„ï¼Œå› æ­¤å­ç±»å¯ä»¥é€šè¿‡æ‰©å±•æ–¹å¼å¢åŠ ç›¸åº”çš„åŠŸèƒ½ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚</p></li></ul><p>è¯¥æ¨¡å¼çš„ä¸»è¦ç¼ºç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>å¯¹æ¯ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦å®šä¹‰ä¸€ä¸ªå­ç±»ï¼Œè¿™ä¼šå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œç³»ç»Ÿæ›´åŠ åºå¤§ï¼Œè®¾è®¡ä¹Ÿæ›´åŠ æŠ½è±¡ã€‚</p></li><li><p>çˆ¶ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ç”±å­ç±»å®ç°ï¼Œå­ç±»æ‰§è¡Œçš„ç»“æœä¼šå½±å“çˆ¶ç±»çš„ç»“æœï¼Œè¿™å¯¼è‡´ä¸€ç§åå‘çš„æ§åˆ¶ç»“æ„ï¼Œå®ƒæé«˜äº†ä»£ç é˜…è¯»çš„éš¾åº¦ã€‚</p></li></ul><p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸‹é¢å‡ ç§æƒ…å†µå¯ä»¥è€ƒè™‘ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼š</p><ul><li>ä¸€æ¬¡æ€§åœ°å®ç°ä¸€ä¸ªç®—æ³•ä¸å˜çš„éƒ¨åˆ†ï¼Œè€Œå°†å¯å˜çš„è¡Œä¸ºç•™ç»™å­ç±»æ¥å®ç°ï¼›</li><li>å½“å­ç±»ä¸­æœ‰å…¬å…±çš„è¡Œä¸ºå¯ä»¥æå–åˆ°å…¬å…±çš„çˆ¶ç±»ä¸­å»ï¼Œå¹¶ä¸”å­ç±»æœ‰è‡ªå·±çš„â€œä¸ªæ€§åŒ–è¦æ±‚â€æ—¶ï¼›</li><li>å­ç±»éœ€è¦æ‰©å±•çš„åœ°æ–¹éƒ½æ˜¯å›ºå®šçš„ï¼Œå³ä»…å…è®¸åœ¨è¿™äº›ç‚¹è¿›è¡Œæ‰©å±•æ—¶ï¼›</li></ul><h4 id="2-ç­–ç•¥æ¨¡å¼"><a href="#2-ç­–ç•¥æ¨¡å¼" class="headerlink" title="2.ç­–ç•¥æ¨¡å¼"></a>2.ç­–ç•¥æ¨¡å¼</h4><p>åœ¨ç°å®ç”Ÿæ´»ä¸­å¸¸å¸¸é‡åˆ°å®ç°æŸç§ç›®æ ‡å­˜åœ¨å¤šç§ç­–ç•¥å¯ä¾›é€‰æ‹©çš„æƒ…å†µï¼Œä¾‹å¦‚ï¼Œå‡ºè¡Œæ—…æ¸¸å¯ä»¥ä¹˜åé£æœºã€ä¹˜åç«è½¦ã€éª‘è‡ªè¡Œè½¦æˆ–è‡ªå·±å¼€ç§å®¶è½¦ç­‰ï¼Œè¶…å¸‚ä¿ƒé”€å¯ä»¥é‡†ç”¨æ‰“æŠ˜ã€é€å•†å“ã€é€ç§¯åˆ†ç­‰æ–¹æ³•ã€‚</p><p>åœ¨è½¯ä»¶å¼€å‘ä¸­ä¹Ÿå¸¸å¸¸é‡åˆ°ç±»ä¼¼çš„æƒ…å†µï¼Œå½“å®ç°æŸä¸€ä¸ªåŠŸèƒ½å­˜åœ¨å¤šç§ç®—æ³•æˆ–è€…ç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ç¯å¢ƒæˆ–è€…æ¡ä»¶çš„ä¸åŒé€‰æ‹©ä¸åŒçš„ç®—æ³•æˆ–è€…ç­–ç•¥æ¥å®Œæˆè¯¥åŠŸèƒ½ï¼Œå¦‚æ•°æ®æ’åºç­–ç•¥æœ‰å†’æ³¡æ’åºã€é€‰æ‹©æ’åºã€æ’å…¥æ’åºã€äºŒå‰æ ‘æ’åºç­‰ã€‚</p><p>å¦‚æœä½¿ç”¨å¤šé‡æ¡ä»¶è½¬ç§»è¯­å¥å®ç°ï¼ˆå³ç¡¬ç¼–ç ï¼‰ï¼Œä¸ä½†ä½¿æ¡ä»¶è¯­å¥å˜å¾—å¾ˆå¤æ‚ï¼Œè€Œä¸”å¢åŠ ã€åˆ é™¤æˆ–æ›´æ¢ç®—æ³•è¦ä¿®æ”¹åŸä»£ç ï¼Œä¸æ˜“ç»´æŠ¤ï¼Œè¿èƒŒå¼€é—­åŸåˆ™ã€‚å¦‚æœé‡‡ç”¨ç­–ç•¥æ¨¡å¼å°±èƒ½å¾ˆå¥½è§£å†³è¯¥é—®é¢˜ã€‚</p><p><strong>ç­–ç•¥ï¼ˆStrategyï¼‰æ¨¡å¼</strong>çš„å®šä¹‰ï¼šç­–ç•¥æ¨¡å¼å®šä¹‰äº†ç®—æ³•å®¶æ—ï¼Œåˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©å®ƒä»¬ä¹‹é—´å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œæ­¤æ¨¡å¼è®©ç®—æ³•çš„å˜åŒ–ä¸ä¼šå½±å“åˆ°ä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚</p><p>ç­–ç•¥æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ï¼š</p><ol><li><strong>æŠ½è±¡ç­–ç•¥ï¼ˆStrategyï¼‰ç±»</strong>ï¼šå®šä¹‰äº†ä¸€ä¸ªå…¬å…±æ¥å£ï¼Œå„ç§ä¸åŒçš„ç®—æ³•ä»¥ä¸åŒçš„æ–¹å¼å®ç°è¿™ä¸ªæ¥å£ï¼Œç¯å¢ƒè§’è‰²ä½¿ç”¨è¿™ä¸ªæ¥å£è°ƒç”¨ä¸åŒçš„ç®—æ³•ï¼Œä¸€èˆ¬ä½¿ç”¨æ¥å£æˆ–æŠ½è±¡ç±»å®ç°ï¼›</li><li><strong>å…·ä½“ç­–ç•¥ï¼ˆConcreteStrategyï¼‰ç±»</strong>ï¼šå®ç°äº†æŠ½è±¡ç­–ç•¥å®šä¹‰çš„æ¥å£ï¼Œæä¾›å…·ä½“çš„ç®—æ³•å®ç°ï¼›</li><li><strong>ç¯å¢ƒï¼ˆContextï¼‰ç±»</strong>ï¼šæŒæœ‰ä¸€ä¸ªç­–ç•¥ç±»çš„å¼•ç”¨ï¼Œæœ€ç»ˆç»™å®¢æˆ·ç«¯è°ƒç”¨ï¼›</li></ol><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/StrategyPattern.png" alt></p><p>ç¤ºä¾‹</p><p>æŠ½è±¡ç­–ç•¥ç±»</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> integerface Strategy <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">strategyMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“ç­–ç•¥ç±»A</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//å…·ä½“ç­–ç•¥ç±»A</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteStrategyA</span> <span class="token keyword">implements</span> <span class="token class-name">Strategy</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">strategyMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…·ä½“ç­–ç•¥Açš„ç­–ç•¥æ–¹æ³•è¢«è®¿é—®ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“ç­–ç•¥ç±»B</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//å…·ä½“ç­–ç•¥ç±»B</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteStrategyB</span> <span class="token keyword">implements</span> <span class="token class-name">Strategy</span><span class="token punctuation">{</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">strategyMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…·ä½“ç­–ç•¥Bçš„ç­–ç•¥æ–¹æ³•è¢«è®¿é—®ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ç¯å¢ƒç±»ï¼ˆä¸Šä¸‹æ–‡ï¼‰</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//ç¯å¢ƒç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Context</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> Strategy strategy<span class="token punctuation">;</span>    <span class="token keyword">public</span> Strategy <span class="token function">getStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> strategy<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStrategy</span><span class="token punctuation">(</span>Strategy strategy<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>strategy<span class="token operator">=</span>strategy<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">strategyMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        strategy<span class="token punctuation">.</span><span class="token function">strategyMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        Context c<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Strategy s<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ConcreteStrategyA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        c<span class="token punctuation">.</span><span class="token function">setStrategy</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>        c<span class="token punctuation">.</span><span class="token function">strategyMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        s<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ConcreteStrategyB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        c<span class="token punctuation">.</span><span class="token function">setStrategy</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>        c<span class="token punctuation">.</span><span class="token function">strategyMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šå…·ä½“ç­–ç•¥Açš„ç­–ç•¥æ–¹æ³•è¢«è®¿é—®ï¼<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>å…·ä½“ç­–ç•¥Bçš„ç­–ç•¥æ–¹æ³•è¢«è®¿é—®ï¼</code></pre><p>ç¤ºä¾‹2</p><p>æŠ½è±¡ç­–ç•¥ç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//è®¡ç®—ç­–ç•¥ç±»</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CalculatorStrategy</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * è®¡ç®—æ¥å£     * @param a     * @param b     * @return     */</span>    <span class="token keyword">int</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“ç­–ç•¥ç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//åŠ æ³•</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddCalculator</span> <span class="token keyword">implements</span> <span class="token class-name">CalculatorStrategy</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//å‡æ³•</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SubstractCalculator</span> <span class="token keyword">implements</span> <span class="token class-name">CalculatorStrategy</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//ä¹˜æ³•</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MultiplyCalculator</span> <span class="token keyword">implements</span> <span class="token class-name">CalculatorStrategy</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//é™¤æ³•</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DivideCalculator</span> <span class="token keyword">implements</span> <span class="token class-name">CalculatorStrategy</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ç¯å¢ƒï¼ˆä¸Šä¸‹æ–‡ï¼‰</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Context</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> CalculatorStrategy strategy<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//æ„é€ æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token function">Context</span><span class="token punctuation">(</span>CalculatorStrategy strategy<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>strategy <span class="token operator">=</span> strategy<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//ä¸Šä¸‹æ–‡æ“ä½œ</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>strategy<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> CalculatorStrategy <span class="token function">getStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> strategy<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStrategy</span><span class="token punctuation">(</span>CalculatorStrategy strategy<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>strategy <span class="token operator">=</span> strategy<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>        Context context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span>CaculatorType<span class="token punctuation">.</span>ADD<span class="token punctuation">.</span><span class="token function">getStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> r <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"a + b = "</span> <span class="token operator">+</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>        context<span class="token punctuation">.</span><span class="token function">setStrategy</span><span class="token punctuation">(</span>CaculatorType<span class="token punctuation">.</span>SUBSTRACT<span class="token punctuation">.</span><span class="token function">getStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        r <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"a - b = "</span> <span class="token operator">+</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>        context<span class="token punctuation">.</span><span class="token function">setStrategy</span><span class="token punctuation">(</span>CaculatorType<span class="token punctuation">.</span>MULTIPLY<span class="token punctuation">.</span><span class="token function">getStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        r <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"a * b = "</span> <span class="token operator">+</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>        context<span class="token punctuation">.</span><span class="token function">setStrategy</span><span class="token punctuation">(</span>CaculatorType<span class="token punctuation">.</span>DIVIDE<span class="token punctuation">.</span><span class="token function">getStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        r <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"a / b = "</span> <span class="token operator">+</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼ša <span class="token operator">+</span> b <span class="token operator">=</span> <span class="token number">15</span>a <span class="token operator">-</span> b <span class="token operator">=</span> <span class="token number">5</span>a <span class="token operator">*</span> b <span class="token operator">=</span> <span class="token number">50</span>a <span class="token operator">/</span> b <span class="token operator">=</span> <span class="token number">2</span></code></pre><p>ç­–ç•¥æ¨¡å¼æ€»ç»“</p><p>ç­–ç•¥æ¨¡å¼çš„ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>å¤šé‡æ¡ä»¶è¯­å¥ä¸æ˜“ç»´æŠ¤ï¼Œè€Œä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶è¯­å¥ï¼›</p></li><li><p>ç­–ç•¥æ¨¡å¼æä¾›äº†ä¸€ç³»åˆ—çš„å¯ä¾›é‡ç”¨çš„ç®—æ³•æ—ï¼Œæ°å½“ä½¿ç”¨ç»§æ‰¿å¯ä»¥æŠŠç®—æ³•æ—çš„å…¬å…±ä»£ç è½¬ç§»åˆ°çˆ¶ç±»é‡Œé¢ï¼Œä»è€Œé¿å…é‡å¤çš„ä»£ç ï¼›</p></li><li><p>ç­–ç•¥æ¨¡å¼å¯ä»¥æä¾›ç›¸åŒè¡Œä¸ºçš„ä¸åŒå®ç°ï¼Œå®¢æˆ·å¯ä»¥æ ¹æ®ä¸åŒæ—¶é—´æˆ–ç©ºé—´è¦æ±‚é€‰æ‹©ä¸åŒçš„ï¼›</p></li><li><p>ç­–ç•¥æ¨¡å¼æä¾›äº†å¯¹å¼€é—­åŸåˆ™çš„å®Œç¾æ”¯æŒï¼Œå¯ä»¥åœ¨ä¸ä¿®æ”¹åŸä»£ç çš„æƒ…å†µä¸‹ï¼Œçµæ´»å¢åŠ æ–°ç®—æ³•ï¼›</p></li><li><p>ç­–ç•¥æ¨¡å¼æŠŠç®—æ³•çš„ä½¿ç”¨æ”¾åˆ°ç¯å¢ƒç±»ä¸­ï¼Œè€Œç®—æ³•çš„å®ç°ç§»åˆ°å…·ä½“ç­–ç•¥ç±»ä¸­ï¼Œå®ç°äº†äºŒè€…çš„åˆ†ç¦»ï¼›</p></li></ul><p>å…¶ä¸»è¦ç¼ºç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>å®¢æˆ·ç«¯å¿…é¡»ç†è§£æ‰€æœ‰ç­–ç•¥ç®—æ³•çš„åŒºåˆ«ï¼Œä»¥ä¾¿é€‚æ—¶é€‰æ‹©æ°å½“çš„ç®—æ³•ç±»ï¼›</p></li><li><p>ç­–ç•¥æ¨¡å¼é€ æˆå¾ˆå¤šçš„ç­–ç•¥ç±»ï¼›</p></li></ul><p>ç­–ç•¥æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li>å¾ˆå¤šç›¸å…³çš„ç±»åªæ˜¯åœ¨è¡Œä¸ºä¸Šæœ‰å·®å¼‚ï¼›</li><li>å½“éœ€è¦ä½¿ç”¨ä¸€ä¸ªç®—æ³•çš„ä¸åŒå˜ä½“æ—¶ï¼›</li><li>ä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ä¸åº”è¯¥çŸ¥é“ç®—æ³•çš„å…·ä½“ç»“æ„æ—¶ï¼›</li><li>å½“ä¸€ä¸ªç±»å®šä¹‰äº†å¤šç§è¡Œä¸ºå¹¶ä¸”è¿™äº›è¡Œä¸ºåœ¨è¿™ä¸ªç±»çš„æ“ä½œä¸­ä»¥å¤šä¸ªæ¡ä»¶è¯­å¥çš„å½¢å¼å‡ºç°æ—¶ï¼›</li></ul><h4 id="3-çŠ¶æ€æ¨¡å¼"><a href="#3-çŠ¶æ€æ¨¡å¼" class="headerlink" title="3.çŠ¶æ€æ¨¡å¼"></a>3.çŠ¶æ€æ¨¡å¼</h4><p>åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨ç¨‹åºä¸­çš„æœ‰äº›å¯¹è±¡å¯èƒ½ä¼šæ ¹æ®ä¸åŒçš„æƒ…å†µåšå‡ºä¸åŒçš„è¡Œä¸ºï¼Œæˆ‘ä»¬æŠŠè¿™ç§å¯¹è±¡ç§°ä¸º<strong>æœ‰çŠ¶æ€çš„å¯¹è±¡</strong>ï¼Œè€ŒæŠŠå½±å“å¯¹è±¡è¡Œä¸ºçš„ä¸€ä¸ªæˆ–å¤šä¸ªåŠ¨æ€å˜åŒ–çš„å±æ€§ç§°ä¸º<strong>çŠ¶æ€</strong>ã€‚å½“æœ‰çŠ¶æ€çš„å¯¹è±¡ä¸å¤–éƒ¨äº‹ä»¶äº§ç”Ÿäº’åŠ¨æ—¶ï¼Œå…¶å†…éƒ¨çŠ¶æ€ä¼šå‘ç”Ÿæ”¹å˜ï¼Œä»è€Œä½¿å¾—å…¶è¡Œä¸ºä¹Ÿéšä¹‹å‘ç”Ÿæ”¹å˜ã€‚å¦‚äººçš„æƒ…ç»ªæœ‰é«˜å…´çš„æ—¶å€™å’Œä¼¤å¿ƒçš„æ—¶å€™ï¼Œä¸åŒçš„æƒ…ç»ªæœ‰ä¸åŒçš„è¡Œä¸ºï¼Œå½“ç„¶å¤–ç•Œä¹Ÿä¼šå½±å“å…¶æƒ…ç»ªå˜åŒ–ã€‚</p><p>å¯¹è¿™ç§æœ‰çŠ¶æ€çš„å¯¹è±¡ç¼–ç¨‹ï¼Œä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šå°†è¿™äº›æ‰€æœ‰å¯èƒ½å‘ç”Ÿçš„æƒ…å†µå…¨éƒ½è€ƒè™‘åˆ°ï¼Œç„¶åä½¿ç”¨ if-else è¯­å¥æ¥åšçŠ¶æ€åˆ¤æ–­ï¼Œå†è¿›è¡Œä¸åŒæƒ…å†µçš„å¤„ç†ã€‚ä½†å½“å¯¹è±¡çš„çŠ¶æ€å¾ˆå¤šæ—¶ï¼Œç¨‹åºä¼šå˜å¾—å¾ˆå¤æ‚ã€‚è€Œä¸”å¢åŠ æ–°çš„çŠ¶æ€è¦æ·»åŠ æ–°çš„ if-else è¯­å¥ï¼Œè¿™è¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€ï¼Œä¸åˆ©äºç¨‹åºçš„æ‰©å±•ã€‚</p><p>ä»¥ä¸Šé—®é¢˜å¦‚æœé‡‡ç”¨â€œçŠ¶æ€æ¨¡å¼â€å°±èƒ½å¾ˆå¥½åœ°å¾—åˆ°è§£å†³ã€‚çŠ¶æ€æ¨¡å¼çš„è§£å†³æ€æƒ³æ˜¯ï¼šå½“æ§åˆ¶ä¸€ä¸ªå¯¹è±¡çŠ¶æ€è½¬æ¢çš„æ¡ä»¶è¡¨è¾¾å¼è¿‡äºå¤æ‚æ—¶ï¼ŒæŠŠç›¸å…³â€œåˆ¤æ–­é€»è¾‘â€æå–å‡ºæ¥ï¼Œæ”¾åˆ°ä¸€ç³»åˆ—çš„çŠ¶æ€ç±»å½“ä¸­ï¼Œè¿™æ ·å¯ä»¥æŠŠåŸæ¥å¤æ‚çš„é€»è¾‘åˆ¤æ–­ç®€å•åŒ–ã€‚</p><p><strong>çŠ¶æ€ï¼ˆStateï¼‰æ¨¡å¼</strong>çš„å®šä¹‰ï¼šå½“ä¸€ä¸ªå¯¹è±¡çš„å†…åœ¨çŠ¶æ€æ”¹å˜æ—¶å…è®¸æ”¹å˜å…¶è¡Œä¸ºï¼Œè¿™ä¸ªå¯¹è±¡çœ‹èµ·æ¥åƒæ˜¯æ”¹å˜äº†å…¶ç±»ã€‚</p><p>çŠ¶æ€æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š</p><ol><li><strong>ç¯å¢ƒï¼ˆContextï¼‰è§’è‰²</strong>ï¼šä¹Ÿç§°ä¸ºä¸Šä¸‹æ–‡ï¼Œå®ƒå®šä¹‰äº†å®¢æˆ·æ„Ÿå…´è¶£çš„æ¥å£ï¼Œç»´æŠ¤ä¸€ä¸ªå½“å‰çŠ¶æ€ï¼Œå¹¶å°†ä¸çŠ¶æ€ç›¸å…³çš„æ“ä½œå§”æ‰˜ç»™å½“å‰çŠ¶æ€å¯¹è±¡æ¥å¤„ç†ï¼›</li><li><strong>æŠ½è±¡çŠ¶æ€ï¼ˆStateï¼‰è§’è‰²</strong>ï¼šå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç”¨ä»¥å°è£…ç¯å¢ƒå¯¹è±¡ä¸­çš„ç‰¹å®šçŠ¶æ€æ‰€å¯¹åº”çš„è¡Œä¸ºï¼›</li><li><strong>å…·ä½“çŠ¶æ€ï¼ˆConcreteStateï¼‰è§’è‰²</strong>ï¼šå®ç°æŠ½è±¡çŠ¶æ€æ‰€å¯¹åº”çš„è¡Œä¸ºï¼›</li></ol><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/StatePattern.png" alt></p><p>ç¤ºä¾‹</p><p>æŠ½è±¡çŠ¶æ€ç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æŠ½è±¡çŠ¶æ€ç±» */</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> String stateName<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">Handle</span><span class="token punctuation">(</span>Context context<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ç¯å¢ƒç±»ï¼ˆä¸Šä¸‹æ–‡ï¼‰</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * ç¯å¢ƒç±»ï¼ˆä¸Šä¸‹æ–‡ï¼‰ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Context</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> State state<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Context</span><span class="token punctuation">(</span>State state<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> State <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> state<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span>State state<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å½“å‰çŠ¶æ€ä¸ºï¼š"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>stateName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"çŠ¶æ€å˜æ›´ä¸ºï¼š"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>stateName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“çŠ¶æ€ç±»A</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteStateA</span> <span class="token keyword">extends</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">ConcreteStateA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        stateName <span class="token operator">=</span> <span class="token string">"çŠ¶æ€ A"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Handle</span><span class="token punctuation">(</span>Context context<span class="token punctuation">)</span> <span class="token punctuation">{</span>        context<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcreteStateB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“çŠ¶æ€ç±»B</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteStateB</span> <span class="token keyword">extends</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">ConcreteStateB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        stateName <span class="token operator">=</span> <span class="token string">"çŠ¶æ€ B"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Handle</span><span class="token punctuation">(</span>Context context<span class="token punctuation">)</span> <span class="token punctuation">{</span>        context<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcreteStateA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Context context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcreteStateA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        context<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        context<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        context<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šå½“å‰çŠ¶æ€ä¸ºï¼šçŠ¶æ€ AçŠ¶æ€å˜æ›´ä¸ºï¼šçŠ¶æ€ B<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>å½“å‰çŠ¶æ€ä¸ºï¼šçŠ¶æ€ BçŠ¶æ€å˜æ›´ä¸ºï¼šçŠ¶æ€ A<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>å½“å‰çŠ¶æ€ä¸ºï¼šçŠ¶æ€ AçŠ¶æ€å˜æ›´ä¸ºï¼šçŠ¶æ€ B</code></pre><p>ç¤ºä¾‹2</p><p>æŠ½è±¡çŠ¶æ€</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æŠ½è±¡çŠ¶æ€ç±»ï¼šç«è½¦çŠ¶æ€ */</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">TrainState</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span>Train train<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ç¯å¢ƒï¼ˆä¸Šä¸‹æ–‡ï¼‰</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * ä¸Šä¸‹æ–‡ï¼šç«è½¦ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Train</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// ç«è½¦è¡Œé©¶</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        state<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> TrainState state<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// è½¦é€Ÿåº¦</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> speed<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// æ˜¯å¦è®©è¡Œ</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> giveWay <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Train</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StartState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> TrainState <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> state<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span>TrainState state<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> speed<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSpeed</span><span class="token punctuation">(</span><span class="token keyword">int</span> speed<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>speed <span class="token operator">=</span> speed<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isGiveWay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> giveWay<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setGiveWay</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> giveWay<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>giveWay <span class="token operator">=</span> giveWay<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“çŠ¶æ€</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“çŠ¶æ€ç±»ï¼šç«è½¦åŠ é€ŸçŠ¶æ€ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FastState</span> <span class="token keyword">extends</span> <span class="token class-name">TrainState</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span>Train train<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>train<span class="token punctuation">.</span><span class="token function">getSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é€Ÿä¸ºï¼š"</span> <span class="token operator">+</span> train<span class="token punctuation">.</span><span class="token function">getSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"åˆ—è½¦æ­£åœ¨åŠ é€Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            train<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SlowState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            train<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“çŠ¶æ€ï¼šç«è½¦å‡é€ŸçŠ¶æ€ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SlowState</span> <span class="token keyword">extends</span> <span class="token class-name">TrainState</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span>Train train<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>train<span class="token punctuation">.</span><span class="token function">getSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é€Ÿä¸ºï¼š"</span> <span class="token operator">+</span> train<span class="token punctuation">.</span><span class="token function">getSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"åˆ—è½¦æ­£åœ¨å‡é€Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            train<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            train<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“çŠ¶æ€ï¼šç«è½¦åŒ€é€Ÿè¡Œé©¶çŠ¶æ€ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunState</span> <span class="token keyword">extends</span> <span class="token class-name">TrainState</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span>Train train<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>train<span class="token punctuation">.</span><span class="token function">isGiveWay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            train<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StopState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            train<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é€Ÿä¸ºï¼š"</span> <span class="token operator">+</span> train<span class="token punctuation">.</span><span class="token function">getSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"åˆ—è½¦æ­£åœ¨åŒ€é€Ÿè¡Œé©¶"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“çŠ¶æ€ï¼šç«è½¦åœæ­¢è®©è¡ŒçŠ¶æ€ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StopState</span> <span class="token keyword">extends</span> <span class="token class-name">TrainState</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span>Train train<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é€Ÿä¸ºï¼š"</span> <span class="token operator">+</span> train<span class="token punctuation">.</span><span class="token function">getSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"åˆ—è½¦å‡†å¤‡åœæ­¢è®©è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Train train <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Train</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        train<span class="token punctuation">.</span><span class="token function">setSpeed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        train<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        train<span class="token punctuation">.</span><span class="token function">setSpeed</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        train<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        train<span class="token punctuation">.</span><span class="token function">setSpeed</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        train<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        train<span class="token punctuation">.</span><span class="token function">setSpeed</span><span class="token punctuation">(</span><span class="token number">210</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        train<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        train<span class="token punctuation">.</span><span class="token function">setSpeed</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        train<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        train<span class="token punctuation">.</span><span class="token function">setGiveWay</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        train<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šå½“å‰æ—¶é€Ÿä¸ºï¼š<span class="token number">0</span>åˆ—è½¦å¼€å§‹å¯åŠ¨å½“å‰æ—¶é€Ÿä¸ºï¼š<span class="token number">100</span>åˆ—è½¦æ­£åœ¨åŠ é€Ÿå½“å‰æ—¶é€Ÿä¸ºï¼š<span class="token number">150</span>åˆ—è½¦æ­£åœ¨åŠ é€Ÿå½“å‰æ—¶é€Ÿä¸ºï¼š<span class="token number">210</span>åˆ—è½¦æ­£åœ¨å‡é€Ÿå½“å‰æ—¶é€Ÿä¸ºï¼š<span class="token number">200</span>åˆ—è½¦æ­£åœ¨åŒ€é€Ÿè¡Œé©¶å½“å‰æ—¶é€Ÿä¸ºï¼š<span class="token number">200</span>åˆ—è½¦å‡†å¤‡åœæ­¢è®©è¡Œ</code></pre><p>çŠ¶æ€æ¨¡å¼æ€»ç»“</p><p>çŠ¶æ€æ¨¡å¼ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>çŠ¶æ€æ¨¡å¼å°†ä¸ç‰¹å®šçŠ¶æ€ç›¸å…³çš„è¡Œä¸ºå±€éƒ¨åŒ–åˆ°ä¸€ä¸ªçŠ¶æ€ä¸­ï¼Œå¹¶ä¸”å°†ä¸åŒçŠ¶æ€çš„è¡Œä¸ºåˆ†å‰²å¼€æ¥ï¼Œæ»¡è¶³â€œå•ä¸€èŒè´£åŸåˆ™â€ï¼›</p></li><li><p>å‡å°‘å¯¹è±¡é—´çš„ç›¸äº’ä¾èµ–ã€‚å°†ä¸åŒçš„çŠ¶æ€å¼•å…¥ç‹¬ç«‹çš„å¯¹è±¡ä¸­ä¼šä½¿å¾—çŠ¶æ€è½¬æ¢å˜å¾—æ›´åŠ æ˜ç¡®ï¼Œä¸”å‡å°‘å¯¹è±¡é—´çš„ç›¸äº’ä¾èµ–ï¼›</p></li><li><p>æœ‰åˆ©äºç¨‹åºçš„æ‰©å±•ã€‚é€šè¿‡å®šä¹‰æ–°çš„å­ç±»å¾ˆå®¹æ˜“åœ°å¢åŠ æ–°çš„çŠ¶æ€å’Œè½¬æ¢ï¼›</p></li></ul><p>çŠ¶æ€æ¨¡å¼çš„ä¸»è¦ç¼ºç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>çŠ¶æ€æ¨¡å¼çš„ä½¿ç”¨å¿…ç„¶ä¼šå¢åŠ ç³»ç»Ÿçš„ç±»ä¸å¯¹è±¡çš„ä¸ªæ•°ï¼›</p></li><li><p>çŠ¶æ€æ¨¡å¼çš„ç»“æ„ä¸å®ç°éƒ½è¾ƒä¸ºå¤æ‚ï¼Œå¦‚æœä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´ç¨‹åºç»“æ„å’Œä»£ç çš„æ··ä¹±ï¼›</p></li></ul><p>é€šå¸¸åœ¨ä»¥ä¸‹æƒ…å†µä¸‹å¯ä»¥è€ƒè™‘ä½¿ç”¨çŠ¶æ€æ¨¡å¼ï¼š</p><ul><li>å½“ä¸€ä¸ªå¯¹è±¡çš„è¡Œä¸ºå–å†³äºå®ƒçš„çŠ¶æ€ï¼Œå¹¶ä¸”å®ƒå¿…é¡»åœ¨è¿è¡Œæ—¶æ ¹æ®çŠ¶æ€æ”¹å˜å®ƒçš„è¡Œä¸ºæ—¶ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨çŠ¶æ€æ¨¡å¼ã€‚</li><li>ä¸€ä¸ªæ“ä½œä¸­å«æœ‰åºå¤§çš„åˆ†æ”¯ç»“æ„ï¼Œå¹¶ä¸”è¿™äº›åˆ†æ”¯å†³å®šäºå¯¹è±¡çš„çŠ¶æ€æ—¶ã€‚</li></ul><h4 id="4-è§‚å¯Ÿè€…æ¨¡å¼"><a href="#4-è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="4.è§‚å¯Ÿè€…æ¨¡å¼"></a>4.è§‚å¯Ÿè€…æ¨¡å¼</h4><p>åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œè®¸å¤šå¯¹è±¡å¹¶ä¸æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼Œå…¶ä¸­ä¸€ä¸ªå¯¹è±¡çš„è¡Œä¸ºå‘ç”Ÿæ”¹å˜å¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ªæˆ–è€…å¤šä¸ªå…¶ä»–å¯¹è±¡çš„è¡Œä¸ºä¹Ÿå‘ç”Ÿæ”¹å˜ã€‚ä¾‹å¦‚ï¼ŒæŸç§å•†å“çš„ç‰©ä»·ä¸Šæ¶¨æ—¶ä¼šå¯¼è‡´éƒ¨åˆ†å•†å®¶é«˜å…´ï¼Œè€Œæ¶ˆè´¹è€…ä¼¤å¿ƒï¼›è¿˜æœ‰ï¼Œå½“æˆ‘ä»¬å¼€è½¦åˆ°äº¤å‰è·¯å£æ—¶ï¼Œé‡åˆ°çº¢ç¯ä¼šåœï¼Œé‡åˆ°ç»¿ç¯ä¼šè¡Œã€‚è¿™æ ·çš„ä¾‹å­è¿˜æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ï¼Œè‚¡ç¥¨ä»·æ ¼ä¸è‚¡æ°‘ã€å¾®ä¿¡å…¬ä¼—å·ä¸å¾®ä¿¡ç”¨æˆ·ã€æ°”è±¡å±€çš„å¤©æ°”é¢„æŠ¥ä¸å¬ä¼—ã€å°å·ä¸è­¦å¯Ÿç­‰ã€‚</p><p>åœ¨è½¯ä»¶ä¸–ç•Œä¹Ÿæ˜¯è¿™æ ·ï¼Œä¾‹å¦‚ï¼ŒExcel ä¸­çš„æ•°æ®ä¸æŠ˜çº¿å›¾ã€é¥¼çŠ¶å›¾ã€æŸ±çŠ¶å›¾ä¹‹é—´çš„å…³ç³»ï¼›MVC æ¨¡å¼ä¸­çš„æ¨¡å‹ä¸è§†å›¾çš„å…³ç³»ï¼›äº‹ä»¶æ¨¡å‹ä¸­çš„äº‹ä»¶æºä¸äº‹ä»¶å¤„ç†è€…ã€‚æ‰€æœ‰è¿™äº›ï¼Œå¦‚æœç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥å®ç°å°±éå¸¸æ–¹ä¾¿ã€‚</p><p><strong>è§‚å¯Ÿè€…ï¼ˆObserverï¼‰æ¨¡å¼</strong>å®šä¹‰ï¼šè§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªä¸»é¢˜å¯¹è±¡ã€‚è¿™ä¸ªä¸»é¢˜å¯¹è±¡åœ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°è‡ªå·±ã€‚è¿™ç§æ¨¡å¼æœ‰æ—¶åˆç§°ä½œå‘å¸ƒ-è®¢é˜…æ¨¡å¼ã€æ¨¡å‹-è§†å›¾æ¨¡å¼ï¼Œå®ƒæ˜¯å¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼ã€‚</p><p>è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ï¼š</p><ol><li><strong>æŠ½è±¡ä¸»é¢˜ï¼ˆSubjectï¼‰è§’è‰²</strong>ï¼šä¹Ÿå«æŠ½è±¡ç›®æ ‡ç±»ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç”¨äºä¿å­˜è§‚å¯Ÿè€…å¯¹è±¡çš„èšé›†ç±»å’Œå¢åŠ ã€åˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡çš„æ–¹æ³•ï¼Œä»¥åŠé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…çš„æŠ½è±¡æ–¹æ³•ã€‚</li><li><strong>å…·ä½“ä¸»é¢˜ï¼ˆConcreteSubjectï¼‰è§’è‰²</strong>ï¼šä¹Ÿå«å…·ä½“ç›®æ ‡ç±»ï¼Œå®ƒå®ç°æŠ½è±¡ç›®æ ‡ä¸­çš„é€šçŸ¥æ–¹æ³•ï¼Œå½“å…·ä½“ä¸»é¢˜çš„å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œé€šçŸ¥æ‰€æœ‰æ³¨å†Œè¿‡çš„è§‚å¯Ÿè€…å¯¹è±¡ã€‚</li><li><strong>æŠ½è±¡è§‚å¯Ÿè€…ï¼ˆObserverï¼‰è§’è‰²</strong>ï¼šå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»æˆ–æ¥å£ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªæ›´æ–°è‡ªå·±çš„æŠ½è±¡æ–¹æ³•ï¼Œå½“æ¥åˆ°å…·ä½“ä¸»é¢˜çš„æ›´æ”¹é€šçŸ¥æ—¶è¢«è°ƒç”¨ã€‚</li><li><strong>å…·ä½“è§‚å¯Ÿè€…ï¼ˆConcreteObserverï¼‰è§’è‰²</strong>ï¼šå®ç°æŠ½è±¡è§‚å¯Ÿè€…ä¸­å®šä¹‰çš„æŠ½è±¡æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨å¾—åˆ°ç›®æ ‡çš„æ›´æ”¹é€šçŸ¥æ—¶æ›´æ–°è‡ªèº«çš„çŠ¶æ€ã€‚</li></ol><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/ObserverPattern.png" alt></p><p>ç¤ºä¾‹</p><p>æŠ½è±¡è§‚å¯Ÿè€…ç±»</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“è§‚å¯Ÿè€…</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteObserver</span> <span class="token keyword">implements</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String observerName<span class="token punctuation">;</span>    <span class="token keyword">private</span> String state<span class="token punctuation">;</span>    <span class="token keyword">private</span> ConcreteSubject concreteSubject<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">ConcreteObserver</span><span class="token punctuation">(</span> String observerName<span class="token punctuation">,</span> ConcreteSubject concreteSubject<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>concreteSubject <span class="token operator">=</span> concreteSubject<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>observerName <span class="token operator">=</span> observerName<span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token keyword">public</span> ConcreteSubject <span class="token function">getConcreteSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> concreteSubject<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setConcreteSubject</span><span class="token punctuation">(</span>ConcreteSubject concreteSubject<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>concreteSubject <span class="token operator">=</span> concreteSubject<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        state <span class="token operator">=</span> concreteSubject<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        String subName <span class="token operator">=</span> concreteSubject<span class="token punctuation">.</span><span class="token function">getSubjectName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"["</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>observerName <span class="token operator">+</span> <span class="token string">"]è§‚å¯Ÿåˆ°["</span> <span class="token operator">+</span> subName <span class="token operator">+</span> <span class="token string">"]çŠ¶æ€æ˜¯ï¼š"</span> <span class="token operator">+</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æŠ½è±¡ä¸»é¢˜</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Subject</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// è®°å½•è§‚å¯Ÿè€…åˆ—è¡¨</span>    <span class="token keyword">protected</span> ArrayList<span class="token operator">&lt;</span>Observer<span class="token operator">></span> observers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>Observer<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>Observer observer<span class="token punctuation">)</span><span class="token punctuation">{</span>        observers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span>Observer observer<span class="token punctuation">)</span><span class="token punctuation">{</span>        observers<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// é€šçŸ¥</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">notifyObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“ä¸»é¢˜</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteSubject</span> <span class="token keyword">extends</span> <span class="token class-name">Subject</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> String subjectName<span class="token punctuation">;</span>    <span class="token keyword">private</span> String state<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">ConcreteSubject</span><span class="token punctuation">(</span>String subjectName<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>subjectName <span class="token operator">=</span> subjectName<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">getSubjectName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> subjectName<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSubjectName</span><span class="token punctuation">(</span>String subjectName<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>subjectName <span class="token operator">=</span> subjectName<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> state<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span>String state<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notifyObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> observers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            observers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ConcreteSubject shenzhouX <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteSubject</span><span class="token punctuation">(</span><span class="token string">"ç¥èˆŸ10å·é£èˆ¹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shenzhouX<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcreteObserver</span><span class="token punctuation">(</span><span class="token string">"è¿œæœ›1å·è§‚æµ‹èˆ¹"</span><span class="token punctuation">,</span>shenzhouX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shenzhouX<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcreteObserver</span><span class="token punctuation">(</span><span class="token string">"è¿œæœ›2å·è§‚æµ‹èˆ¹"</span><span class="token punctuation">,</span>shenzhouX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shenzhouX<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcreteObserver</span><span class="token punctuation">(</span><span class="token string">"è¿œæœ›3å·è§‚æµ‹èˆ¹"</span><span class="token punctuation">,</span>shenzhouX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shenzhouX<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"é£èˆ¹è¿›å…¥è½¨é“"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shenzhouX<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"å§¿æ€è°ƒæ•´"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        shenzhouX<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"å±•å¼€å¤ªé˜³èƒ½æ¿"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼š<span class="token punctuation">[</span>è¿œæœ›<span class="token number">1</span>å·è§‚æµ‹èˆ¹<span class="token punctuation">]</span>è§‚å¯Ÿåˆ°<span class="token punctuation">[</span>ç¥èˆŸ<span class="token number">10</span>å·é£èˆ¹<span class="token punctuation">]</span>çŠ¶æ€æ˜¯ï¼šé£èˆ¹è¿›å…¥è½¨é“<span class="token punctuation">[</span>è¿œæœ›<span class="token number">2</span>å·è§‚æµ‹èˆ¹<span class="token punctuation">]</span>è§‚å¯Ÿåˆ°<span class="token punctuation">[</span>ç¥èˆŸ<span class="token number">10</span>å·é£èˆ¹<span class="token punctuation">]</span>çŠ¶æ€æ˜¯ï¼šé£èˆ¹è¿›å…¥è½¨é“<span class="token punctuation">[</span>è¿œæœ›<span class="token number">3</span>å·è§‚æµ‹èˆ¹<span class="token punctuation">]</span>è§‚å¯Ÿåˆ°<span class="token punctuation">[</span>ç¥èˆŸ<span class="token number">10</span>å·é£èˆ¹<span class="token punctuation">]</span>çŠ¶æ€æ˜¯ï¼šé£èˆ¹è¿›å…¥è½¨é“<span class="token punctuation">[</span>è¿œæœ›<span class="token number">1</span>å·è§‚æµ‹èˆ¹<span class="token punctuation">]</span>è§‚å¯Ÿåˆ°<span class="token punctuation">[</span>ç¥èˆŸ<span class="token number">10</span>å·é£èˆ¹<span class="token punctuation">]</span>çŠ¶æ€æ˜¯ï¼šå§¿æ€è°ƒæ•´<span class="token punctuation">[</span>è¿œæœ›<span class="token number">2</span>å·è§‚æµ‹èˆ¹<span class="token punctuation">]</span>è§‚å¯Ÿåˆ°<span class="token punctuation">[</span>ç¥èˆŸ<span class="token number">10</span>å·é£èˆ¹<span class="token punctuation">]</span>çŠ¶æ€æ˜¯ï¼šå§¿æ€è°ƒæ•´<span class="token punctuation">[</span>è¿œæœ›<span class="token number">3</span>å·è§‚æµ‹èˆ¹<span class="token punctuation">]</span>è§‚å¯Ÿåˆ°<span class="token punctuation">[</span>ç¥èˆŸ<span class="token number">10</span>å·é£èˆ¹<span class="token punctuation">]</span>çŠ¶æ€æ˜¯ï¼šå§¿æ€è°ƒæ•´<span class="token punctuation">[</span>è¿œæœ›<span class="token number">1</span>å·è§‚æµ‹èˆ¹<span class="token punctuation">]</span>è§‚å¯Ÿåˆ°<span class="token punctuation">[</span>ç¥èˆŸ<span class="token number">10</span>å·é£èˆ¹<span class="token punctuation">]</span>çŠ¶æ€æ˜¯ï¼šå±•å¼€å¤ªé˜³èƒ½æ¿<span class="token punctuation">[</span>è¿œæœ›<span class="token number">2</span>å·è§‚æµ‹èˆ¹<span class="token punctuation">]</span>è§‚å¯Ÿåˆ°<span class="token punctuation">[</span>ç¥èˆŸ<span class="token number">10</span>å·é£èˆ¹<span class="token punctuation">]</span>çŠ¶æ€æ˜¯ï¼šå±•å¼€å¤ªé˜³èƒ½æ¿<span class="token punctuation">[</span>è¿œæœ›<span class="token number">3</span>å·è§‚æµ‹èˆ¹<span class="token punctuation">]</span>è§‚å¯Ÿåˆ°<span class="token punctuation">[</span>ç¥èˆŸ<span class="token number">10</span>å·é£èˆ¹<span class="token punctuation">]</span>çŠ¶æ€æ˜¯ï¼šå±•å¼€å¤ªé˜³èƒ½æ¿</code></pre><p>è§‚å¯Ÿè€…æ¨¡å¼æ€»ç»“</p><p>è§‚å¯Ÿè€…æ¨¡å¼ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>é™ä½äº†ç›®æ ‡ä¸è§‚å¯Ÿè€…ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œä¸¤è€…ä¹‹é—´æ˜¯æŠ½è±¡è€¦åˆå…³ç³»ï¼›</p></li><li><p>ç›®æ ‡ä¸è§‚å¯Ÿè€…ä¹‹é—´å»ºç«‹äº†ä¸€å¥—è§¦å‘æœºåˆ¶ï¼›</p></li></ul><p>å®ƒçš„ä¸»è¦ç¼ºç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>ç›®æ ‡ä¸è§‚å¯Ÿè€…ä¹‹é—´çš„ä¾èµ–å…³ç³»å¹¶æ²¡æœ‰å®Œå…¨è§£é™¤ï¼Œè€Œä¸”æœ‰å¯èƒ½å‡ºç°å¾ªç¯å¼•ç”¨ï¼›</p></li><li><p>å½“è§‚å¯Ÿè€…å¯¹è±¡å¾ˆå¤šæ—¶ï¼Œé€šçŸ¥çš„å‘å¸ƒä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼Œå½±å“ç¨‹åºçš„æ•ˆç‡ï¼›</p></li></ul><p>è§‚å¯Ÿè€…æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li>å½“ä¸€ä¸ªæŠ½è±¡ç±»å‹æœ‰ä¸¤ä¸ªæ–¹é¢ï¼Œè€Œå…¶ä¸­ä¸€ä¸ªæ–¹é¢å¿…é¡»ä¾èµ–äºå¦ä¸€ä¸ªæ–¹é¢æ—¶ï¼›</li><li>å½“å¯¹ä¸€ä¸ªå¯¹è±¡çš„æ”¹å˜éœ€è¦åŒæ—¶æ”¹å˜å…¶ä»–çš„å¯¹è±¡ä½†æ˜¯å´ä¸çŸ¥é“å…·ä½“æœ‰å¤šå°‘ä¸ªå¯¹è±¡ç­‰å¾…æ”¹å˜æ—¶ï¼›</li><li>å½“ä¸€ä¸ªå¯¹è±¡å¿…é¡»é€šçŸ¥å…¶ä»–å¯¹è±¡ä½†å´ä¸èƒ½ä¸å…¶ä»–å¯¹è±¡é€ æˆç´§å¯†è€¦åˆæ—¶ï¼›</li></ul><h4 id="5-å¤‡å¿˜å½•æ¨¡å¼"><a href="#5-å¤‡å¿˜å½•æ¨¡å¼" class="headerlink" title="5.å¤‡å¿˜å½•æ¨¡å¼"></a>5.å¤‡å¿˜å½•æ¨¡å¼</h4><p>å¤‡å¿˜å½•æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºæ¨¡å¼ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå½“æˆ‘ä»¬éœ€è¦æ‰§è¡Œä¸€ä¸ªå–æ¶ˆæ“ä½œä»è€Œä½¿ç³»ç»Ÿå›æ»šåˆ°ä»å‰çš„ä¸€ä¸ªçŠ¶æ€ï¼Œæˆ–è€…æˆ‘ä»¬å¸Œæœ›è®©ä¸€ä¸ªå¤„äºæš‚åœçŠ¶æ€çš„å·¥ä½œç»§ç»­è¿è¡Œæ—¶ï¼Œå°±éœ€è¦åˆ›å»ºä¸€ä¸ªæ›¾ç»åœ¨ç³»ç»Ÿä¸­å‡ºç°è¿‡çš„å¯¹è±¡ã€‚å¤‡å¿˜å½•æ¨¡å¼å¯ä»¥ä¸ºä¸€ä¸ªå¯¹è±¡å¬çŠ¶æ€å­˜å‚¨å³çŠ¶æ€æ¢å¤çš„æ–¹æ³•ã€‚</p><p>å…¶å®å¾ˆå¤šåº”ç”¨è½¯ä»¶éƒ½æä¾›äº†è¿™é¡¹åŠŸèƒ½ï¼Œå¦‚ Wordã€è®°äº‹æœ¬ã€Photoshopã€Eclipse ç­‰è½¯ä»¶åœ¨ç¼–è¾‘æ—¶æŒ‰ Ctrl+Z ç»„åˆé”®æ—¶èƒ½æ’¤é”€å½“å‰æ“ä½œï¼Œä½¿æ–‡æ¡£æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼›è¿˜æœ‰åœ¨ IE ä¸­çš„åé€€é”®ã€æ•°æ®åº“äº‹åŠ¡ç®¡ç†ä¸­çš„å›æ»šæ“ä½œã€ç©æ¸¸æˆæ—¶çš„ä¸­é—´ç»“æœå­˜æ¡£åŠŸèƒ½ã€æ•°æ®åº“ä¸æ“ä½œç³»ç»Ÿçš„å¤‡ä»½æ“ä½œã€æ£‹ç±»æ¸¸æˆä¸­çš„æ‚”æ£‹åŠŸèƒ½ç­‰éƒ½å±äºè¿™ç±»ã€‚</p><p><strong>å¤‡å¿˜å½•ï¼ˆMementoï¼‰æ¨¡å¼</strong>å®šä¹‰ï¼šåœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•æ‰ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿æŒè¿™ä¸ªçŠ¶æ€ã€‚è¿™æ ·ä»¥åå°±å¯ä»¥å°†è¯¥å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€ã€‚</p><p>å¤‡å¿˜å½•æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ï¼š</p><ol><li><strong>å‘èµ·äººï¼ˆOriginatorï¼‰è§’è‰²</strong>ï¼šè®°å½•å½“å‰æ—¶åˆ»çš„å†…éƒ¨çŠ¶æ€ä¿¡æ¯ï¼Œæä¾›åˆ›å»ºå¤‡å¿˜å½•å’Œæ¢å¤å¤‡å¿˜å½•æ•°æ®çš„åŠŸèƒ½ï¼Œå®ç°å…¶ä»–ä¸šåŠ¡åŠŸèƒ½ï¼Œå®ƒå¯ä»¥è®¿é—®å¤‡å¿˜å½•é‡Œçš„æ‰€æœ‰ä¿¡æ¯ã€‚</li><li><strong>å¤‡å¿˜å½•ï¼ˆMementoï¼‰è§’è‰²</strong>ï¼šè´Ÿè´£å­˜å‚¨å‘èµ·äººçš„å†…éƒ¨çŠ¶æ€ï¼Œåœ¨éœ€è¦çš„æ—¶å€™æä¾›è¿™äº›å†…éƒ¨çŠ¶æ€ç»™å‘èµ·äººã€‚</li><li><strong>ç®¡ç†è€…ï¼ˆCaretakerï¼‰è§’è‰²</strong>ï¼šå¯¹å¤‡å¿˜å½•è¿›è¡Œç®¡ç†ï¼Œæä¾›ä¿å­˜ä¸è·å–å¤‡å¿˜å½•çš„åŠŸèƒ½ï¼Œä½†å…¶ä¸èƒ½å¯¹å¤‡å¿˜å½•çš„å†…å®¹è¿›è¡Œè®¿é—®ä¸ä¿®æ”¹ã€‚</li></ol><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/MementoPattern.png" alt></p><p>ç¤ºä¾‹</p><p>å¤‡å¿˜å½•è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å¤‡å¿˜å½• */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Memento</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String state<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Memento</span><span class="token punctuation">(</span>String state<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span>String state<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> state<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å‘èµ·äººè§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å‘èµ·äºº */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Originator</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String state<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span>String state<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> state<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Memento <span class="token function">createMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Memento</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">restoreMemento</span><span class="token punctuation">(</span>Memento m<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ç®¡ç†è€…</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * ç®¡ç†è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Caretaker</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Memento memento<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMemento</span><span class="token punctuation">(</span>Memento m<span class="token punctuation">)</span> <span class="token punctuation">{</span>        memento <span class="token operator">=</span> m<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Memento <span class="token function">getMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> memento<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Originator originator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Originator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Caretaker caretaker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Caretaker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        originator<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"State1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åˆå§‹çŠ¶æ€:"</span> <span class="token operator">+</span> originator<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        caretaker<span class="token punctuation">.</span><span class="token function">setMemento</span><span class="token punctuation">(</span>originator<span class="token punctuation">.</span><span class="token function">createMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//ä¿å­˜çŠ¶æ€</span>        originator<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"State2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ–°çš„çŠ¶æ€:"</span> <span class="token operator">+</span> originator<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        originator<span class="token punctuation">.</span><span class="token function">restoreMemento</span><span class="token punctuation">(</span>caretaker<span class="token punctuation">.</span><span class="token function">getMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æ¢å¤çŠ¶æ€</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¢å¤çŠ¶æ€:"</span> <span class="token operator">+</span> originator<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šåˆå§‹çŠ¶æ€<span class="token operator">:</span>State1æ–°çš„çŠ¶æ€<span class="token operator">:</span>State2æ¢å¤çŠ¶æ€<span class="token operator">:</span>State1</code></pre><p>ç¤ºä¾‹2ï¼ˆæ¸¸æˆè¿›åº¦å½’æ¡£ï¼‰</p><p>å¤‡å¿˜å½•è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æ¸¸æˆçŠ¶æ€ï¼ˆå¤‡å¿˜å½•è§’è‰²ï¼‰ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GameState</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">GameState</span><span class="token punctuation">(</span><span class="token keyword">int</span> level<span class="token punctuation">,</span> <span class="token keyword">int</span> coordinate<span class="token punctuation">,</span> <span class="token keyword">int</span> chapter<span class="token punctuation">,</span> <span class="token keyword">int</span> HP<span class="token punctuation">,</span> <span class="token keyword">int</span> MP<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>level <span class="token operator">=</span> level<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>coordinate <span class="token operator">=</span> coordinate<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>chapter <span class="token operator">=</span> chapter<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>HP <span class="token operator">=</span> HP<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>MP <span class="token operator">=</span> MP<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * è§’è‰²ç­‰çº§     */</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> level<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * è§’è‰²çš„åœ°å›¾åæ ‡     */</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> coordinate<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * ç« èŠ‚è¿›åº¦     */</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> chapter<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * ç”Ÿå‘½å€¼     */</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> HP<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * é­”åŠ›å€¼     */</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> MP<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> level<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLevel</span><span class="token punctuation">(</span><span class="token keyword">int</span> level<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>level <span class="token operator">=</span> level<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCoordinate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> coordinate<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCoordinate</span><span class="token punctuation">(</span><span class="token keyword">int</span> coordinate<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>coordinate <span class="token operator">=</span> coordinate<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getChapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> chapter<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setChapter</span><span class="token punctuation">(</span><span class="token keyword">int</span> chapter<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>chapter <span class="token operator">=</span> chapter<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getHP</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> HP<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setHP</span><span class="token punctuation">(</span><span class="token keyword">int</span> HP<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>HP <span class="token operator">=</span> HP<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> MP<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMP</span><span class="token punctuation">(</span><span class="token keyword">int</span> MP<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>MP <span class="token operator">=</span> MP<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å‘èµ·äººè§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æ¸¸æˆè§’è‰²ï¼ˆå‘èµ·äººè§’è‰²ï¼‰ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GameRole</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * è§’è‰²ç­‰çº§     */</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> level<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * è§’è‰²çš„åœ°å›¾åæ ‡     */</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> coordinate<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * ç« èŠ‚è¿›åº¦     */</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> chapter<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * ç”Ÿå‘½å€¼     */</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> HP<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * é­”åŠ›å€¼     */</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> MP<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * ä¿å­˜æ¸¸æˆçŠ¶æ€     * @return     */</span>    <span class="token keyword">public</span> GameState <span class="token function">saveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GameState</span><span class="token punctuation">(</span>level<span class="token punctuation">,</span> coordinate<span class="token punctuation">,</span> chapter<span class="token punctuation">,</span> HP<span class="token punctuation">,</span> MP<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * æ¢å¤å­˜æ¡£     * @param gameState     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">recover</span><span class="token punctuation">(</span>GameState gameState<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>level <span class="token operator">=</span> gameState<span class="token punctuation">.</span><span class="token function">getLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>coordinate <span class="token operator">=</span> gameState<span class="token punctuation">.</span><span class="token function">getCoordinate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>chapter <span class="token operator">=</span> gameState<span class="token punctuation">.</span><span class="token function">getChapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>HP <span class="token operator">=</span> gameState<span class="token punctuation">.</span><span class="token function">getHP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>MP <span class="token operator">=</span> gameState<span class="token punctuation">.</span><span class="token function">getMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * æ˜¾ç¤ºæ¸¸æˆçŠ¶æ€     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">showState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¸¸æˆè¿›åº¦ä¿¡æ¯å¦‚ä¸‹ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è§’è‰²çº§åˆ«ï¼š"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>level<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è§’è‰²åæ ‡ï¼š"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>coordinate<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è§’è‰²ç”Ÿå‘½å€¼ï¼š"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>HP<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è§’è‰²é­”åŠ›å€¼ï¼š"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>MP<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¸¸æˆç« èŠ‚ï¼š"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chapter <span class="token operator">+</span> <span class="token string">"ç« èŠ‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * åˆå§‹åŒ–     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>level <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>coordinate <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>chapter <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>HP <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>MP <span class="token operator">=</span> <span class="token number">999</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * åšä»»åŠ¡å¤±è´¥     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doTaskFail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>level <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>coordinate <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>chapter <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>HP <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>MP <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å¤‡å¿˜å½•ç®¡ç†è€…è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å­˜æ¡£ç®¡ç†è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GameStateCaretaker</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> GameState gameState<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setGameState</span><span class="token punctuation">(</span>GameState gameState<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>gameState <span class="token operator">=</span> gameState<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> GameState <span class="token function">getGameState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> gameState<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//æ¸¸æˆåˆå§‹çŠ¶æ€</span>        GameRole  first <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GameRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        first<span class="token punctuation">.</span><span class="token function">initial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"åšä»»åŠ¡ä¹‹å‰ï¼Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        first<span class="token punctuation">.</span><span class="token function">showState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//è¿›åº¦ä¿å­˜</span>        GameStateCaretaker gameStateCaretaker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GameStateCaretaker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gameStateCaretaker<span class="token punctuation">.</span><span class="token function">setGameState</span><span class="token punctuation">(</span>first<span class="token punctuation">.</span><span class="token function">saveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//åšä»»åŠ¡å¤±è´¥</span>        first<span class="token punctuation">.</span><span class="token function">doTaskFail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"åšä»»åŠ¡å¤±è´¥åï¼Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        first<span class="token punctuation">.</span><span class="token function">showState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ¢å¤å­˜æ¡£</span>        first<span class="token punctuation">.</span><span class="token function">recover</span><span class="token punctuation">(</span>gameStateCaretaker<span class="token punctuation">.</span><span class="token function">getGameState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"æ¢å¤å­˜æ¡£åï¼Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        first<span class="token punctuation">.</span><span class="token function">showState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šåšä»»åŠ¡ä¹‹å‰ï¼Œæ¸¸æˆè¿›åº¦ä¿¡æ¯å¦‚ä¸‹ï¼šè§’è‰²çº§åˆ«ï¼š<span class="token number">100</span>è§’è‰²åæ ‡ï¼š<span class="token number">1234</span>è§’è‰²ç”Ÿå‘½å€¼ï¼š<span class="token number">1000</span>è§’è‰²é­”åŠ›å€¼ï¼š<span class="token number">999</span>æ¸¸æˆç« èŠ‚ï¼š<span class="token number">10</span>ç« èŠ‚<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>åšä»»åŠ¡å¤±è´¥åï¼Œæ¸¸æˆè¿›åº¦ä¿¡æ¯å¦‚ä¸‹ï¼šè§’è‰²çº§åˆ«ï¼š<span class="token number">100</span>è§’è‰²åæ ‡ï¼š<span class="token number">1234</span>è§’è‰²ç”Ÿå‘½å€¼ï¼š<span class="token number">0</span>è§’è‰²é­”åŠ›å€¼ï¼š<span class="token number">0</span>æ¸¸æˆç« èŠ‚ï¼š<span class="token number">10</span>ç« èŠ‚<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>æ¢å¤å­˜æ¡£åï¼Œæ¸¸æˆè¿›åº¦ä¿¡æ¯å¦‚ä¸‹ï¼šè§’è‰²çº§åˆ«ï¼š<span class="token number">100</span>è§’è‰²åæ ‡ï¼š<span class="token number">1234</span>è§’è‰²ç”Ÿå‘½å€¼ï¼š<span class="token number">1000</span>è§’è‰²é­”åŠ›å€¼ï¼š<span class="token number">999</span>æ¸¸æˆç« èŠ‚ï¼š<span class="token number">10</span>ç« èŠ‚</code></pre><p>å¤‡å¿˜å½•è§’è‰²æ€»ç»“</p><p>å¤‡å¿˜å½•æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼ï¼Œå…¶ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li>æä¾›äº†ä¸€ç§å¯ä»¥æ¢å¤çŠ¶æ€çš„æœºåˆ¶ã€‚å½“ç”¨æˆ·éœ€è¦æ—¶èƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿åœ°å°†æ•°æ®æ¢å¤åˆ°æŸä¸ªå†å²çš„çŠ¶æ€ï¼›</li><li>å®ç°äº†å†…éƒ¨çŠ¶æ€çš„å°è£…ã€‚é™¤äº†åˆ›å»ºå®ƒçš„å‘èµ·äººä¹‹å¤–ï¼Œå…¶ä»–å¯¹è±¡éƒ½ä¸èƒ½å¤Ÿè®¿é—®è¿™äº›çŠ¶æ€ä¿¡æ¯ï¼›</li><li>ç®€åŒ–äº†å‘èµ·äººç±»ã€‚å‘èµ·äººä¸éœ€è¦ç®¡ç†å’Œä¿å­˜å…¶å†…éƒ¨çŠ¶æ€çš„å„ä¸ªå¤‡ä»½ï¼Œæ‰€æœ‰çŠ¶æ€ä¿¡æ¯éƒ½ä¿å­˜åœ¨å¤‡å¿˜å½•ä¸­ï¼Œå¹¶ç”±ç®¡ç†è€…è¿›è¡Œç®¡ç†ï¼Œè¿™ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ï¼›</li></ul><p>å…¶ä¸»è¦ç¼ºç‚¹æ˜¯ï¼šèµ„æºæ¶ˆè€—å¤§ï¼›å¦‚æœè¦ä¿å­˜çš„å†…éƒ¨çŠ¶æ€ä¿¡æ¯è¿‡å¤šæˆ–è€…ç‰¹åˆ«é¢‘ç¹ï¼Œå°†ä¼šå ç”¨æ¯”è¾ƒå¤§çš„å†…å­˜èµ„æºã€‚</p><p>å¤‡å¿˜å½•æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li>å½“å¿…é¡»ä¿å­˜ä¸€ä¸ªå¯¹è±¡åœ¨æŸä¸€æ—¶åˆ»çš„å…¨éƒ¨æˆ–éƒ¨åˆ†çŠ¶æ€ä»¥ä¾¿åœ¨éœ€è¦æ—¶å¯ä»¥å°†å…¶æ¢å¤åˆ°å…ˆå‰çŠ¶æ€æ—¶ï¼›</li><li>å½“ä½¿ç”¨æ¥å£è®©å…¶ä»–å¯¹è±¡ç›´æ¥å¾—åˆ°è‡ªå·±çš„çŠ¶æ€ä¼šæš´éœ²å¯¹è±¡çš„å®ç°ç»†èŠ‚ç»§è€Œç ´åå…¶å°è£…æ€§æ—¶ï¼›</li></ul><p>è¯´äººè¯ï¼Œåœ¨ä»¥ä¸‹åœºæ™¯å¯ä»¥è€ƒè™‘ä½¿ç”¨å¤‡å¿˜å½•æ¨¡å¼ï¼š</p><ul><li>éœ€è¦ä¿å­˜ä¸æ¢å¤æ•°æ®çš„åœºæ™¯ï¼Œå¦‚ç©æ¸¸æˆæ—¶çš„ä¸­é—´ç»“æœçš„å­˜æ¡£åŠŸèƒ½ã€‚</li><li>éœ€è¦æä¾›ä¸€ä¸ªå¯å›æ»šæ“ä½œçš„åœºæ™¯ï¼Œå¦‚ Wordã€è®°äº‹æœ¬ã€Photoshopï¼ŒEclipse ç­‰è½¯ä»¶åœ¨ç¼–è¾‘æ—¶æŒ‰ Ctrl+Z ç»„åˆé”®ï¼Œè¿˜æœ‰æ•°æ®åº“ä¸­äº‹åŠ¡æ“ä½œã€‚</li></ul><h4 id="6-ä¸­ä»‹è€…æ¨¡å¼"><a href="#6-ä¸­ä»‹è€…æ¨¡å¼" class="headerlink" title="6.ä¸­ä»‹è€…æ¨¡å¼"></a>6.ä¸­ä»‹è€…æ¨¡å¼</h4><p>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œå¸¸å¸¸ä¼šå‡ºç°å¥½å¤šå¯¹è±¡ä¹‹é—´å­˜åœ¨å¤æ‚çš„äº¤äº’å…³ç³»ï¼Œè¿™ç§äº¤äº’å…³ç³»å¸¸å¸¸æ˜¯â€œç½‘çŠ¶ç»“æ„â€ï¼Œå®ƒè¦æ±‚æ¯ä¸ªå¯¹è±¡éƒ½å¿…é¡»çŸ¥é“å®ƒéœ€è¦äº¤äº’çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œæ¯ä¸ªäººå¿…é¡»è®°ä½ä»–ï¼ˆå¥¹ï¼‰æ‰€æœ‰æœ‹å‹çš„ç”µè¯ï¼›è€Œä¸”ï¼Œæœ‹å‹ä¸­å¦‚æœæœ‰äººçš„ç”µè¯ä¿®æ”¹äº†ï¼Œä»–ï¼ˆå¥¹ï¼‰å¿…é¡»å‘Šè¯‰å…¶ä»–æ‰€æœ‰çš„æœ‹å‹ä¿®æ”¹ï¼Œè¿™å«ä½œâ€œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«â€ï¼Œéå¸¸å¤æ‚ã€‚</p><p>å¦‚æœæŠŠè¿™ç§â€œç½‘çŠ¶ç»“æ„â€æ”¹ä¸ºâ€œæ˜Ÿå½¢ç»“æ„â€çš„è¯ï¼Œå°†å¤§å¤§é™ä½å®ƒä»¬ä¹‹é—´çš„â€œè€¦åˆæ€§â€ï¼Œè¿™æ—¶åªè¦æ‰¾ä¸€ä¸ªâ€œä¸­ä»‹è€…â€å°±å¯ä»¥äº†ã€‚å¦‚å‰é¢æ‰€è¯´çš„â€œæ¯ä¸ªäººå¿…é¡»è®°ä½æ‰€æœ‰æœ‹å‹ç”µè¯â€çš„é—®é¢˜ï¼Œåªè¦åœ¨ç½‘ä¸Šå»ºç«‹ä¸€ä¸ªæ¯ä¸ªæœ‹å‹éƒ½å¯ä»¥è®¿é—®çš„â€œé€šä¿¡å½•â€å°±è§£å†³äº†ã€‚è¿™æ ·çš„ä¾‹å­è¿˜æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ï¼Œä½ åˆšåˆšå‚åŠ å·¥ä½œæƒ³ç§Ÿæˆ¿ï¼Œå¯ä»¥æ‰¾â€œæˆ¿å±‹ä¸­ä»‹â€ï¼›æˆ–è€…ï¼Œè‡ªå·±åˆšåˆšåˆ°ä¸€ä¸ªé™Œç”ŸåŸå¸‚æ‰¾å·¥ä½œï¼Œå¯ä»¥æ‰¾â€œäººæ‰äº¤æµä¸­å¿ƒâ€å¸®å¿™ã€‚</p><p>åœ¨è½¯ä»¶çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¿™æ ·çš„ä¾‹å­ä¹Ÿå¾ˆå¤šï¼Œä¾‹å¦‚ï¼Œåœ¨ MVC æ¡†æ¶ä¸­ï¼Œæ§åˆ¶å™¨ï¼ˆCï¼‰å°±æ˜¯æ¨¡å‹ï¼ˆMï¼‰å’Œè§†å›¾ï¼ˆVï¼‰çš„ä¸­ä»‹è€…ï¼›è¿˜æœ‰å¤§å®¶å¸¸ç”¨çš„ QQ èŠå¤©ç¨‹åºçš„â€œä¸­ä»‹è€…â€æ˜¯ QQ æœåŠ¡å™¨ã€‚æ‰€æœ‰è¿™äº›ï¼Œéƒ½å¯ä»¥é‡‡ç”¨â€œä¸­ä»‹è€…æ¨¡å¼â€æ¥å®ç°ï¼Œå®ƒå°†å¤§å¤§é™ä½å¯¹è±¡ä¹‹é—´çš„è€¦åˆæ€§ï¼Œæé«˜ç³»ç»Ÿçš„çµæ´»æ€§ã€‚</p><p><strong>ä¸­ä»‹è€…ï¼ˆMediatorï¼‰æ¨¡å¼</strong>å®šä¹‰ï¼šç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—çš„å¯¹è±¡äº¤äº’ã€‚ä¸­ä»‹è€…ä½¿å„ä¸ªå¯¹è±¡ä¸éœ€è¦æ˜¾ç¤ºçš„ç›¸äº’å¼•ç”¨ï¼Œä»è€Œä½¿å™¨è€¦åˆæ¾æ•£ï¼Œè€Œä¸”å¯ä»¥ç‹¬ç«‹çš„æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚ä¸­ä»‹è€…æ¨¡å¼åˆå«è°ƒåœæ¨¡å¼ï¼Œå®ƒæ˜¯è¿ªç±³ç‰¹æ³•åˆ™çš„å…¸å‹åº”ç”¨ã€‚</p><p>ä¸­ä»‹è€…æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š</p><ol><li><strong>æŠ½è±¡ä¸­ä»‹è€…ï¼ˆMediatorï¼‰è§’è‰²</strong>ï¼šå®ƒæ˜¯ä¸­ä»‹è€…çš„æ¥å£ï¼Œæä¾›äº†åŒäº‹å¯¹è±¡æ³¨å†Œä¸è½¬å‘åŒäº‹å¯¹è±¡ä¿¡æ¯çš„æŠ½è±¡æ–¹æ³•ã€‚</li><li><strong>å…·ä½“ä¸­ä»‹è€…ï¼ˆConcreteMediatorï¼‰è§’è‰²</strong>ï¼šå®ç°ä¸­ä»‹è€…æ¥å£ï¼Œå®šä¹‰ä¸€ä¸ª List æ¥ç®¡ç†åŒäº‹å¯¹è±¡ï¼Œåè°ƒå„ä¸ªåŒäº‹è§’è‰²ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼Œå› æ­¤å®ƒä¾èµ–äºåŒäº‹è§’è‰²ã€‚</li><li><strong>æŠ½è±¡åŒäº‹ç±»ï¼ˆColleagueï¼‰è§’è‰²</strong>ï¼šå®šä¹‰åŒäº‹ç±»çš„æ¥å£ï¼Œä¿å­˜ä¸­ä»‹è€…å¯¹è±¡ï¼Œæä¾›åŒäº‹å¯¹è±¡äº¤äº’çš„æŠ½è±¡æ–¹æ³•ï¼Œå®ç°æ‰€æœ‰ç›¸äº’å½±å“çš„åŒäº‹ç±»çš„å…¬å…±åŠŸèƒ½ã€‚</li><li><strong>å…·ä½“åŒäº‹ç±»ï¼ˆConcreteColleagueï¼‰è§’è‰²</strong>ï¼šæ˜¯æŠ½è±¡åŒäº‹ç±»çš„å®ç°è€…ï¼Œå½“éœ€è¦ä¸å…¶ä»–åŒäº‹å¯¹è±¡äº¤äº’æ—¶ï¼Œç”±ä¸­ä»‹è€…å¯¹è±¡è´Ÿè´£åç»­çš„äº¤äº’ã€‚</li></ol><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/MediatorPattern.png" alt></p><p>ç¤ºä¾‹</p><p>æŠ½è±¡ä¸­ä»‹è€…è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Mediator</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * æ³¨å†Œ     * @param colleague     */</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span>Colleague colleague<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * è½¬å‘     * @param msg     * @param c     */</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">forward</span><span class="token punctuation">(</span>String msg<span class="token punctuation">,</span> Colleague c<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“ä¸­ä»‹è€…è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteMediator</span> <span class="token keyword">extends</span> <span class="token class-name">Mediator</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>Colleague<span class="token operator">></span> colleagueList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span>Colleague colleague<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>colleagueList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>colleague<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>colleagueList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>colleague<span class="token punctuation">)</span><span class="token punctuation">;</span>            colleague<span class="token punctuation">.</span><span class="token function">setMediator</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">forward</span><span class="token punctuation">(</span>String msg<span class="token punctuation">,</span> Colleague c<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>Colleague colleague <span class="token operator">:</span> colleagueList<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>colleague<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                colleague<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æŠ½è±¡åŒäº‹ç±»è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Colleague</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> Mediator mediator<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMediator</span><span class="token punctuation">(</span>Mediator mediator<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>mediator <span class="token operator">=</span> mediator<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * æ¥æ”¶ä¿¡æ¯     */</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">receive</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * å‘é€ä¿¡æ¯     * @param msg     */</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“åŒäº‹ç±»è§’è‰²A</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteColleagueA</span> <span class="token keyword">extends</span> <span class="token class-name">Colleague</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Colleague A got a message: "</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        mediator<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“åŒäº‹ç±»è§’è‰²B</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteColleagueB</span> <span class="token keyword">extends</span> <span class="token class-name">Colleague</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Colleague B got a message: "</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        mediator<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ConcreteMediator concreteMediator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteMediator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ConcreteColleagueA ca <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteColleagueA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ca<span class="token punctuation">.</span><span class="token function">setMediator</span><span class="token punctuation">(</span>concreteMediator<span class="token punctuation">)</span><span class="token punctuation">;</span>        ConcreteColleagueB cb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteColleagueB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        cb<span class="token punctuation">.</span><span class="token function">setMediator</span><span class="token punctuation">(</span>concreteMediator<span class="token punctuation">)</span><span class="token punctuation">;</span>        concreteMediator<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>ca<span class="token punctuation">)</span><span class="token punctuation">;</span>        concreteMediator<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>        ca<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Hello, I am A!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        cb<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Hello, I am B!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šColleague B got a message<span class="token operator">:</span> Hello<span class="token punctuation">,</span> I am A<span class="token operator">!</span>Colleague A got a message<span class="token operator">:</span> Hello<span class="token punctuation">,</span> I am B<span class="token operator">!</span></code></pre><p>ä¸­ä»‹è€…æ¨¡å¼æ€»ç»“</p><p>ä¸­ä»‹è€…æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼ï¼Œå…¶ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>é™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆæ€§ï¼Œä½¿å¾—å¯¹è±¡æ˜“äºç‹¬ç«‹åœ°è¢«å¤ç”¨ï¼›</p></li><li><p>å°†å¯¹è±¡é—´çš„ä¸€å¯¹å¤šå…³è”è½¬å˜ä¸ºä¸€å¯¹ä¸€çš„å…³è”ï¼Œæé«˜ç³»ç»Ÿçš„çµæ´»æ€§ï¼Œä½¿å¾—ç³»ç»Ÿæ˜“äºç»´æŠ¤å’Œæ‰©å±•ï¼›</p></li></ul><p>å…¶ä¸»è¦ç¼ºç‚¹æ˜¯ï¼šå½“åŒäº‹ç±»å¤ªå¤šæ—¶ï¼Œä¸­ä»‹è€…çš„èŒè´£å°†å¾ˆå¤§ï¼Œå®ƒä¼šå˜å¾—å¤æ‚è€Œåºå¤§ï¼Œä»¥è‡³äºç³»ç»Ÿéš¾ä»¥ç»´æŠ¤ã€‚</p><p>å‰é¢åˆ†æäº†ä¸­ä»‹è€…æ¨¡å¼çš„ç»“æ„ä¸ç‰¹ç‚¹ï¼Œä¸‹é¢åˆ†æå…¶ä»¥ä¸‹åº”ç”¨åœºæ™¯ï¼š</p><ul><li>å½“å¯¹è±¡ä¹‹é—´å­˜åœ¨å¤æ‚çš„ç½‘çŠ¶ç»“æ„å…³ç³»è€Œå¯¼è‡´ä¾èµ–å…³ç³»æ··ä¹±ä¸”éš¾ä»¥å¤ç”¨æ—¶ã€‚</li><li>å½“æƒ³åˆ›å»ºä¸€ä¸ªè¿è¡Œäºå¤šä¸ªç±»ä¹‹é—´çš„å¯¹è±¡ï¼Œåˆä¸æƒ³ç”Ÿæˆæ–°çš„å­ç±»æ—¶ã€‚</li></ul><h4 id="7-å‘½ä»¤æ¨¡å¼"><a href="#7-å‘½ä»¤æ¨¡å¼" class="headerlink" title="7.å‘½ä»¤æ¨¡å¼"></a>7.å‘½ä»¤æ¨¡å¼</h4><p>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œä¸ºäº†æ‰§è¡Œä¸€ä¸ªæ–¹æ³•ï¼Œå¼€å‘äººå‘˜ç»Ÿç­¹ä¼šå»è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚æœ‰è¿™ä¹ˆä¸€ç§æƒ…å†µå¹¶ä¸é€‚ç”¨åŸŸç›´æ¥å»è°ƒç”¨æ–¹æ³•ï¼Œé‚£å°±æ˜¯ä¸ºäº†æ‰§è¡ŒæŸä¸ªæ–¹æ³•ç³»ç»Ÿå¿…é¡»æ»¡è¶³ä¸€ä¸ªç‰¹å®šçš„æ‰§è¡Œé¡ºåºæˆ–è€…è¯­å¢ƒï¼Œä½†æ˜¯å¼€å‘äººå‘˜è®¾æ³•å»æ§åˆ¶è¿™ä¸ªç‰¹å®šçš„é¡ºåºæˆ–è¯­å¢ƒæ—¶ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•å°±æ˜¯æŠŠæ–¹æ³•å°è£…åœ¨ä¸€ä¸ªå¯¹è±¡å½“ä¸­ï¼Œè¿™å°±æ˜¯å‘½ä»¤æ¨¡å¼ã€‚</p><p>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œè¿™æ ·çš„ä¾‹å­ä¹Ÿæœ‰å¾ˆå¤šã€‚ä¾‹å¦‚ï¼Œç”µè§†é¥æ§å™¨(å‘½ä»¤å‘é€è€…)é€šè¿‡æŒ‰é’®(å…·ä½“å‘½ä»¤)æ¥é¥æ§ç”µè§†æœº(å‘½ä»¤çš„æ¥æ”¶è€…)ã€‚</p><p><strong>å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰</strong>å®šä¹‰ï¼šå°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œä½¿ç”¨æˆ·å¯ä»¥ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–ï¼›å¯¹è¯·æ±‚æ’é˜Ÿæˆ–è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œå¹¶æ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚</p><p>å‘½ä»¤æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š</p><ol><li><strong>æŠ½è±¡å‘½ä»¤ç±»ï¼ˆCommandï¼‰è§’è‰²</strong>ï¼šå£°æ˜æ‰§è¡Œå‘½ä»¤çš„æ¥å£ï¼Œæ‹¥æœ‰æ‰§è¡Œå‘½ä»¤çš„æŠ½è±¡æ–¹æ³• execute()ã€‚</li><li><strong>å…·ä½“å‘½ä»¤è§’è‰²ï¼ˆConcreteCommandï¼‰è§’è‰²</strong>ï¼šæ˜¯æŠ½è±¡å‘½ä»¤ç±»çš„å…·ä½“å®ç°ç±»ï¼Œå®ƒæ‹¥æœ‰æ¥æ”¶è€…å¯¹è±¡ï¼Œå¹¶é€šè¿‡è°ƒç”¨æ¥æ”¶è€…çš„åŠŸèƒ½æ¥å®Œæˆå‘½ä»¤è¦æ‰§è¡Œçš„æ“ä½œã€‚</li><li><strong>å®ç°è€…/æ¥æ”¶è€…ï¼ˆReceiverï¼‰è§’è‰²</strong>ï¼šæ‰§è¡Œå‘½ä»¤åŠŸèƒ½çš„ç›¸å…³æ“ä½œï¼Œæ˜¯å…·ä½“å‘½ä»¤å¯¹è±¡ä¸šåŠ¡çš„çœŸæ­£å®ç°è€…ã€‚</li><li><strong>è°ƒç”¨è€…/è¯·æ±‚è€…ï¼ˆInvokerï¼‰è§’è‰²</strong>ï¼šæ˜¯è¯·æ±‚çš„å‘é€è€…ï¼Œå®ƒé€šå¸¸æ‹¥æœ‰å¾ˆå¤šçš„å‘½ä»¤å¯¹è±¡ï¼Œå¹¶é€šè¿‡è®¿é—®å‘½ä»¤å¯¹è±¡æ¥æ‰§è¡Œç›¸å…³è¯·æ±‚ï¼Œå®ƒä¸ç›´æ¥è®¿é—®æ¥æ”¶è€…ã€‚</li></ol><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/CommandPattern.png" alt></p><p>ç¤ºä¾‹1</p><p>æŠ½è±¡å‘½ä»¤è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æŠ½è±¡å‘½ä»¤è§’è‰² * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“å‘½ä»¤è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“å‘½ä»¤è§’è‰² * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteCommand</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Receiver receiver<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">ConcreteCommand</span><span class="token punctuation">(</span>Receiver receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>receiver <span class="token operator">=</span> receiver<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        receiver<span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ¥æ”¶è€…è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å‘½ä»¤æ¥æ”¶è€…è§’è‰² * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Receiver</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¥æ”¶è€…: execute the request!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è°ƒç”¨è€…è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å‘½ä»¤è°ƒç”¨è€…è§’è‰² * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Invoker</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Command command<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCommand</span><span class="token punctuation">(</span>Command command<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>command <span class="token operator">=</span> command<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è°ƒç”¨è€…å‘å‡ºå‘½ä»¤..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>command<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å®¢æˆ·ç«¯ * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Receiver receiver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Receiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Command command <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteCommand</span><span class="token punctuation">(</span>receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>        Invoker invoker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Invoker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        invoker<span class="token punctuation">.</span><span class="token function">setCommand</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//å®¢æˆ·ç«¯è°ƒç”¨è°ƒç”¨è€…çš„callæ–¹æ³•</span>        invoker<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šè°ƒç”¨è€…å‘å‡ºå‘½ä»¤<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>æ¥æ”¶è€…<span class="token operator">:</span> execute the request<span class="token operator">!</span></code></pre><p>ç¤ºä¾‹2</p><p>æŠ½è±¡å‘½ä»¤è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æŠ½è±¡å‘½ä»¤è§’è‰² * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“å‘½ä»¤è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å¼€ç¯ï¼ˆå…·ä½“å‘½ä»¤è§’è‰²ï¼‰ * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwitchOnCommand</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> Light light<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">SwitchOnCommand</span><span class="token punctuation">(</span>Light light<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>light <span class="token operator">=</span> light<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        light<span class="token punctuation">.</span><span class="token function">turnOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“å‘½ä»¤è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…³ç¯ï¼ˆå…·ä½“å‘½ä»¤è§’è‰²ï¼‰ * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwitchOffCommand</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> Light light<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">SwitchOffCommand</span><span class="token punctuation">(</span>Light light<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>light <span class="token operator">=</span> light<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        light<span class="token punctuation">.</span><span class="token function">turnOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ¥æ”¶è€…è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * ç¯ï¼ˆå‘½ä»¤æ¥æ”¶è€…è§’è‰²ï¼‰ * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Light</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">turnOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"The light is on"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">turnOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"The light is off"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è°ƒç”¨è€…è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æ§åˆ¶å¼€å…³ï¼ˆè°ƒç”¨è€…è§’è‰²ï¼‰ * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Switch</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> HashMap<span class="token operator">&lt;</span>String <span class="token punctuation">,</span>Command<span class="token operator">></span> commandMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span>String cname<span class="token punctuation">,</span> Command command<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>commandMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>cname<span class="token punctuation">,</span> command<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span>String cname<span class="token punctuation">)</span><span class="token punctuation">{</span>        Command command <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>commandMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>cname<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"no command registered for "</span> <span class="token operator">+</span> cname<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        command<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Light lamp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Light</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Command switchOn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SwitchOnCommand</span><span class="token punctuation">(</span>lamp<span class="token punctuation">)</span><span class="token punctuation">;</span>        Command switchOff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SwitchOffCommand</span><span class="token punctuation">(</span>lamp<span class="token punctuation">)</span><span class="token punctuation">;</span>        Switch mySwitch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Switch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mySwitch<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">"on"</span><span class="token punctuation">,</span> switchOn<span class="token punctuation">)</span><span class="token punctuation">;</span>        mySwitch<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">"off"</span><span class="token punctuation">,</span> switchOff<span class="token punctuation">)</span><span class="token punctuation">;</span>        mySwitch<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"on"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mySwitch<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"off"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šThe light is onThe light is off</code></pre><p>å‘½ä»¤æ¨¡å¼æ€»ç»“</p><p>å‘½ä»¤æ¨¡å¼çš„ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>é™ä½ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚å‘½ä»¤æ¨¡å¼èƒ½å°†è°ƒç”¨æ“ä½œçš„å¯¹è±¡ä¸å®ç°è¯¥æ“ä½œçš„å¯¹è±¡è§£è€¦ã€‚</p></li><li><p>å¢åŠ æˆ–åˆ é™¤å‘½ä»¤éå¸¸æ–¹ä¾¿ã€‚é‡‡ç”¨å‘½ä»¤æ¨¡å¼å¢åŠ ä¸åˆ é™¤å‘½ä»¤ä¸ä¼šå½±å“å…¶ä»–ç±»ï¼Œå®ƒæ»¡è¶³â€œå¼€é—­åŸåˆ™â€ï¼Œå¯¹æ‰©å±•æ¯”è¾ƒçµæ´»ã€‚</p></li><li><p>å¯ä»¥å®ç°å®å‘½ä»¤ã€‚å‘½ä»¤æ¨¡å¼å¯ä»¥ä¸<strong>ç»„åˆæ¨¡å¼</strong>ç»“åˆï¼Œå°†å¤šä¸ªå‘½ä»¤è£…é…æˆä¸€ä¸ªç»„åˆå‘½ä»¤ï¼Œå³å®å‘½ä»¤ã€‚</p></li><li><p>æ–¹ä¾¿å®ç° Undo å’Œ Redo æ“ä½œã€‚å‘½ä»¤æ¨¡å¼å¯ä»¥ä¸å‰é¢ä»‹ç»çš„<strong>å¤‡å¿˜å½•æ¨¡å¼</strong>ç»“åˆï¼Œå®ç°å‘½ä»¤çš„æ’¤é”€ä¸æ¢å¤ã€‚</p></li></ul><p>å…¶ç¼ºç‚¹æ˜¯ï¼šå¯èƒ½äº§ç”Ÿå¤§é‡å…·ä½“å‘½ä»¤ç±»ã€‚å› ä¸ºè®¡å¯¹æ¯ä¸€ä¸ªå…·ä½“æ“ä½œéƒ½éœ€è¦è®¾è®¡ä¸€ä¸ªå…·ä½“å‘½ä»¤ç±»ï¼Œè¿™å°†å¢åŠ ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚</p><p>å‘½ä»¤æ¨¡å¼é€šå¸¸é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p><ul><li><p>å½“ç³»ç»Ÿéœ€è¦å°†è¯·æ±‚è°ƒç”¨è€…ä¸è¯·æ±‚æ¥æ”¶è€…è§£è€¦æ—¶ï¼Œå‘½ä»¤æ¨¡å¼ä½¿å¾—è°ƒç”¨è€…å’Œæ¥æ”¶è€…ä¸ç›´æ¥äº¤äº’ã€‚</p></li><li><p>å½“ç³»ç»Ÿéœ€è¦éšæœºè¯·æ±‚å‘½ä»¤æˆ–ç»å¸¸å¢åŠ æˆ–åˆ é™¤å‘½ä»¤æ—¶ï¼Œå‘½ä»¤æ¨¡å¼æ¯”è¾ƒæ–¹ä¾¿å®ç°è¿™äº›åŠŸèƒ½ã€‚</p></li><li><p>å½“ç³»ç»Ÿéœ€è¦æ‰§è¡Œä¸€ç»„æ“ä½œæ—¶ï¼Œå‘½ä»¤æ¨¡å¼å¯ä»¥å®šä¹‰å®å‘½ä»¤æ¥å®ç°è¯¥åŠŸèƒ½ã€‚</p></li><li><p>å½“ç³»ç»Ÿéœ€è¦æ”¯æŒå‘½ä»¤çš„æ’¤é”€ï¼ˆUndoï¼‰æ“ä½œå’Œæ¢å¤ï¼ˆRedoï¼‰æ“ä½œæ—¶ï¼Œå¯ä»¥å°†å‘½ä»¤å¯¹è±¡å­˜å‚¨èµ·æ¥ï¼Œé‡‡ç”¨å¤‡å¿˜å½•æ¨¡å¼æ¥å®ç°ã€‚</p></li></ul><h4 id="8-è®¿é—®è€…æ¨¡å¼"><a href="#8-è®¿é—®è€…æ¨¡å¼" class="headerlink" title="8.è®¿é—®è€…æ¨¡å¼"></a>8.è®¿é—®è€…æ¨¡å¼</h4><p>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæœ‰äº›é›†åˆå…ƒç´ å¯¹è±¡ä¸­å­˜åœ¨å¾ˆå¤šç§ä¸åŒçš„å…ƒç´ ä¸”æ¯ç§å…ƒç´ ä¹Ÿå­˜åœ¨è®¸å¤šç§ä¸åŒçš„è®¿é—®è€…å’Œå¤„ç†æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œå…¬å›­ä¸­å­˜åœ¨å¤šä¸ªæ™¯ç‚¹ï¼Œä¹Ÿå­˜åœ¨å¤šä¸ªæ¸¸å®¢ï¼Œä¸åŒçš„æ¸¸å®¢å¯¹åŒä¸€ä¸ªæ™¯ç‚¹çš„è¯„ä»·å¯èƒ½ä¸åŒï¼›ç”µå½±æˆ–ç”µè§†å‰§ä¸­çš„äººç‰©è§’è‰²ï¼Œä¸åŒçš„è§‚ä¼—å¯¹å®ƒä»¬çš„è¯„ä»·ä¹Ÿä¸åŒï¼Œâ€ä¸€åƒä¸ªè¯»è€…å¿ƒä¸­æœ‰ä¸€åƒä¸ªå“ˆå§†é›·ç‰¹â€ã€‚</p><p>è¿™äº›è¢«å¤„ç†çš„æ•°æ®å…ƒç´ ç›¸å¯¹ç¨³å®šè€Œè®¿é—®æ–¹å¼å¤šç§å¤šæ ·çš„æ•°æ®ç»“æ„ï¼Œå¦‚æœç”¨â€è®¿é—®è€…æ¨¡å¼â€æ¥å¤„ç†æ¯”è¾ƒæ–¹ä¾¿ã€‚è®¿é—®è€…æ¨¡å¼æ˜¯23ç§è®¾è®¡æ¨¡å¼ç§æœ€å¤æ‚ä¹Ÿæ˜¯æœ€éš¾ç†è§£çš„ä¸€ä¸ªï¼Œè®¿é—®è€…æ¨¡å¼èƒ½æŠŠå¤„ç†æ•°æ®æ–¹æ³•ä»æ•°æ®ç»“æ„ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå¹¶å¯ä»¥æ ¹æ®éœ€è¦å¢åŠ æ–°çš„å¤„ç†æ–¹æ³•ï¼Œä¸”ä¸ç”¨ä¿®æ”¹åŸç†çš„ç¨‹åºä»£ç ä¸æ•°æ®ç»“æ„ï¼Œè¿™æ ·æé«˜äº†ç¨‹åºçš„æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚</p><p><strong>è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰</strong>å®šä¹‰ï¼šå°†ä½œç”¨äºæŸç§æ•°æ®ç»“æ„ä¸­çš„å…ƒç´ çš„æ“ä½œåˆ†ç¦»å‡ºæ¥å°è£…æˆç‹¬ç«‹çš„ç±»ï¼Œä½¿å…¶åœ¨ä¸æ”¹å˜æ•°æ®ç»“æ„çš„å‰æä¸‹å¯ä»¥æ·»åŠ ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°çš„æ“ä½œï¼Œä¸ºæ•°æ®ç»“æ„ä¸­çš„æ¯ä¸ªå…ƒç´ æä¾›å¤šç§è®¿é—®æ–¹å¼ã€‚</p><p>è®¿é—®è€…æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š</p><ol><li><p><strong>æŠ½è±¡è®¿é—®è€…ï¼ˆVisitorï¼‰è§’è‰²</strong>ï¼šå®šä¹‰ä¸€ä¸ªè®¿é—®å…·ä½“å…ƒç´ çš„æ¥å£ï¼Œä¸ºæ¯ä¸ªå…·ä½“å…ƒç´ ç±»å¯¹åº”ä¸€ä¸ªè®¿é—®æ“ä½œ visit() ï¼Œè¯¥æ“ä½œä¸­çš„å‚æ•°ç±»å‹æ ‡è¯†äº†è¢«è®¿é—®çš„å…·ä½“å…ƒç´ ã€‚</p></li><li><p><strong>å…·ä½“è®¿é—®è€…ï¼ˆConcreteVisitorï¼‰è§’è‰²</strong>ï¼šå®ç°æŠ½è±¡è®¿é—®è€…è§’è‰²ä¸­å£°æ˜çš„å„ä¸ªè®¿é—®æ“ä½œï¼Œç¡®å®šè®¿é—®è€…è®¿é—®ä¸€ä¸ªå…ƒç´ æ—¶è¯¥åšä»€ä¹ˆã€‚</p></li><li><p><strong>æŠ½è±¡å…ƒç´ ï¼ˆElementï¼‰è§’è‰²</strong>ï¼šå£°æ˜ä¸€ä¸ªåŒ…å«æ¥å—æ“ä½œ accept() çš„æ¥å£ï¼Œè¢«æ¥å—çš„è®¿é—®è€…å¯¹è±¡ä½œä¸º accept() æ–¹æ³•çš„å‚æ•°ã€‚</p></li><li><p><strong>å…·ä½“å…ƒç´ ï¼ˆConcreteElementï¼‰è§’è‰²</strong>ï¼šå®ç°æŠ½è±¡å…ƒç´ è§’è‰²æä¾›çš„ accept() æ“ä½œï¼Œå…¶æ–¹æ³•ä½“é€šå¸¸éƒ½æ˜¯ visitor.visit(this) ï¼Œå¦å¤–å…·ä½“å…ƒç´ ä¸­å¯èƒ½è¿˜åŒ…å«æœ¬èº«ä¸šåŠ¡é€»è¾‘çš„ç›¸å…³æ“ä½œã€‚</p></li><li><p><strong>å¯¹è±¡ç»“æ„ï¼ˆObjectStructureï¼‰è§’è‰²</strong>ï¼šæ˜¯ä¸€ä¸ªåŒ…å«å…ƒç´ è§’è‰²çš„å®¹å™¨ï¼Œæä¾›è®©è®¿é—®è€…å¯¹è±¡éå†å®¹å™¨ä¸­çš„æ‰€æœ‰å…ƒç´ çš„æ–¹æ³•ï¼Œé€šå¸¸ç”± Listã€Setã€Map ç­‰èšåˆç±»å®ç°ã€‚</p><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/VisitorPattern.png" alt></p><p>ç¤ºä¾‹1</p><p>æŠ½è±¡è®¿é—®è€…</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æŠ½è±¡è®¿é—®è€…ç±» * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Visitor</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>ConcreteElementA elementA<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>ConcreteElementB elementB<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“è®¿é—®è€…A</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“è®¿é—®è€…A * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteVisitorA</span> <span class="token keyword">implements</span> <span class="token class-name">Visitor</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>ConcreteElementA elementA<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…·ä½“è®¿é—®è€…Aï¼š"</span> <span class="token operator">+</span> elementA<span class="token punctuation">.</span><span class="token function">operationA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>ConcreteElementB elementB<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…·ä½“è®¿é—®è€…Aï¼š"</span> <span class="token operator">+</span> elementB<span class="token punctuation">.</span><span class="token function">operationB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“è®¿é—®è€…B</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“è®¿é—®è€…B * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteVisitorB</span> <span class="token keyword">implements</span> <span class="token class-name">Visitor</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>ConcreteElementA elementA<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…·ä½“è®¿é—®è€…Bï¼š"</span> <span class="token operator">+</span> elementA<span class="token punctuation">.</span><span class="token function">operationA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>ConcreteElementB elementB<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…·ä½“è®¿é—®è€…Bï¼š"</span> <span class="token operator">+</span> elementB<span class="token punctuation">.</span><span class="token function">operationB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æŠ½è±¡å…ƒç´ ç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æŠ½è±¡å…ƒç´ ç±» * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Element</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>Visitor visitor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“å…ƒç´ ç±»A</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“å…ƒç´ A * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteElementA</span> <span class="token keyword">implements</span> <span class="token class-name">Element</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>Visitor visitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>        visitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">operationA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"å…·ä½“å…ƒç´ Açš„æ“ä½œã€‚"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“å…ƒç´ ç±»B</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“å…ƒç´ B * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteElementB</span> <span class="token keyword">implements</span> <span class="token class-name">Element</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>Visitor visitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>        visitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">operationB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"å…·ä½“å…ƒç´ Bçš„æ“ä½œã€‚"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å¯¹è±¡ç»“æ„</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å¯¹è±¡ç»“æ„ç±» * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ObjectStructure</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>Element<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>Element<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>Visitor visitor<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        Iterator<span class="token operator">&lt;</span>Element<span class="token operator">></span> i<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            Element element <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            element<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>visitor<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>Element element<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span>Element element<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å®¢æˆ·ç«¯ * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ObjectStructure objectStructure <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectStructure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        objectStructure<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcreteElementA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        objectStructure<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcreteElementB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Visitor visitor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteVisitorA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        objectStructure<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>visitor<span class="token punctuation">)</span><span class="token punctuation">;</span>        visitor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteVisitorB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        objectStructure<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>visitor<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šå…·ä½“è®¿é—®è€…Aï¼šå…·ä½“å…ƒç´ Açš„æ“ä½œã€‚å…·ä½“è®¿é—®è€…Aï¼šå…·ä½“å…ƒç´ Bçš„æ“ä½œã€‚å…·ä½“è®¿é—®è€…Bï¼šå…·ä½“å…ƒç´ Açš„æ“ä½œã€‚å…·ä½“è®¿é—®è€…Bï¼šå…·ä½“å…ƒç´ Bçš„æ“ä½œã€‚</code></pre><p>ç¤ºä¾‹2</p><p>æŠ½è±¡è®¿é—®ç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æŠ½è±¡è®¿é—®ç±» * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CarElementVisitor</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Body body<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Car car<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Engine engine<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Wheel wheel<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“è®¿é—®ç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“è®¿é—®ç±» * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CarElementDoVisitor</span> <span class="token keyword">implements</span> <span class="token class-name">CarElementVisitor</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Body body<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Moving my body"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Car car<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Starting my car"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Engine engine<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Starting my engine"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Wheel wheel<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Kicking my "</span> <span class="token operator">+</span> wheel<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" wheel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“è®¿é—®ç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“è®¿é—®ç±» * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CarElementPrintVisitor</span> <span class="token keyword">implements</span> <span class="token class-name">CarElementVisitor</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Body body<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Visiting body"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Car car<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Visiting car"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Engine engine<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Visiting engine"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Wheel wheel<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Visiting "</span> <span class="token operator">+</span> wheel<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" wheel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æŠ½è±¡å…ƒç´ ç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æŠ½è±¡å…ƒç´ ç±» * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CarElement</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>CarElementVisitor visitor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“å…ƒç´ ç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * ï¼ˆè½¦è½®ï¼‰å…·ä½“å…ƒç´ ç±» * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Wheel</span> <span class="token keyword">implements</span> <span class="token class-name">CarElement</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> String name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Wheel</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>CarElementVisitor visitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>        visitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“å…ƒç´ ç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * ï¼ˆå‘åŠ¨æœºï¼‰å…·ä½“å…ƒç´ ç±» * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Engine</span> <span class="token keyword">implements</span> <span class="token class-name">CarElement</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>CarElementVisitor visitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>        visitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“å…ƒç´ ç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * ï¼ˆè½¦èº«ï¼‰å…·ä½“å…ƒç´ ç±» * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Body</span> <span class="token keyword">implements</span> <span class="token class-name">CarElement</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>CarElementVisitor visitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>        visitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å¯¹è±¡ç»“æ„ç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å¯¹è±¡ç»“æ„ç±» * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token keyword">implements</span> <span class="token class-name">CarElement</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> List<span class="token operator">&lt;</span>CarElement<span class="token operator">></span> elements<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        List<span class="token operator">&lt;</span>CarElement<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Wheel</span><span class="token punctuation">(</span><span class="token string">"front left"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Wheel</span><span class="token punctuation">(</span><span class="token string">"front right"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Wheel</span><span class="token punctuation">(</span><span class="token string">"back left"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Wheel</span><span class="token punctuation">(</span><span class="token string">"back right"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Engine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>elements <span class="token operator">=</span> list<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>CarElementVisitor visitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>CarElement element <span class="token operator">:</span> elements<span class="token punctuation">)</span><span class="token punctuation">{</span>            element<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>visitor<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        visitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯ç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å®¢æˆ·ç«¯ç±» * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Car car <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        car<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CarElementPrintVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        car<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CarElementDoVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šVisiting front left wheelVisiting front right wheelVisiting back left wheelVisiting back right wheelVisiting bodyVisiting engineVisiting carKicking my front left wheelKicking my front right wheelKicking my back left wheelKicking my back right wheelMoving my bodyStarting my engineStarting my car</code></pre><p>è®¿é—®è€…æ¨¡å¼æ€»ç»“</p><p>è®¿é—®è€…ï¼ˆVisitorï¼‰æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼ï¼Œå…¶ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>æ‰©å±•æ€§å¥½ï¼šèƒ½å¤Ÿåœ¨ä¸ä¿®æ”¹å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œä¸ºå¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚</p></li><li><p>å¤ç”¨æ€§å¥½ï¼šå¯ä»¥é€šè¿‡è®¿é—®è€…æ¥å®šä¹‰æ•´ä¸ªå¯¹è±¡ç»“æ„é€šç”¨çš„åŠŸèƒ½ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¤ç”¨ç¨‹åº¦ã€‚</p></li><li><p>çµæ´»æ€§å¥½ï¼šè®¿é—®è€…æ¨¡å¼å°†æ•°æ®ç»“æ„ä¸ä½œç”¨äºç»“æ„ä¸Šçš„æ“ä½œè§£è€¦ï¼Œä½¿å¾—æ“ä½œé›†åˆå¯ç›¸å¯¹è‡ªç”±åœ°æ¼”åŒ–è€Œä¸å½±å“ç³»ç»Ÿçš„æ•°æ®ç»“æ„ã€‚</p></li><li><p>ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ï¼šè®¿é—®è€…æ¨¡å¼æŠŠç›¸å…³çš„è¡Œä¸ºå°è£…åœ¨ä¸€èµ·ï¼Œæ„æˆä¸€ä¸ªè®¿é—®è€…ï¼Œä½¿æ¯ä¸€ä¸ªè®¿é—®è€…çš„åŠŸèƒ½éƒ½æ¯”è¾ƒå•ä¸€ã€‚</p></li></ul><p>è®¿é—®è€…ï¼ˆVisitorï¼‰æ¨¡å¼çš„ä¸»è¦ç¼ºç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>å¢åŠ æ–°çš„å…ƒç´ ç±»å¾ˆå›°éš¾ï¼šåœ¨è®¿é—®è€…æ¨¡å¼ä¸­ï¼Œæ¯å¢åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ ç±»ï¼Œéƒ½è¦åœ¨æ¯ä¸€ä¸ªå…·ä½“è®¿é—®è€…ç±»ä¸­å¢åŠ ç›¸åº”çš„å…·ä½“æ“ä½œï¼Œè¿™è¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€ã€‚</p></li><li><p>ç ´åå°è£…ï¼šè®¿é—®è€…æ¨¡å¼ä¸­å…·ä½“å…ƒç´ å¯¹è®¿é—®è€…å…¬å¸ƒç»†èŠ‚ï¼Œè¿™ç ´åäº†å¯¹è±¡çš„å°è£…æ€§ã€‚</p></li><li><p>è¿åäº†ä¾èµ–å€’ç½®åŸåˆ™ï¼šè®¿é—®è€…æ¨¡å¼ä¾èµ–äº†å…·ä½“ç±»ï¼Œè€Œæ²¡æœ‰ä¾èµ–æŠ½è±¡ç±»ã€‚</p></li></ul><p>è®¿é—®è€…æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li><p>å½“ä¸€ä¸ªå¯¹è±¡ç»“æ„åŒ…å«å¾ˆå¤šç±»å¯¹è±¡ï¼Œä½†æ˜¯å®ƒæ¢¦æœ‰ä¸åŒçš„æ¥å£ï¼Œå¹¶ä¸”å¼€å‘äººå‘˜å¸Œæœ›å¯¹è¿™äº›å¯¹è±¡å®æ–½ä¸€äº›ä¾èµ–äºå…¶å…·ä½“ç±»çš„æ“ä½œæ—¶ï¼›</p></li><li><p>å½“éœ€è¦å¯¹ä¸€ä¸ªå¯¹è±¡ç»“æ„ä¸­çš„å¯¹è±¡è¿›è¡Œå¾ˆå¤šä¸åŒçš„å¹¶ä¸”ä¸ç›¸å…³çš„æ“ä½œæ—¶ï¼›</p></li><li><p>å½“è¯¥å¯¹è±¡ç»“æ„è¢«å¾ˆå¤šåº”ç”¨å…±äº«æ—¶ã€‚</p></li></ul></li></ol><h4 id="9-èŒè´£é“¾æ¨¡å¼"><a href="#9-èŒè´£é“¾æ¨¡å¼" class="headerlink" title="9.èŒè´£é“¾æ¨¡å¼"></a>9.èŒè´£é“¾æ¨¡å¼</h4><p>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæœ‰è¿™æ ·çš„ä¸€äº›ä¾‹å­ï¼šä¸€ä¸ªç”³è¯·æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†ï¼Œä½†æ˜¯æ¯ä¸ªå¯¹è±¡çš„å¤„ç†çš„æ¡ä»¶æˆ–æƒé™ä¸åŒã€‚ä¾‹å¦‚ï¼Œå…¬å¸å‘˜å·¥è¯·å‡ï¼Œå¯ä»¥æ‰¹å‡çš„é¢†å¯¼æœ‰éƒ¨é—¨è´Ÿè´£äººã€å‰¯æ€»ç»ç†ã€æ€»ç»ç†ï¼Œä½†æ¯ä¸ªé¢†å¯¼èƒ½æ‰¹å‡†çš„å¤©æ•°ä¸åŒï¼Œå‘˜å·¥å¿…é¡»æ ¹æ®è‡ªå·±è¦è¯·å‡çš„å¤©æ•°å»æ‰¾ä¸åŒçš„é¢†å¯¼ç­¾åï¼Œå°±æ˜¯è¯´å‘˜å·¥å¿…é¡»è®°ä½æ¯ä¸ªé¢†å¯¼çš„å§“åã€ç”µè¯å’Œåœ°å€ç­‰ä¿¡æ¯ï¼Œè¿™å¢åŠ äº†éš¾åº¦ã€‚</p><p>åœ¨è®¡ç®—æœºè½¯ä»¶ä¸­ä¹Ÿæœ‰ç›¸å…³çš„ä¾‹å­ï¼ŒStruts2çš„æ‹¦æˆªå™¨ã€JSPå’ŒServletçš„Filterç­‰ï¼Œæ‰€æœ‰è¿™äº›éƒ½æ˜¯èŒè´£é“¾æ¨¡å¼çš„ä½“ç°ã€‚</p><p><strong>èŒè´£é“¾ï¼ˆChain Of Responsibilityï¼‰æ¨¡å¼</strong>å®šä¹‰ï¼šä¸ºäº†é¿å…è¯·æ±‚å‘é€è€…ä¸å¤šä¸ªè¯·æ±‚å¤„ç†è€…è€¦åˆåœ¨ä¸€èµ·ï¼Œå°†è¯·æ±‚çš„æ‰€æœ‰å¤„ç†è€…è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯¥è¯·æ±‚ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚</p><p>èŒè´£é“¾æ¨¡å¼ä¸»è¦åŒ…å«ä»¥ä¸‹è§’è‰²ï¼š</p><ol><li><strong>æŠ½è±¡å¤„ç†è€…ï¼ˆHandlerï¼‰è§’è‰²</strong>ï¼šå®šä¹‰ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æ¥å£ï¼ŒåŒ…å«æŠ½è±¡å¤„ç†æ–¹æ³•å’Œä¸€ä¸ªåç»§è¿æ¥ã€‚</li><li><strong>å…·ä½“å¤„ç†è€…ï¼ˆConcreteHandlerï¼‰è§’è‰²</strong>ï¼šå®ç°æŠ½è±¡å¤„ç†è€…çš„å¤„ç†æ–¹æ³•ï¼Œåˆ¤æ–­èƒ½å¦å¤„ç†æœ¬æ¬¡è¯·æ±‚ï¼Œå¦‚æœå¯ä»¥å¤„ç†è¯·æ±‚åˆ™å¤„ç†ï¼Œå¦åˆ™å°†è¯¥è¯·æ±‚è½¬ç»™å®ƒçš„åç»§è€…ã€‚</li><li><strong>å®¢æˆ·ç±»ï¼ˆClientï¼‰è§’è‰²</strong>ï¼šåˆ›å»ºå¤„ç†é“¾ï¼Œå¹¶å‘é“¾å¤´çš„å…·ä½“å¤„ç†è€…å¯¹è±¡æäº¤è¯·æ±‚ï¼Œå®ƒä¸å…³å¿ƒå¤„ç†ç»†èŠ‚å’Œè¯·æ±‚çš„ä¼ é€’è¿‡ç¨‹ã€‚</li></ol><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/ChainOfResponsibilityPattern.png" alt></p><p>ç¤ºä¾‹1</p><p>æŠ½è±¡å¤„ç†è€…è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** *  å¤„ç†è¯·æ±‚æ¥å£ * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Handler</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> Handler next<span class="token punctuation">;</span>    <span class="token keyword">public</span> Handler <span class="token function">getNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> next<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNext</span><span class="token punctuation">(</span>Handler next<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * æŠ½è±¡å¤„ç†è¯·æ±‚æ–¹æ³•     * @param request     */</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span>String request<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“å¤„ç†è€…è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“å¤„ç†è€…1 * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteHandler1</span> <span class="token keyword">extends</span> <span class="token class-name">Handler</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span>String request<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"first"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…·ä½“å¤„ç†è€…1è´Ÿè´£å¤„ç†è¯¥è¯·æ±‚ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"è‡ªèº«æ— æ³•æ»¡è¶³è¯·æ±‚ï¼Œè½¬ç»™ä¸‹ä¸€ä¸ªå¤„ç†è€…ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">getNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ²¡æœ‰äººå¤„ç†è¯¥è¯·æ±‚ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span></code></pre><p>å…·ä½“å¤„ç†è€…è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * * å…·ä½“å¤„ç†è€…1 * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteHandler2</span> <span class="token keyword">extends</span> <span class="token class-name">Handler</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span>String request<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"second"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…·ä½“å¤„ç†è€…2è´Ÿè´£å¤„ç†è¯¥è¯·æ±‚ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"è‡ªèº«æ— æ³•æ»¡è¶³è¯·æ±‚ï¼Œè½¬ç»™ä¸‹ä¸€ä¸ªå¤„ç†è€…ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">getNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ²¡æœ‰äººå¤„ç†è¯¥è¯·æ±‚ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å®¢æˆ·ç«¯ * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Handler handler1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteHandler1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Handler handler2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteHandler2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        handler1<span class="token punctuation">.</span><span class="token function">setNext</span><span class="token punctuation">(</span>handler2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æäº¤è¯·æ±‚</span>        handler1<span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token string">"second"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šcom<span class="token punctuation">.</span>lancq<span class="token punctuation">.</span>behaviorpattern<span class="token punctuation">.</span>chainofresponsibility<span class="token punctuation">.</span>ConcreteHandler1è‡ªèº«æ— æ³•æ»¡è¶³è¯·æ±‚ï¼Œè½¬ç»™ä¸‹ä¸€ä¸ªå¤„ç†è€…ï¼å…·ä½“å¤„ç†è€…<span class="token number">2</span>è´Ÿè´£å¤„ç†è¯¥è¯·æ±‚ï¼</code></pre><p>ç¤ºä¾‹2ï¼šæ—¥å¿—æ‰“å°</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">enum</span> LogLevel <span class="token punctuation">{</span>    INFO<span class="token punctuation">,</span> DEBUG<span class="token punctuation">,</span> WARNING<span class="token punctuation">,</span> ERROR<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æŠ½è±¡å¤„ç†è€…è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**æŠ½è±¡å¤„ç†è€…è§’è‰² * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> LogLevel logMask<span class="token punctuation">;</span>    <span class="token keyword">protected</span> Logger next<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Logger</span><span class="token punctuation">(</span>LogLevel mask<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>logMask <span class="token operator">=</span> mask<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Logger <span class="token function">setNext</span><span class="token punctuation">(</span>Logger nextLogger<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> nextLogger<span class="token punctuation">;</span>        <span class="token keyword">return</span> nextLogger<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">message</span><span class="token punctuation">(</span>String msg<span class="token punctuation">,</span> LogLevel severity<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>logMask <span class="token operator">==</span> severity<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">writeMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            next<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> severity<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">abstract</span> <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">writeMessage</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“å¤„ç†è€…è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“å¤„ç†è¯·æ±‚è§’è‰² * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsoleLogger</span> <span class="token keyword">extends</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">ConsoleLogger</span><span class="token punctuation">(</span>LogLevel mask<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">writeMessage</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Writing to console: "</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“å¤„ç†è€…è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“å¤„ç†è¯·æ±‚è§’è‰² * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmailLogger</span> <span class="token keyword">extends</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">EmailLogger</span><span class="token punctuation">(</span>LogLevel mask<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">writeMessage</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Sending via email: "</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“å¤„ç†è€…è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“å¤„ç†è¯·æ±‚è§’è‰² * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileLogger</span> <span class="token keyword">extends</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">FileLogger</span><span class="token punctuation">(</span>LogLevel mask<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">writeMessage</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Writing to Log File: "</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å®¢æˆ·ç«¯ * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Logger logger<span class="token punctuation">,</span> logger1<span class="token punctuation">,</span> logger2<span class="token punctuation">;</span>        logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConsoleLogger</span><span class="token punctuation">(</span>LogLevel<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span><span class="token punctuation">;</span>        logger1 <span class="token operator">=</span> logger<span class="token punctuation">.</span><span class="token function">setNext</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EmailLogger</span><span class="token punctuation">(</span>LogLevel<span class="token punctuation">.</span>WARNING<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger2 <span class="token operator">=</span> logger1<span class="token punctuation">.</span><span class="token function">setNext</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileLogger</span><span class="token punctuation">(</span>LogLevel<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"Entering function ProcessOrder()."</span><span class="token punctuation">,</span> LogLevel<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"Customer Address details missing in Branch DataBase."</span><span class="token punctuation">,</span> LogLevel<span class="token punctuation">.</span>WARNING<span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"Customer Address details missing in Organization DataBase."</span><span class="token punctuation">,</span> LogLevel<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šWriting to console<span class="token operator">:</span> Entering function <span class="token function">ProcessOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Sending via email<span class="token operator">:</span> Customer Address details missing in Branch DataBase<span class="token punctuation">.</span>Writing to Log File<span class="token operator">:</span> Customer Address details missing in Organization DataBase<span class="token punctuation">.</span></code></pre><p>èŒè´£é“¾æ¨¡å¼æ€»ç»“</p><p>è´£ä»»é“¾æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼ï¼Œå…¶ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li>é™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ã€‚è¯¥æ¨¡å¼ä½¿å¾—ä¸€ä¸ªå¯¹è±¡æ— é¡»çŸ¥é“åˆ°åº•æ˜¯å“ªä¸€ä¸ªå¯¹è±¡å¤„ç†å…¶è¯·æ±‚ä»¥åŠé“¾çš„ç»“æ„ï¼Œå‘é€è€…å’Œæ¥æ”¶è€…ä¹Ÿæ— é¡»æ‹¥æœ‰å¯¹æ–¹çš„æ˜ç¡®ä¿¡æ¯ã€‚</li><li>å¢å¼ºäº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚å¯ä»¥æ ¹æ®éœ€è¦å¢åŠ æ–°çš„è¯·æ±‚å¤„ç†ç±»ï¼Œæ»¡è¶³å¼€é—­åŸåˆ™ã€‚</li><li>å¢å¼ºäº†ç»™å¯¹è±¡æŒ‡æ´¾èŒè´£çš„çµæ´»æ€§ã€‚å½“å·¥ä½œæµç¨‹å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥åŠ¨æ€åœ°æ”¹å˜é“¾å†…çš„æˆå‘˜æˆ–è€…è°ƒåŠ¨å®ƒä»¬çš„æ¬¡åºï¼Œä¹Ÿå¯åŠ¨æ€åœ°æ–°å¢æˆ–è€…åˆ é™¤è´£ä»»ã€‚</li><li>è´£ä»»é“¾ç®€åŒ–äº†å¯¹è±¡ä¹‹é—´çš„è¿æ¥ã€‚æ¯ä¸ªå¯¹è±¡åªéœ€ä¿æŒä¸€ä¸ªæŒ‡å‘å…¶åç»§è€…çš„å¼•ç”¨ï¼Œä¸éœ€ä¿æŒå…¶ä»–æ‰€æœ‰å¤„ç†è€…çš„å¼•ç”¨ï¼Œè¿™é¿å…äº†ä½¿ç”¨ä¼—å¤šçš„ if æˆ–è€… ifÂ·Â·Â·else è¯­å¥ã€‚</li><li>è´£ä»»åˆ†æ‹…ã€‚æ¯ä¸ªç±»åªéœ€è¦å¤„ç†è‡ªå·±è¯¥å¤„ç†çš„å·¥ä½œï¼Œä¸è¯¥å¤„ç†çš„ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¯¹è±¡å®Œæˆï¼Œæ˜ç¡®å„ç±»çš„è´£ä»»èŒƒå›´ï¼Œç¬¦åˆç±»çš„å•ä¸€èŒè´£åŸåˆ™ã€‚</li></ul><p>å…¶ä¸»è¦ç¼ºç‚¹å¦‚ä¸‹ï¼š</p><ul><li>ä¸èƒ½ä¿è¯æ¯ä¸ªè¯·æ±‚ä¸€å®šè¢«å¤„ç†ã€‚ç”±äºä¸€ä¸ªè¯·æ±‚æ²¡æœ‰æ˜ç¡®çš„æ¥æ”¶è€…ï¼Œæ‰€ä»¥ä¸èƒ½ä¿è¯å®ƒä¸€å®šä¼šè¢«å¤„ç†ï¼Œè¯¥è¯·æ±‚å¯èƒ½ä¸€ç›´ä¼ åˆ°é“¾çš„æœ«ç«¯éƒ½å¾—ä¸åˆ°å¤„ç†ã€‚</li><li>å¯¹æ¯”è¾ƒé•¿çš„èŒè´£é“¾ï¼Œè¯·æ±‚çš„å¤„ç†å¯èƒ½æ¶‰åŠå¤šä¸ªå¤„ç†å¯¹è±¡ï¼Œç³»ç»Ÿæ€§èƒ½å°†å—åˆ°ä¸€å®šå½±å“ã€‚</li><li>èŒè´£é“¾å»ºç«‹çš„åˆç†æ€§è¦é å®¢æˆ·ç«¯æ¥ä¿è¯ï¼Œå¢åŠ äº†å®¢æˆ·ç«¯çš„å¤æ‚æ€§ï¼Œå¯èƒ½ä¼šç”±äºèŒè´£é“¾çš„é”™è¯¯è®¾ç½®è€Œå¯¼è‡´ç³»ç»Ÿå‡ºé”™ï¼Œå¦‚å¯èƒ½ä¼šé€ æˆå¾ªç¯è°ƒç”¨ã€‚</li></ul><p>è´£ä»»é“¾æ¨¡å¼é€šå¸¸åœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä½¿ç”¨ï¼š</p><ul><li><p>æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œå“ªä¸ªå¯¹è±¡å¤„ç†è¯¥è¯·æ±‚ç”±è¿è¡Œæ—¶åˆ»è‡ªåŠ¨ç¡®å®šã€‚</p></li><li><p>å¯åŠ¨æ€æŒ‡å®šä¸€ç»„å¯¹è±¡å¤„ç†è¯·æ±‚ï¼Œæˆ–æ·»åŠ æ–°çš„å¤„ç†è€…ã€‚</p></li><li><p>åœ¨ä¸æ˜ç¡®æŒ‡å®šè¯·æ±‚å¤„ç†è€…çš„æƒ…å†µä¸‹ï¼Œå‘å¤šä¸ªå¤„ç†è€…ä¸­çš„ä¸€ä¸ªæäº¤è¯·æ±‚ã€‚</p></li></ul><h4 id="10-è¿­ä»£å™¨æ¨¡å¼"><a href="#10-è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="10.è¿­ä»£å™¨æ¨¡å¼"></a>10.è¿­ä»£å™¨æ¨¡å¼</h4><p>è¿­ä»£å™¨æ¨¡å¼æ›¾ç»æ˜¯ä¸€ç§æœ€å¸¸è§ã€æœ€ç®€å•çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒæä¾›ä¸€ç§é¡ºåºè®¿é—®æŸä¸ªé›†åˆä¸­æ‰€æœ‰å…ƒç´ çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œä¸ç”¨äº†è§£é›†åˆåº•å±‚çš„æ“ä½œã€‚è™½ç„¶ç°åœ¨ä¿¡æ¯çš„è¯­è¨€å½“ä¸­éƒ½å°†è¿­ä»£å™¨é›†æˆäº†è¿›å»ï¼Œä½†æ˜¯è®¨è®ºè¿­ä»£å™¨æ¨¡å¼çš„å®ç°å¯¹äºæˆ‘ä»¬ç†è§£é¢å‘å¯¹è±¡å¼€å‘è€Œè¨€ä»»ç„¶æœ‰å™¨å­¦ä¹ ä»·å€¼å­˜åœ¨ã€‚</p><p>å°†éå†èšåˆå¯¹è±¡ä¸­æ•°æ®çš„è¡Œä¸ºæå–å‡ºæ¥ï¼Œå¹¶æŠŠå…¶å°è£…åˆ°ä¸€ä¸ªè¿­ä»£å™¨ä¸­ï¼Œé€šè¿‡è½¬å…¥çš„è¿­ä»£å™¨å»éå†èšåˆå¯¹è±¡çš„å†…éƒ¨æ•°æ®ï¼Œè¿™æ˜¯è¿­ä»£å™¨æ¨¡å¼çš„æœ¬è´¨ã€‚è¿­ä»£å™¨æ¨¡å¼æ˜¯â€å•ä¸€èŒè´£â€çš„å®Œç¾ä½“ç°ã€‚åœ¨Javaä¸­ï¼ŒListã€Setã€Mapéƒ½åŒ…å«äº†è¿­ä»£å™¨ã€‚</p><p><strong>è¿­ä»£å™¨ï¼ˆIteratorï¼‰æ¨¡å¼</strong>å®šä¹‰ï¼šæä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸ä¿ç•™è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚</p><p>è¿­ä»£å™¨æ¨¡å¼ä¸»è¦åŒ…å«ä»¥ä¸‹è§’è‰²ï¼š</p><ol><li><strong>æŠ½è±¡èšåˆï¼ˆAggregateï¼‰è§’è‰²</strong>ï¼šå®šä¹‰å­˜å‚¨ã€æ·»åŠ ã€åˆ é™¤èšåˆå¯¹è±¡ä»¥åŠåˆ›å»ºè¿­ä»£å™¨å¯¹è±¡çš„æ¥å£ã€‚</li><li><strong>å…·ä½“èšåˆï¼ˆConcreteAggregateï¼‰è§’è‰²</strong>ï¼šå®ç°æŠ½è±¡èšåˆç±»ï¼Œè¿”å›ä¸€ä¸ªå…·ä½“è¿­ä»£å™¨çš„å®ä¾‹ã€‚</li><li><strong>æŠ½è±¡è¿­ä»£å™¨ï¼ˆIteratorï¼‰è§’è‰²</strong>ï¼šå®šä¹‰è®¿é—®å’Œéå†èšåˆå…ƒç´ çš„æ¥å£ï¼Œé€šå¸¸åŒ…å« hasNext()ã€first()ã€next() ç­‰æ–¹æ³•ã€‚</li><li><strong>å…·ä½“è¿­ä»£å™¨ï¼ˆConcretelteratorï¼‰è§’è‰²</strong>ï¼šå®ç°æŠ½è±¡è¿­ä»£å™¨æ¥å£ä¸­æ‰€å®šä¹‰çš„æ–¹æ³•ï¼Œå®Œæˆå¯¹èšåˆå¯¹è±¡çš„éå†ï¼Œè®°å½•éå†çš„å½“å‰ä½ç½®ã€‚</li></ol><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/IteratorPattern.png" alt></p><p>ç¤ºä¾‹</p><p>æŠ½è±¡èšåˆè§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æŠ½è±¡èšåˆè§’è‰² * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Aggregate</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>Object obj<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span>Object obj<span class="token punctuation">)</span><span class="token punctuation">;</span>    Iterator <span class="token function">createIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“èšåˆè§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“èšåˆè§’è‰² * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteAggregate</span> <span class="token keyword">implements</span> <span class="token class-name">Aggregate</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>Object<span class="token operator">></span> items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>Object obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>        items<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span>Object obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>        items<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Iterator <span class="token function">createIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteIterator</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>Object<span class="token operator">></span> <span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> items<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æŠ½è±¡è¿­ä»£å™¨è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æŠ½è±¡è¿­ä»£å™¨è§’è‰² * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Iterator</span> <span class="token punctuation">{</span>    Object <span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Object <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“è¿­ä»£å™¨è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å…·ä½“è¿­ä»£å™¨è§’è‰² * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteIterator</span> <span class="token keyword">implements</span> <span class="token class-name">Iterator</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> ConcreteAggregate aggregate<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">ConcreteIterator</span><span class="token punctuation">(</span>ConcreteAggregate concreteAggregate<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>aggregate <span class="token operator">=</span> concreteAggregate<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Object <span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> aggregate<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Object <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        Object obj <span class="token operator">=</span> null<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>aggregate<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>aggregate<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> obj<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> index <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>aggregate<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å®¢æˆ·ç«¯ * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ConcreteAggregate aggregate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteAggregate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            aggregate<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"ã€"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"ã€‘å·æ±‚èŒè€…"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        Iterator iterator <span class="token operator">=</span> aggregate<span class="token punctuation">.</span><span class="token function">createIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¯·"</span> <span class="token operator">+</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"åˆ°ç¬¬"</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"ä¼šè®®å®¤å‚åŠ é¢è¯•ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šè¯·ã€<span class="token number">1</span>ã€‘å·æ±‚èŒè€…åˆ°ç¬¬<span class="token number">3</span>ä¼šè®®å®¤å‚åŠ é¢è¯•ï¼è¯·ã€<span class="token number">2</span>ã€‘å·æ±‚èŒè€…åˆ°ç¬¬<span class="token number">5</span>ä¼šè®®å®¤å‚åŠ é¢è¯•ï¼è¯·ã€<span class="token number">3</span>ã€‘å·æ±‚èŒè€…åˆ°ç¬¬<span class="token number">4</span>ä¼šè®®å®¤å‚åŠ é¢è¯•ï¼è¯·ã€<span class="token number">4</span>ã€‘å·æ±‚èŒè€…åˆ°ç¬¬<span class="token number">3</span>ä¼šè®®å®¤å‚åŠ é¢è¯•ï¼è¯·ã€<span class="token number">5</span>ã€‘å·æ±‚èŒè€…åˆ°ç¬¬<span class="token number">4</span>ä¼šè®®å®¤å‚åŠ é¢è¯•ï¼è¯·ã€<span class="token number">6</span>ã€‘å·æ±‚èŒè€…åˆ°ç¬¬<span class="token number">3</span>ä¼šè®®å®¤å‚åŠ é¢è¯•ï¼è¯·ã€<span class="token number">7</span>ã€‘å·æ±‚èŒè€…åˆ°ç¬¬<span class="token number">5</span>ä¼šè®®å®¤å‚åŠ é¢è¯•ï¼è¯·ã€<span class="token number">8</span>ã€‘å·æ±‚èŒè€…åˆ°ç¬¬<span class="token number">4</span>ä¼šè®®å®¤å‚åŠ é¢è¯•ï¼è¯·ã€<span class="token number">9</span>ã€‘å·æ±‚èŒè€…åˆ°ç¬¬<span class="token number">5</span>ä¼šè®®å®¤å‚åŠ é¢è¯•ï¼è¯·ã€<span class="token number">10</span>ã€‘å·æ±‚èŒè€…åˆ°ç¬¬<span class="token number">2</span>ä¼šè®®å®¤å‚åŠ é¢è¯•ï¼</code></pre><p>è¿­ä»£å™¨æ¨¡å¼æ€»ç»“</p><p>ä¸»è¦ä¼˜ç‚¹ï¼š</p><ul><li><p>è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹è€Œæ— é¡»æš´éœ²å®ƒçš„å†…éƒ¨è¡¨ç¤ºï¼›</p></li><li><p>éå†ä»»åŠ¡äº¤ç”±è¿­ä»£å™¨å®Œæˆï¼Œè¿™ç®€åŒ–äº†èšåˆç±»ï¼›</p></li><li><p>å®ƒæ”¯æŒä»¥ä¸åŒæ–¹å¼éå†ä¸€ä¸ªèšåˆï¼Œç”šè‡³å¯ä»¥è‡ªå®šä¹‰è¿­ä»£å™¨çš„å­ç±»ä»¥æ”¯æŒæ–°çš„éå†ï¼›</p></li><li><p>å¢åŠ æ–°çš„èšåˆç±»å’Œè¿­ä»£å™¨ç±»éƒ½å¾ˆæ–¹ä¾¿ï¼Œæ— é¡»ä¿®æ”¹åŸæœ‰ä»£ç ï¼›</p></li><li><p>å°è£…æ€§è‰¯å¥½ï¼Œä¸ºéå†ä¸åŒçš„èšåˆç»“æ„æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼›</p></li></ul><p>å…¶ä¸»è¦ç¼ºç‚¹æ˜¯ï¼šå¢åŠ äº†ç±»çš„ä¸ªæ•°ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚</p><p>è¿­ä»£å™¨é€‚ç”¨äºä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li>å½“éœ€è¦è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹è€Œåˆä¸æƒ³æš´éœ²å®ƒçš„å†…éƒ¨è¡¨ç¤ºæ—¶ï¼›</li><li>å½“å¸Œæœ›æ”¯æŒå¯¹èšåˆå¯¹è±¡çš„å¤šç§éå†æ–¹å¼æ—¶ï¼›</li><li>å½“éœ€è¦ä¸ºéå†ä¸åŒçš„èšåˆè§£é›‡æä¾›ç»Ÿä¸€çš„å¯¹å¤–æ¥å£æ—¶ï¼›</li></ul><h4 id="11-è§£é‡Šå™¨æ¨¡å¼"><a href="#11-è§£é‡Šå™¨æ¨¡å¼" class="headerlink" title="11.è§£é‡Šå™¨æ¨¡å¼"></a>11.è§£é‡Šå™¨æ¨¡å¼</h4><p>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œå½“ä¸€ç§ç‰¹å®šç±»å‹çš„é—®é¢˜å‘ç”Ÿè‡³è¶³å¤Ÿé«˜çš„é¢‘ç‡åï¼Œé‚£ä¹ˆå°±å€¼å¾—å°†æ­¤é—®é¢˜çš„å„ä¸ªå®ä¾‹è¡¨è¿°ä¸ºä¸€ä¸ªç®€å•è¯­è¨€ä¸­çš„å¥å­ï¼Œä»¥æ­¤æ¥æ„å»ºä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¿™ä¸ªè§£é‡Šå™¨é€šè¿‡è§£é‡Šè¿™äº›è¯­å¥æ¥å¤„ç†é—®é¢˜ã€‚</p><p><strong>è§£é‡Šå™¨ï¼ˆInterpreterï¼‰æ¨¡å¼</strong>å®šä¹‰ï¼šç»™å®šä¸€ä¸ªè¯­è¨€ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•çš„ä¸€ç§è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¿™ä¸ªè§£é‡Šå™¨ä½¿ç”¨è¯¥è¡¨ç¤ºæ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ã€‚</p><p>è§£é‡Šå™¨æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š</p><ol><li><strong>æŠ½è±¡è¡¨è¾¾å¼ï¼ˆAbstractExpressionï¼‰è§’è‰²</strong>ï¼šå®šä¹‰è§£é‡Šå™¨çš„æ¥å£ï¼Œçº¦å®šè§£é‡Šå™¨çš„è§£é‡Šæ“ä½œï¼Œä¸»è¦åŒ…å«è§£é‡Šæ–¹æ³• interpret()ã€‚</li><li><strong>ç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼ˆTerminalExpressionï¼‰è§’è‰²</strong>ï¼šæ˜¯æŠ½è±¡è¡¨è¾¾å¼çš„å­ç±»ï¼Œç”¨æ¥å®ç°æ–‡æ³•ä¸­ä¸ç»ˆç»“ç¬¦ç›¸å…³çš„æ“ä½œï¼Œæ–‡æ³•ä¸­çš„æ¯ä¸€ä¸ªç»ˆç»“ç¬¦éƒ½æœ‰ä¸€ä¸ªå…·ä½“ç»ˆç»“è¡¨è¾¾å¼ä¸ä¹‹ç›¸å¯¹åº”ã€‚</li><li><strong>éç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼ˆNonterminalExpressionï¼‰è§’è‰²</strong>ï¼šä¹Ÿæ˜¯æŠ½è±¡è¡¨è¾¾å¼çš„å­ç±»ï¼Œç”¨æ¥å®ç°æ–‡æ³•ä¸­ä¸éç»ˆç»“ç¬¦ç›¸å…³çš„æ“ä½œï¼Œæ–‡æ³•ä¸­çš„æ¯æ¡è§„åˆ™éƒ½å¯¹åº”äºä¸€ä¸ªéç»ˆç»“ç¬¦è¡¨è¾¾å¼ã€‚</li><li><strong>ç¯å¢ƒï¼ˆContextï¼‰è§’è‰²</strong>ï¼šé€šå¸¸åŒ…å«å„ä¸ªè§£é‡Šå™¨éœ€è¦çš„æ•°æ®æˆ–æ˜¯å…¬å…±çš„åŠŸèƒ½ï¼Œä¸€èˆ¬ç”¨æ¥ä¼ é€’è¢«æ‰€æœ‰è§£é‡Šå™¨å…±äº«çš„æ•°æ®ï¼Œåé¢çš„è§£é‡Šå™¨å¯ä»¥ä»è¿™é‡Œè·å–è¿™äº›å€¼ã€‚</li><li><strong>å®¢æˆ·ç«¯ï¼ˆClientï¼‰</strong>ï¼šä¸»è¦ä»»åŠ¡æ˜¯å°†éœ€è¦åˆ†æçš„å¥å­æˆ–è¡¨è¾¾å¼è½¬æ¢æˆä½¿ç”¨è§£é‡Šå™¨å¯¹è±¡æè¿°çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œç„¶åè°ƒç”¨è§£é‡Šå™¨çš„è§£é‡Šæ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒè§’è‰²é—´æ¥è®¿é—®è§£é‡Šå™¨çš„è§£é‡Šæ–¹æ³•ã€‚</li></ol><p>ç»“æ„å›¾</p><p><img src="/2019/03/02/DesignPattern/InterpreterPattern.png" alt></p><p>ç¤ºä¾‹</p><p>æŠ½è±¡è¡¨è¾¾å¼è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æŠ½è±¡è¡¨è¾¾å¼ *  * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractExpression</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">interpret</span><span class="token punctuation">(</span>Context info<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ç»ˆç«¯è¡¨è¾¾å¼è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * ç»ˆç«¯è¡¨è¾¾å¼ * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TerminalExpression</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractExpression</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">interpret</span><span class="token punctuation">(</span>Context info<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span><span class="token function">getInputString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç»ˆç«¯è§£é‡Šå™¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>éç»ˆç«¯è¡¨è¾¾å¼è§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * éç»ˆç«¯è¡¨è¾¾å¼ * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NonterminalExpression</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractExpression</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">interpret</span><span class="token punctuation">(</span>Context info<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span><span class="token function">getInputString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"éç»ˆç«¯è§£é‡Šå™¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ç¯å¢ƒè§’è‰²</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * ç¯å¢ƒ * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Context</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String inputString<span class="token punctuation">;</span>    <span class="token keyword">private</span> String outputString<span class="token punctuation">;</span>    <span class="token keyword">public</span> String <span class="token function">getInputString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> inputString<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setInputString</span><span class="token punctuation">(</span>String inputString<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>inputString <span class="token operator">=</span> inputString<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">getOutputString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> outputString<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOutputString</span><span class="token punctuation">(</span>String outputString<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>outputString <span class="token operator">=</span> outputString<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å®¢æˆ·ç«¯ * * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Context context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        context<span class="token punctuation">.</span><span class="token function">setInputString</span><span class="token punctuation">(</span><span class="token string">"è¾“å…¥çš„æ–‡å­—"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        List<span class="token operator">&lt;</span>AbstractExpression<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TerminalExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NonterminalExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TerminalExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼šè¾“å…¥çš„æ–‡å­—ç»ˆç«¯è§£é‡Šå™¨è¾“å…¥çš„æ–‡å­—éç»ˆç«¯è§£é‡Šå™¨è¾“å…¥çš„æ–‡å­—ç»ˆç«¯è§£é‡Šå™¨</code></pre><p>ç¤ºä¾‹2</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * @author lancq */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Interpreter</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@FunctionalInterface</span>    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Expr</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> <span class="token function">interpret</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Integer<span class="token operator">></span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">static</span> Expr <span class="token function">number</span><span class="token punctuation">(</span><span class="token keyword">int</span> number<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> context <span class="token operator">-</span><span class="token operator">></span> number<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">static</span> Expr <span class="token function">plus</span><span class="token punctuation">(</span>Expr left<span class="token punctuation">,</span> Expr right<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> context <span class="token operator">-</span><span class="token operator">></span> left<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">+</span> right<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">static</span> Expr <span class="token function">minus</span><span class="token punctuation">(</span>Expr left<span class="token punctuation">,</span> Expr right<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> context <span class="token operator">-</span><span class="token operator">></span> left<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">-</span> right<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">static</span> Expr <span class="token function">variable</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> context <span class="token operator">-</span><span class="token operator">></span> context<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> Expr <span class="token function">parseToken</span><span class="token punctuation">(</span>String token<span class="token punctuation">,</span> ArrayDeque<span class="token operator">&lt;</span>Expr<span class="token operator">></span> stack<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Expr left<span class="token punctuation">,</span> right<span class="token punctuation">;</span>        <span class="token keyword">switch</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token string">"+"</span><span class="token operator">:</span>                <span class="token comment" spellcheck="true">// it's necessary to remove first the right operand from the stack</span>                right <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// ..and then the left one</span>                left <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> Expr<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token string">"-"</span><span class="token operator">:</span>                right <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                left <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> Expr<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">default</span><span class="token operator">:</span>                <span class="token keyword">return</span> Expr<span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> Expr <span class="token function">parse</span><span class="token punctuation">(</span>String expression<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ArrayDeque<span class="token operator">&lt;</span>Expr<span class="token operator">></span> stack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayDeque</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>String token <span class="token operator">:</span> expression<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">parseToken</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> stack<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">final</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Expr expr <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"w x z - +"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Integer<span class="token operator">></span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        context<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"w"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        context<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"x"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        context<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"z"</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> result <span class="token operator">=</span> expr<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// -27</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼š<span class="token operator">-</span><span class="token number">27</span></code></pre><p>è§£é‡Šå™¨æ¨¡å¼æ€»ç»“:</p><p>è§£é‡Šå™¨æ¨¡å¼æ˜¯ä¸€ç§ç±»è¡Œä¸ºå‹æ¨¡å¼ï¼Œå…¶ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹:</p><ul><li><p>æ‰©å±•æ€§å¥½ï¼šç”±äºåœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ä½¿ç”¨ç±»æ¥è¡¨ç¤ºè¯­è¨€çš„æ–‡æ³•è§„åˆ™ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ç»§æ‰¿ç­‰æœºåˆ¶æ¥æ”¹å˜æˆ–æ‰©å±•æ–‡æ³•ï¼›</p></li><li><p>å®¹æ˜“å®ç°ï¼šåœ¨è¯­æ³•æ ‘ä¸­çš„æ¯ä¸ªè¡¨è¾¾å¼èŠ‚ç‚¹ç±»éƒ½æ˜¯ç›¸ä¼¼çš„ï¼Œæ‰€ä»¥å®ç°å…¶æ–‡æ³•è¾ƒä¸ºå®¹æ˜“ï¼›</p></li></ul><p>è§£é‡Šå™¨æ¨¡å¼çš„ä¸»è¦ç¼ºç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>æ‰§è¡Œæ•ˆç‡è¾ƒä½ï¼šè§£é‡Šå™¨æ¨¡å¼ä¸­é€šå¸¸ä½¿ç”¨å¤§é‡çš„å¾ªç¯å’Œé€’å½’è°ƒç”¨ï¼Œå½“è¦è§£é‡Šçš„å¥å­è¾ƒå¤æ‚æ—¶ï¼Œå…¶è¿è¡Œé€Ÿåº¦å¾ˆæ…¢ï¼Œä¸”ä»£ç çš„è°ƒè¯•è¿‡ç¨‹ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼›</p></li><li><p>ä¼šå¼•èµ·ç±»è†¨èƒ€ï¼šè§£é‡Šå™¨æ¨¡å¼ä¸­çš„æ¯æ¡è§„åˆ™è‡³å°‘éœ€è¦å®šä¹‰ä¸€ä¸ªç±»ï¼Œå½“åŒ…å«çš„æ–‡æ³•è§„åˆ™å¾ˆå¤šæ—¶ï¼Œç±»çš„ä¸ªæ•°å°†æ€¥å‰§å¢åŠ ï¼Œå¯¼è‡´ç³»ç»Ÿéš¾ä»¥ç®¡ç†ä¸ç»´æŠ¤ï¼›</p></li><li><p>å¯åº”ç”¨çš„åœºæ™¯æ¯”è¾ƒå°‘ï¼šåœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œéœ€è¦å®šä¹‰è¯­è¨€æ–‡æ³•çš„åº”ç”¨å®ä¾‹éå¸¸å°‘ï¼Œæ‰€ä»¥è¿™ç§æ¨¡å¼å¾ˆå°‘è¢«ä½¿ç”¨åˆ°ã€‚</p></li></ul><p>é¢ä»‹ç»äº†è§£é‡Šå™¨æ¨¡å¼çš„ç»“æ„ä¸ç‰¹ç‚¹ï¼Œä¸‹é¢åˆ†æå®ƒçš„åº”ç”¨åœºæ™¯ï¼š</p><ul><li><p>å½“è¯­è¨€çš„æ–‡æ³•è¾ƒä¸ºç®€å•ï¼Œä¸”æ‰§è¡Œæ•ˆç‡ä¸æ˜¯å…³é”®é—®é¢˜æ—¶ï¼›</p></li><li><p>å½“é—®é¢˜é‡å¤å‡ºç°ï¼Œä¸”å¯ä»¥ç”¨ä¸€ç§ç®€å•çš„è¯­è¨€æ¥è¿›è¡Œè¡¨è¾¾æ—¶ï¼›</p></li><li><p>å½“ä¸€ä¸ªè¯­è¨€éœ€è¦è§£é‡Šæ‰§è¡Œï¼Œå¹¶ä¸”è¯­è¨€ä¸­çš„å¥å­å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘çš„æ—¶å€™ï¼Œå¦‚ XML æ–‡æ¡£è§£é‡Šã€‚</p></li></ul><h2 id="TO-BE-CONTINUE"><a href="#TO-BE-CONTINUE" class="headerlink" title="TO BE CONTINUE!"></a>TO BE CONTINUE!</h2>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•å°†ä¸€ä¸ªå•é“¾è¡¨é€†ç½®ï¼Ÿ</title>
      <link href="/2019/02/28/ListReverseDemo/"/>
      <url>/2019/02/28/ListReverseDemo/</url>
      
        <content type="html"><![CDATA[<h2 id="å¦‚ä½•å°†ä¸€ä¸ªå•é“¾è¡¨é€†ç½®ï¼Ÿ"><a href="#å¦‚ä½•å°†ä¸€ä¸ªå•é“¾è¡¨é€†ç½®ï¼Ÿ" class="headerlink" title="å¦‚ä½•å°†ä¸€ä¸ªå•é“¾è¡¨é€†ç½®ï¼Ÿ"></a>å¦‚ä½•å°†ä¸€ä¸ªå•é“¾è¡¨é€†ç½®ï¼Ÿ</h2><p><img src="/2019/02/28/ListReverseDemo/image-20190302002632947.png" alt></p><p>é“¾è¡¨çš„èŠ‚ç‚¹</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ListNode</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> value<span class="token punctuation">;</span>    <span class="token keyword">public</span> ListNode next<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">ListNode</span><span class="token punctuation">(</span><span class="token keyword">int</span> value<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> value <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><h4 id="æ™®é€šè§£æ³•"><a href="#æ™®é€šè§£æ³•" class="headerlink" title="æ™®é€šè§£æ³•"></a>æ™®é€šè§£æ³•</h4><p>é“¾è¡¨çš„é€†ç½®æœ€å®¹æ˜“æƒ³åˆ°æ˜¯åˆ©ç”¨ä¸€ä¸ªæ ˆçš„ç»“æ„ï¼Œè¯¥ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºo(n)ï¼Œç©ºé—´å¤æ‚åº¦åŒæ ·ä¸ºo(n)ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> ListNode <span class="token function">reverseListByStack</span><span class="token punctuation">(</span>ListNode head<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>head <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    Stack<span class="token operator">&lt;</span>Integer<span class="token operator">></span> stack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>head <span class="token operator">!=</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>head<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>        head <span class="token operator">=</span> head<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    ListNode newHead <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span>stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ListNode p <span class="token operator">=</span> newHead<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å–å‡ºæ ˆä¸­çš„å…ƒç´ ï¼Œæ„é€ æ–°é“¾è¡¨</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>stack<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        ListNode node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span>stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        p<span class="token punctuation">.</span>next <span class="token operator">=</span> node<span class="token punctuation">;</span>        p <span class="token operator">=</span> node<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> newHead<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    ListNode node1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ListNode node2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ListNode node3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ListNode node4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    node1<span class="token punctuation">.</span>next <span class="token operator">=</span> node2<span class="token punctuation">;</span>    node2<span class="token punctuation">.</span>next <span class="token operator">=</span> node3<span class="token punctuation">;</span>    node3<span class="token punctuation">.</span>next <span class="token operator">=</span> node4<span class="token punctuation">;</span>    node1 <span class="token operator">=</span> <span class="token function">reverseListByStack</span><span class="token punctuation">(</span>node1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>node1 <span class="token operator">!=</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>node1<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>        node1 <span class="token operator">=</span> node1<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="é«˜çº§è§£æ³•"><a href="#é«˜çº§è§£æ³•" class="headerlink" title="é«˜çº§è§£æ³•"></a>é«˜çº§è§£æ³•</h4><p>åªé¢å¤–ä½¿ç”¨äº†ä¸¤ä¸ªåªé’ˆï¼Œè¿™ç§è§£æ³•çš„ç©ºé—´å¤æ‚åº¦èƒ½è¾¾åˆ°o(1)ï¼Œæ—¶é—´å¤æ‚åº¦åŒæ ·ä¸ºo(n)ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> ListNode <span class="token function">reverseList</span><span class="token punctuation">(</span>ListNode head<span class="token punctuation">)</span> <span class="token punctuation">{</span>    ListNode pre <span class="token operator">=</span> null<span class="token punctuation">;</span>    ListNode next <span class="token operator">=</span> null<span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>head <span class="token operator">!=</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>        next <span class="token operator">=</span> head<span class="token punctuation">.</span>next<span class="token punctuation">;</span>        head<span class="token punctuation">.</span>next <span class="token operator">=</span> pre<span class="token punctuation">;</span>        pre <span class="token operator">=</span> head<span class="token punctuation">;</span>        head <span class="token operator">=</span> next<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> pre<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    ListNode node1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ListNode node2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ListNode node3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ListNode node4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    node1<span class="token punctuation">.</span>next <span class="token operator">=</span> node2<span class="token punctuation">;</span>    node2<span class="token punctuation">.</span>next <span class="token operator">=</span> node3<span class="token punctuation">;</span>    node3<span class="token punctuation">.</span>next <span class="token operator">=</span> node4<span class="token punctuation">;</span>    node1 <span class="token operator">=</span> <span class="token function">reverse</span><span class="token punctuation">(</span>node1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>node1 <span class="token operator">!=</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>node1<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>        node1 <span class="token operator">=</span> node1<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“æ­¥éª¤ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/2019/02/28/ListReverseDemo/image-20190302003014433.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> ç®—æ³• </tag>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2019/02/28/hello-world/"/>
      <url>/2019/02/28/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class=" language-bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class=" language-bash"><code class="language-bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class=" language-bash"><code class="language-bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class=" language-bash"><code class="language-bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>JVMåŸç†</title>
      <link href="/2017/03/03/jvm-principle/"/>
      <url>/2017/03/03/jvm-principle/</url>
      
        <content type="html"><![CDATA[<p>å¯¹äºJavaç¨‹åºå‘˜æ¥è¯´ï¼Œåœ¨è™šæ‹Ÿæœºè‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶çš„å¸®åŠ©ä¸‹ï¼Œä¸å†éœ€è¦ä¸ºæ¯ä¸€ä¸ªåˆ›å»ºå¯¹è±¡æ“ä½œå»å†™é…å¯¹çš„delete/freeä»£ç ï¼Œä¸å®¹æ˜“å‡ºç°å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºé—®é¢˜ï¼Œç”±äºè™šæ‹Ÿæœºç®¡ç†å†…å­˜è¿™ä¸€åˆ‡çœ‹èµ·æ¥å¾ˆç¾å¥½ã€‚ä¸è¿‡ï¼Œä¹Ÿæ­£æ˜¯å› ä¸ºJavaç¨‹åºå‘˜æŠŠå†…å­˜æ§åˆ¶æƒäº¤ç»™äº†Javaè™šæ‹Ÿæœºï¼Œä¸€æ—¦å‡ºç°å†…å­˜æ³„æ¼å’Œæº¢å‡ºæ–¹é¢çš„é—®é¢˜ï¼Œå¦‚æœä¸äº†è§£è™šæ‹Ÿæœºæ˜¯æ€æ ·ä½¿ç”¨å†…å­˜çš„ï¼Œé‚£ä¹ˆæ’æŸ¥é”™è¯¯å°†æˆä¸ºä¸€é¡¹å¼‚å¸¸è‰°è¾›çš„å·¥ä½œã€‚åé¢è®²ä»æ¦‚å¿µä¸Šä»‹ç»Javaè™šæ‹Ÿæœºå†…å­˜çš„å„ä¸ªåŒºåŸŸã€‚</p><h2 id="ä¸€ã€è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"><a href="#ä¸€ã€è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ" class="headerlink" title="ä¸€ã€è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"></a>ä¸€ã€è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ</h2><p>Javaè™šæ‹Ÿæœºåœ¨æ‰§è¡ŒJavaç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠå®ƒæ‰€ç®¡ç†çš„å†…å­˜åˆ’åˆ†æˆè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸã€‚è¿™äº›åŒºåŸŸéƒ½æœ‰å„è‡ªçš„ç”¨é€”ï¼Œä»¥åŠåˆ›å»ºå’Œé”€æ¯çš„æ—¶é—´ï¼Œæœ‰çš„åŒºåŸŸéšç€è™šæ‹Ÿæœºè¿›ç¨‹çš„å¯åŠ¨è€Œå­˜åœ¨ï¼Œæœ‰äº›åŒºåŸŸåˆ™ä¾èµ–ç”¨æˆ·çº¿ç¨‹çš„å¯åŠ¨å’Œç»“æŸè€Œåˆ›å»ºå’Œé”€æ¯ã€‚æ ¹æ®<a href="https://docs.oracle.com/javase/specs/jvms/se7/html/index.html" target="_blank" rel="noopener">ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒï¼ˆJava SE 7 ç‰ˆï¼‰ã€‹</a>çš„è§„å®šï¼ŒJavaè™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªè¿è¡Œæ—¶æ•°æ®åŒºåŸŸï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/2017/03/03/jvm-principle/JavaRuntimeDataArea.png" alt></p><p>è¿è¡Œæ—¶æ•°æ®åŒºåŸŸåŒ…æ‹¬ï¼šæ–¹æ³•åŒºã€å †ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨ï¼›</p><h3 id="1-ç¨‹åºè®¡æ•°å™¨"><a href="#1-ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="1.ç¨‹åºè®¡æ•°å™¨"></a>1.ç¨‹åºè®¡æ•°å™¨</h3><p><strong>ç¨‹åºè®¡æ•°å™¨</strong>æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯<strong>å½“å‰çº¿ç¨‹</strong>æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚å­—èŠ‚ç æŒ‡ä»¤ä¸­çš„åˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚</p><p>ç”±äºJavaè™šæ‹Ÿæœºçš„å¤šçº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢å¹¶åˆ†é…å¤„ç†å™¨æ‰§è¡Œæ—¶é—´çš„æ–¹å¼æ¥å®ç°çš„ï¼Œåœ¨ä»»ä½•ä¸€ä¸ªç¡®å®šçš„æ—¶åˆ»ï¼Œä¸€ä¸ªå¤„ç†å™¨ï¼ˆå¤šæ ¸å¤„ç†å™¨çš„ä¸€ä¸ªæ ¸å¿ƒï¼‰éƒ½åªä¼šæ‰§è¡Œä¸€æ¡çº¿ç¨‹ä¸­çš„æŒ‡ä»¤ã€‚å› æ­¤ï¼Œä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œæ¯æ¡çº¿ç¨‹éƒ½éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå„ä¸ªçº¿ç¨‹ä¹‹é—´çš„è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ï¼Œæ‰€ä»¥ç¨‹åºè®¡æ•°å™¨ä¸ºâ€œçº¿ç¨‹ç§æœ‰â€çš„å†…å­˜ã€‚</p><p>æ­¤å†…å­˜åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨Javaè™šæ‹Ÿæœºè§„èŒƒåªèƒ½å¤Ÿæ²¡æœ‰è§„å®šä»»ä½•OutOfMemoryErroræƒ…å†µçš„åŒºåŸŸã€‚</p><h3 id="2-è™šæ‹Ÿæœºæ ˆ"><a href="#2-è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="2.è™šæ‹Ÿæœºæ ˆ"></a>2.è™šæ‹Ÿæœºæ ˆ</h3><p><strong>è™šæ‹Ÿæœºæ ˆ</strong>ä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„å†…å­˜åŒºåŸŸï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼šæ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ç”¨äºå­˜å‚¨<strong>å±€éƒ¨å˜é‡è¡¨</strong>ã€<strong>æ“ä½œæ•°æ ˆ</strong>ã€<strong>åŠ¨æ€é“¾æ¥</strong>ã€<strong>æ–¹æ³•å‡ºå£</strong>ç­‰ä¿¡æ¯ã€‚æ¯ä¸ªæ–¹æ³•ä»è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±æ—¶å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆæ€»å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚</p><p>å±€éƒ¨å˜é‡è¡¨å­˜æ”¾äº†åœ¨ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰å’Œå¯¹è±¡å¼•ç”¨ï¼ˆreferenceç±»å‹ï¼‰ã€‚å±€éƒ¨å˜é‡è¡¨æ‰€éœ€è¦çš„å†…å­˜ç©ºé—´åœ¨ç¼–è¯‘æœŸé—´å®Œæˆåˆ†é…ï¼Œå½“è¿›å…¥ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦åœ¨æ ˆå¸§ä¸­åˆ†é…å¤šå¤§çš„å±€éƒ¨å˜é‡ç©ºé—´æ˜¯å®Œå…¨ç¡®å®šçš„ï¼Œåœ¨æ–¹æ³•è¿è¡ŒæœŸé—´ä¸ä¼šæ”¹å˜å±€éƒ¨å˜é‡è¡¨çš„å¤§å°ã€‚</p><p>åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­ï¼Œå¯¹è¿™ä¸ªåŒºåŸŸè§„å®šäº†2ç§å¼‚å¸¸æƒ…å†µï¼š</p><ul><li>å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦ï¼Œå°†æŠ›å‡ºStackOverflowErrorå¼‚å¸¸ï¼›</li><li>å¦‚æœè™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼ˆå½“å‰å¤§éƒ¨åˆ†çš„è™šæ‹Ÿæœºéƒ½å¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œåªä¸è¿‡Javaè™šæ‹Ÿæœºè§„èŒƒä¸­ä¹Ÿå…è®¸å›ºå®šé•¿åº¦çš„è™šæ‹Ÿæœºæ ˆï¼‰ï¼Œå¦‚æœæ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œå°±ä¼šè·‘å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</li></ul><h3 id="3-æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#3-æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="3.æœ¬åœ°æ–¹æ³•æ ˆ"></a>3.æœ¬åœ°æ–¹æ³•æ ˆ</h3><p><strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong>ä¸è™šæ‹Ÿæœºæ ˆçš„ä½œç”¨éå¸¸ç±»ä¼¼ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ä¸è¿‡æ˜¯è™šæ‹Ÿæœºæ ˆæ˜¯ä¸ºè™šæ‹Ÿæœºæ‰§è¡ŒJavaæ–¹æ³•æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„nativeæ–¹æ³•æœåŠ¡ã€‚ä¸è™šæ‹Ÿæœºæ ˆä¸€æ ·ï¼Œæœ¬åœ°æ–¹æ³•æ ˆåŒºåŸŸä¹Ÿä¼šæŠ›å‡ºStackOverflowErrorå’ŒOutOfMemoryErrorå¼‚å¸¸ã€‚</p><h3 id="4-å †"><a href="#4-å †" class="headerlink" title="4.å †"></a>4.å †</h3><p><strong>å †</strong>æ˜¯Javaè™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ã€‚å †æ˜¯è¢«æ‰€ä»¥çº¿ç¨‹æ‰€å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚</p><p>å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸã€‚</p><p>ä»å†…å­˜çš„å›æ”¶è§’åº¦æ¥çœ‹ï¼Œç”±äºç°åœ¨çš„æ”¶é›†å™¨åŸºé‡‡ç”¨äº†åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥å †è¿˜å¯ä»¥åŒ–åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚æ–°ç”Ÿä»£å¯ä»¥å†åˆ†ä¸ºEdenç©ºé—´ã€From Survivorç©ºé—´ã€To Survivorç©ºé—´ã€‚</p><p>ä»å†…å­˜åˆ†é…çš„è§’åº¦æ¥çœ‹ï¼Œçº¿ç¨‹å…±äº«çš„å †ä¸­å¯èƒ½åˆ’åˆ†å‡ºå¤šä¸ªçº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒºï¼ˆThread Local Allocation Bufferï¼ŒTLABï¼‰ã€‚</p><p>æ— è®ºå¦‚ä½•åˆ’åˆ†ï¼Œéƒ½ä¸å­˜æ”¾å†…å®¹æ— å…³ï¼Œæ— è®ºå“ªä¸ªåŒºåŸŸï¼Œå­˜å‚¨çš„éƒ½æ˜¯å¯¹è±¡å®ä¾‹ï¼Œè¿›ä¸€æ­¥åˆ’åˆ†çš„ç›®çš„æ˜¯ä¸ºäº†æ›´å¥½çš„å›æ”¶å†…å­˜ï¼Œæˆ–è€…æ›´å¿«çš„åˆ†é…å†…å­˜ã€‚</p><p>æ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒçš„è§„å®šï¼Œå †å¯ä»¥å¤„åœ¨ç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œåªè¦é€»è¾‘ä¸Šæ˜¯è¿ç»­çš„å³å¯ï¼Œå°±åƒç£ç›˜ç©ºé—´ä¸€æ ·ã€‚æ—¢å¯ä»¥æ˜¯å›ºå®šå¤§å°çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æ‰©å±•çš„ï¼Œå…·ä½“å¯ä»¥é€šè¿‡-Xmxå’Œ-Xmsæ§åˆ¶ã€‚å¦‚æœå †ä¸­æ²¡æœ‰å†…å­˜å®Œæˆå®ä¾‹åˆ†é…ï¼Œå¹¶ä¸”ä¹Ÿæ— æ³•æ‰©å±•æ—¶ï¼Œå°†ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p><h3 id="5-æ–¹æ³•åŒº"><a href="#5-æ–¹æ³•åŒº" class="headerlink" title="5.æ–¹æ³•åŒº"></a>5.æ–¹æ³•åŒº</h3><p><strong>æ–¹æ³•åŒº</strong>ä¸å †ä¸€æ ·æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨å·²ç»è¢«è™šæ‹ŸæœºåŠ è½½çš„<strong>ç±»ä¿¡æ¯</strong>ã€<strong>å¸¸é‡</strong>ã€<strong>é™æ€å˜é‡</strong>ã€<strong>å³æ—¶ç¼–è¯‘åçš„ä»£ç </strong>ç­‰æ•°æ®ã€‚ç†è®ºä¸Šå±äºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¸ºäº†å’Œå †ï¼ˆHeapï¼‰åŒºåˆ†ï¼Œå®ƒæœ‰ä¸€ä¸ªåˆ«åå«åšéå †ï¼ˆNon-Heapï¼‰ã€‚</p><p>è¿™ä¸ªåŒºåŸŸå¯ä»¥é€‰æ‹©ä¸è¿›è¡Œå†…å­˜å›æ”¶ï¼Œè¯¥åŒºåŸŸå›æ”¶çš„ç›®æ ‡ä¸»è¦æ˜¯é’ˆå¯¹å¸¸é‡æ± å›æ”¶å’Œå¯¹ç±»å‹çš„å¸è½½ã€‚å†…å­˜ä¸è¶³æ—¶ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p><p><strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong>ï¼šå®ƒæ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚Classçš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰ï¼Œä»¥åŠç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡ã€ç¬¦å·å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åå­˜æ”¾åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚</p><h2 id="äºŒã€ç›´æ¥å†…å­˜"><a href="#äºŒã€ç›´æ¥å†…å­˜" class="headerlink" title="äºŒã€ç›´æ¥å†…å­˜"></a>äºŒã€ç›´æ¥å†…å­˜</h2><p><strong>ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰</strong>å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸï¼Œä½†ä¹Ÿä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p><p>åœ¨JDK1.4ä¸­æ–°åŠ å…¥äº†NIOï¼ˆNew Input/Outputï¼‰ï¼Œå¼•å…¥äº†ä¸€ç§åŸºäºé€šé“ï¼ˆChannelï¼‰ä¸ç¼“å†²åŒºï¼ˆBufferï¼‰çš„IOæ–¹å¼ï¼Œå®ƒå¯ä»¥ä½¿ç”¨Nativeå‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨Javaå †ä¸­çš„DirectByteBufferå¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› æ­¤é¿å…äº†Javaå †å’ŒNativeå †ä¸­æ¥å›å¤åˆ¶æ•°æ®ã€‚</p><p>ç›´æ¥å†…å­˜çš„åˆ†é…ä¸å—Javaå †å¤§å°çš„é™åˆ¶ï¼Œä½†æ˜¯ä¼šå—åˆ°æœ¬æœºæ€»å†…å­˜å¤§å°å’Œå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶ã€‚</p><h2 id="ä¸‰ã€å¯¹è±¡çš„å†…å­˜å¸ƒå±€"><a href="#ä¸‰ã€å¯¹è±¡çš„å†…å­˜å¸ƒå±€" class="headerlink" title="ä¸‰ã€å¯¹è±¡çš„å†…å­˜å¸ƒå±€"></a>ä¸‰ã€å¯¹è±¡çš„å†…å­˜å¸ƒå±€</h2><p>åœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„å¸ƒå±€å¯ä»¥åˆ†ä¸º3å—åŒºåŸŸï¼š<strong>å¯¹è±¡å¤´ï¼ˆHeaderï¼‰</strong>ã€<strong>å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰</strong>ã€<strong>å¯¹é½å¡«å……ï¼ˆPaddingï¼‰</strong>ã€‚</p><h3 id="1-å¯¹è±¡å¤´ï¼ˆHeaderï¼‰"><a href="#1-å¯¹è±¡å¤´ï¼ˆHeaderï¼‰" class="headerlink" title="1.å¯¹è±¡å¤´ï¼ˆHeaderï¼‰"></a>1.å¯¹è±¡å¤´ï¼ˆHeaderï¼‰</h3><p>å¯¹è±¡å¤´åŒ…æ‹¬ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼š</p><ul><li><p>ç¬¬ä¸€éƒ¨åˆ†ä¸ºMark Wordï¼Œç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹åƒè¯çš„é”ã€åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ç­‰ã€‚Mark Wordåœ¨32ä½JVMä¸­çš„é•¿åº¦æ˜¯32bitï¼Œåœ¨64ä½JVMä¸­é•¿åº¦æ˜¯64bitã€‚ä¾‹å¦‚ï¼Œåœ¨32ä½çš„HotSpotè™šæ‹Ÿæœºä¸­ï¼Œå¦‚æœå¯¹è±¡å¤„äºæœªè¢«é”å®šçš„çŠ¶æ€ä¸‹ï¼Œé‚£ä¹ˆMarkWordçš„32ä½ç©ºé—´ä¸­çš„25ä½ç”¨äºå­˜å‚¨å¯¹è±¡å“ˆå¸Œç ï¼Œ4ä½ç”¨äºå­˜å‚¨å¯¹è±¡åˆ†ä»£å¹´é¾„ï¼Œ2ä½ç”¨äºå­˜å‚¨é”æ ‡å¿—ä½ï¼Œ1ä½å›ºå®šä¸º0ã€‚</p><p><img src="/2017/03/03/jvm-principle/MarkWord.png" alt></p><p>å…¶ä¸­<strong>æ— é”</strong>å’Œ<strong>åå‘é”</strong>çš„é”æ ‡å¿—ä½éƒ½æ˜¯01ï¼Œåªæ˜¯åœ¨å‰é¢çš„1bitåŒºåˆ†äº†è¿™æ˜¯æ— é”çŠ¶æ€è¿˜æ˜¯åå‘é”çŠ¶æ€ã€‚</p><p>JDK1.6å¯¹é”è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä»¥åçš„ç‰ˆæœ¬åœ¨å¤„ç†åŒæ­¥é”æ—¶å­˜åœ¨é”å‡çº§çš„æ¦‚å¿µï¼ŒJVMå¯¹äºåŒæ­¥é”çš„å¤„ç†æ˜¯ä»<strong>åå‘é”</strong>å¼€å§‹çš„ï¼Œéšç€ç«äº‰è¶Šæ¥è¶Šæ¿€çƒˆï¼Œå¤„ç†æ–¹å¼ä»<strong>åå‘é”</strong>å‡çº§åˆ°<strong>è½»é‡çº§é”</strong>ï¼Œæœ€ç»ˆå‡çº§åˆ°<strong>é‡é‡çº§é”</strong>ã€‚</p><p>JVMä¸€èˆ¬æ˜¯è¿™æ ·ä½¿ç”¨é”å’ŒMark Wordçš„ï¼š</p><ul><li><p>ï¼ˆ1ï¼‰å½“æ²¡æœ‰è¢«å½“æˆé”æ—¶ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼ŒMark Wordè®°å½•å¯¹è±¡çš„HashCodeï¼Œé”æ ‡å¿—ä½æ˜¯01ï¼Œæ˜¯å¦åå‘é”é‚£ä¸€ä½æ˜¯0ï¼Œè¡¨ç¤º<strong>æ— é”</strong>ã€‚</p></li><li><p>ï¼ˆ2ï¼‰å½“å¯¹è±¡è¢«å½“åšåŒæ­¥é”å¹¶æœ‰ä¸€ä¸ªçº¿ç¨‹AæŠ¢åˆ°äº†é”æ—¶ï¼Œé”æ ‡å¿—ä½è¿˜æ˜¯01ï¼Œä½†æ˜¯å¦åå‘é”é‚£ä¸€ä½æ”¹æˆ1ï¼Œå‰23bitè®°å½•æŠ¢åˆ°é”çš„çº¿ç¨‹IDï¼Œè¡¨ç¤ºè¿›å…¥<strong>åå‘é”</strong>çŠ¶æ€ã€‚</p></li><li><p>ï¼ˆ3ï¼‰å½“çº¿ç¨‹Aå†æ¬¡è¯•å›¾æ¥è·å¾—é”æ—¶ï¼ŒJVMå‘ç°åŒæ­¥é”å¯¹è±¡çš„æ ‡å¿—ä½æ˜¯01ï¼Œæ˜¯å¦åå‘é”æ˜¯1ï¼Œä¹Ÿå°±æ˜¯åå‘çŠ¶æ€ï¼ŒMark Wordä¸­è®°å½•çš„çº¿ç¨‹IDå°±æ˜¯çº¿ç¨‹Aè‡ªå·±çš„IDï¼Œè¡¨ç¤ºçº¿ç¨‹Aå·²ç»è·å¾—äº†è¿™ä¸ªåå‘é”ï¼Œå¯ä»¥æ‰§è¡ŒåŒæ­¥é”çš„ä»£ç ã€‚</p></li><li><p>ï¼ˆ4ï¼‰å½“å¦ä¸€ä¸ªçº¿ç¨‹Bè¯•å›¾è·å¾—è¿™ä¸ªé”æ—¶ï¼ŒJVMå‘ç°åŒæ­¥é”å¤„äºåå‘çŠ¶æ€ï¼Œä½†æ˜¯Mark Wordä¸­çš„çº¿ç¨‹IDè®°å½•çš„ä¸æ˜¯Bï¼Œé‚£ä¹ˆçº¿ç¨‹Bä¼šå…ˆç”¨CASæ“ä½œè¯•å›¾è·å¾—é”ï¼Œè¿™é‡Œçš„è·å¾—é”æ“ä½œæ˜¯æœ‰å¯èƒ½æˆåŠŸçš„ï¼Œå› ä¸ºçº¿ç¨‹Aä¸€èˆ¬ä¸ä¼šè‡ªåŠ¨é‡Šæ”¾åå‘é”ã€‚å¦‚æœæŠ¢é”æˆåŠŸï¼Œå°±æŠŠMark Wordé‡Œçš„çº¿ç¨‹IDæ”¹ä¸ºçº¿ç¨‹Bçš„IDï¼Œä»£è¡¨çº¿ç¨‹Bè·å¾—äº†è¿™ä¸ªåå‘é”ï¼Œå¯ä»¥æ‰§è¡ŒåŒæ­¥é”ä»£ç ã€‚å¦‚æœæŠ¢é”å¤±è´¥ï¼Œåˆ™ç»§ç»­æ‰§è¡Œæ­¥éª¤ï¼ˆ5ï¼‰ã€‚</p></li><li><p>ï¼ˆ5ï¼‰åå‘é”çŠ¶æ€æŠ¢é”å¤±è´¥ï¼Œä»£è¡¨å½“å‰é”æœ‰ä¸€å®šçš„ç«äº‰ï¼Œåå‘é”å°†å‡çº§ä¸º<strong>è½»é‡çº§é”</strong>ã€‚JVMä¼šåœ¨å½“å‰çº¿ç¨‹çš„çº¿ç¨‹æ ˆä¸­å¼€è¾Ÿä¸€å—å•ç‹¬çš„ç©ºé—´ï¼Œé‡Œé¢ä¿å­˜æŒ‡å‘å¯¹è±¡é”Mark Wordçš„æŒ‡é’ˆï¼ŒåŒæ—¶åœ¨å¯¹è±¡é”Mark Wordä¸­ä¿å­˜æŒ‡å‘è¿™ç‰‡ç©ºé—´çš„æŒ‡é’ˆã€‚ä¸Šè¿°ä¸¤ä¸ªä¿å­˜æ“ä½œéƒ½æ˜¯CASæ“ä½œï¼Œå¦‚æœä¿å­˜æˆåŠŸï¼Œä»£è¡¨çº¿ç¨‹æŠ¢åˆ°äº†åŒæ­¥é”ï¼Œå°±æŠŠMark Wordä¸­çš„é”æ ‡å¿—ä½æ”¹æˆ00ï¼Œå¯ä»¥æ‰§è¡ŒåŒæ­¥é”ä»£ç ã€‚å¦‚æœä¿å­˜å¤±è´¥ï¼Œè¡¨ç¤ºæŠ¢é”å¤±è´¥ï¼Œç«äº‰å¤ªæ¿€çƒˆï¼Œç»§ç»­æ‰§è¡Œæ­¥éª¤ï¼ˆ6ï¼‰ã€‚</p></li><li><p>ï¼ˆ6ï¼‰è½»é‡çº§é”æŠ¢é”å¤±è´¥ï¼ŒJVMä¼šä½¿ç”¨è‡ªæ—‹é”ï¼Œè‡ªæ—‹é”ä¸æ˜¯ä¸€ä¸ªé”çŠ¶æ€ï¼Œåªæ˜¯ä»£è¡¨ä¸æ–­çš„é‡è¯•ï¼Œå°è¯•æŠ¢é”ã€‚ä»JDK1.7å¼€å§‹ï¼Œè‡ªæ—‹é”é»˜è®¤å¯ç”¨ï¼Œè‡ªæ—‹æ¬¡æ•°ç”±JVMå†³å®šã€‚å¦‚æœæŠ¢é”æˆåŠŸåˆ™æ‰§è¡ŒåŒæ­¥é”ä»£ç ï¼Œå¦‚æœå¤±è´¥åˆ™ç»§ç»­æ‰§è¡Œæ­¥éª¤ï¼ˆ7ï¼‰ã€‚</p></li><li><p>ï¼ˆ7ï¼‰è‡ªæ—‹é”é‡è¯•ä¹‹åå¦‚æœæŠ¢é”ä¾ç„¶å¤±è´¥ï¼ŒåŒæ­¥é”ä¼šå‡çº§è‡³<strong>é‡é‡çº§é”</strong>ï¼Œé”æ ‡å¿—ä½æ”¹ä¸º10ã€‚åœ¨è¿™ä¸ªçŠ¶æ€ä¸‹ï¼ŒæœªæŠ¢åˆ°é”çš„çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ã€‚</p></li></ul></li><li><p>ç¬¬äºŒéƒ¨åˆ†æ˜¯ç±»å‹æŒ‡é’ˆï¼Œå®ƒæ˜¯æŒ‡å‘<strong>æ–¹æ³•åŒº</strong>å¯¹è±¡ç±»å‹æ•°æ®çš„æŒ‡é’ˆï¼Œå¦‚æœæ˜¯æ•°ç»„å¯¹è±¡çš„è¯ï¼Œè¿˜ä¼šæœ‰ä¸€ä¸ªé¢å¤–çš„éƒ¨åˆ†å­˜å‚¨æ•°ç»„é•¿åº¦ã€‚</p></li></ul><p>###2.å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰</p><p>å®ä¾‹æ•°æ®æ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼Œä¹Ÿæ˜¯åœ¨ç¨‹åºä»£ç ä¸­æ‰€å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µå†…å®¹ã€‚</p><h3 id="3-å¯¹é½å¡«å……ï¼ˆPaddingï¼‰"><a href="#3-å¯¹é½å¡«å……ï¼ˆPaddingï¼‰" class="headerlink" title="3.å¯¹é½å¡«å……ï¼ˆPaddingï¼‰"></a>3.å¯¹é½å¡«å……ï¼ˆPaddingï¼‰</h3><p>å¯¹é½å¡«å……å¹¶ä¸æ˜¯å¿…ç„¶å­˜åœ¨çš„ï¼Œä¹Ÿæ²¡æœ‰ç‰¹åˆ«çš„å«ä¹‰ï¼Œå®ƒä»…ä»…èµ·ç€å ä½ç¬¦çš„ä½œç”¨ã€‚</p><h2 id="å››ã€å¯¹è±¡çš„è®¿é—®å®šä½"><a href="#å››ã€å¯¹è±¡çš„è®¿é—®å®šä½" class="headerlink" title="å››ã€å¯¹è±¡çš„è®¿é—®å®šä½"></a>å››ã€å¯¹è±¡çš„è®¿é—®å®šä½</h2><p>å»ºç«‹å¯¹è±¡æ˜¯ä¸ºäº†ä½¿ç”¨å¯¹è±¡ï¼ŒJavaç¨‹åºéœ€è¦é€šè¿‡æ ˆä¸Šçš„referenceæ•°æ®æ¥æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ã€‚ç”±äºreferenceç±»å‹åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­è§„å®šäº†ä¸€ä¸ªæŒ‡å‘å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶æ²¡æœ‰å®šä¹‰è¿™ä¸ªå¼•ç”¨åº”è¯¥é€šè¿‡ä½•ç§æ–¹å¼å»å®šä½ã€è®¿é—®å †ä¸­çš„å¯¹è±¡çš„å…·ä½“ä½ç½®ã€‚æ‰€ä»¥å¯¹è±¡çš„è®¿é—®æ–¹å¼ä¹Ÿæ˜¯å–å†³äºè™šæ‹Ÿæœºå®ç°è€Œå®šçš„ã€‚ç›®å‰ä¸»æµçš„è®¿é—®æ–¹å¼æœ‰<strong>ä½¿ç”¨å¥æŸ„</strong>å’Œ<strong>ç›´æ¥æŒ‡é’ˆ</strong>ä¸¤ç§ã€‚</p><h3 id="1-å¥æŸ„æ–¹å¼è®¿é—®"><a href="#1-å¥æŸ„æ–¹å¼è®¿é—®" class="headerlink" title="1.å¥æŸ„æ–¹å¼è®¿é—®"></a>1.å¥æŸ„æ–¹å¼è®¿é—®</h3><p>å¦‚æœä½¿ç”¨å¥æŸ„è®¿é—®çš„è¯ï¼Œé‚£ä¹ˆJavaå †ä¸­å°†ä¼šåˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸º<strong>å¥æŸ„æ± </strong>ï¼Œreferenceä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸ç±»å‹æ•°æ®å„è‡ªçš„å…·ä½“åœ°å€ä¿¡æ¯ã€‚</p><p><img src="/2017/03/03/jvm-principle/ObjectHandlerAccess.png" alt></p><p>ä½¿ç”¨å¥æŸ„æ¥è®¿é—®çš„æœ€å¤§å¥½å¤„å°±æ˜¯referenceä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡è¢«ç§»åŠ¨ï¼ˆåƒåœ¾æ”¶é›†æ—¶ç§»åŠ¨å¯¹è±¡æ—¶éå¸¸æ™®éçš„è¡Œä¸ºï¼‰æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œreferenceæœ¬èº«ä¸éœ€è¦æ”¹å˜ã€‚</p><h3 id="2-ç›´æ¥æŒ‡é’ˆå¼è®¿é—®"><a href="#2-ç›´æ¥æŒ‡é’ˆå¼è®¿é—®" class="headerlink" title="2.ç›´æ¥æŒ‡é’ˆå¼è®¿é—®"></a>2.ç›´æ¥æŒ‡é’ˆå¼è®¿é—®</h3><p>å¦‚æœä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Œé‚£ä¹ˆJavaå †å¯¹è±¡çš„å¸ƒå±€ä¸­å°±å¿…é¡»è€ƒè™‘å¦‚ä½•æ”¾ç½®è®¿é—®ç±»å‹æ•°æ®çš„åœ°å€ä¿¡æ¯ï¼Œè€Œreferenceå­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡åœ°å€ã€‚</p><p><img src="/2017/03/03/jvm-principle/ObjectDirectPointerAccess.png" alt></p><p>ä½¿ç”¨ç›´æ¥åœ°å€è®¿é—®æ–¹å¼çš„æœ€å¤§å¥½å¤„å°±æ˜¯é€Ÿåº¦å¿«ï¼Œå®ƒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ï¼Œç”±äºå¯¹è±¡çš„è®¿é—®åœ¨Javaä¸­éå¸¸é¢‘ç¹ï¼Œå› æ­¤è¿™ç±»å¼€é”€ç§¯å°‘æˆå¤šåä¹Ÿæ˜¯ä¸€é¡¹éå¸¸å¯è§‚çš„æŒ‡å‘æˆæœ¬ã€‚å°±Hotspotè™šæ‹Ÿæœºè€Œè¨€ï¼Œå®ƒæ˜¯ä½¿ç”¨çš„ç¬¬äºŒç§æ–¹å¼è¿›è¡Œè®¿é—®çš„ã€‚</p><h2 id="äº”ã€å†…å­˜åŒºåŸŸæ§åˆ¶å‚æ•°åŠå¯¹åº”æº¢å‡ºå¼‚å¸¸"><a href="#äº”ã€å†…å­˜åŒºåŸŸæ§åˆ¶å‚æ•°åŠå¯¹åº”æº¢å‡ºå¼‚å¸¸" class="headerlink" title="äº”ã€å†…å­˜åŒºåŸŸæ§åˆ¶å‚æ•°åŠå¯¹åº”æº¢å‡ºå¼‚å¸¸"></a>äº”ã€å†…å­˜åŒºåŸŸæ§åˆ¶å‚æ•°åŠå¯¹åº”æº¢å‡ºå¼‚å¸¸</h2><p>åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒçš„æè¿°ä¸­ï¼Œé™¤äº†ç¨‹åºè®¡æ•°å™¨å¤–ï¼Œè™šæ‹Ÿæœºå†…å­˜çš„å…¶ä»–å‡ ä¸ªè¿è¡Œæ—¶æ•°æ®åŒºåŸŸéƒ½æœ‰å¯èƒ½å‘ç”ŸOutOfMemoryErrorå¼‚å¸¸ï¼ˆä»¥ä¸‹ç®€ç§°OOMï¼‰ã€‚</p><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­æˆ–ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ¯æ¬¡é‡åˆ°OOMå¼‚å¸¸æˆ–StackOverflowErrorå¼‚å¸¸æˆ–GCå¼‚å¸¸æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å¼‚å¸¸ä¿¡æ¯æ¥å¿«é€Ÿåˆ¤æ–­æ—¶å“ªä¸ªåŒºåŸŸçš„å¼‚å¸¸ï¼ŒçŸ¥é“æ€æ ·çš„ä»£ç å¯èƒ½ä¼šå¯¼è‡´è¿™äº›åŒºåŸŸçš„å¼‚å¸¸ï¼Œä»¥åŠå‡ºç°è¿™äº›å¼‚å¸¸åæ”¹æ€ä¹ˆå¤„ç†ã€‚ä¸‹é¢å°±æ¥ä»‹ç»ä¸€ä¸‹æ¯ä¸ªåŒºåŸŸå¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ã€å‘ç”Ÿå¼‚å¸¸çš„åœºæ™¯ä»¥åŠå†…å­˜åŒºåŸŸå¯¹è±¡çš„å‚æ•°ã€‚</p><h3 id="1-å †å†…å­˜"><a href="#1-å †å†…å­˜" class="headerlink" title="1.å †å†…å­˜"></a>1.å †å†…å­˜</h3><p>å¸¸ç”¨å‚æ•°ï¼š</p><ul><li><p>-Xmsï¼šå †æœ€å°å€¼</p></li><li><p>-Xmxï¼šå †æœ€å¤§å€¼</p></li><li><p>å…¶ä»–ï¼š-XX:+HeapDumpOnOutOfMemoeryErrorå¯ä»¥è®©è™šæ‹Ÿæœºåœ¨å‡ºç°å†…å­˜æº¢å‡ºå¼‚å¸¸æ—¶Dumpå½“å‰çš„å†…å­˜å †è½¬å‚¨å¿«ç…§ä¸€èˆ¬äº‹åè¿›è¡Œåˆ†æã€‚</p></li></ul><p>ä¾‹ï¼š-Xms128M -Xmx=128M</p><p>é€šå¸¸å°†-Xmxå’Œ-Xmsè®¾ç½®ä¸ºä¸€æ ·çš„å¤§å°æ¥å‡å°‘gcçš„æ¬¡æ•°ï¼Œå †å†…å­˜ä¸è¶³æ—¶æŠ›å‡ºOOMå¼‚å¸¸ã€‚</p><p>Javaå †å†…å­˜çš„OOMå¼‚å¸¸æ—¶å®é™…åº”ç”¨ä¸­å¸¸è§çš„å†…å­˜æº¢å‡ºå¼‚å¸¸æƒ…å†µã€‚å½“å‡ºç°Javaå †å†…å­˜æº¢å‡ºæ—¶ï¼Œå¼‚å¸¸å †æ ˆä¿¡æ¯â€œjava.lang.OutOfMemoryErrorâ€ä¼šè·Ÿç€è¿›ä¸€æ­¥æç¤ºâ€œJava heap spaceâ€ã€‚</p><p>è¦è§£å†³ç€åŒºåŸŸçš„å¼‚å¸¸ï¼Œä¸€èˆ¬çš„æ‰‹æ®µæ˜¯å…ˆé€šè¿‡å†…å­˜æ˜ åƒåˆ†æå·¥å…·ï¼ˆå¦‚Eclipse Memory Analyzerï¼‰å¯¹Dumpå‡ºæ¥çš„å †è½¬å‚¨å¿«ç…§è¿›è¡Œåˆ†æï¼Œé‡ç‚¹æ˜¯ç¡®è®¤å†…å­˜ä¸­çš„å¯¹è±¡æ˜¯å¦å¿…è¦çš„ï¼Œä¹Ÿå°±è¦å…ˆåˆ†æ¸…æ¥šåˆ°åº•æ˜¯å‡ºç°äº†å†…å­˜æ³„æ¼è¿˜æ˜¯å†…å­˜æº¢å‡ºã€‚</p><h3 id="2-æ ˆå†…å­˜ï¼ˆè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼‰"><a href="#2-æ ˆå†…å­˜ï¼ˆè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼‰" class="headerlink" title="2.æ ˆå†…å­˜ï¼ˆè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼‰"></a>2.æ ˆå†…å­˜ï¼ˆè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼‰</h3><p>å¸¸ç”¨å‚æ•°ï¼š-Xssï¼Œä¾‹å¦‚ï¼š-Xss128Kã€‚</p><p>å…³äºè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼Œåœ¨è™šæ‹Ÿæœºè§„èŒƒä¸­æè¿°äº†ä¸¤ç§å¼‚å¸¸ï¼š</p><ul><li><p>å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸æœ€å¤§æ·±åº¦ï¼Œå°†æŠ›å‡ºStackOverflowErrorå¼‚å¸¸ï¼›</p></li><li><p>å¦‚æœè™šæ‹Ÿæœºæ ˆåœ¨æ‰©å±•æ ˆæ˜¯æ— æ³•ç”³è¯·è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œåˆ™æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ï¼›</p></li></ul><h3 id="3-æ–¹æ³•åŒºå†…å­˜"><a href="#3-æ–¹æ³•åŒºå†…å­˜" class="headerlink" title="3.æ–¹æ³•åŒºå†…å­˜"></a>3.æ–¹æ³•åŒºå†…å­˜</h3><p>å¸¸ç”¨å‚æ•°ï¼š</p><ul><li><p>-XX:PermSizeæ–¹æ³•åŒºå†…å­˜æœ€å°å€¼</p></li><li><p>-XX:MaxPermSizeæ–¹æ³•åŒºå†…å­˜æœ€å¤§å€¼</p></li></ul><p>ä¾‹ï¼š-XX:PermSize=200M -XX:MaxPermSize=200M</p><p>å¼‚å¸¸ç±»å‹ï¼šOutOfMemoryError</p><p>å› ä¸ºæ–¹æ³•åŒºç”¨äºå­˜æ”¾åŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ï¼Œæ‰€ä»¥äº§ç”Ÿç±»è¿‡å¤šå°±å¯èƒ½å‡ºæ–¹æ³•åŒºå¼‚å¸¸å¼‚å¸¸ã€‚å½“å‰çš„å¾ˆå¤šæ¡†æ¶ï¼Œä¾‹å¦‚Springã€Hibernateï¼Œåœ¨å¤šç±»è¿›è¡Œå¢å¼ºæ—¶ï¼Œéƒ½ä¼šä½¿ç”¨CGLibå­—èŠ‚ç æŠ€æœ¯ï¼Œå¢å¼ºçš„ç±»è¶Šå¤šï¼Œå°±éœ€è¦è¶Šå¤§çš„æ–¹æ³•åŒºæ¥ä¿è¯åŠ¨æ€ç”Ÿæˆçš„Classå¯ä»¥åŠ è½½å…¥å†…å­˜ã€‚</p><h3 id="4-ç›´æ¥å†…å­˜"><a href="#4-ç›´æ¥å†…å­˜" class="headerlink" title="4.ç›´æ¥å†…å­˜"></a>4.ç›´æ¥å†…å­˜</h3><p>å¸¸ç”¨å‚æ•°ï¼š-XX:MaxDirectMemorySizeï¼Œä¾‹å¦‚ï¼š-XX:MaxDirectMemorySize=100Mã€‚å¦‚æœä¸æŒ‡å®šåˆ™ä¸å †çš„æœ€å¤§å€¼ç›¸åŒã€‚</p><p>å¼‚å¸¸ï¼šOutOfMemoryError</p><h2 id="å…­ã€åƒåœ¾æ”¶é›†ç®—æ³•"><a href="#å…­ã€åƒåœ¾æ”¶é›†ç®—æ³•" class="headerlink" title="å…­ã€åƒåœ¾æ”¶é›†ç®—æ³•"></a>å…­ã€åƒåœ¾æ”¶é›†ç®—æ³•</h2><h3 id="1-æ€ä¹ˆç¡®å®šå¯¹è±¡å¯è¢«å›æ”¶"><a href="#1-æ€ä¹ˆç¡®å®šå¯¹è±¡å¯è¢«å›æ”¶" class="headerlink" title="1.æ€ä¹ˆç¡®å®šå¯¹è±¡å¯è¢«å›æ”¶"></a>1.æ€ä¹ˆç¡®å®šå¯¹è±¡å¯è¢«å›æ”¶</h3><p>åœ¨å †é‡Œé¢å­˜æ”¾Javaä¸­å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ã€‚åƒåœ¾æ”¶é›†å™¨åœ¨å¯¹å †è¿›è¡Œå›æ”¶ä¹‹å‰ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯è¦ç¡®å®šè¿™äº›å¯¹è±¡ä¹‹ä¸­å“ªäº›è¿˜â€œå­˜æ´»â€ç€ï¼Œå“ªäº›å·²ç»â€œæ­»å»â€ã€‚</p><h4 id="å¼•ç”¨è®¡æ•°ç®—æ³•"><a href="#å¼•ç”¨è®¡æ•°ç®—æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°ç®—æ³•"></a>å¼•ç”¨è®¡æ•°ç®—æ³•</h4><p>ç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨å°±åŠ 1ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å€¼å°±å‡1ï¼›ä»»ä½•æ—¶åˆ»è®¡æ•°å™¨ä¸º0çš„å¯¹è±¡å°±æ˜¯ä¸èƒ½åœ¨ä½¿ç”¨çš„ã€‚</p><p>å®¢è§‚åœ°è¯´ï¼Œå¼•ç”¨è®¡æ•°ç®—æ³•çš„å®ç°å¾ˆç®€å•ï¼Œåˆ¤æ–­æ•ˆç‡ä¹Ÿå¾ˆé«˜ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹å®ƒéƒ½æ˜¯ä¸€ä¸ªä¸é”™çš„ç®—æ³•ï¼Œä¹Ÿæœ‰ä¸€äº›è‘—åçš„åº”ç”¨æ¡ˆä¾‹ã€‚ä½†æ˜¯ï¼Œè‡³å°‘ä¸»æµçš„Javaè™šæ‹Ÿæœºé‡Œé¢æ²¡æœ‰é€‰ç”¨å¼•ç”¨è®¡æ•°å™¨ç®—æ³•æ¥ç®¡ç†å†…å­˜ï¼Œå…¶ä¸­ä¸»è¦çš„åŸå› æ—¶å®ƒå¾ˆéš¾è§£å†³å¯¹è±¡ä¹‹é—´å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</p><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReferenceCountingGC</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span>  Object instance <span class="token operator">=</span> null<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1MB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * è¿™ä¸ªæˆå‘˜å±æ€§çš„å”¯ä¸€æ„ä¹‰å°±æ˜¯å ç‚¹å†…å­˜ï¼Œä»¥ä¾¿åœ¨GCæ—¥å¿—ä¸­çœ‹æƒ…å†µæ˜¯å¦å†…å›æ”¶è¿‡     */</span>    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bigSize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testGC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        ReferenceCountingGC objA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceCountingGC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ReferenceCountingGC objB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceCountingGC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        objA<span class="token punctuation">.</span>instance <span class="token operator">=</span> objB<span class="token punctuation">;</span>        objB<span class="token punctuation">.</span>instance <span class="token operator">=</span> objA<span class="token punctuation">;</span>        objA <span class="token operator">=</span> null<span class="token punctuation">;</span>        objB <span class="token operator">=</span> null<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//å‡è®¾è¿™è¡Œå‘ç”ŸGCï¼ŒobjAå’ŒobjBæ˜¯å¦èƒ½è¢«å›æ”¶ï¼Ÿ</span>        System<span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">testGC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>åœ¨ideaè®¾ç½®vmå‚æ•°ï¼Œè®©ç¨‹åºè¿è¡Œåæ‰“å°GCæ—¥å¿—ï¼Œâ€œ-Xms50M -Xmx100M -XX:+PrintGCDetails -Xloggc:./gc.logâ€</p><p><img src="/2017/03/03/jvm-principle/idea-vm-params.png" alt></p><p>åœ¨è¾“å‡ºçš„GCæ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°â€œ6679K-&gt;704Kâ€ï¼Œæ„å‘³ç€è™šæ‹Ÿæœºå¹¶æ²¡æœ‰å› ä¸ºè¿™ä¸¤ä¸ªå¯¹è±¡äº’ç›¸å¼•ç”¨å°±ä¸å›æ”¶å®ƒä»¬ï¼Œè¿™ä¹Ÿä»ä¾§é¢è¯´æ˜è™šæ‹Ÿæœºå¹¶ä¸æ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°ç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»çš„ã€‚</p><pre><code>0.188: [GC (System.gc()) [PSYoungGen: 6679K-&gt;704K(14848K)] 6679K-&gt;712K(49152K), 0.0010985 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 0.189: [Full GC (System.gc()) [PSYoungGen: 704K-&gt;0K(14848K)] [ParOldGen: 8K-&gt;596K(34304K)] 712K-&gt;596K(49152K), [Metaspace: 3074K-&gt;3074K(1056768K)], 0.0053940 secs] [Times: user=0.01 sys=0.00, real=0.01 secs] Heap PSYoungGen      total 14848K, used 256K [0x00000007bdf00000, 0x00000007bef80000, 0x00000007c0000000)  eden space 12800K, 2% used [0x00000007bdf00000,0x00000007bdf40190,0x00000007beb80000)  from space 2048K, 0% used [0x00000007beb80000,0x00000007beb80000,0x00000007bed80000)  to   space 2048K, 0% used [0x00000007bed80000,0x00000007bed80000,0x00000007bef80000) ParOldGen       total 34304K, used 596K [0x00000007b9c00000, 0x00000007bbd80000, 0x00000007bdf00000)  object space 34304K, 1% used [0x00000007b9c00000,0x00000007b9c953c8,0x00000007bbd80000) Metaspace       used 3086K, capacity 4496K, committed 4864K, reserved 1056768K  class space    used 335K, capacity 388K, committed 512K, reserved 1048576K</code></pre><h4 id="å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="å¯è¾¾æ€§åˆ†æç®—æ³•"></a>å¯è¾¾æ€§åˆ†æç®—æ³•</h4><p>åœ¨ä¸»æµçš„å•†ç”¨ç¨‹åºè¯­è¨€ï¼ˆJavaã€C#ï¼‰çš„ä¸»æµå®ç°ä¸­ï¼Œéƒ½æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†ææ¥åˆ¤å®šå¯¹è±¡æ˜¯å¦å­˜æ´»çš„ã€‚å¯è¾¾æ€§åˆ†æç®—æ³•çš„åŸºæœ¬æ€è·¯å°±æ˜¯é€šè¿‡ä¸€äº›åˆ—çš„ç§°ä¸ºâ€œGC Rootsâ€çš„å¯¹è±¡ä½œä¸ºèµ·å§‹ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼ˆReference Chainï¼‰ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼ˆç”¨å›¾ä¼¦çš„è¯æ¥è¯´ï¼Œå°±æ˜¯ä»GC Roots åˆ°è¿™ä¸ªå¯¹è±¡ä¸å¯è¾¾ï¼‰æ—¶ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ—¶ä¸å¯ç”¨çš„ã€‚ReachabilityAnalysis</p><p><img src="/2017/03/03/jvm-principle/ReachabilityAnalysis.png" alt></p><p>åœ¨Javaè¯­è¨€ä¸­ï¼Œå¯ä½œä¸ºGC Rootsçš„å¯¹è±¡åŒ…æ‹¬ä¸‹é¢4ç§ï¼š</p><ul><li><p>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ï¼›</p></li><li><p>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ï¼›</p></li><li><p>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼›</p></li><li><p>æœ¬åœ°æ–¹æ³•æ ˆä¸­ï¼ˆå³ä¸€èˆ¬è¯´çš„Nativeæ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡ã€‚</p></li></ul><p>åœ¨JDK1.2ä¹‹åï¼ŒJavaå¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œå°†å¼•ç”¨åˆ†ä¸º<strong>å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰</strong>ã€<strong>è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰</strong>ã€<strong>å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰</strong>ã€<strong>è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰</strong>4ç§ï¼Œè¿™4ç§å¼•ç”¨å¼ºåº¦ä¾æ¬¡é€æ¸å‡å¼±ã€‚</p><ul><li><p><strong>å¼ºå¼•ç”¨</strong>å°±æ˜¯æŒ‡åœ¨ç¨‹åºä»£ç ä¸­æ™®éå­˜åœ¨çš„ï¼Œç±»ä¼¼â€œObject obj = new Object()â€è¿™ç±»çš„å¼•ç”¨ï¼Œåªè¦å¼ºå¼•ç”¨è¿˜å­˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚</p></li><li><p><strong>è½¯å¼•ç”¨</strong>æ˜¯ç”¨æ¥æè¿°ä¸€äº›è¿˜æœ‰ç”¨ä½†å¹¶éå¿…éœ€çš„å¯¹è±¡ã€‚å¯¹äºè½¯å¼•ç”¨å…³è”ç€çš„å¯¹è±¡ï¼Œåœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œå°†ä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—è¿›å›æ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡Œç¬¬äºŒæ¬¡å›æ”¶ã€‚å¦‚æœè¿™æ¬¡å›æ”¶è¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚åœ¨JDK1.2ä¹‹åï¼Œæä¾›äº†SoftReferenceæ¥å®ç°è½¯å¼•ç”¨ã€‚</p></li><li><p><strong>å¼±å¼•ç”¨</strong>ä¹Ÿæ˜¯ç”¨æ¥æè¿°éå¿…éœ€å¯¹è±¡çš„ï¼Œä½†æ˜¯å®ƒçš„å¼ºåº¦æ¯”è½¯å¼•ç”¨è¿˜è¦å¼±ä¸€äº›ï¼Œè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†ä¹‹å‰ã€‚å½“åƒåœ¾æ”¶é›†å™¨å·¥ä½œæ—¶ï¼Œæ— è®ºå½“å‰å†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶æ‰åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚åœ¨JDK1.2ä¹‹åï¼Œæä¾›äº†WeakReferenceç±»æ¥å®ç°å¼±å¼•ç”¨ã€‚</p></li><li><p><strong>è™šå¼•ç”¨</strong>ä¹Ÿæˆä¸ºå¹½çµå¼•ç”¨æˆ–è™šå¹»å¼•ç”¨ï¼Œå®ƒæ˜¯æœ€å¼±çš„ä¸€ç§å¼•ç”¨å…³ç³»ã€‚ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´æ„æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥å–å¾—ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„å°±æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚åœ¨JDK1.2ä¹‹åï¼Œæä¾›äº†PhantomReferenceç±»æ¥å®ç°è™šå¼•ç”¨ã€‚</p></li></ul><h3 id="2-åƒåœ¾æ”¶é›†ç®—æ³•"><a href="#2-åƒåœ¾æ”¶é›†ç®—æ³•" class="headerlink" title="2.åƒåœ¾æ”¶é›†ç®—æ³•"></a>2.åƒåœ¾æ”¶é›†ç®—æ³•</h3><h4 id="æ ‡è®°-æ¸…é™¤ç®—æ³•"><a href="#æ ‡è®°-æ¸…é™¤ç®—æ³•" class="headerlink" title="æ ‡è®°-æ¸…é™¤ç®—æ³•"></a>æ ‡è®°-æ¸…é™¤ç®—æ³•</h4><p>æœ€åŸºç¡€çš„æ”¶é›†ç®—æ³•æ˜¯<strong>â€œæ ‡è®°-æ¸…é™¤â€ï¼ˆMark-Sweepï¼‰</strong>ç®—æ³•ï¼Œç®—æ³•åˆ†ä¸ºâ€œæ ‡è®°â€å’Œâ€œæ¸…é™¤â€ä¸¤ä¸ªé˜¶æ®µï¼šæ ‡è®°é˜¶æ®µï¼šé¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰€æœ‰æ ‡è®°çš„å¯¹è±¡ã€‚å…¶ä»–çš„æ”¶é›†ç®—æ³•éƒ½æ˜¯åŸºäºæ ‡è®°æ¸…é™¤ç®—æ³•åŸºç¡€ä¸Šè¿›è¡Œæ”¹è¿›å¾—åˆ°çš„ã€‚</p><p>ä¸»è¦ç¼ºç‚¹ï¼š</p><p>ä¸€ä¸ªæ˜¯æ•ˆç‡é—®é¢˜ï¼Œæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªè¿‡ç¨‹çš„æ•ˆç‡éƒ½ä¸é«˜ï¼›</p><p>å¦ä¸€ä¸ªæ˜¯ç©ºé—´é—®é¢˜ï¼Œæ ‡è®°æ¸…é™¤ä¹‹åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ã€‚</p><p><img src="/2017/03/03/jvm-principle/MarkSweep.png" alt></p><h4 id="å¤åˆ¶ç®—æ³•"><a href="#å¤åˆ¶ç®—æ³•" class="headerlink" title="å¤åˆ¶ç®—æ³•"></a>å¤åˆ¶ç®—æ³•</h4><p>ä¸ºäº†è§£å†³æ•ˆç‡é—®é¢˜ï¼Œä¸€ç§ç§°ä¸º<strong>â€œå¤åˆ¶â€ï¼ˆCopyingï¼‰</strong>çš„æ”¶é›†ç®—æ³•å‡ºç°äº†ï¼Œå®ƒå°†å¯ç”¨çš„å†…å­˜å®¹é‡åˆ’åˆ†å¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ã€‚å½“ç€ä¸€å—çš„å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠå·²ç»ä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚è¿™ç§ç®—æ³•çš„ä»£ä»·å°±æ˜¯å°†å†…å­˜ç¼©å°ä¸ºåŸç†çš„ä¸€åŠï¼Œæœªå…ä¹Ÿå¤ªé«˜äº†ä¸€ç‚¹ã€‚</p><p><img src="/2017/03/03/jvm-principle/Copying.png" alt></p><p>åœ¨å•†ç”¨çš„è™šæ‹Ÿä¸­ä½¿ç”¨è¯¥ç®—æ³•å›æ”¶æ–°ç”Ÿä»£ï¼Œç”±ç ”ç©¶è¡¨æ˜ï¼Œæ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡98%æ˜¯â€œæœç”Ÿå¤•æ­»â€çš„ï¼Œå¹¶ä¸éœ€è¦æŒ‰ç…§1:1çš„æ¯”ä¾‹æ¥åˆ’åˆ†å†…å­˜ï¼Œè€Œæ˜¯å°†å†…å­˜åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„<strong>Edenç©ºé—´</strong>å’Œä¸¤å—å°çš„<strong>Survivorç©ºé—´</strong>ï¼Œæ¯æ¬¡ä½¿ç”¨Edenå’Œå…¶ä¸­ä¸€å—Survivorã€‚å½“å›æ”¶æ—¶ï¼Œå°†Edenå’ŒSurvivorä¸­è¿˜å­˜æ´»ç€çš„å¯¹è±¡ä¸€æ¬¡æ€§åœ°å¤åˆ¶åˆ°å¦ä¸€å—Survivorç©ºé—´ä¸Šï¼Œæœ€åæ¸…ç†æ‰Edenå’Œåˆšæ‰ç”¨è¿‡çš„Survivorç©ºé—´ã€‚HotSpotè™šæ‹Ÿæœºé»˜è®¤Edenå’ŒSurvivorçš„å¤§å°æ¯”ä¾‹æ˜¯8:1ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡æ–°ç”Ÿä»£ä¸­å¯ç”¨å†…å­˜ç©ºé—´ä¸ºæ•´ä¸ªæ–°ç”Ÿä»£å®¹é‡çš„90%ï¼ˆ80%+10%ï¼‰ï¼Œåªæœ‰10%çš„å†…å­˜ä¼šè¢«â€œæµªè´¹â€ã€‚</p><p>å½“ç„¶98%çš„å¯¹è±¡å¯ä»¥å›æ”¶è¿™åªæ˜¯ä¸€èˆ¬åœºæ™¯ä¸‹çš„æ•°æ®ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•ä¿è¯æ¯æ¬¡å›æ”¶éƒ½åªæœ‰ä¸åˆ°10%çš„å¯¹è±¡å­˜æ´»ï¼Œå½“Survivorç©ºé—´ä¸å¤Ÿç”¨æ—¶ï¼Œéœ€è¦ä¾èµ–å…¶ä»–å†…å­˜ï¼ˆè¿™é‡ŒæŒ‡è€å¹´ä»£ï¼‰è¿›è¡Œåˆ†é…æ‹…ä¿ï¼ˆHandle Promotionï¼‰ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><p>æ¯”è¾ƒæ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œé¿å…äº†å›æ”¶é€ æˆçš„å†…å­˜ç¢ç‰‡ï¼›</p><p>ç¼ºç‚¹ï¼š</p><p>ä»¥ç‰ºç‰²ç©ºé—´ä¸ºä»£ä»·ï¼Œå¤åˆ¶ä¹Ÿæœ‰ä¸€å®šçš„æ•ˆç‡å’Œç©ºé—´æˆæœ¬ã€‚</p><h4 id="æ ‡è®°æ•´ç†ç®—æ³•"><a href="#æ ‡è®°æ•´ç†ç®—æ³•" class="headerlink" title="æ ‡è®°æ•´ç†ç®—æ³•"></a>æ ‡è®°æ•´ç†ç®—æ³•</h4><p>å‰é¢çš„è®²è§£çš„å¤åˆ¶ç®—æ³•åœ¨å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜æ—¶å°±éœ€è¦è¿›è¡Œå¤šæ¬¡çš„å¤åˆ¶æ“ä½œï¼Œæ•ˆç‡å°†ä¼šé™ä½ï¼Œæ›´å…³é”®çš„æ˜¯å¦‚æœä¸æƒ³æµªè´¹50%çš„ç©ºé—´ï¼Œå°±éœ€è¦æœ‰é¢å¤–çš„ç©ºé—´è¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œä»¥åº”å¯¹è¢«ä½¿ç”¨çš„çš„å†…å­˜ä¸­æ‰€ä»¥å¯¹è±¡éƒ½100%å­˜æ´»çš„æç«¯æƒ…å†µï¼Œæ‰€ä»¥åœ¨<strong>è€å¹´ä»£</strong>ä¸€èˆ¬ä¸ç›´æ¥é‡‡ç”¨è¿™ç§ç®—æ³•ã€‚</p><p>æ›´åŠ è€å¹´ä»£å¯¹è±¡å­˜æ´»ç‡é«˜çš„ç‰¹ç‚¹ï¼Œæœ‰äººæå‡ºäº†å¦å¤–ä¸€ç§â€œæ ‡è®°-æ•´ç†â€ï¼ˆMark-Compactï¼‰ç®—æ³•ï¼Œæ ‡è®°è¿‡ç¨‹ä»»ç„¶ä¸â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸€æ ·ï¼Œä½†åé¢æ­¥éª¤ä¸åœ¨æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯è®©æ‰€ä»¥å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</p><p><img src="/2017/03/03/jvm-principle/MarkCompact.png" alt></p><h4 id="åˆ†ä»£æ”¶é›†ç®—æ³•"><a href="#åˆ†ä»£æ”¶é›†ç®—æ³•" class="headerlink" title="åˆ†ä»£æ”¶é›†ç®—æ³•"></a>åˆ†ä»£æ”¶é›†ç®—æ³•</h4><p>å½“å‰å•†ä¸šè™šæ‹Ÿæœºçš„æ‡’è§‰æ”¶é›†éƒ½é‡‡ç”¨â€œåˆ†ä»£æ”¶é›†â€ï¼ˆGenerational Collectionï¼‰ç®—æ³•ï¼Œè¿™ç§ç®—æ³•å¹¶æ²¡æœ‰ä»€ä¹ˆæ–°çš„æ€æƒ³ï¼Œåªæ˜¯æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ã€‚ä¸€èˆ¬æŠŠå†…å­˜åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£2å—ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é‡‡ç”¨æœ€åˆé€‚çš„æ”¶é›†ç®—æ³•ã€‚åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡åƒåœ¾æ”¶é›†æ—¶éƒ½å‘ç°æœ‰å¤§é‡çš„å¯¹è±¡æ­»å»ï¼Œåªæœ‰å°‘é‡å­˜æ´»ï¼Œé‚£å°±é€‰ç”¨æˆ·<strong>å¤åˆ¶ç®—æ³•</strong>ã€‚è€Œè€å¹´ä»£ä¸­å› ä¸ºå¯¹è±¡å­˜æ´»ç‡é«˜ï¼Œæ²¡æœ‰é¢å¤–çš„ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œå°±å¿…é¡»ä½¿ç”¨â€œæ ‡è®°-æ¸…ç†â€æˆ–â€œæ ‡è®°-æ•´ç†â€ç®—æ³•æ¥è¿›è¡Œå›æ”¶ã€‚</p><h2 id="ä¸ƒã€åƒåœ¾æ”¶é›†å™¨"><a href="#ä¸ƒã€åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="ä¸ƒã€åƒåœ¾æ”¶é›†å™¨"></a>ä¸ƒã€åƒåœ¾æ”¶é›†å™¨</h2><p>Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å¯¹åƒåœ¾æ”¶é›†å™¨åº”è¯¥å¦‚ä½•å®ç°å¹¶æ²¡æœ‰ä»»ä½•è§„å®šï¼Œå› æ­¤ä¸åŒçš„å‚å•†ã€ä¸åŒç‰ˆæœ¬çš„è™šæ‹Ÿæœºæ‰€æä¾›çš„åƒåœ¾æ”¶é›†å™¨éƒ½å¯èƒ½ä¼šæœ‰å¾ˆå¤§å·®åˆ«ï¼Œå¹¶ä¸”ä¸€èˆ¬éƒ½ä¼šæä¾›å‚æ•°ä¾›ç”¨æˆ·æ ¹æ®è‡ªå·±çš„åº”ç”¨ç‰¹ç‚¹å’Œè¦æ±‚ç»„åˆå‡ºå„ä¸ªå¹´ä»£æ‰€ä½¿ç”¨çš„æ”¶é›†å™¨ã€‚</p><p><img src="/2017/03/03/jvm-principle/GarbageCollector.png" alt></p><h3 id="1-Serial-æ”¶é›†å™¨"><a href="#1-Serial-æ”¶é›†å™¨" class="headerlink" title="1.Serial æ”¶é›†å™¨"></a>1.Serial æ”¶é›†å™¨</h3><p>ç‰¹ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå¯ä»¥å’ŒSerial Oldã€CMSç»„åˆä½¿ç”¨ï¼›</p><p>ï¼ˆ2ï¼‰é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼›</p><p>ï¼ˆ3ï¼‰ä½¿ç”¨å•çº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå›æ”¶æ—¶ä¼šå¯¼è‡´Stop The Worldï¼Œç”¨æˆ·è¿›ç¨‹åœæ­¢ï¼›</p><p>ï¼ˆ4ï¼‰Clientæ¨¡å¼æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼›</p><p><img src="/2017/03/03/jvm-principle/Serial.png" alt></p><h3 id="2-ParNew-æ”¶é›†å™¨"><a href="#2-ParNew-æ”¶é›†å™¨" class="headerlink" title="2.ParNew æ”¶é›†å™¨"></a>2.ParNew æ”¶é›†å™¨</h3><p>ç‰¹ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå¯ä»¥å’ŒSerial Oldã€CMSç»„åˆä½¿ç”¨ï¼›</p><p>ï¼ˆ2ï¼‰é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼›</p><p>ï¼ˆ3ï¼‰ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå›æ”¶æ—¶ä¼šå¯¼è‡´Stop The Worldï¼Œå…¶å®ƒç­–ç•¥å’ŒSerialä¸€æ ·ï¼›</p><p>ï¼ˆ4ï¼‰è®¸å¤šè™šæ‹ŸæœºServeræ¨¡å¼çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼›</p><p><img src="/2017/03/03/jvm-principle/ParNew.png" alt></p><h3 id="3-Parallel-Scavenge-æ”¶é›†å™¨"><a href="#3-Parallel-Scavenge-æ”¶é›†å™¨" class="headerlink" title="3.Parallel Scavenge æ”¶é›†å™¨"></a>3.Parallel Scavenge æ”¶é›†å™¨</h3><p>ç‰¹ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå¯ä»¥å’ŒSerial Oldã€Parallelç»„åˆä½¿ç”¨ï¼Œä¸èƒ½å’ŒCMSç»„åˆä½¿ç”¨ï¼›</p><p>ï¼ˆ2ï¼‰é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼›</p><p>ï¼ˆ3ï¼‰ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå›æ”¶æ—¶ä¼šå¯¼è‡´Stop The Worldï¼›</p><p>ï¼ˆ4ï¼‰å…³æ³¨ååé‡ï¼Œååé‡=è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´/ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´+åƒåœ¾æ”¶é›†æ—¶é—´ï¼‰ï¼›</p><p><img src="/2017/03/03/jvm-principle/ParallelScavenge.png" alt></p><h3 id="4-Serial-Old-æ”¶é›†å™¨"><a href="#4-Serial-Old-æ”¶é›†å™¨" class="headerlink" title="4.Serial Old æ”¶é›†å™¨"></a>4.Serial Old æ”¶é›†å™¨</h3><p>ç‰¹ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰è€å¹´ä»£æ”¶é›†å™¨ï¼Œå¯ä»¥å’Œæ‰€æœ‰çš„å¹´è½»ä»£æ”¶é›†å™¨ç»„åˆä½¿ç”¨ï¼ŒSerialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼›</p><p>ï¼ˆ2ï¼‰æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œä¼šå¯¹åƒåœ¾å›æ”¶å¯¼è‡´çš„å†…å­˜ç¢ç‰‡è¿›è¡Œæ•´ç†ï¼›</p><p>ï¼ˆ3ï¼‰ä½¿ç”¨å•çº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå›æ”¶æ—¶ä¼šå¯¼è‡´Stop The Worldï¼Œç”¨æˆ·è¿›ç¨‹åœæ­¢ï¼›</p><p><img src="/2017/03/03/jvm-principle/SerialOld.png" alt></p><h3 id="5-Parallel-Old-æ”¶é›†å™¨"><a href="#5-Parallel-Old-æ”¶é›†å™¨" class="headerlink" title="5.Parallel Old æ”¶é›†å™¨"></a>5.Parallel Old æ”¶é›†å™¨</h3><p>ç‰¹ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰å¹´è€ä»£æ”¶é›†å™¨ï¼Œåªèƒ½å’ŒParallel Scavengeç»„åˆä½¿ç”¨ï¼ŒParallel Scavengeæ”¶é›†å™¨çš„å¹´è€ä»£ç‰ˆæœ¬ï¼ŒStop The Worldï¼›</p><p>ï¼ˆ2ï¼‰å¤šçº¿ç¨‹ï¼Œé‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œä¼šå¯¹åƒåœ¾å›æ”¶å¯¼è‡´çš„å†…å­˜ç¢ç‰‡è¿›è¡Œæ•´ç†ï¼›</p><p>ï¼ˆ3ï¼‰å…³æ³¨ååé‡çš„ç³»ç»Ÿå¯ä»¥å°†Parallel Scavenge + Parallel Oldç»„åˆä½¿ç”¨ï¼›</p><p><img src="/2017/03/03/jvm-principle/ParallelOld.png" alt></p><h3 id="6-CMS-æ”¶é›†å™¨"><a href="#6-CMS-æ”¶é›†å™¨" class="headerlink" title="6.CMS æ”¶é›†å™¨"></a>6.CMS æ”¶é›†å™¨</h3><p>ç‰¹ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰å¹´è€ä»£æ”¶é›†å™¨ï¼Œå¯ä»¥å’ŒSerialã€ParNewç»„åˆä½¿ç”¨ï¼›</p><p>ï¼ˆ2ï¼‰é‡‡ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®å‚æ•°åœ¨åƒåœ¾å›æ”¶æ—¶è¿›è¡Œå†…å­˜ç¢ç‰‡çš„æ•´ç†ï¼›</p><p>ï¼ˆ3ï¼‰CMSæ˜¯å¹¶å‘ç®—æ³•ï¼Œè¡¨ç¤ºåƒåœ¾å›æ”¶å’Œç”¨æˆ·è¿›è¡ŒåŒæ—¶è¿›è¡Œï¼Œä½†æ˜¯ä¸æ˜¯æ‰€æœ‰é˜¶æ®µéƒ½åŒæ—¶è¿›è¡Œï¼Œåœ¨åˆå§‹æ ‡è®°ã€é‡æ–°æ ‡è®°é˜¶æ®µè¿˜æ˜¯éœ€è¦Stop the Worldï¼›</p><p>ï¼ˆ4ï¼‰CMSåƒåœ¾å›æ”¶åˆ†è¿™å››ä¸ªé˜¶æ®µï¼Œä¸‰æ¬¡æ ‡è®°ä¸€æ¬¡å›æ”¶ï¼š</p><ul><li><p><strong>åˆå§‹æ ‡è®°</strong>ï¼ŒStop the Worldï¼Œæ ‡è®°ä¸€ä¸‹GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¿«ï¼›</p></li><li><p><strong>å¹¶å‘æ ‡è®°</strong>ï¼ŒGC Roots Tracingï¼Œæ—¶é—´é•¿ï¼Œä¸åœæ­¢ç”¨æˆ·è¿›ç¨‹ï¼›</p></li><li><p><strong>é‡æ–°æ ‡è®°</strong>ï¼ŒStop the Worldï¼Œä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œå¯¼è‡´æ ‡è®°å˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œæ—¶é—´é•¿ï¼Œä½†è¿œæ¯”å¹¶å‘æ ‡è®°æ—¶é—´çŸ­ï¼›</p></li><li><p><strong>å¹¶å‘æ¸…é™¤</strong>ï¼Œæ¸…é™¤çš„åŒæ—¶ç”¨æˆ·è¿›ç¨‹ä¼šå¯¼è‡´æ–°çš„åƒåœ¾ï¼Œæ—¶é—´é•¿ï¼›</p></li></ul><p>5ã€é€‚åˆäºå¯¹å“åº”æ—¶é—´è¦æ±‚é«˜çš„ç³»ç»Ÿï¼Œä»¥æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡ï¼›</p><p>ç¼ºç‚¹ï¼š</p><ul><li><p>å¯¹CPUèµ„æºéå¸¸æ•æ„Ÿï¼Œå¹¶å‘ä¸”ç»´æŠ¤ç”¨æˆ·è¿›ç¨‹çš„ä»£ä»·ï¼›</p></li><li><p>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼Œæ¸…é™¤æ—¶äº§ç”Ÿæ–°åƒåœ¾ï¼›</p></li><li><p>ç”±äºä½¿ç”¨æ ‡è®°æ¸…é™¤ï¼Œæ•…æœ‰ç©ºé—´ç¢ç‰‡ï¼›</p></li></ul><p><img src="/2017/03/03/jvm-principle/CMS.png" alt></p><h3 id="7-G1-æ”¶é›†å™¨"><a href="#7-G1-æ”¶é›†å™¨" class="headerlink" title="7.G1 æ”¶é›†å™¨"></a>7.G1 æ”¶é›†å™¨</h3><p>ç‰¹ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰å¹¶è¡Œå¹¶å‘ï¼Œä½¿ç”¨å¤šä¸ªCPUç¼©çŸ­STWçš„æ—¶é—´ï¼›</p><p>ï¼ˆ2ï¼‰åˆ†ä»£æ”¶é›†ï¼Œä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆä¹Ÿèƒ½ç‹¬ç«‹ç®¡ç†å †ï¼›</p><p>ï¼ˆ3ï¼‰ç©ºé—´æ•´åˆï¼Œæ•´ä½“åŸºäºæ ‡è®°æ•´ç†ç®—æ³•ï¼Œå±€éƒ¨ä¸¤ä¸ªRegionåŸºäºå¤åˆ¶ï¼›</p><p>ï¼ˆ4ï¼‰å¯é¢„æµ‹åœé¡¿ï¼Œå¯ä»¥æŒ‡å®šæ—¶é—´æ®µMå†…GCè¿‡ç¨‹æ—¶é—´ä¸è¶…è¿‡Nï¼›</p><p>ï¼ˆ5ï¼‰è¾ƒä½åœé¡¿ï¼Œåœé¡¿æ—¶é—´æ›´åŠ å¯æ§å¯é¢„æµ‹ï¼›</p><p>ç‰¹æ®Šç‚¹ï¼š</p><ul><li><p>æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†ç‰©ç†éš”ç¦»ï¼Œéƒ½æ˜¯ä¸€éƒ¨åˆ†Regionçš„é›†åˆï¼Œå°†å †åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„Regionï¼›</p></li><li><p>G1è·Ÿè¸ªå„ä¸ªRegionåƒåœ¾çš„ä»·å€¼å¤§å°ä»¥åŠå›æ”¶éœ€è¦æ—¶é—´ç»´æŠ¤ä¸€ä¸ªRegionä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„Regionï¼Œè¿™æ˜¯G1-Garbage Firståå­—çš„ç”±æ¥ï¼›</p></li></ul><p>G1è¿ä½œåˆ†å››ä¸ªé˜¶æ®µï¼Œä¸‰æ¬¡æ ‡è®°ä¸€æ¬¡å›æ”¶ï¼šåˆå§‹æ ‡è®°ï¼Œå¹¶å‘æ ‡è®°ï¼Œæœ€ç»ˆæ ‡è®°ï¼Œç­›é€‰å›æ”¶ï¼›</p><p><img src="/2017/03/03/jvm-principle/G1.png" alt></p><h3 id="åƒåœ¾æ”¶é›†å™¨å‚æ•°æ€»ç»“"><a href="#åƒåœ¾æ”¶é›†å™¨å‚æ•°æ€»ç»“" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨å‚æ•°æ€»ç»“"></a>åƒåœ¾æ”¶é›†å™¨å‚æ•°æ€»ç»“</h3><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>-XX:+UseSerialGC</td><td>è™šæ‹Ÿæœºè¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹çš„é»˜è®¤å€¼ï¼Œæ·»åŠ æ­¤é…ç½®åï¼Œä½¿ç”¨Serial+Serial Oldæ”¶é›†å™¨ç»„åˆè¿›è¡Œå†…å­˜å›æ”¶ã€‚</td></tr><tr><td>-XX:+UseParNewGC</td><td>æ·»åŠ æ­¤é…ç½®åï¼Œä½¿ç”¨ParNew+SerialOldæ”¶é›†å™¨ç»„åˆè¿›è¡Œå†…å­˜å›æ”¶ã€‚</td></tr><tr><td>-XX:+UseConcMarkSweepGC</td><td>æ·»åŠ æ­¤é…ç½®åï¼Œä½¿ç”¨ParNew+CMS+SerialOldæ”¶é›†å™¨ç»„åˆè¿›è¡Œå†…å­˜å›æ”¶ã€‚Serial Oldæ‰‹æœºå™¨ä½œä¸ºCMSæ”¶é›†å™¨Concurrent Mode Failureå¤±è´¥åçš„å¤‡ç”¨æ‰‹æœºå™¨ã€‚</td></tr><tr><td>-XX:+UseParallelGC</td><td>è™šæ‹Ÿæœºè¿è¡Œåœ¨Severæ¨¡å¼ä¸‹çš„é»˜è®¤å€¼ï¼Œæ·»åŠ æ­¤é…ç½®åï¼Œä½¿ç”¨Parallel  Scavenge  + Serial Oldï¼ˆPS MarkSweepï¼‰æ”¶é›†å™¨ç»„åˆè¿›è¡Œå†…å­˜å›æ”¶</td></tr><tr><td>-XX:+UseParallelOldGC</td><td>æ·»åŠ æ­¤é…ç½®åï¼Œä½¿ç”¨Parallel Scavenge + Parallel Oldæ”¶é›†å™¨è¿›è¡Œå†…å­˜å›æ”¶ã€‚</td></tr><tr><td>-XX:SurvivorRatio</td><td>æ–°ç”Ÿä»£ä¸­EdenåŒºåŸŸä¸SurvivoråŒºåŸŸçš„å®¹é‡æ¯”å€¼ï¼Œé»˜è®¤ä¸º8ï¼Œä»£è¡¨Eden:Survivor = 8:1</td></tr><tr><td>-XX:PretenureSizeThreshold</td><td>ç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¤§å°ï¼Œè®¾ç½®è¿™ä¸ªå‚æ•°åï¼Œå¤§äºè¿™ä¸ªå‚æ•°çš„å¯¹è±¡å°†ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…</td></tr><tr><td>-XX:MaxTenuringThreshold</td><td>æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¹´é¾„ã€‚æ¯ä¸ªå¯¹è±¡åœ¨åšæŒè¿‡ä¸€æ¬¡MinorGCä¹‹åï¼Œå¹´é¾„å°±å¢åŠ 1ï¼Œå½“è¶…è¿‡è¿™ä¸ªå‚æ•°å€¼æ˜¯å°±è¿›å…¥è€å¹´ä»£</td></tr><tr><td>-XX:UseAdaptiveSizePolicy</td><td>åŠ¨æ€è°ƒæ•´Javaå †ä¸­å„ä¸ªåŒºåŸŸçš„å¤§å°ä»¥åŠè¿›å…¥è€å¹´ä»£çš„å¹´é¾„</td></tr><tr><td>-XX:HandlePromotionFailure</td><td>æ˜¯å¦å…è®¸åˆ†é…æ‹…ä¿å¤±è´¥ï¼Œå³è€å¹´ä»£çš„å‰©ä½™ç©ºé—´ä¸è¶³ä»¥åº”å¯¹æ–°ç”Ÿä»£çš„æ•´ä¸ªEdenå’ŒSurvivoråŒºçš„æ‰€æœ‰å¯¹è±¡éƒ½å­˜æ´»çš„æç«¯æƒ…å†µ</td></tr><tr><td>-XX:ParalelGCThreads</td><td>è®¾ç½®å¹¶è¡ŒGCæ—¶è¿›è¡Œå†…å­˜å›æ”¶çš„çº¿ç¨‹æ•°</td></tr><tr><td>-XX:GCTimeRatio</td><td>GCæ—¶é—´å æ€»æ—¶é—´çš„æ¯”ç‡ï¼Œé»˜è®¤å€¼ä¸º99ï¼Œå³å…è®¸1%çš„GCæ—¶é—´ã€‚ä»…åœ¨ä½¿ç”¨Parallel Scavengeæ”¶é›†å™¨æ—¶ç”Ÿæ•ˆ</td></tr><tr><td>-XX:MaxGCPauseMillis</td><td>è®¾ç½®GCçš„æœ€å¤§åœé¡¿æ—¶é—´ã€‚ä»…åœ¨ä½¿ç”¨Parallel Scavengeæ”¶é›†å™¨æ—¶ç”Ÿæ•ˆ</td></tr><tr><td>-XX:CMSInitiatingOccupancyFraction</td><td>è®¾ç½®CMSæ”¶é›†å™¨åœ¨è€å¹´ä»£ç©ºé—´è¢«ä½¿ç”¨å¤šå°‘åè§¦å‘åƒåœ¾æ”¶é›†ã€‚é»˜è®¤å€¼ä¸º68%ï¼Œä»…åœ¨ä½¿ç”¨CMSæ”¶é›†å™¨æ—¶ç”Ÿæ•ˆ</td></tr><tr><td>-XX:UseCMSCompacatAtFullCollection</td><td>å®è´¨CMSæ”¶é›†å™¨åœ¨å®Œæˆåƒåœ¾æ”¶é›†åæ˜¯å¦è¦è¿›è¡Œä¸€æ¬¡å†…å­˜ç¢ç‰‡æ•´ç†ã€‚ä»…åœ¨ä½¿ç”¨CMSæ”¶é›†å™¨æ—¶ç”Ÿæ•ˆ</td></tr><tr><td>-XX:CMSFullGCsBeforeCompaction</td><td>è®¾ç½®CMSæ”¶é›†å™¨åœ¨è¿›è¡Œè‹¥å¹²æ¬¡åƒåœ¾æ”¶é›†åå†å¯åŠ¨ä¸€æ¬¡å†…å­˜ç¢ç‰‡æ•´ç†ã€‚ä»…åœ¨ä½¿ç”¨CMSæ”¶é›†å™¨æ—¶ç”Ÿæ•ˆ</td></tr></tbody></table><p>å…¶ä»–å‚æ•°ï¼š</p><p>-verbose:gcæˆ–è€…-XX:+PrintGCï¼Œè·å–gcä¿¡æ¯</p><p>-XX:+PrintGCDetailsï¼Œè·å–æ›´åŠ çº¤ç»†çš„gcä¿¡æ¯</p><p>-XX:+PrintGCTimeStampsï¼Œ è·å–GCçš„é¢‘ç‡å’Œé—´éš”</p><p>-XX:+PrintHeapAtGCï¼Œè·å–å †çš„ä½¿ç”¨æƒ…å†µ</p><p>-XXloggc:D:\gc.logï¼ŒæŒ‡å®šGCæ—¥å¿—çš„ä¿å­˜è·¯å¾„</p><h3 id="è°ƒä¼˜ç­–ç•¥"><a href="#è°ƒä¼˜ç­–ç•¥" class="headerlink" title="è°ƒä¼˜ç­–ç•¥"></a>è°ƒä¼˜ç­–ç•¥</h3><ul><li><strong>å¯¹è±¡ä¼˜å…ˆåœ¨æ–°ç”Ÿä»£EdenåŒºåŸŸåˆ†é…</strong>ï¼šç”±äºFullGC/MajorGCï¼ˆå‘ç”Ÿåœ¨è€å¹´ä»£ï¼‰ï¼Œæˆæœ¬è¿œæ¯”MinorGCï¼ˆå‘ç”Ÿåœ¨æ–°ç”Ÿä»£ï¼‰è¦å¤§çš„å¤šï¼Œæ‰€ä»¥ç»™åº”ç”¨åˆ†é…ä¸€ä¸ªåˆç†çš„æ–°ç”Ÿä»£ç©ºï¼Œå°½é‡å°†å¯¹è±¡ä¼˜å…ˆåˆ†é…åˆ°æ–°ç”Ÿä»£ï¼Œå‡å°‘Full GCçš„é¢‘ç‡ã€‚</li><li><strong>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</strong>ï¼šå°†å¤§å¯¹è±¡ï¼ˆä¾‹å¦‚é•¿å­—ç¬¦ä¸²ä»¥åŠæ•°ç»„ï¼‰ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼Œä¿æŒæ–°ç”Ÿä»£å¯¹è±¡çš„ç»“æ„çš„å®Œæ•´è¡Œï¼Œä»¥æé«˜GCæ•ˆç‡ã€‚å¯ä»¥é€šè¿‡-XX:PretenureSizeThresholdå‚æ•°è®¾ç½®å¯¹è±¡è¿›å…¥è€å¹´ä»£çš„é˜€å€¼ã€‚</li><li><strong>é•¿æœŸå­˜æ´»çš„å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</strong>ï¼šå¯¹è±¡æ™‹å‡è€å¹´ä»£çš„å¹´é¾„é˜€å€¼ï¼Œå¯ä»¥é€šè¿‡å‚æ•°-XX:MaxTenuringThresholdæ¥è®¾ç½®ã€‚</li><li><strong>ç¨³å®šçš„å †å¤§å°</strong>ï¼šç¨³å®šçš„å †å¤§å°æ—¶å¯¹åƒåœ¾å›æ”¶æœ‰åˆ©çš„ï¼ŒæŠŠ-Xmså’Œ-Xmxçš„å¤§å°è®¾ç½®ä¸€è‡´ã€‚</li><li><strong>æ›´åŠ æƒ…å†µé€‰æ‹©åˆé€‚çš„æ”¶é›†å™¨</strong>ï¼šååé‡ä¼˜å…ˆï¼Œå°½å¯èƒ½å‡å°‘ç³»ç»Ÿæ‰§è¡Œåƒåœ¾å›æ”¶çš„æ€»æ—¶é—´ï¼Œæ•…é‡‡ç”¨å¹¶è¡Œæ”¶é›†å™¨ï¼›ä½åœé¡¿ï¼šä½¿ç”¨CMSæ”¶é›†å™¨ï¼ŒåŒæ—¶å‡å°‘Full GCçš„æ¬¡æ•°ã€‚</li></ul><h2 id="å…«ã€ç›‘æ§å·¥å…·"><a href="#å…«ã€ç›‘æ§å·¥å…·" class="headerlink" title="å…«ã€ç›‘æ§å·¥å…·"></a>å…«ã€ç›‘æ§å·¥å…·</h2><h3 id="1-JDKå‘½ä»¤è¡Œå·¥å…·"><a href="#1-JDKå‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="1.JDKå‘½ä»¤è¡Œå·¥å…·"></a>1.JDKå‘½ä»¤è¡Œå·¥å…·</h3><p>Sun JDK ç›‘æ§ä¸æ•…éšœå¤„ç†å·¥å…·</p><table><thead><tr><th>åç§°</th><th>ä¸»è¦ä½œç”¨</th></tr></thead><tbody><tr><td>jps</td><td>JVM Process Status Toolï¼Œæ˜¾ç¤ºæŒ‡å®šç³»ç»Ÿå†…æ‰€æœ‰çš„è™šæ‹Ÿæœºè¿›ç¨‹</td></tr><tr><td>jstat</td><td>JVM Statistics Monitoring Toolï¼Œç”¨äºæ”¶é›†è™šæ‹Ÿæœºå„æ–¹é¢çš„è¿è¡Œæ•°æ®</td></tr><tr><td>jinfo</td><td>Configuration Info for Javaï¼Œæ˜¾ç¤ºè™šæ‹Ÿæœºé…ç½®ä¿¡æ¯</td></tr><tr><td>jmap</td><td>Memory Map for Javaï¼Œç”Ÿæˆè™šæ‹Ÿæœºçš„å†…å­˜è½¬å‚¨å¿«ç…§ï¼ˆheapdumpæ–‡ä»¶ï¼‰</td></tr><tr><td>jhat</td><td>JVM Heap Dump Browserï¼Œç”¨äºåˆ†æheap dumpæ–‡ä»¶ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªhttpæœåŠ¡å™¨ï¼Œè®©ç”¨æˆ·å¯ä»¥åœ¨æµè§ˆå™¨ä¸ŠæŸ¥çœ‹åˆ†æç»“æœ</td></tr><tr><td>jstack</td><td>Stack Trace for Javaï¼Œæ˜¾ç¤ºè™šæ‹Ÿæœºçº¿ç¨‹æ ˆå¿«ç…§</td></tr></tbody></table><h4 id="ï¼ˆ1ï¼‰jps"><a href="#ï¼ˆ1ï¼‰jps" class="headerlink" title="ï¼ˆ1ï¼‰jps"></a>ï¼ˆ1ï¼‰jps</h4><p>JDKçš„å¾ˆå¤šå°å·¥å…·çš„åå­—éƒ½æ˜¯å‚è€ƒäº†UNIXå‘½ä»¤çš„å‘½åæ–¹å¼ï¼Œ<strong>jpsï¼ˆJVM Process Status Toolï¼‰</strong>æ˜¯å…¶ä¸­çš„å…¸å‹ã€‚å®ƒçš„åŠŸèƒ½å’Œpså‘½ä»¤ç±»ä¼¼ï¼Œå¯ä»¥åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„è™šæ‹Ÿæœºè¿›ç¨‹ï¼Œå¹¶æ˜¾ç¤ºè™šæ‹Ÿæœºæ‰§è¡Œä¸»ç±»ï¼ˆMain Classï¼Œmain()å‡½æ•°æ‰€åœ¨çš„ç±»ï¼‰åç§°ä»¥åŠè¿™äº›è¿›ç¨‹çš„å”¯ä¸€IDï¼ˆLocal Virtual Machine Identifierï¼ŒLVMIDï¼‰ã€‚</p><p><strong>å‘½ä»¤æ ¼å¼ï¼šjps [options] [hostid]</strong></p><p><strong>jpså·¥å…·ä¸»è¦é€‰é¡¹</strong></p><table><thead><tr><th>é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-q</td><td>åªè¾“å‡ºLVMIDï¼Œçœç•¥ä¸»ç±»çš„åç§°</td></tr><tr><td>-m</td><td>è¾“å‡ºè™šæ‹Ÿæœºè¿›ç¨‹å¯åŠ¨æ—¶ä¼ é€’ç»™ä¸»ç±»main()æ–¹æ³•çš„å‚æ•°</td></tr><tr><td>-l</td><td>è¾“å‡ºä¸»ç±»çš„å…¨åï¼Œå¦‚æœè¿›ç¨‹æ‰§è¡Œçš„æ˜¯JaråŒ…ï¼Œè¾“å‡ºJarè·¯å¾„</td></tr><tr><td>-v</td><td>è¾“å‡ºè™šæ‹Ÿæœºè¿›ç¨‹å¯åŠ¨æ—¶JVMå‚æ•°</td></tr></tbody></table><h4 id="ï¼ˆ2ï¼‰jstat"><a href="#ï¼ˆ2ï¼‰jstat" class="headerlink" title="ï¼ˆ2ï¼‰jstat"></a>ï¼ˆ2ï¼‰jstat</h4><p>jstatï¼ˆJVM Statistics Monitoring Toolï¼‰æ˜¯ç”¨äºç›‘æ§è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒå¯ä»¥æ˜¾ç¤ºæœ¬åœ°æˆ–åŸåˆ›è™šæ‹Ÿæœºä¸­çš„ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JITç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ï¼Œåœ¨æ²¡æœ‰GUIå›¾å½¢ç•Œé¢çš„æœåŠ¡å™¨ä¸Šï¼Œå®ƒæ˜¯é¦–é€‰çš„ä¸€æ¬¾ç›‘æ§å·¥å…·ã€‚</p><p>å‘½ä»¤æ ¼å¼ï¼šjstat [ option  vmid  [interval  [s|ms]  [count]] ]</p><p>å‘½ä»¤æ ¼å¼è§£é‡Šï¼šjstat ç›‘æ§å†…å®¹ çº¿ç¨‹å· æ—¶é—´é—´éš” æ¬¡æ•°</p><p>ä¾‹å¦‚ï¼šjstat -gc 2045 1 20ï¼Œæ¯1ç§’æŸ¥è¯¢ä¸€æ¬¡è¿›ç¨‹2045çš„åƒåœ¾æ”¶é›†çŠ¶å†µï¼Œä¸€å…±æ‰§è¡Œ20æ¬¡ã€‚</p><p>jstatå·¥å…·ä¸»è¦é€‰é¡¹</p><table><thead><tr><th>é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-class</td><td>ç›‘è§†ç±»è£…è½½ã€å¸è½½æ•°é‡ä»¥åŠç±»çš„è£…è½½æ€»ç©ºé—´å’Œè€—è´¹æ—¶é—´</td></tr><tr><td>-gc</td><td>ç›‘è§†Javaå †çŠ¶å†µï¼ŒåŒ…æ‹¬EdenåŒºã€ä¸¤ä¸ªSurvivoråŒºã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ç­‰çš„å®¹é‡ã€å·²ç”¨ç©ºé—´ã€GCæ—¶é—´å’Œæœºç­‰ä¿¡æ¯</td></tr><tr><td>-gccapacity</td><td>ç›‘è§†å†…å®¹ä¸-gcåŸºæœ¬ç›¸åŒï¼Œä½†è¾“å‡ºä¸»è¦å…³æ³¨Javaå †å„ä¸ªåŒºåŸŸä½¿ç”¨åˆ°çš„æœ€å¤§å’Œæœ€å°ç©ºé—´</td></tr><tr><td>-gcutil</td><td>ç›‘è§†å†…å®¹ä¸-gcåŸºæœ¬ç›¸åŒï¼Œä½†è¾“å‡ºä¸»è¦å…³æ³¨å·²ä½¿ç”¨ç©ºé—´å æ€»ç©ºé—´çš„ç™¾åˆ†æ¯”</td></tr><tr><td>-gccause</td><td>ä¸-gcutilåŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯ä¼šé¢å¤–è¾“å‡ºå¯¼è‡´ä¸Šä¸€æ¬¡GCäº§ç”Ÿçš„åŸå› </td></tr><tr><td>-gcnew</td><td>ç›‘æ§æ–°ç”Ÿä»£GCçŠ¶å†µ</td></tr><tr><td>-gcnewcapacity</td><td>ç›‘è§†å†…å®¹ä¸-gcnewåŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºä¸»è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§å’Œæœ€å°ç©ºé—´</td></tr><tr><td>-gcold</td><td>ç›‘æ§è€å¹´ä»£GCçŠ¶å†µ</td></tr><tr><td>-gcoldcapacity</td><td>ç›‘è§†å†…å®¹ä¸-gcoldåŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºä¸»è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§å’Œæœ€å°ç©ºé—´</td></tr><tr><td>-gcpermcapacity</td><td>è¾“å‡ºæ°¸ä¹…ä»£ä½¿ç”¨çš„æœ€å¤§å’Œæœ€å°ç©ºé—´</td></tr><tr><td>-compiler</td><td>è¾“å‡ºJITç¼–è¯‘å™¨ç¼–è¯‘è¿‡çš„æ–¹æ³•ã€è€—æ—¶ä¿¡æ¯</td></tr><tr><td>-printcompilation</td><td>è¾“å‡ºå·²ç»è¢«JITç¼–è¯‘çš„æ–¹æ³•</td></tr></tbody></table><h4 id="ï¼ˆ3ï¼‰jinfo"><a href="#ï¼ˆ3ï¼‰jinfo" class="headerlink" title="ï¼ˆ3ï¼‰jinfo"></a>ï¼ˆ3ï¼‰jinfo</h4><p>jinfoï¼ˆConfiguration Info for Javaï¼‰çš„ä½œç”¨æ˜¯å®æ—¶åœ°æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºå„é¡¹å‚æ•°ä¿¡æ¯ã€‚ä½¿ç”¨jinfo -v å¯ä»¥æŸ¥çœ‹è™šæ‹Ÿæœºå¯åŠ¨æ—¶æ˜¾å¼æŒ‡å®šçš„å‚æ•°åˆ—è¡¨ï¼Œä½†æ˜¯å¦‚æœæƒ³çŸ¥é“æœªè¢«æ˜¾å¼æŒ‡å®šçš„å‚æ•°çš„ç³»ç»Ÿé»˜è®¤å€¼ï¼Œå¯ä»¥ä½¿ç”¨â€jinfo -flag å‚æ•°å çº¿ç¨‹IDâ€  è¿›è¡ŒæŸ¥è¯¢ã€‚</p><p>å‘½ä»¤æ ¼å¼ï¼š</p><p>jinfo [ option ] pid</p><p>ä¾‹å¦‚ï¼šjinfo -flag CMSInitiatingOccupancyFraction 9668ï¼Œè¾“å‡º -XX:CMSInitiatingOccupancyFraction=-1</p><h4 id="ï¼ˆ4ï¼‰jmap"><a href="#ï¼ˆ4ï¼‰jmap" class="headerlink" title="ï¼ˆ4ï¼‰jmap"></a>ï¼ˆ4ï¼‰jmap</h4><p>jmapï¼ˆMemory Map for Javaï¼‰å‘½ä»¤ç”¨äºç”Ÿæˆè½¬å‚¨å¿«ç…§ï¼ˆheapdumpï¼‰ã€‚å¦‚æœä¸ä½¿ç”¨jmapå‘½ä»¤ï¼Œè¦æƒ³è·å–Javaå †è½¬å‚¨å¿«ç…§ï¼Œè¿˜æœ‰ä¸€äº›æ¯”è¾ƒâ€œæš´åŠ›â€çš„æ–¹å¼ï¼Œè­¬å¦‚ï¼š</p><ul><li><p>é€šè¿‡JVMå¯åŠ¨æ—¶åŠ å…¥å¯åŠ¨å‚æ•°-XX:HeapDumpOutOfMemoryErrorå‚æ•°ï¼Œå¯ä»¥è®©JVMåœ¨å‡ºç°å†…å­˜æº¢å‡ºå¼‚å¸¸æ—¶è‡ªåŠ¨ç”Ÿæˆdumpæ–‡ä»¶ï¼›</p></li><li><p>ä¹Ÿå¯ä»¥é€šè¿‡-XX:HeapDumpOnCtrlBreakå‚æ•°ï¼Œåˆ™åœ¨è¿è¡Œæ—¶å¯ä»¥ä½¿ç”¨ctrl + breaké”®è®©è™šæ‹Ÿæœº ç”Ÿæˆdumpæ–‡ä»¶ï¼›</p></li><li><p>åˆæˆ–è€…åœ¨Linuxç³»ç»Ÿä¸‹é€šè¿‡Kill -3å‘½ä»¤å‘é€è¿›ç¨‹é€€å‡ºä¿¡å·â€œå“å”¬â€ä¸€ä¸‹è™šæ‹Ÿæœºä¹Ÿèƒ½è·å–dumpæ–‡ä»¶ã€‚    </p></li></ul><p>jmapä½œç”¨ä¸ä»…ä»…æ˜¯ä¸ºäº†è·å–dumpæ–‡ä»¶ï¼Œè¿˜å¯ä»¥ç”¨äºæŸ¥è¯¢finalizeæ‰§è¡Œé˜Ÿåˆ—ã€Javaå †å’Œæ°¸ä¹…ä»£çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ç©ºé—´ä½¿ç”¨ç‡ã€å½“å‰ä½¿ç”¨çš„æ˜¯å“ªç§åƒåœ¾æ”¶é›†å™¨ã€‚</p><p>å‘½ä»¤æ ¼å¼ï¼š</p><p>jmap [ option ] vmid</p><p>ä¾‹å¦‚ï¼šjmap -dump:format=b,file=eclipse.dum 1234</p><p>jmapå·¥å…·ä¸»è¦é€‰é¡¹</p><table><thead><tr><th>é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-dump</td><td>ç”ŸæˆJavaå †è½¬å‚¨å¿«ç…§ï¼Œæ ¼å¼ä¸ºï¼š-dump:[live, ]format=b, file=<filename>,å…¶ä¸­liveå­å‚æ•°è¯´æ˜æ˜¯å¦åªdumpå‡ºå­˜æ´»çš„å¯¹è±¡</filename></td></tr><tr><td>-finalizerinfo</td><td>æ˜¾ç¤ºåœ¨F-Queueä¸­ç­‰å¾…çš„Finalizerçº¿ç¨‹æ‰§è¡Œfinalizeæ–¹æ³•çš„å¯¹è±¡ï¼ˆåªåœ¨Linux/Solariså¹³å°ä¸‹æœ‰æ•ˆï¼‰</td></tr><tr><td>-heap</td><td>æ˜¾ç¤ºJavaå †è¯¦ç»†ä¿¡æ¯ï¼Œä¹³æ²Ÿä½¿ç”¨å“ªç§å›æ”¶å™¨ã€å‚æ•°é…ç½®ã€åˆ†ä»£è¯¦æƒ…ç­‰ï¼ˆåªåœ¨Linux/solariså¹³å°ä¸‹æœ‰æ•ˆï¼‰</td></tr><tr><td>-histo</td><td>æ˜¾ç¤ºå †æ ˆä¸­çš„å¯¹è±¡çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…å«ç±»ã€å®ä¾‹æ•°é‡å’Œåˆè®¡å®¹é‡</td></tr><tr><td>-permstat</td><td>ä»¥ClassLoaderä¸ºç»Ÿè®¡å£å¾„æ˜¾ç¤ºæ°¸ä¹…ä»£å†…å­˜çŠ¶æ€ï¼ˆåªåœ¨Linux/Solariså¹³å°ä¸‹æœ‰æ•ˆï¼‰</td></tr><tr><td>-F</td><td>å½“è™šæ‹Ÿæœºè¿›ç¨‹å¯¹-dumpé€‰é¡¹æ²¡æœ‰å“åº”æ—¶ï¼Œå¯ä»¥ç”¨è¿™ä¸ªé€‰é¡¹å¼ºåˆ¶ç”Ÿæˆdumpå¿«ç…§ï¼ˆåªåœ¨Linux/Solariså¹³å°ä¸‹æœ‰æ•ˆï¼‰</td></tr></tbody></table><h4 id="ï¼ˆ5ï¼‰jstack"><a href="#ï¼ˆ5ï¼‰jstack" class="headerlink" title="ï¼ˆ5ï¼‰jstack"></a>ï¼ˆ5ï¼‰jstack</h4><p>jstackï¼ˆStack Trace for Javaï¼‰å‘½ä»¤ç”¨äºèº«æè™šæ‹Ÿæœºå½“å‰æ—¶é—´çš„çº¿ç¨‹å¿«ç…§ï¼ˆä¸€èˆ¬ç§°ä¸ºthreaddumpæˆ–è€…javacoreæ–‡ä»¶ï¼‰ã€‚çº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆï¼Œç”Ÿæˆçº¿ç¨‹å¿«ç…§ä¸»è¦ç›®çš„æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´ç­‰å¾…éƒ½æ˜¯å¯¼è‡´çº¿ç¨‹é•¿æ—¶é—´åœé¡¿çš„å¸¸è§åŸå› ã€‚é€šè¿‡jstackæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“å“ªäº›è¿›ç¨‹åœ¨åå°åšäº›ä»€ä¹ˆï¼Œåœ¨ç­‰å¾…ä»€ä¹ˆèµ„æºã€‚</p><p>å‘½ä»¤æ ¼å¼ï¼š</p><p>jstack [ option ] vmid</p><p>jstackå·¥å…·ä¸»è¦é€‰é¡¹</p><table><thead><tr><th>é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-F</td><td>å½“æ­£å¸¸è¾“å‡ºçš„è¯·æ±‚ä¸è¢«å“åº”æ—¶ï¼Œå¼ºåˆ¶è¾“å‡ºçº¿ç¨‹å †æ ˆ</td></tr><tr><td>-l</td><td>é™¤å †æ ˆå¤–ï¼Œæ˜¾ç¤ºå…³äºé”çš„é™„åŠ ä¿¡æ¯</td></tr><tr><td>-m</td><td>æ˜¾ç¤ºnativeæ–¹æ³•çš„å †æ ˆä¿¡æ¯</td></tr></tbody></table><h4 id="ï¼ˆ6ï¼‰jhat"><a href="#ï¼ˆ6ï¼‰jhat" class="headerlink" title="ï¼ˆ6ï¼‰jhat"></a>ï¼ˆ6ï¼‰jhat</h4><p>Sun JDKæä¾›jhat(JVM Heap Analysis Tool)å‘½ä»¤ä¸jmapæ­é…ä½¿ç”¨ï¼Œæ¥åˆ†æjmapç”Ÿæˆçš„å †æ ˆè½¬å‚¨å¿«ç…§ã€‚jhatå†…ç½®äº†ä¸€ä¸ªå¾®å‹çš„HTTP/HTMLæœåŠ¡å™¨ï¼Œç”Ÿæˆdumpæ–‡ä»¶çš„åˆ†æç»“æœåï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚</p><h3 id="2-JDKå¯è§†åŒ–å·¥å…·"><a href="#2-JDKå¯è§†åŒ–å·¥å…·" class="headerlink" title="2.JDKå¯è§†åŒ–å·¥å…·"></a>2.JDKå¯è§†åŒ–å·¥å…·</h3><h4 id="ï¼ˆ1ï¼‰jconsole"><a href="#ï¼ˆ1ï¼‰jconsole" class="headerlink" title="ï¼ˆ1ï¼‰jconsole"></a>ï¼ˆ1ï¼‰jconsole</h4><h4 id="ï¼ˆ2ï¼‰jvisualvm"><a href="#ï¼ˆ2ï¼‰jvisualvm" class="headerlink" title="ï¼ˆ2ï¼‰jvisualvm"></a>ï¼ˆ2ï¼‰jvisualvm</h4><p><em>æ–‡ç« å†…å®¹ä¸»è¦æ‘˜è‡ªã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº-JVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µã€‹</em></p>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> Javaè™šæ‹Ÿæœº </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
